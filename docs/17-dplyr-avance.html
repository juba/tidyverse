<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Partie 17 dplyr avancé | Introduction à R et au tidyverse</title>
  <meta name="description" content="Une introduction à R et aux extensions du tidyverse" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Partie 17 dplyr avancé | Introduction à R et au tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Une introduction à R et aux extensions du tidyverse" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Partie 17 dplyr avancé | Introduction à R et au tidyverse" />
  
  <meta name="twitter:description" content="Une introduction à R et aux extensions du tidyverse" />
  

<meta name="author" content="Julien Barnier" />


<meta name="date" content="2021-10-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="16-boucles-if.html"/>
<link rel="next" href="18-purrr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Introduction à R et au <em>tidyverse</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>À propos de ce document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01-presentation.html"><a href="01-presentation.html"><i class="fa fa-check"></i><b>1</b> Présentation</a><ul>
<li class="chapter" data-level="1.1" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-de-r"><i class="fa fa-check"></i><b>1.1</b> À propos de R</a></li>
<li class="chapter" data-level="1.2" data-path="01-presentation.html"><a href="01-presentation.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> À propos de RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-du-tidyverse"><i class="fa fa-check"></i><b>1.3</b> À propos du <em>tidyverse</em></a></li>
<li class="chapter" data-level="1.4" data-path="01-presentation.html"><a href="01-presentation.html#structure-du-document"><i class="fa fa-check"></i><b>1.4</b> Structure du document</a></li>
<li class="chapter" data-level="1.5" data-path="01-presentation.html"><a href="01-presentation.html#prérequis"><i class="fa fa-check"></i><b>1.5</b> Prérequis</a></li>
</ul></li>
<li class="part"><span><b>I Introduction à R</b></span></li>
<li class="chapter" data-level="2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html"><i class="fa fa-check"></i><b>2</b> Prise en main</a><ul>
<li class="chapter" data-level="2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#la-console"><i class="fa fa-check"></i><b>2.1</b> La console</a><ul>
<li class="chapter" data-level="2.1.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#linvite-de-commandes"><i class="fa fa-check"></i><b>2.1.1</b> L’invite de commandes</a></li>
<li class="chapter" data-level="2.1.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#précisions-concernant-la-saisie-des-commandes"><i class="fa fa-check"></i><b>2.1.2</b> Précisions concernant la saisie des commandes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets"><i class="fa fa-check"></i><b>2.2</b> Objets</a><ul>
<li class="chapter" data-level="2.2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets-simples"><i class="fa fa-check"></i><b>2.2.1</b> Objets simples</a></li>
<li class="chapter" data-level="2.2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#introvecteurs"><i class="fa fa-check"></i><b>2.2.2</b> Vecteurs</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#fonctions"><i class="fa fa-check"></i><b>2.3</b> Fonctions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#principe"><i class="fa fa-check"></i><b>2.3.1</b> Principe</a></li>
<li class="chapter" data-level="2.3.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#arguments"><i class="fa fa-check"></i><b>2.3.2</b> Arguments</a></li>
<li class="chapter" data-level="2.3.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#aide-sur-une-fonction"><i class="fa fa-check"></i><b>2.3.3</b> Aide sur une fonction</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#regrouper-ses-commandes-dans-des-scripts"><i class="fa fa-check"></i><b>2.4</b> Regrouper ses commandes dans des scripts</a><ul>
<li class="chapter" data-level="2.4.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#commentaires"><i class="fa fa-check"></i><b>2.4.1</b> Commentaires</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#packages"><i class="fa fa-check"></i><b>2.5</b> Installer et charger des extensions (<em>packages</em>)</a></li>
<li class="chapter" data-level="2.6" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#exercices"><i class="fa fa-check"></i><b>2.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-premier_travail.html"><a href="03-premier_travail.html"><i class="fa fa-check"></i><b>3</b> Premier travail avec des données</a><ul>
<li class="chapter" data-level="3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#jeu-de-données-dexemple"><i class="fa fa-check"></i><b>3.1</b> Jeu de données d’exemple</a></li>
<li class="chapter" data-level="3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#tableau-de-données-data-frame"><i class="fa fa-check"></i><b>3.2</b> Tableau de données (<em>data frame</em>)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#structure-du-tableau"><i class="fa fa-check"></i><b>3.2.1</b> Structure du tableau</a></li>
<li class="chapter" data-level="3.2.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#accéder-aux-variables-dun-tableau"><i class="fa fa-check"></i><b>3.2.2</b> Accéder aux variables d’un tableau</a></li>
<li class="chapter" data-level="3.2.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#créer-une-nouvelle-variable"><i class="fa fa-check"></i><b>3.2.3</b> Créer une nouvelle variable</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyse-univariée"><i class="fa fa-check"></i><b>3.3</b> Analyse univariée</a><ul>
<li class="chapter" data-level="3.3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-quantitative"><i class="fa fa-check"></i><b>3.3.1</b> Analyser une variable quantitative</a></li>
<li class="chapter" data-level="3.3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-qualitative"><i class="fa fa-check"></i><b>3.3.2</b> Analyser une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="03-premier_travail.html"><a href="03-premier_travail.html#exercices-1"><i class="fa fa-check"></i><b>3.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-bivarie.html"><a href="04-bivarie.html"><i class="fa fa-check"></i><b>4</b> Analyse bivariée</a><ul>
<li class="chapter" data-level="4.1" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-qualitatives"><i class="fa fa-check"></i><b>4.1</b> Croisement de deux variables qualitatives</a><ul>
<li class="chapter" data-level="4.1.1" data-path="04-bivarie.html"><a href="04-bivarie.html#tableaux-croisés"><i class="fa fa-check"></i><b>4.1.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="4.1.2" data-path="04-bivarie.html"><a href="04-bivarie.html#test-du-χ²"><i class="fa fa-check"></i><b>4.1.2</b> Test du χ²</a></li>
<li class="chapter" data-level="4.1.3" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-1"><i class="fa fa-check"></i><b>4.1.3</b> Représentation graphique</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-dune-variable-quantitative-et-dune-variable-qualitative"><i class="fa fa-check"></i><b>4.2</b> Croisement d’une variable quantitative et d’une variable qualitative</a><ul>
<li class="chapter" data-level="4.2.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-2"><i class="fa fa-check"></i><b>4.2.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.2.2" data-path="04-bivarie.html"><a href="04-bivarie.html#tapply"><i class="fa fa-check"></i><b>4.2.2</b> Calculs d’indicateurs</a></li>
<li class="chapter" data-level="4.2.3" data-path="04-bivarie.html"><a href="04-bivarie.html#tests-statistiques"><i class="fa fa-check"></i><b>4.2.3</b> Tests statistiques</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-quantitatives"><i class="fa fa-check"></i><b>4.3</b> Croisement de deux variables quantitatives</a><ul>
<li class="chapter" data-level="4.3.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-3"><i class="fa fa-check"></i><b>4.3.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.3.2" data-path="04-bivarie.html"><a href="04-bivarie.html#calcul-dindicateurs"><i class="fa fa-check"></i><b>4.3.2</b> Calcul d’indicateurs</a></li>
<li class="chapter" data-level="4.3.3" data-path="04-bivarie.html"><a href="04-bivarie.html#régression-linéaire"><i class="fa fa-check"></i><b>4.3.3</b> Régression linéaire</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="04-bivarie.html"><a href="04-bivarie.html#exercices-2"><i class="fa fa-check"></i><b>4.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-organiser.html"><a href="05-organiser.html"><i class="fa fa-check"></i><b>5</b> Organiser ses scripts</a><ul>
<li class="chapter" data-level="5.1" data-path="05-organiser.html"><a href="05-organiser.html#projets"><i class="fa fa-check"></i><b>5.1</b> Les projets dans RStudio</a></li>
<li class="chapter" data-level="5.2" data-path="05-organiser.html"><a href="05-organiser.html#créer-des-sections-dans-un-script"><i class="fa fa-check"></i><b>5.2</b> Créer des sections dans un script</a></li>
<li class="chapter" data-level="5.3" data-path="05-organiser.html"><a href="05-organiser.html#répartir-son-travail-entre-plusieurs-scripts"><i class="fa fa-check"></i><b>5.3</b> Répartir son travail entre plusieurs scripts</a></li>
<li class="chapter" data-level="5.4" data-path="05-organiser.html"><a href="05-organiser.html#désactiver-la-sauvegarde-de-lespace-de-travail"><i class="fa fa-check"></i><b>5.4</b> Désactiver la sauvegarde de l’espace de travail</a></li>
</ul></li>
<li class="part"><span><b>II Introduction au tidyverse</b></span></li>
<li class="chapter" data-level="6" data-path="06-tidyverse.html"><a href="06-tidyverse.html"><i class="fa fa-check"></i><b>6</b> Le tidyverse</a><ul>
<li class="chapter" data-level="6.1" data-path="06-tidyverse.html"><a href="06-tidyverse.html#extensions"><i class="fa fa-check"></i><b>6.1</b> Extensions</a></li>
<li class="chapter" data-level="6.2" data-path="06-tidyverse.html"><a href="06-tidyverse.html#installation"><i class="fa fa-check"></i><b>6.2</b> Installation</a></li>
<li class="chapter" data-level="6.3" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tidydata"><i class="fa fa-check"></i><b>6.3</b> tidy data</a></li>
<li class="chapter" data-level="6.4" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>6.4</b> tibbles</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-import.html"><a href="07-import.html"><i class="fa fa-check"></i><b>7</b> Importer et exporter des données</a><ul>
<li class="chapter" data-level="7.1" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-textes"><i class="fa fa-check"></i><b>7.1</b> Import de fichiers textes</a><ul>
<li class="chapter" data-level="7.1.1" data-path="07-import.html"><a href="07-import.html#interface-interactive-dimport-de-fichiers"><i class="fa fa-check"></i><b>7.1.1</b> Interface interactive d’import de fichiers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="07-import.html"><a href="07-import.html#import-depuis-un-fichier-excel"><i class="fa fa-check"></i><b>7.2</b> Import depuis un fichier Excel</a></li>
<li class="chapter" data-level="7.3" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-sas-spss-et-stata"><i class="fa fa-check"></i><b>7.3</b> Import de fichiers SAS, SPSS et Stata</a></li>
<li class="chapter" data-level="7.4" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-dbase"><i class="fa fa-check"></i><b>7.4</b> Import de fichiers dBase</a></li>
<li class="chapter" data-level="7.5" data-path="07-import.html"><a href="07-import.html#connexion-à-des-bases-de-données"><i class="fa fa-check"></i><b>7.5</b> Connexion à des bases de données</a><ul>
<li class="chapter" data-level="7.5.1" data-path="07-import.html"><a href="07-import.html#interfaçage-via-lextension-dbi"><i class="fa fa-check"></i><b>7.5.1</b> Interfaçage via l’extension <code>DBI</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="07-import.html"><a href="07-import.html#utilisation-de-dplyr-et-dbplyr"><i class="fa fa-check"></i><b>7.5.2</b> Utilisation de <code>dplyr</code> et <code>dbplyr</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="07-import.html"><a href="07-import.html#ressources"><i class="fa fa-check"></i><b>7.5.3</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="07-import.html"><a href="07-import.html#export-de-données"><i class="fa fa-check"></i><b>7.6</b> Export de données</a><ul>
<li class="chapter" data-level="7.6.1" data-path="07-import.html"><a href="07-import.html#export-de-tableaux-de-données"><i class="fa fa-check"></i><b>7.6.1</b> Export de tableaux de données</a></li>
<li class="chapter" data-level="7.6.2" data-path="07-import.html"><a href="07-import.html#sauvegarder-des-objets"><i class="fa fa-check"></i><b>7.6.2</b> Sauvegarder des objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-ggplot2.html"><a href="08-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Visualiser avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="8.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#préparation"><i class="fa fa-check"></i><b>8.1</b> Préparation</a></li>
<li class="chapter" data-level="8.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#initialisation"><i class="fa fa-check"></i><b>8.2</b> Initialisation</a></li>
<li class="chapter" data-level="8.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-geom"><i class="fa fa-check"></i><b>8.3</b> Exemples de <code>geom</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_boxplot"><i class="fa fa-check"></i><b>8.3.1</b> <code>geom_boxplot</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_violin"><i class="fa fa-check"></i><b>8.3.2</b> <code>geom_violin</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar"><i class="fa fa-check"></i><b>8.3.3</b> <code>geom_bar</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_text"><i class="fa fa-check"></i><b>8.3.4</b> <code>geom_text</code></a></li>
<li class="chapter" data-level="8.3.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_label"><i class="fa fa-check"></i><b>8.3.5</b> <code>geom_label</code></a></li>
<li class="chapter" data-level="8.3.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_density"><i class="fa fa-check"></i><b>8.3.6</b> <code>geom_density</code></a></li>
<li class="chapter" data-level="8.3.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_line"><i class="fa fa-check"></i><b>8.3.7</b> <code>geom_line</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#mappages"><i class="fa fa-check"></i><b>8.4</b> Mappages</a><ul>
<li class="chapter" data-level="8.4.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-mappages"><i class="fa fa-check"></i><b>8.4.1</b> Exemples de mappages</a></li>
<li class="chapter" data-level="8.4.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#aes-or-not-aes"><i class="fa fa-check"></i><b>8.4.2</b> <code>aes()</code> or not <code>aes()</code> ?</a></li>
<li class="chapter" data-level="8.4.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar-et-position"><i class="fa fa-check"></i><b>8.4.3</b> <code>geom_bar</code> et <code>position</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#représentation-de-plusieurs-geom"><i class="fa fa-check"></i><b>8.5</b> Représentation de plusieurs <code>geom</code></a><ul>
<li class="chapter" data-level="8.5.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#plusieurs-sources-de-données"><i class="fa fa-check"></i><b>8.5.1</b> Plusieurs sources de données</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#faceting"><i class="fa fa-check"></i><b>8.6</b> Faceting</a></li>
<li class="chapter" data-level="8.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scales"><i class="fa fa-check"></i><b>8.7</b> Scales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_size"><i class="fa fa-check"></i><b>8.7.1</b> <code>scale_size</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_x-scale_y"><i class="fa fa-check"></i><b>8.7.2</b> <code>scale_x</code>, <code>scale_y</code></a></li>
<li class="chapter" data-level="8.7.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scalecolor"><i class="fa fa-check"></i><b>8.7.3</b> <code>scale_color</code>, <code>scale_fill</code></a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="08-ggplot2.html"><a href="08-ggplot2.html#thèmes"><i class="fa fa-check"></i><b>8.8</b> Thèmes</a></li>
<li class="chapter" data-level="8.9" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ladd-in-esquisse"><i class="fa fa-check"></i><b>8.9</b> L’add-in <code>esquisse</code></a></li>
<li class="chapter" data-level="8.10" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ressources-1"><i class="fa fa-check"></i><b>8.10</b> Ressources</a></li>
<li class="chapter" data-level="8.11" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exercices-3"><i class="fa fa-check"></i><b>8.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-recodages.html"><a href="09-recodages.html"><i class="fa fa-check"></i><b>9</b> Recoder des variables</a><ul>
<li class="chapter" data-level="9.1" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs"><i class="fa fa-check"></i><b>9.1</b> Rappel sur les variables et les vecteurs</a></li>
<li class="chapter" data-level="9.2" data-path="09-recodages.html"><a href="09-recodages.html#tests"><i class="fa fa-check"></i><b>9.2</b> Tests et comparaison</a></li>
<li class="chapter" data-level="9.3" data-path="09-recodages.html"><a href="09-recodages.html#recoder-une-variable-qualitative"><i class="fa fa-check"></i><b>9.3</b> Recoder une variable qualitative</a><ul>
<li class="chapter" data-level="9.3.1" data-path="09-recodages.html"><a href="09-recodages.html#facteurs"><i class="fa fa-check"></i><b>9.3.1</b> Facteurs et <code>forcats</code></a></li>
<li class="chapter" data-level="9.3.2" data-path="09-recodages.html"><a href="09-recodages.html#recode"><i class="fa fa-check"></i><b>9.3.2</b> Modifier les modalités d’une variable qualitative</a></li>
<li class="chapter" data-level="9.3.3" data-path="09-recodages.html"><a href="09-recodages.html#ordonner-les-modalités-dune-variable-qualitative"><i class="fa fa-check"></i><b>9.3.3</b> Ordonner les modalités d’une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables"><i class="fa fa-check"></i><b>9.4</b> Combiner plusieurs variables</a><ul>
<li class="chapter" data-level="9.4.1" data-path="09-recodages.html"><a href="09-recodages.html#if-else"><i class="fa fa-check"></i><b>9.4.1</b> <code>if_else</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="09-recodages.html"><a href="09-recodages.html#case_when"><i class="fa fa-check"></i><b>9.4.2</b> <code>case_when</code></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique-en-classes"><i class="fa fa-check"></i><b>9.5</b> Découper une variable numérique en classes</a><ul>
<li class="chapter" data-level="9.5.1" data-path="09-recodages.html"><a href="09-recodages.html#interface-graphique"><i class="fa fa-check"></i><b>9.5.1</b> Interface graphique</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="09-recodages.html"><a href="09-recodages.html#exercices-4"><i class="fa fa-check"></i><b>9.6</b> Exercices</a><ul>
<li class="chapter" data-level="9.6.1" data-path="09-recodages.html"><a href="09-recodages.html#préparation-1"><i class="fa fa-check"></i><b>9.6.1</b> Préparation</a></li>
<li class="chapter" data-level="9.6.2" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs-et-tests"><i class="fa fa-check"></i><b>9.6.2</b> Vecteurs et tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="09-recodages.html"><a href="09-recodages.html#recodages-de-variable-qualitative"><i class="fa fa-check"></i><b>9.6.3</b> Recodages de variable qualitative</a></li>
<li class="chapter" data-level="9.6.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables-1"><i class="fa fa-check"></i><b>9.6.4</b> Combiner plusieurs variables</a></li>
<li class="chapter" data-level="9.6.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique"><i class="fa fa-check"></i><b>9.6.5</b> Découper une variable numérique</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-dplyr.html"><a href="10-dplyr.html"><i class="fa fa-check"></i><b>10</b> Manipuler les données avec <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.1" data-path="10-dplyr.html"><a href="10-dplyr.html#préparation-2"><i class="fa fa-check"></i><b>10.1</b> Préparation</a></li>
<li class="chapter" data-level="10.2" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-dplyr"><i class="fa fa-check"></i><b>10.2</b> Les verbes de <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice"><i class="fa fa-check"></i><b>10.2.1</b> <code>slice</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="10-dplyr.html"><a href="10-dplyr.html#filter"><i class="fa fa-check"></i><b>10.2.2</b> <code>filter</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="10-dplyr.html"><a href="10-dplyr.html#select-rename"><i class="fa fa-check"></i><b>10.2.3</b> <code>select</code> et <code>rename</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="10-dplyr.html"><a href="10-dplyr.html#arrange"><i class="fa fa-check"></i><b>10.2.4</b> <code>arrange</code></a></li>
<li class="chapter" data-level="10.2.5" data-path="10-dplyr.html"><a href="10-dplyr.html#mutate"><i class="fa fa-check"></i><b>10.2.5</b> <code>mutate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="10-dplyr.html"><a href="10-dplyr.html#pipe"><i class="fa fa-check"></i><b>10.3</b> Enchaîner les opérations avec le <em>pipe</em></a></li>
<li class="chapter" data-level="10.4" data-path="10-dplyr.html"><a href="10-dplyr.html#opérations-groupées"><i class="fa fa-check"></i><b>10.4</b> Opérations groupées</a><ul>
<li class="chapter" data-level="10.4.1" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by"><i class="fa fa-check"></i><b>10.4.1</b> <code>group_by</code></a></li>
<li class="chapter" data-level="10.4.2" data-path="10-dplyr.html"><a href="10-dplyr.html#summarise-et-count"><i class="fa fa-check"></i><b>10.4.2</b> <code>summarise</code> et <code>count</code></a></li>
<li class="chapter" data-level="10.4.3" data-path="10-dplyr.html"><a href="10-dplyr.html#grouper-selon-plusieurs-variables"><i class="fa fa-check"></i><b>10.4.3</b> Grouper selon plusieurs variables</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="10-dplyr.html"><a href="10-dplyr.html#autres-fonctions-utiles"><i class="fa fa-check"></i><b>10.5</b> Autres fonctions utiles</a><ul>
<li class="chapter" data-level="10.5.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_sample"><i class="fa fa-check"></i><b>10.5.1</b> <code>slice_sample</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_head-slice_tail-slice_min-slice_max"><i class="fa fa-check"></i><b>10.5.2</b> <code>slice_head</code>, <code>slice_tail</code>, <code>slice_min</code>, <code>slice_max</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="10-dplyr.html"><a href="10-dplyr.html#lead-et-lag"><i class="fa fa-check"></i><b>10.5.3</b> <code>lead</code> et <code>lag</code></a></li>
<li class="chapter" data-level="10.5.4" data-path="10-dplyr.html"><a href="10-dplyr.html#distinct-et-n_distinct"><i class="fa fa-check"></i><b>10.5.4</b> <code>distinct</code> et <code>n_distinct</code></a></li>
<li class="chapter" data-level="10.5.5" data-path="10-dplyr.html"><a href="10-dplyr.html#relocate"><i class="fa fa-check"></i><b>10.5.5</b> <code>relocate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="10-dplyr.html"><a href="10-dplyr.html#tables-multiples"><i class="fa fa-check"></i><b>10.6</b> Tables multiples</a><ul>
<li class="chapter" data-level="10.6.1" data-path="10-dplyr.html"><a href="10-dplyr.html#concaténation-bind_rows-et-bind_cols"><i class="fa fa-check"></i><b>10.6.1</b> Concaténation : <code>bind_rows</code> et <code>bind_cols</code></a></li>
<li class="chapter" data-level="10.6.2" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures"><i class="fa fa-check"></i><b>10.6.2</b> Jointures</a></li>
<li class="chapter" data-level="10.6.3" data-path="10-dplyr.html"><a href="10-dplyr.html#types-de-jointures"><i class="fa fa-check"></i><b>10.6.3</b> Types de jointures</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="10-dplyr.html"><a href="10-dplyr.html#ressources-2"><i class="fa fa-check"></i><b>10.7</b> Ressources</a></li>
<li class="chapter" data-level="10.8" data-path="10-dplyr.html"><a href="10-dplyr.html#exercices-5"><i class="fa fa-check"></i><b>10.8</b> Exercices</a><ul>
<li class="chapter" data-level="10.8.1" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-base-de-dplyr"><i class="fa fa-check"></i><b>10.8.1</b> Les verbes de base de <code>dplyr</code></a></li>
<li class="chapter" data-level="10.8.2" data-path="10-dplyr.html"><a href="10-dplyr.html#enchaîner-des-opérations"><i class="fa fa-check"></i><b>10.8.2</b> Enchaîner des opérations</a></li>
<li class="chapter" data-level="10.8.3" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by-et-summarise"><i class="fa fa-check"></i><b>10.8.3</b> <code>group_by</code> et <code>summarise</code></a></li>
<li class="chapter" data-level="10.8.4" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures-1"><i class="fa fa-check"></i><b>10.8.4</b> Jointures</a></li>
<li class="chapter" data-level="10.8.5" data-path="10-dplyr.html"><a href="10-dplyr.html#bonus"><i class="fa fa-check"></i><b>10.8.5</b> Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-stringr.html"><a href="11-stringr.html"><i class="fa fa-check"></i><b>11</b> Manipuler du texte avec <code>stringr</code></a><ul>
<li class="chapter" data-level="11.1" data-path="11-stringr.html"><a href="11-stringr.html#expressions-régulières"><i class="fa fa-check"></i><b>11.1</b> Expressions régulières</a></li>
<li class="chapter" data-level="11.2" data-path="11-stringr.html"><a href="11-stringr.html#concat"><i class="fa fa-check"></i><b>11.2</b> Concaténer des chaînes</a></li>
<li class="chapter" data-level="11.3" data-path="11-stringr.html"><a href="11-stringr.html#convertir-en-majuscules-minuscules"><i class="fa fa-check"></i><b>11.3</b> Convertir en majuscules / minuscules</a></li>
<li class="chapter" data-level="11.4" data-path="11-stringr.html"><a href="11-stringr.html#découper-des-chaînes"><i class="fa fa-check"></i><b>11.4</b> Découper des chaînes</a></li>
<li class="chapter" data-level="11.5" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-sous-chaînes-par-position"><i class="fa fa-check"></i><b>11.5</b> Extraire des sous-chaînes par position</a></li>
<li class="chapter" data-level="11.6" data-path="11-stringr.html"><a href="11-stringr.html#str-detect"><i class="fa fa-check"></i><b>11.6</b> Détecter des motifs</a></li>
<li class="chapter" data-level="11.7" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-motifs"><i class="fa fa-check"></i><b>11.7</b> Extraire des motifs</a></li>
<li class="chapter" data-level="11.8" data-path="11-stringr.html"><a href="11-stringr.html#remplacer-des-motifs"><i class="fa fa-check"></i><b>11.8</b> Remplacer des motifs</a></li>
<li class="chapter" data-level="11.9" data-path="11-stringr.html"><a href="11-stringr.html#modificateurs"><i class="fa fa-check"></i><b>11.9</b> Modificateurs de motifs</a></li>
<li class="chapter" data-level="11.10" data-path="11-stringr.html"><a href="11-stringr.html#ressources-3"><i class="fa fa-check"></i><b>11.10</b> Ressources</a></li>
<li class="chapter" data-level="11.11" data-path="11-stringr.html"><a href="11-stringr.html#exercices-6"><i class="fa fa-check"></i><b>11.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-tidyr.html"><a href="12-tidyr.html"><i class="fa fa-check"></i><b>12</b> Mettre en ordre avec <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.1" data-path="12-tidyr.html"><a href="12-tidyr.html#tidy-data"><i class="fa fa-check"></i><b>12.1</b> Tidy data</a></li>
<li class="chapter" data-level="12.2" data-path="12-tidyr.html"><a href="12-tidyr.html#trois-règles-pour-des-données-bien-rangées"><i class="fa fa-check"></i><b>12.2</b> Trois règles pour des données bien rangées</a></li>
<li class="chapter" data-level="12.3" data-path="12-tidyr.html"><a href="12-tidyr.html#les-verbes-de-tidyr"><i class="fa fa-check"></i><b>12.3</b> Les verbes de <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.3.1" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>12.3.1</b> <code>pivot_longer</code> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="12.3.2" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>12.3.2</b> <code>pivot_wider</code> : transformer des lignes en colonnes</a></li>
<li class="chapter" data-level="12.3.3" data-path="12-tidyr.html"><a href="12-tidyr.html#separate"><i class="fa fa-check"></i><b>12.3.3</b> <code>separate</code> : séparer une colonne en plusieurs colonnes</a></li>
<li class="chapter" data-level="12.3.4" data-path="12-tidyr.html"><a href="12-tidyr.html#separate-rows"><i class="fa fa-check"></i><b>12.3.4</b> <code>separate_rows</code> : séparer une colonne en plusieurs lignes</a></li>
<li class="chapter" data-level="12.3.5" data-path="12-tidyr.html"><a href="12-tidyr.html#unite-regrouper-plusieurs-colonnes-en-une-seule"><i class="fa fa-check"></i><b>12.3.5</b> <code>unite</code> : regrouper plusieurs colonnes en une seule</a></li>
<li class="chapter" data-level="12.3.6" data-path="12-tidyr.html"><a href="12-tidyr.html#extract"><i class="fa fa-check"></i><b>12.3.6</b> <code>extract</code> : créer de nouvelles colonnes à partir d’une colonne de texte</a></li>
<li class="chapter" data-level="12.3.7" data-path="12-tidyr.html"><a href="12-tidyr.html#complete-compléter-des-combinaisons-de-variables-manquantes"><i class="fa fa-check"></i><b>12.3.7</b> <code>complete</code> : compléter des combinaisons de variables manquantes</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="12-tidyr.html"><a href="12-tidyr.html#ressources-4"><i class="fa fa-check"></i><b>12.4</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html"><i class="fa fa-check"></i><b>13</b> Diffuser et publier avec <code>rmarkdown</code></a><ul>
<li class="chapter" data-level="13.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#créer-un-nouveau-document"><i class="fa fa-check"></i><b>13.1</b> Créer un nouveau document</a></li>
<li class="chapter" data-level="13.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#éléments-dun-document-r-markdown"><i class="fa fa-check"></i><b>13.2</b> Éléments d’un document R Markdown</a><ul>
<li class="chapter" data-level="13.2.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#en-tête-préambule"><i class="fa fa-check"></i><b>13.2.1</b> En-tête (préambule)</a></li>
<li class="chapter" data-level="13.2.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#texte-du-document"><i class="fa fa-check"></i><b>13.2.2</b> Texte du document</a></li>
<li class="chapter" data-level="13.2.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#blocs-de-code-r"><i class="fa fa-check"></i><b>13.2.3</b> Blocs de code R</a></li>
<li class="chapter" data-level="13.2.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#compiler-un-document-knit"><i class="fa fa-check"></i><b>13.2.4</b> Compiler un document (<em>Knit</em>)</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#personnaliser-le-document-généré"><i class="fa fa-check"></i><b>13.3</b> Personnaliser le document généré</a></li>
<li class="chapter" data-level="13.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-des-blocs-de-code-r"><i class="fa fa-check"></i><b>13.4</b> Options des blocs de code R</a><ul>
<li class="chapter" data-level="13.4.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#nom-du-bloc"><i class="fa fa-check"></i><b>13.4.1</b> Nom du bloc</a></li>
<li class="chapter" data-level="13.4.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options"><i class="fa fa-check"></i><b>13.4.2</b> Options</a></li>
<li class="chapter" data-level="13.4.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#modifier-les-options"><i class="fa fa-check"></i><b>13.4.3</b> Modifier les options</a></li>
<li class="chapter" data-level="13.4.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-globales"><i class="fa fa-check"></i><b>13.4.4</b> Options globales</a></li>
<li class="chapter" data-level="13.4.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#mise-en-cache-des-résultats"><i class="fa fa-check"></i><b>13.4.5</b> Mise en cache des résultats</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#rendu-des-tableaux"><i class="fa fa-check"></i><b>13.5</b> Rendu des tableaux</a><ul>
<li class="chapter" data-level="13.5.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-croisés-1"><i class="fa fa-check"></i><b>13.5.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="13.5.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-de-données-et-tris-à-plat"><i class="fa fa-check"></i><b>13.5.2</b> Tableaux de données et tris à plat</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates"><i class="fa fa-check"></i><b>13.6</b> Modèles de documents</a><ul>
<li class="chapter" data-level="13.6.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#slides"><i class="fa fa-check"></i><b>13.6.1</b> Slides</a></li>
<li class="chapter" data-level="13.6.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates-1"><i class="fa fa-check"></i><b>13.6.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#ressources-5"><i class="fa fa-check"></i><b>13.7</b> Ressources</a></li>
</ul></li>
<li class="part"><span><b>III Aller plus loin</b></span></li>
<li class="chapter" data-level="14" data-path="14-fonctions.html"><a href="14-fonctions.html"><i class="fa fa-check"></i><b>14</b> Écrire ses propres fonctions</a><ul>
<li class="chapter" data-level="14.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples"><i class="fa fa-check"></i><b>14.1</b> Introduction et exemples</a><ul>
<li class="chapter" data-level="14.1.1" data-path="14-fonctions.html"><a href="14-fonctions.html#structure-dune-fonction"><i class="fa fa-check"></i><b>14.1.1</b> Structure d’une fonction</a></li>
<li class="chapter" data-level="14.1.2" data-path="14-fonctions.html"><a href="14-fonctions.html#exemple-de-fonction"><i class="fa fa-check"></i><b>14.1.2</b> Exemple de fonction</a></li>
<li class="chapter" data-level="14.1.3" data-path="14-fonctions.html"><a href="14-fonctions.html#effets-de-bord-et-affichage-de-messages"><i class="fa fa-check"></i><b>14.1.3</b> Effets de bord et affichage de messages</a></li>
<li class="chapter" data-level="14.1.4" data-path="14-fonctions.html"><a href="14-fonctions.html#utilité-des-fonctions"><i class="fa fa-check"></i><b>14.1.4</b> Utilité des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultat-dune-fonction"><i class="fa fa-check"></i><b>14.2</b> Arguments et résultat d’une fonction</a><ul>
<li class="chapter" data-level="14.2.1" data-path="14-fonctions.html"><a href="14-fonctions.html#définition-des-arguments"><i class="fa fa-check"></i><b>14.2.1</b> Définition des arguments</a></li>
<li class="chapter" data-level="14.2.2" data-path="14-fonctions.html"><a href="14-fonctions.html#valeurs-par-défaut"><i class="fa fa-check"></i><b>14.2.2</b> Valeurs par défaut</a></li>
<li class="chapter" data-level="14.2.3" data-path="14-fonctions.html"><a href="14-fonctions.html#largument-..."><i class="fa fa-check"></i><b>14.2.3</b> L’argument <code>...</code></a></li>
<li class="chapter" data-level="14.2.4" data-path="14-fonctions.html"><a href="14-fonctions.html#resfunc"><i class="fa fa-check"></i><b>14.2.4</b> Résultat d’une fonction</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables"><i class="fa fa-check"></i><b>14.3</b> Portée des variables</a><ul>
<li class="chapter" data-level="14.3.1" data-path="14-fonctions.html"><a href="14-fonctions.html#une-fonction-peut-accéder-à-un-objet-extérieur"><i class="fa fa-check"></i><b>14.3.1</b> Une fonction peut accéder à un objet extérieur</a></li>
<li class="chapter" data-level="14.3.2" data-path="14-fonctions.html"><a href="14-fonctions.html#les-arguments-et-les-objets-créés-dans-la-fonction-sont-prioritaires"><i class="fa fa-check"></i><b>14.3.2</b> Les arguments et les objets créés dans la fonction sont prioritaires</a></li>
<li class="chapter" data-level="14.3.3" data-path="14-fonctions.html"><a href="14-fonctions.html#un-objet-créé-dans-une-fonction-nexiste-que-dans-cette-fonction"><i class="fa fa-check"></i><b>14.3.3</b> Un objet créé dans une fonction n’existe que dans cette fonction</a></li>
<li class="chapter" data-level="14.3.4" data-path="14-fonctions.html"><a href="14-fonctions.html#on-ne-peut-pas-modifier-un-objet-global-dans-une-fonction"><i class="fa fa-check"></i><b>14.3.4</b> On ne peut pas modifier un objet global dans une fonction</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets"><i class="fa fa-check"></i><b>14.4</b> Les fonctions comme objets</a><ul>
<li class="chapter" data-level="14.4.1" data-path="14-fonctions.html"><a href="14-fonctions.html#passer-des-fonctions-comme-argument"><i class="fa fa-check"></i><b>14.4.1</b> Passer des fonctions comme argument</a></li>
<li class="chapter" data-level="14.4.2" data-path="14-fonctions.html"><a href="14-fonctions.html#fonctions-anonymes"><i class="fa fa-check"></i><b>14.4.2</b> Fonctions anonymes</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="14-fonctions.html"><a href="14-fonctions.html#ressources-6"><i class="fa fa-check"></i><b>14.5</b> Ressources</a></li>
<li class="chapter" data-level="14.6" data-path="14-fonctions.html"><a href="14-fonctions.html#exercices-7"><i class="fa fa-check"></i><b>14.6</b> Exercices</a><ul>
<li class="chapter" data-level="14.6.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples-1"><i class="fa fa-check"></i><b>14.6.1</b> Introduction et exemples</a></li>
<li class="chapter" data-level="14.6.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultats"><i class="fa fa-check"></i><b>14.6.2</b> Arguments et résultats</a></li>
<li class="chapter" data-level="14.6.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables-1"><i class="fa fa-check"></i><b>14.6.3</b> Portée des variables</a></li>
<li class="chapter" data-level="14.6.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets-1"><i class="fa fa-check"></i><b>14.6.4</b> Les fonctions comme objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html"><i class="fa fa-check"></i><b>15</b> Structures de données</a><ul>
<li class="chapter" data-level="15.1" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#vecteurs-atomiques"><i class="fa fa-check"></i><b>15.1</b> Vecteurs atomiques</a><ul>
<li class="chapter" data-level="15.1.1" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#création-dun-vecteur"><i class="fa fa-check"></i><b>15.1.1</b> Création d’un vecteur</a></li>
<li class="chapter" data-level="15.1.2" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#vecteurs-nommés"><i class="fa fa-check"></i><b>15.1.2</b> Vecteurs nommés</a></li>
<li class="chapter" data-level="15.1.3" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#types-de-vecteurs"><i class="fa fa-check"></i><b>15.1.3</b> Types de vecteurs</a></li>
<li class="chapter" data-level="15.1.4" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#sélection-déléments"><i class="fa fa-check"></i><b>15.1.4</b> Sélection d’éléments</a></li>
<li class="chapter" data-level="15.1.5" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#modification"><i class="fa fa-check"></i><b>15.1.5</b> Modification</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#listes"><i class="fa fa-check"></i><b>15.2</b> Listes</a><ul>
<li class="chapter" data-level="15.2.1" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#création"><i class="fa fa-check"></i><b>15.2.1</b> Création</a></li>
<li class="chapter" data-level="15.2.2" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#ajout-déléments"><i class="fa fa-check"></i><b>15.2.2</b> Ajout d’éléments</a></li>
<li class="chapter" data-level="15.2.3" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#sélection-déléments-1"><i class="fa fa-check"></i><b>15.2.3</b> Sélection d’éléments</a></li>
<li class="chapter" data-level="15.2.4" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#modification-1"><i class="fa fa-check"></i><b>15.2.4</b> Modification</a></li>
<li class="chapter" data-level="15.2.5" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#utilisation"><i class="fa fa-check"></i><b>15.2.5</b> Utilisation</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#data-frame-tibbles"><i class="fa fa-check"></i><b>15.3</b> Tableaux de données (<em>data frame</em> et <em>tibble</em>)</a><ul>
<li class="chapter" data-level="15.3.1" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#création-1"><i class="fa fa-check"></i><b>15.3.1</b> Création</a></li>
<li class="chapter" data-level="15.3.2" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#noms-de-colonnes-et-de-lignes"><i class="fa fa-check"></i><b>15.3.2</b> Noms de colonnes et de lignes</a></li>
<li class="chapter" data-level="15.3.3" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#sélection-de-lignes-et-de-colonnes"><i class="fa fa-check"></i><b>15.3.3</b> Sélection de lignes et de colonnes</a></li>
<li class="chapter" data-level="15.3.4" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#modification-2"><i class="fa fa-check"></i><b>15.3.4</b> Modification</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#ressources-7"><i class="fa fa-check"></i><b>15.4</b> Ressources</a></li>
<li class="chapter" data-level="15.5" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#exercices-8"><i class="fa fa-check"></i><b>15.5</b> Exercices</a><ul>
<li class="chapter" data-level="15.5.1" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#vecteurs-atomiques-1"><i class="fa fa-check"></i><b>15.5.1</b> Vecteurs atomiques</a></li>
<li class="chapter" data-level="15.5.2" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#listes-1"><i class="fa fa-check"></i><b>15.5.2</b> Listes</a></li>
<li class="chapter" data-level="15.5.3" data-path="15-structures-donnees.html"><a href="15-structures-donnees.html#tableaux-de-données"><i class="fa fa-check"></i><b>15.5.3</b> Tableaux de données</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="16-boucles-if.html"><a href="16-boucles-if.html"><i class="fa fa-check"></i><b>16</b> Boucles et exécution conditionnelle</a><ul>
<li class="chapter" data-level="16.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#if-else-exécuter-du-code-sous-certaines-conditions"><i class="fa fa-check"></i><b>16.1</b> <code>if</code>, <code>else</code> : exécuter du code sous certaines conditions</a><ul>
<li class="chapter" data-level="16.1.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#if"><i class="fa fa-check"></i><b>16.1.1</b> <code>if</code></a></li>
<li class="chapter" data-level="16.1.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#if-else-1"><i class="fa fa-check"></i><b>16.1.2</b> <code>if</code> / <code>else</code></a></li>
<li class="chapter" data-level="16.1.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#if-else-if-else"><i class="fa fa-check"></i><b>16.1.3</b> “<code>if</code>” / “<code>else if</code>” / “<code>else</code>”</a></li>
<li class="chapter" data-level="16.1.4" data-path="16-boucles-if.html"><a href="16-boucles-if.html#construction-de-conditions-complexes"><i class="fa fa-check"></i><b>16.1.4</b> Construction de conditions complexes</a></li>
<li class="chapter" data-level="16.1.5" data-path="16-boucles-if.html"><a href="16-boucles-if.html#différence-entre-if-else-et-ifelse"><i class="fa fa-check"></i><b>16.1.5</b> Différence entre <code>if</code> / <code>else</code> et <code>ifelse</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#contrôle-de-lexécution-et-gestion-des-erreurs"><i class="fa fa-check"></i><b>16.2</b> Contrôle de l’exécution et gestion des erreurs</a><ul>
<li class="chapter" data-level="16.2.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#utilisation-de-return-pour-sortir-de-la-fonction"><i class="fa fa-check"></i><b>16.2.1</b> Utilisation de <code>return</code> pour sortir de la fonction</a></li>
<li class="chapter" data-level="16.2.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#warning"><i class="fa fa-check"></i><b>16.2.2</b> <code>warning</code></a></li>
<li class="chapter" data-level="16.2.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#stop-et-stopifnot"><i class="fa fa-check"></i><b>16.2.3</b> <code>stop</code> et <code>stopifnot</code></a></li>
<li class="chapter" data-level="16.2.4" data-path="16-boucles-if.html"><a href="16-boucles-if.html#tester-la-présence-dun-argument"><i class="fa fa-check"></i><b>16.2.4</b> Tester la présence d’un argument</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#for-et-while-répéter-des-instructions-dans-une-boucle"><i class="fa fa-check"></i><b>16.3</b> <code>for</code> et <code>while</code> : répéter des instructions dans une boucle</a><ul>
<li class="chapter" data-level="16.3.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#for"><i class="fa fa-check"></i><b>16.3.1</b> <code>for</code></a></li>
<li class="chapter" data-level="16.3.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#while"><i class="fa fa-check"></i><b>16.3.2</b> <code>while</code></a></li>
<li class="chapter" data-level="16.3.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#next-et-break"><i class="fa fa-check"></i><b>16.3.3</b> <code>next</code> et <code>break</code></a></li>
<li class="chapter" data-level="16.3.4" data-path="16-boucles-if.html"><a href="16-boucles-if.html#no-boucles"><i class="fa fa-check"></i><b>16.3.4</b> Quand (ne pas) utiliser des boucles</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="16-boucles-if.html"><a href="16-boucles-if.html#débugguer-une-fonction"><i class="fa fa-check"></i><b>16.4</b> Débugguer une fonction</a><ul>
<li class="chapter" data-level="16.4.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#print"><i class="fa fa-check"></i><b>16.4.1</b> print()</a></li>
<li class="chapter" data-level="16.4.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#localiser-une-erreur"><i class="fa fa-check"></i><b>16.4.2</b> Localiser une erreur</a></li>
<li class="chapter" data-level="16.4.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#browser"><i class="fa fa-check"></i><b>16.4.3</b> browser()</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="16-boucles-if.html"><a href="16-boucles-if.html#ressources-boucles"><i class="fa fa-check"></i><b>16.5</b> Ressources</a></li>
<li class="chapter" data-level="16.6" data-path="16-boucles-if.html"><a href="16-boucles-if.html#exercices-9"><i class="fa fa-check"></i><b>16.6</b> Exercices</a><ul>
<li class="chapter" data-level="16.6.1" data-path="16-boucles-if.html"><a href="16-boucles-if.html#if-et-else"><i class="fa fa-check"></i><b>16.6.1</b> <code>if</code> et <code>else</code></a></li>
<li class="chapter" data-level="16.6.2" data-path="16-boucles-if.html"><a href="16-boucles-if.html#contrôle-de-lexécution"><i class="fa fa-check"></i><b>16.6.2</b> Contrôle de l’exécution</a></li>
<li class="chapter" data-level="16.6.3" data-path="16-boucles-if.html"><a href="16-boucles-if.html#boucles"><i class="fa fa-check"></i><b>16.6.3</b> Boucles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html"><i class="fa fa-check"></i><b>17</b> <code>dplyr</code> avancé</a><ul>
<li class="chapter" data-level="17.1" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#appliquer-ses-propres-fonctions"><i class="fa fa-check"></i><b>17.1</b> Appliquer ses propres fonctions</a><ul>
<li class="chapter" data-level="17.1.1" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#exemple-avec-mutate"><i class="fa fa-check"></i><b>17.1.1</b> Exemple avec <code>mutate</code></a></li>
<li class="chapter" data-level="17.1.2" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#exemple-avec-summarise"><i class="fa fa-check"></i><b>17.1.2</b> Exemple avec <code>summarise</code></a></li>
<li class="chapter" data-level="17.1.3" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#exemple-avec-rename_with"><i class="fa fa-check"></i><b>17.1.3</b> Exemple avec <code>rename_with</code></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#across"><i class="fa fa-check"></i><b>17.2</b> <code>across()</code> : appliquer des fonctions à plusieurs colonnes</a><ul>
<li class="chapter" data-level="17.2.1" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#appliquer-une-fonction-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>17.2.1</b> Appliquer une fonction à plusieurs colonnes</a></li>
<li class="chapter" data-level="17.2.2" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#passer-des-arguments-supplémentaires-à-la-fonction-appliquée"><i class="fa fa-check"></i><b>17.2.2</b> Passer des arguments supplémentaires à la fonction appliquée</a></li>
<li class="chapter" data-level="17.2.3" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#noms-des-nouvelles-colonnes"><i class="fa fa-check"></i><b>17.2.3</b> Noms des nouvelles colonnes</a></li>
<li class="chapter" data-level="17.2.4" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#appliquer-plusieurs-fonctions-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>17.2.4</b> Appliquer plusieurs fonctions à plusieurs colonnes</a></li>
<li class="chapter" data-level="17.2.5" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#renommer-plusieurs-colonnes-avec-une-fonction"><i class="fa fa-check"></i><b>17.2.5</b> Renommer plusieurs colonnes avec une fonction</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#rowwise-et-c_across-appliquer-une-transformation-ligne-par-ligne"><i class="fa fa-check"></i><b>17.3</b> <code>rowwise()</code> et <code>c_across()</code> : appliquer une transformation ligne par ligne</a></li>
<li class="chapter" data-level="17.4" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#syntaxes-abregees"><i class="fa fa-check"></i><b>17.4</b> Fonctions anonymes et syntaxes abrégées</a></li>
<li class="chapter" data-level="17.5" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#ressources-8"><i class="fa fa-check"></i><b>17.5</b> Ressources</a></li>
<li class="chapter" data-level="17.6" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#exercices-10"><i class="fa fa-check"></i><b>17.6</b> Exercices</a><ul>
<li class="chapter" data-level="17.6.1" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#appliquer-ses-propres-fonctions-1"><i class="fa fa-check"></i><b>17.6.1</b> Appliquer ses propres fonctions</a></li>
<li class="chapter" data-level="17.6.2" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#across-1"><i class="fa fa-check"></i><b>17.6.2</b> <code>across()</code></a></li>
<li class="chapter" data-level="17.6.3" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#rowwise-et-c_across"><i class="fa fa-check"></i><b>17.6.3</b> <code>rowwise()</code> et <code>c_across()</code></a></li>
<li class="chapter" data-level="17.6.4" data-path="17-dplyr-avance.html"><a href="17-dplyr-avance.html#fonctions-anonymes-et-notations-abrégées"><i class="fa fa-check"></i><b>17.6.4</b> Fonctions anonymes et notations abrégées</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="18-purrr.html"><a href="18-purrr.html"><i class="fa fa-check"></i><b>18</b> Itérer avec <code>purrr</code></a><ul>
<li class="chapter" data-level="18.1" data-path="18-purrr.html"><a href="18-purrr.html#exemple-dapplication"><i class="fa fa-check"></i><b>18.1</b> Exemple d’application</a></li>
<li class="chapter" data-level="18.2" data-path="18-purrr.html"><a href="18-purrr.html#map-et-ses-variantes"><i class="fa fa-check"></i><b>18.2</b> <code>map</code> et ses variantes</a><ul>
<li class="chapter" data-level="18.2.1" data-path="18-purrr.html"><a href="18-purrr.html#modes-dappel-de-map"><i class="fa fa-check"></i><b>18.2.1</b> Modes d’appel de <code>map</code></a></li>
<li class="chapter" data-level="18.2.2" data-path="18-purrr.html"><a href="18-purrr.html#variantes-de-map"><i class="fa fa-check"></i><b>18.2.2</b> Variantes de <code>map</code></a></li>
<li class="chapter" data-level="18.2.3" data-path="18-purrr.html"><a href="18-purrr.html#map_dfr-et-map_dfc"><i class="fa fa-check"></i><b>18.2.3</b> <code>map_dfr()</code> et <code>map_dfc()</code></a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="18-purrr.html"><a href="18-purrr.html#itérer-sur-les-colonnes-dun-tableau-de-données"><i class="fa fa-check"></i><b>18.3</b> Itérer sur les colonnes d’un tableau de données</a></li>
<li class="chapter" data-level="18.4" data-path="18-purrr.html"><a href="18-purrr.html#modify"><i class="fa fa-check"></i><b>18.4</b> <code>modify</code></a></li>
<li class="chapter" data-level="18.5" data-path="18-purrr.html"><a href="18-purrr.html#imap"><i class="fa fa-check"></i><b>18.5</b> <code>imap</code></a></li>
<li class="chapter" data-level="18.6" data-path="18-purrr.html"><a href="18-purrr.html#walk"><i class="fa fa-check"></i><b>18.6</b> <code>walk</code></a></li>
<li class="chapter" data-level="18.7" data-path="18-purrr.html"><a href="18-purrr.html#map2-et-pmap-itérer-sur-plusieurs-vecteurs-en-parallèle"><i class="fa fa-check"></i><b>18.7</b> <code>map2</code> et <code>pmap</code> : itérer sur plusieurs vecteurs en parallèle</a></li>
<li class="chapter" data-level="18.8" data-path="18-purrr.html"><a href="18-purrr.html#répéter-une-opération"><i class="fa fa-check"></i><b>18.8</b> Répéter une opération</a></li>
<li class="chapter" data-level="18.9" data-path="18-purrr.html"><a href="18-purrr.html#quand-ne-pas-utiliser-map"><i class="fa fa-check"></i><b>18.9</b> Quand (ne pas) utiliser <code>map</code></a></li>
<li class="chapter" data-level="18.10" data-path="18-purrr.html"><a href="18-purrr.html#purrr-vs-apply"><i class="fa fa-check"></i><b>18.10</b> <code>purrr</code> vs <code>*apply</code></a></li>
<li class="chapter" data-level="18.11" data-path="18-purrr.html"><a href="18-purrr.html#ressources-9"><i class="fa fa-check"></i><b>18.11</b> Ressources</a></li>
<li class="chapter" data-level="18.12" data-path="18-purrr.html"><a href="18-purrr.html#exercices-11"><i class="fa fa-check"></i><b>18.12</b> Exercices</a><ul>
<li class="chapter" data-level="18.12.1" data-path="18-purrr.html"><a href="18-purrr.html#map-et-ses-variantes-1"><i class="fa fa-check"></i><b>18.12.1</b> <code>map</code> et ses variantes</a></li>
<li class="chapter" data-level="18.12.2" data-path="18-purrr.html"><a href="18-purrr.html#modify-et-itération-sur-les-colonnes-dun-tableau"><i class="fa fa-check"></i><b>18.12.2</b> <code>modify</code> et itération sur les colonnes d’un tableau</a></li>
<li class="chapter" data-level="18.12.3" data-path="18-purrr.html"><a href="18-purrr.html#imap-et-walk"><i class="fa fa-check"></i><b>18.12.3</b> <code>imap</code> et <code>walk</code></a></li>
<li class="chapter" data-level="18.12.4" data-path="18-purrr.html"><a href="18-purrr.html#map2-et-pmap"><i class="fa fa-check"></i><b>18.12.4</b> <code>map2</code> et <code>pmap</code></a></li>
<li class="chapter" data-level="18.12.5" data-path="18-purrr.html"><a href="18-purrr.html#répéter-une-opération-1"><i class="fa fa-check"></i><b>18.12.5</b> Répéter une opération</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html"><i class="fa fa-check"></i><b>19</b> Programmer avec le <em>tidyverse</em></a><ul>
<li class="chapter" data-level="19.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#spécificités-du-tidyverse"><i class="fa fa-check"></i><b>19.1</b> Spécificités du <em>tidyverse</em></a><ul>
<li class="chapter" data-level="19.1.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#data-masking"><i class="fa fa-check"></i><b>19.1.1</b> <em>data masking</em></a></li>
<li class="chapter" data-level="19.1.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#tidy-selection"><i class="fa fa-check"></i><b>19.1.2</b> <em>tidy selection</em></a></li>
<li class="chapter" data-level="19.1.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utilisation-dans-des-fonctions"><i class="fa fa-check"></i><b>19.1.3</b> Utilisation dans des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#programmer-avec-dplyr-et-tidyr"><i class="fa fa-check"></i><b>19.2</b> Programmer avec <code>dplyr</code> et <code>tidyr</code></a><ul>
<li class="chapter" data-level="19.2.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utiliser-une-colonne-passée-en-argument"><i class="fa fa-check"></i><b>19.2.1</b> Utiliser une colonne passée en argument</a></li>
<li class="chapter" data-level="19.2.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utiliser-une-sélection-de-colonnes-passée-en-argument"><i class="fa fa-check"></i><b>19.2.2</b> Utiliser une sélection de colonnes passée en argument</a></li>
<li class="chapter" data-level="19.2.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#nommer-de-nouvelles-colonnes-à-partir-dun-argument"><i class="fa fa-check"></i><b>19.2.3</b> Nommer de nouvelles colonnes à partir d’un argument</a></li>
<li class="chapter" data-level="19.2.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#désambiguïser-data-et-env"><i class="fa fa-check"></i><b>19.2.4</b> Désambiguïser data et env</a></li>
<li class="chapter" data-level="19.2.5" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#quand-les-arguments-sont-des-chaînes-de-caractères"><i class="fa fa-check"></i><b>19.2.5</b> Quand les arguments sont des chaînes de caractères</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#programmer-avec-ggplot2"><i class="fa fa-check"></i><b>19.3</b> Programmer avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="19.3.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#sélection-de-colonnes-avec-aes"><i class="fa fa-check"></i><b>19.3.1</b> Sélection de colonnes avec <code>aes()</code></a></li>
<li class="chapter" data-level="19.3.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#faceting-1"><i class="fa fa-check"></i><b>19.3.2</b> Faceting</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#aide-mémoire"><i class="fa fa-check"></i><b>19.4</b> Aide-mémoire</a></li>
<li class="chapter" data-level="19.5" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ressources-10"><i class="fa fa-check"></i><b>19.5</b> Ressources</a></li>
<li class="chapter" data-level="19.6" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#exercices-12"><i class="fa fa-check"></i><b>19.6</b> Exercices</a><ul>
<li class="chapter" data-level="19.6.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#dplyr-et-tidyr"><i class="fa fa-check"></i><b>19.6.1</b> <code>dplyr</code> et <code>tidyr</code></a></li>
<li class="chapter" data-level="19.6.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#noms-de-colonnes-en-chaînes-de-caractères"><i class="fa fa-check"></i><b>19.6.2</b> Noms de colonnes en chaînes de caractères</a></li>
<li class="chapter" data-level="19.6.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ambiguïté-data-env"><i class="fa fa-check"></i><b>19.6.3</b> Ambiguïté <code>data</code> / <code>env</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ggplot2-1"><i class="fa fa-check"></i><b>19.6.4</b> <code>ggplot2</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="20-targets.html"><a href="20-targets.html"><i class="fa fa-check"></i><b>20</b> Organiser un projet avec <code>targets</code></a><ul>
<li class="chapter" data-level="20.1" data-path="20-targets.html"><a href="20-targets.html#définition-du-pipeline"><i class="fa fa-check"></i><b>20.1</b> Définition du pipeline</a><ul>
<li class="chapter" data-level="20.1.1" data-path="20-targets.html"><a href="20-targets.html#projet-dexemple"><i class="fa fa-check"></i><b>20.1.1</b> Projet d’exemple</a></li>
<li class="chapter" data-level="20.1.2" data-path="20-targets.html"><a href="20-targets.html#targets.r"><i class="fa fa-check"></i><b>20.1.2</b> <code>_targets.R</code></a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="20-targets.html"><a href="20-targets.html#exécution-du-pipeline"><i class="fa fa-check"></i><b>20.2</b> Exécution du pipeline</a></li>
<li class="chapter" data-level="20.3" data-path="20-targets.html"><a href="20-targets.html#modification-du-pipeline"><i class="fa fa-check"></i><b>20.3</b> Modification du pipeline</a></li>
<li class="chapter" data-level="20.4" data-path="20-targets.html"><a href="20-targets.html#rmarkdown"><i class="fa fa-check"></i><b>20.4</b> RMarkdown</a></li>
<li class="chapter" data-level="20.5" data-path="20-targets.html"><a href="20-targets.html#gestion-des-données-en-cache"><i class="fa fa-check"></i><b>20.5</b> Gestion des données en cache</a></li>
<li class="chapter" data-level="20.6" data-path="20-targets.html"><a href="20-targets.html#avantages-et-limites"><i class="fa fa-check"></i><b>20.6</b> Avantages et limites</a><ul>
<li class="chapter" data-level="20.6.1" data-path="20-targets.html"><a href="20-targets.html#avantages"><i class="fa fa-check"></i><b>20.6.1</b> Avantages</a></li>
<li class="chapter" data-level="20.6.2" data-path="20-targets.html"><a href="20-targets.html#interactivité-et-développement-du-pipeline"><i class="fa fa-check"></i><b>20.6.2</b> Interactivité et développement du pipeline</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="20-targets.html"><a href="20-targets.html#ressources-11"><i class="fa fa-check"></i><b>20.7</b> Ressources</a></li>
</ul></li>
<li class="appendix"><span><b>Annexes</b></span></li>
<li class="chapter" data-level="A" data-path="21-ressources.html"><a href="21-ressources.html"><i class="fa fa-check"></i><b>A</b> Ressources</a><ul>
<li class="chapter" data-level="A.1" data-path="21-ressources.html"><a href="21-ressources.html#aide"><i class="fa fa-check"></i><b>A.1</b> Aide</a><ul>
<li class="chapter" data-level="A.1.1" data-path="21-ressources.html"><a href="21-ressources.html#aide-de-r-et-rstudio"><i class="fa fa-check"></i><b>A.1.1</b> Aide de R et RStudio</a></li>
<li class="chapter" data-level="A.1.2" data-path="21-ressources.html"><a href="21-ressources.html#aide-en-ligne"><i class="fa fa-check"></i><b>A.1.2</b> Aide en ligne</a></li>
<li class="chapter" data-level="A.1.3" data-path="21-ressources.html"><a href="21-ressources.html#antisèches"><i class="fa fa-check"></i><b>A.1.3</b> Antisèches</a></li>
<li class="chapter" data-level="A.1.4" data-path="21-ressources.html"><a href="21-ressources.html#où-poser-des-questions"><i class="fa fa-check"></i><b>A.1.4</b> Où poser des questions</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="21-ressources.html"><a href="21-ressources.html#ouvrages-blogs-moocs"><i class="fa fa-check"></i><b>A.2</b> Ouvrages, blogs, MOOCs…</a><ul>
<li class="chapter" data-level="A.2.1" data-path="21-ressources.html"><a href="21-ressources.html#francophones"><i class="fa fa-check"></i><b>A.2.1</b> Francophones</a></li>
<li class="chapter" data-level="A.2.2" data-path="21-ressources.html"><a href="21-ressources.html#anglophones"><i class="fa fa-check"></i><b>A.2.2</b> Anglophones</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="21-ressources.html"><a href="21-ressources.html#extensions-1"><i class="fa fa-check"></i><b>A.3</b> Extensions</a><ul>
<li class="chapter" data-level="A.3.1" data-path="21-ressources.html"><a href="21-ressources.html#où-trouver-des-extensions-intéressantes"><i class="fa fa-check"></i><b>A.3.1</b> Où trouver des extensions intéressantes ?</a></li>
<li class="chapter" data-level="A.3.2" data-path="21-ressources.html"><a href="21-ressources.html#lextension-questionr"><i class="fa fa-check"></i><b>A.3.2</b> L’extension <code>questionr</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction à R et au tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr-avancé" class="section level1">
<h1><span class="header-section-number">Partie 17</span> <code>dplyr</code> avancé</h1>
<p>La partie <a href="10-dplyr.html#dplyr">10</a> a permis de présenter l’extension <code>dplyr</code>. On va voir ici comment aller un peu plus loin dans l’utilisation du <em>package</em>, notamment en utilisant nos propres fonctions et en appliquant des transformations à des ensembles de colonnes.</p>
<p>On commence par charger les extensions du <em>tidyverse</em> ainsi que les jeux de données <code>hdv2003</code> et <code>rp2012</code> de l’extension <code>questionr</code>.</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb884-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb884-2" title="2"><span class="kw">library</span>(questionr)</a>
<a class="sourceLine" id="cb884-3" title="3"><span class="kw">data</span>(hdv2003)</a>
<a class="sourceLine" id="cb884-4" title="4"><span class="kw">data</span>(rp2012)</a></code></pre></div>
<div id="appliquer-ses-propres-fonctions" class="section level2">
<h2><span class="header-section-number">17.1</span> Appliquer ses propres fonctions</h2>
<div id="exemple-avec-mutate" class="section level3">
<h3><span class="header-section-number">17.1.1</span> Exemple avec <code>mutate</code></h3>
<p>Dans le jeu de données <code>hdv2003</code> plusieurs variables comprennent les mêmes modalités <code>Oui</code> / <code>Non</code>. C’est le cas notamment de <code>cuisine</code> et <code>cinema</code>.</p>
<p>Supposons qu’on souhaite recoder les valeurs de <code>cuisine</code> en transformant <code>Oui</code> en <code>O</code>, et <code>Non</code> en <code>N</code>. On a vu section <a href="09-recodages.html#recode">9.3.2</a> qu’on peut utiliser pour cela la fonction <code>fct_recode()</code> de <code>forcats</code>.</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb885-3" title="3">        <span class="dt">cuisine =</span> <span class="kw">fct_recode</span>(cuisine,</a>
<a class="sourceLine" id="cb885-4" title="4">            <span class="st">&quot;O&quot;</span> =<span class="st"> &quot;Oui&quot;</span>,</a>
<a class="sourceLine" id="cb885-5" title="5">            <span class="st">&quot;N&quot;</span> =<span class="st"> &quot;Non&quot;</span></a>
<a class="sourceLine" id="cb885-6" title="6">        )</a>
<a class="sourceLine" id="cb885-7" title="7">    )</a></code></pre></div>
<p>Supposons qu’on souhaite également convertir les <code>NA</code> éventuelles de <code>cuisine</code> en valeurs explicites <code>Non réponse</code>. On peut le faire avec la fonction <code>fct_explicit_na()</code> de <code>forcats</code>. Notre recodage doit donc se faire en deux étapes, par exemple de la manière suivante :</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb886-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb886-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb886-3" title="3">        <span class="dt">cuisine =</span> <span class="kw">fct_recode</span>(cuisine,</a>
<a class="sourceLine" id="cb886-4" title="4">            <span class="st">&quot;O&quot;</span> =<span class="st"> &quot;Oui&quot;</span>,</a>
<a class="sourceLine" id="cb886-5" title="5">            <span class="st">&quot;N&quot;</span> =<span class="st"> &quot;Non&quot;</span></a>
<a class="sourceLine" id="cb886-6" title="6">        ),</a>
<a class="sourceLine" id="cb886-7" title="7">        <span class="dt">cuisine =</span> <span class="kw">fct_explicit_na</span>(cuisine, <span class="st">&quot;Non réponse&quot;</span>)</a>
<a class="sourceLine" id="cb886-8" title="8">    )</a></code></pre></div>
<p>Comme notre recodage commence à être un peu complexe, on décide de l’extraire de notre <code>mutate</code> en créant une fonction dédiée. On la nomme <code>recode_oui_non</code>. Celle-ci prend en entrée un vecteur <code>v</code> et retourne le vecteur recodé.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" title="1">recode_oui_non &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb887-2" title="2">    v <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-3" title="3"><span class="st">        </span><span class="kw">fct_recode</span>(</a>
<a class="sourceLine" id="cb887-4" title="4">            <span class="st">&quot;O&quot;</span> =<span class="st"> &quot;Oui&quot;</span>,</a>
<a class="sourceLine" id="cb887-5" title="5">            <span class="st">&quot;N&quot;</span> =<span class="st"> &quot;Non&quot;</span></a>
<a class="sourceLine" id="cb887-6" title="6">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-7" title="7"><span class="st">        </span><span class="kw">fct_explicit_na</span>(<span class="st">&quot;Manquant&quot;</span>)</a>
<a class="sourceLine" id="cb887-8" title="8">}</a></code></pre></div>
<p>On peut dès lors simplifier notre <code>mutate</code> en appelant notre nouvelle fonction.</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb888-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb888-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">cuisine =</span> <span class="kw">recode_oui_non</span>(cuisine))</a></code></pre></div>
<p>Premier avantage : on gagne en lisibilité. On a séparé le code d’une opération spécifique dans une fonction avec un nom “parlant”, ce qui permet de savoir facilement à quoi elle sert. Et on a simplifié notre <code>mutate</code> qui est désormais plus lisible parce qu’il fait apparaître la logique des nos opérations (on veut recoder les valeurs “oui” / “non”) sans en inclure les détails.</p>
<p>Le deuxième avantage évident, comme pour toute fonction, est qu’on peut la réutiliser pour appliquer ce recodage à plusieurs variables. Ainsi, si on veut recoder de la même manière <code>cuisine</code> et <code>cinema</code>, il suffit de faire :</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb889-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb889-3" title="3">        <span class="dt">cuisine =</span> <span class="kw">recode_oui_non</span>(cuisine),</a>
<a class="sourceLine" id="cb889-4" title="4">        <span class="dt">cinema =</span> <span class="kw">recode_oui_non</span>(cinema)</a>
<a class="sourceLine" id="cb889-5" title="5">    )</a></code></pre></div>
<p>Le code est plus court, plus lisible, on évite les erreurs de copier/coller, et si on souhaite modifier le recodage on n’a à intervenir qu’à un seul endroit.</p>
</div>
<div id="exemple-avec-summarise" class="section level3">
<h3><span class="header-section-number">17.1.2</span> Exemple avec <code>summarise</code></h3>
<p>Autre exemple, cette fois sur le jeu de données <code>rp2012</code>. Imaginons qu’on souhaite calculer, pour chaque région, le pourcentage de communes dont le nom se termine par une série de caractères donnée.</p>
<p>Comme il ne s’agit pas forcément d’une question triviale, on va décomposer le problème et rappeler (comme vu section <a href="11-stringr.html#str-detect">11.6</a>) que la fonction <code>str_detect()</code> de l’extension <code>stringr</code> permet de détecter quels éléments d’un vecteur de chaînes de caractères correspondent à une expression régulière. Ainsi, si on veut détecter si un nom de commune (variable <code>rp2012$commune</code>) se termine par <code>"ac"</code>, on utilisera :</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb890-1" title="1"><span class="kw">str_detect</span>(rp2012<span class="op">$</span>commune, <span class="st">&quot;ac$&quot;</span>)</a></code></pre></div>
<div class="rmdnote">
<p>
Le symbole $ dans l’expression régulière <code>“ac$”</code> représente la fin de la chaîne de caractères. Il permet de s’assurer qu’on ne détecte que les noms de communes se terminant par “ac” (comme “Fige<strong>ac</strong>”), et pas ceux contenant “ac” à un autre endroit (comme “Arc<strong>ac</strong>hon”).
</p>
</div>
<p>Si on veut compter le nombre de communes pour lesquelles on a détecté une terminaison en “ac”, on peut tout simplement appliquer la fonction <code>sum()</code> au résultat précédent : les <code>TRUE</code> du résultat du <code>str_detect</code> sont alors convertis en 1, les <code>FALSE</code> en 0, et le <code>sum()</code> renverra donc le nombre de <code>TRUE</code>.</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" title="1"><span class="kw">sum</span>(<span class="kw">str_detect</span>(rp2012<span class="op">$</span>commune, <span class="st">&quot;ac$&quot;</span>))</a>
<a class="sourceLine" id="cb891-2" title="2"><span class="co">#&gt; [1] 122</span></a></code></pre></div>
<p>Si on souhaite convertir ce résultat en pourcentage, il faut qu’on divise par le nombre total de communes, et qu’on multiplie par 100.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb892-1" title="1"><span class="kw">sum</span>(<span class="kw">str_detect</span>(rp2012<span class="op">$</span>commune, <span class="st">&quot;ac$&quot;</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(rp2012<span class="op">$</span>commune) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb892-2" title="2"><span class="co">#&gt; [1] 2.359768</span></a></code></pre></div>
<p>On crée une fonction nommée <code>prop_suffixe</code> qui a pour objectif d’effectuer ce calcul. Elle prend en entrée deux arguments : un vecteur de chaînes de caractères et un “motif” à détecter. On rajoute nous-mêmes le “$” à la fin du motif en question pour faciliter l’usage de la fonction. Le résultat final est le suivant :</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb893-1" title="1">prop_suffixe &lt;-<span class="st"> </span><span class="cf">function</span>(v, motif) {</a>
<a class="sourceLine" id="cb893-2" title="2">    <span class="co"># On ajoute $ à la fin du motif pour capturer uniquement les suffixes</span></a>
<a class="sourceLine" id="cb893-3" title="3">    motif &lt;-<span class="st"> </span><span class="kw">paste0</span>(motif, <span class="st">&quot;$&quot;</span>)</a>
<a class="sourceLine" id="cb893-4" title="4">    <span class="co"># Détection du motif</span></a>
<a class="sourceLine" id="cb893-5" title="5">    nb_detect &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(v, motif))</a>
<a class="sourceLine" id="cb893-6" title="6">    <span class="co"># On retourne le pourcentage</span></a>
<a class="sourceLine" id="cb893-7" title="7">    nb_detect <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(v) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb893-8" title="8">}</a></code></pre></div>
<p>On peut utiliser notre fonction de la manière suivante :</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb894-1" title="1"><span class="kw">prop_suffixe</span>(rp2012<span class="op">$</span>commune, <span class="st">&quot;ac&quot;</span>)</a>
<a class="sourceLine" id="cb894-2" title="2"><span class="co">#&gt; [1] 2.359768</span></a></code></pre></div>
<p>On a donc dans notre jeu de données 2.36% de communes dont le nom se termine par “ac”<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>.</p>
<p>Si maintenant on souhaite calculer ce pourcentage pour toutes les régions françaises, il suffit d’appeler notre fonction dans un <code>summarise</code> :</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb895-1" title="1">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_ac =</span> <span class="kw">prop_suffixe</span>(commune, <span class="st">&quot;ac&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-4" title="4"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(prop_ac))</a>
<a class="sourceLine" id="cb895-5" title="5"><span class="co">#&gt; # A tibble: 26 × 2</span></a>
<a class="sourceLine" id="cb895-6" title="6"><span class="co">#&gt;    region               prop_ac</span></a>
<a class="sourceLine" id="cb895-7" title="7"><span class="co">#&gt;    &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb895-8" title="8"><span class="co">#&gt;  1 Limousin               19.6 </span></a>
<a class="sourceLine" id="cb895-9" title="9"><span class="co">#&gt;  2 Aquitaine              12.2 </span></a>
<a class="sourceLine" id="cb895-10" title="10"><span class="co">#&gt;  3 Auvergne                8.62</span></a>
<a class="sourceLine" id="cb895-11" title="11"><span class="co">#&gt;  4 Poitou-Charentes        5.88</span></a>
<a class="sourceLine" id="cb895-12" title="12"><span class="co">#&gt;  5 Bretagne                4.68</span></a>
<a class="sourceLine" id="cb895-13" title="13"><span class="co">#&gt;  6 Midi-Pyrénées           3.91</span></a>
<a class="sourceLine" id="cb895-14" title="14"><span class="co">#&gt;  7 Languedoc-Roussillon    3.89</span></a>
<a class="sourceLine" id="cb895-15" title="15"><span class="co">#&gt;  8 Pays de la Loire        2.18</span></a>
<a class="sourceLine" id="cb895-16" title="16"><span class="co">#&gt;  9 Franche-Comté           1.16</span></a>
<a class="sourceLine" id="cb895-17" title="17"><span class="co">#&gt; 10 Rhône-Alpes             1.03</span></a>
<a class="sourceLine" id="cb895-18" title="18"><span class="co">#&gt; # … with 16 more rows</span></a></code></pre></div>
<p>L’avantage d’avoir créé une fonction pour effectuer cette opération et qu’on peut du coup très facilement faire le même calcul en faisant varier le suffixe recherché.</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb896-1" title="1">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb896-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb896-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_ac =</span> <span class="kw">prop_suffixe</span>(commune, <span class="st">&quot;ieu&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb896-4" title="4"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(prop_ac))</a>
<a class="sourceLine" id="cb896-5" title="5"><span class="co">#&gt; # A tibble: 26 × 2</span></a>
<a class="sourceLine" id="cb896-6" title="6"><span class="co">#&gt;    region           prop_ac</span></a>
<a class="sourceLine" id="cb896-7" title="7"><span class="co">#&gt;    &lt;chr&gt;              &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb896-8" title="8"><span class="co">#&gt;  1 Rhône-Alpes        3.42 </span></a>
<a class="sourceLine" id="cb896-9" title="9"><span class="co">#&gt;  2 Midi-Pyrénées      1.30 </span></a>
<a class="sourceLine" id="cb896-10" title="10"><span class="co">#&gt;  3 Bourgogne          0.917</span></a>
<a class="sourceLine" id="cb896-11" title="11"><span class="co">#&gt;  4 Pays de la Loire   0.485</span></a>
<a class="sourceLine" id="cb896-12" title="12"><span class="co">#&gt;  5 Aquitaine          0.358</span></a>
<a class="sourceLine" id="cb896-13" title="13"><span class="co">#&gt;  6 Alsace             0    </span></a>
<a class="sourceLine" id="cb896-14" title="14"><span class="co">#&gt;  7 Auvergne           0    </span></a>
<a class="sourceLine" id="cb896-15" title="15"><span class="co">#&gt;  8 Basse-Normandie    0    </span></a>
<a class="sourceLine" id="cb896-16" title="16"><span class="co">#&gt;  9 Bretagne           0    </span></a>
<a class="sourceLine" id="cb896-17" title="17"><span class="co">#&gt; 10 Centre             0    </span></a>
<a class="sourceLine" id="cb896-18" title="18"><span class="co">#&gt; # … with 16 more rows</span></a></code></pre></div>
<p>En créant une fonction plutôt qu’en mettant notre code directement dans le <code>summarise</code> on a un script plus lisible, plus facile à maintenir, et des fonctionnalités facilement réutilisables.</p>
</div>
<div id="exemple-avec-rename_with" class="section level3">
<h3><span class="header-section-number">17.1.3</span> Exemple avec <code>rename_with</code></h3>
<p>On a vu section <a href="10-dplyr.html#select-rename">10.2.3</a> que <code>dplyr</code> propose la fonction <code>rename()</code> pour renommer des colonnes d’un tableau de données. On peut l’utiliser par exemple pour remplacer un <code>.</code> par un <code>_</code> dans le nom d’une variable d’<code>hdv2003</code>.</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb897-1" title="1">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="st">&quot;lecture_bd&quot;</span> =<span class="st"> &quot;lecture.bd&quot;</span>)</a></code></pre></div>
<p>Supposons maintenant qu’on souhaite appliquer la même transformation à l’ensemble des variables de <code>hdv2003</code>. Une solution pour cela est d’utiliser la fonction <code>rename_with()</code>, toujours fournie par <code>dplyr</code>, qui prend en argument non pas une correspondance <code>"nouveau nom" = "ancien nom"</code> mais une fonction qui sera appliquée à l’ensemble des noms de colonnes.</p>
<p>Par exemple, si on souhaite convertir tous les noms de colonnes en majuscules, on peut passer comme argument la fonction <code>str_to_upper()</code> de <code>stringr</code>.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb898-1" title="1">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_with</span>(str_to_upper)</a>
<a class="sourceLine" id="cb898-2" title="2"><span class="co">#&gt;    ID AGE  SEXE                                              NIVETUD     POIDS</span></a>
<a class="sourceLine" id="cb898-3" title="3"><span class="co">#&gt; 1   1  28 Femme Enseignement superieur y compris technique superieur  2634.398</span></a>
<a class="sourceLine" id="cb898-4" title="4"><span class="co">#&gt; 2   2  23 Femme                                                 &lt;NA&gt;  9738.396</span></a>
<a class="sourceLine" id="cb898-5" title="5"><span class="co">#&gt; 3   3  59 Homme                    Derniere annee d&#39;etudes primaires  3994.102</span></a>
<a class="sourceLine" id="cb898-6" title="6"><span class="co">#&gt; 4   4  34 Homme Enseignement superieur y compris technique superieur  5731.662</span></a>
<a class="sourceLine" id="cb898-7" title="7"><span class="co">#&gt; 5   5  71 Femme                    Derniere annee d&#39;etudes primaires  4329.094</span></a>
<a class="sourceLine" id="cb898-8" title="8"><span class="co">#&gt; 6   6  35 Femme        Enseignement technique ou professionnel court  8674.699</span></a>
<a class="sourceLine" id="cb898-9" title="9"><span class="co">#&gt; 7   7  60 Femme                    Derniere annee d&#39;etudes primaires  6165.803</span></a>
<a class="sourceLine" id="cb898-10" title="10"><span class="co">#&gt; 8   8  47 Homme        Enseignement technique ou professionnel court 12891.641</span></a>
<a class="sourceLine" id="cb898-11" title="11"><span class="co">#&gt; 9   9  20 Femme                                                 &lt;NA&gt;  7808.872</span></a>
<a class="sourceLine" id="cb898-12" title="12"><span class="co">#&gt; 10 10  28 Homme         Enseignement technique ou professionnel long  2277.160</span></a>
<a class="sourceLine" id="cb898-13" title="13"><span class="co">#&gt;                    OCCUP           QUALIF FRERES.SOEURS CLSO</span></a>
<a class="sourceLine" id="cb898-14" title="14"><span class="co">#&gt; 1  Exerce une profession          Employe             8  Oui</span></a>
<a class="sourceLine" id="cb898-15" title="15"><span class="co">#&gt; 2        Etudiant, eleve             &lt;NA&gt;             2  Oui</span></a>
<a class="sourceLine" id="cb898-16" title="16"><span class="co">#&gt; 3  Exerce une profession       Technicien             2  Non</span></a>
<a class="sourceLine" id="cb898-17" title="17"><span class="co">#&gt; 4  Exerce une profession       Technicien             1  Non</span></a>
<a class="sourceLine" id="cb898-18" title="18"><span class="co">#&gt; 5               Retraite          Employe             0  Oui</span></a>
<a class="sourceLine" id="cb898-19" title="19"><span class="co">#&gt; 6  Exerce une profession          Employe             5  Non</span></a>
<a class="sourceLine" id="cb898-20" title="20"><span class="co">#&gt; 7               Au foyer Ouvrier qualifie             1  Oui</span></a>
<a class="sourceLine" id="cb898-21" title="21"><span class="co">#&gt; 8  Exerce une profession Ouvrier qualifie             5  Non</span></a>
<a class="sourceLine" id="cb898-22" title="22"><span class="co">#&gt; 9        Etudiant, eleve             &lt;NA&gt;             4  Oui</span></a>
<a class="sourceLine" id="cb898-23" title="23"><span class="co">#&gt; 10 Exerce une profession            Autre             2  Non</span></a>
<a class="sourceLine" id="cb898-24" title="24"><span class="co">#&gt;                          RELIG                     TRAV.IMP    TRAV.SATISF</span></a>
<a class="sourceLine" id="cb898-25" title="25"><span class="co">#&gt; 1  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb898-26" title="26"><span class="co">#&gt; 2  Ni croyance ni appartenance                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb898-27" title="27"><span class="co">#&gt; 3  Ni croyance ni appartenance Aussi important que le reste      Equilibre</span></a>
<a class="sourceLine" id="cb898-28" title="28"><span class="co">#&gt; 4   Appartenance sans pratique Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb898-29" title="29"><span class="co">#&gt; 5          Pratiquant regulier                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb898-30" title="30"><span class="co">#&gt; 6  Ni croyance ni appartenance            Le plus important      Equilibre</span></a>
<a class="sourceLine" id="cb898-31" title="31"><span class="co">#&gt; 7   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb898-32" title="32"><span class="co">#&gt; 8  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb898-33" title="33"><span class="co">#&gt; 9   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb898-34" title="34"><span class="co">#&gt; 10      Pratiquant occasionnel Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb898-35" title="35"><span class="co">#&gt;    HARD.ROCK LECTURE.BD PECHE.CHASSE CUISINE BRICOL CINEMA SPORT HEURES.TV</span></a>
<a class="sourceLine" id="cb898-36" title="36"><span class="co">#&gt; 1        Non        Non          Non     Oui    Non    Non   Non       0.0</span></a>
<a class="sourceLine" id="cb898-37" title="37"><span class="co">#&gt; 2        Non        Non          Non     Non    Non    Oui   Oui       1.0</span></a>
<a class="sourceLine" id="cb898-38" title="38"><span class="co">#&gt; 3        Non        Non          Non     Non    Non    Non   Oui       0.0</span></a>
<a class="sourceLine" id="cb898-39" title="39"><span class="co">#&gt; 4        Non        Non          Non     Oui    Oui    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb898-40" title="40"><span class="co">#&gt; 5        Non        Non          Non     Non    Non    Non   Non       3.0</span></a>
<a class="sourceLine" id="cb898-41" title="41"><span class="co">#&gt; 6        Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb898-42" title="42"><span class="co">#&gt; 7        Non        Non          Oui     Oui    Non    Non   Non       2.9</span></a>
<a class="sourceLine" id="cb898-43" title="43"><span class="co">#&gt; 8        Non        Non          Oui     Oui    Oui    Non   Non       1.0</span></a>
<a class="sourceLine" id="cb898-44" title="44"><span class="co">#&gt; 9        Non        Non          Non     Non    Non    Oui   Non       2.0</span></a>
<a class="sourceLine" id="cb898-45" title="45"><span class="co">#&gt; 10       Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb898-46" title="46"><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1990 rows ]</span></a></code></pre></div>
<p>Pour remplacer les <code>.</code> par des <code>_</code>, on va d’abord créer une fonction <em>ad hoc</em> qui utilise <code>str_replace_all</code>.</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb899-1" title="1">remplace_points &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb899-2" title="2">    <span class="kw">str_replace_all</span>(v, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>)</a>
<a class="sourceLine" id="cb899-3" title="3">}</a></code></pre></div>
<div class="rmdnote">
<p>
On notera qu’on est obligé d’utiliser ici la fonction <code>fixed()</code> pour indiquer que le motif <code>“.”</code> est bien le caractère <code>.</code> et pas une expression régulière.
</p>
</div>
<p>Dès lors, on peut appliquer cette fonction à l’ensemble de nos noms de variables :</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb900-1" title="1">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_with</span>(remplace_points)</a>
<a class="sourceLine" id="cb900-2" title="2"><span class="co">#&gt;    id age  sexe                                              nivetud     poids</span></a>
<a class="sourceLine" id="cb900-3" title="3"><span class="co">#&gt; 1   1  28 Femme Enseignement superieur y compris technique superieur  2634.398</span></a>
<a class="sourceLine" id="cb900-4" title="4"><span class="co">#&gt; 2   2  23 Femme                                                 &lt;NA&gt;  9738.396</span></a>
<a class="sourceLine" id="cb900-5" title="5"><span class="co">#&gt; 3   3  59 Homme                    Derniere annee d&#39;etudes primaires  3994.102</span></a>
<a class="sourceLine" id="cb900-6" title="6"><span class="co">#&gt; 4   4  34 Homme Enseignement superieur y compris technique superieur  5731.662</span></a>
<a class="sourceLine" id="cb900-7" title="7"><span class="co">#&gt; 5   5  71 Femme                    Derniere annee d&#39;etudes primaires  4329.094</span></a>
<a class="sourceLine" id="cb900-8" title="8"><span class="co">#&gt; 6   6  35 Femme        Enseignement technique ou professionnel court  8674.699</span></a>
<a class="sourceLine" id="cb900-9" title="9"><span class="co">#&gt; 7   7  60 Femme                    Derniere annee d&#39;etudes primaires  6165.803</span></a>
<a class="sourceLine" id="cb900-10" title="10"><span class="co">#&gt; 8   8  47 Homme        Enseignement technique ou professionnel court 12891.641</span></a>
<a class="sourceLine" id="cb900-11" title="11"><span class="co">#&gt; 9   9  20 Femme                                                 &lt;NA&gt;  7808.872</span></a>
<a class="sourceLine" id="cb900-12" title="12"><span class="co">#&gt; 10 10  28 Homme         Enseignement technique ou professionnel long  2277.160</span></a>
<a class="sourceLine" id="cb900-13" title="13"><span class="co">#&gt;                    occup           qualif freres_soeurs clso</span></a>
<a class="sourceLine" id="cb900-14" title="14"><span class="co">#&gt; 1  Exerce une profession          Employe             8  Oui</span></a>
<a class="sourceLine" id="cb900-15" title="15"><span class="co">#&gt; 2        Etudiant, eleve             &lt;NA&gt;             2  Oui</span></a>
<a class="sourceLine" id="cb900-16" title="16"><span class="co">#&gt; 3  Exerce une profession       Technicien             2  Non</span></a>
<a class="sourceLine" id="cb900-17" title="17"><span class="co">#&gt; 4  Exerce une profession       Technicien             1  Non</span></a>
<a class="sourceLine" id="cb900-18" title="18"><span class="co">#&gt; 5               Retraite          Employe             0  Oui</span></a>
<a class="sourceLine" id="cb900-19" title="19"><span class="co">#&gt; 6  Exerce une profession          Employe             5  Non</span></a>
<a class="sourceLine" id="cb900-20" title="20"><span class="co">#&gt; 7               Au foyer Ouvrier qualifie             1  Oui</span></a>
<a class="sourceLine" id="cb900-21" title="21"><span class="co">#&gt; 8  Exerce une profession Ouvrier qualifie             5  Non</span></a>
<a class="sourceLine" id="cb900-22" title="22"><span class="co">#&gt; 9        Etudiant, eleve             &lt;NA&gt;             4  Oui</span></a>
<a class="sourceLine" id="cb900-23" title="23"><span class="co">#&gt; 10 Exerce une profession            Autre             2  Non</span></a>
<a class="sourceLine" id="cb900-24" title="24"><span class="co">#&gt;                          relig                     trav_imp    trav_satisf</span></a>
<a class="sourceLine" id="cb900-25" title="25"><span class="co">#&gt; 1  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb900-26" title="26"><span class="co">#&gt; 2  Ni croyance ni appartenance                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb900-27" title="27"><span class="co">#&gt; 3  Ni croyance ni appartenance Aussi important que le reste      Equilibre</span></a>
<a class="sourceLine" id="cb900-28" title="28"><span class="co">#&gt; 4   Appartenance sans pratique Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb900-29" title="29"><span class="co">#&gt; 5          Pratiquant regulier                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb900-30" title="30"><span class="co">#&gt; 6  Ni croyance ni appartenance            Le plus important      Equilibre</span></a>
<a class="sourceLine" id="cb900-31" title="31"><span class="co">#&gt; 7   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb900-32" title="32"><span class="co">#&gt; 8  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb900-33" title="33"><span class="co">#&gt; 9   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb900-34" title="34"><span class="co">#&gt; 10      Pratiquant occasionnel Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb900-35" title="35"><span class="co">#&gt;    hard_rock lecture_bd peche_chasse cuisine bricol cinema sport heures_tv</span></a>
<a class="sourceLine" id="cb900-36" title="36"><span class="co">#&gt; 1        Non        Non          Non     Oui    Non    Non   Non       0.0</span></a>
<a class="sourceLine" id="cb900-37" title="37"><span class="co">#&gt; 2        Non        Non          Non     Non    Non    Oui   Oui       1.0</span></a>
<a class="sourceLine" id="cb900-38" title="38"><span class="co">#&gt; 3        Non        Non          Non     Non    Non    Non   Oui       0.0</span></a>
<a class="sourceLine" id="cb900-39" title="39"><span class="co">#&gt; 4        Non        Non          Non     Oui    Oui    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb900-40" title="40"><span class="co">#&gt; 5        Non        Non          Non     Non    Non    Non   Non       3.0</span></a>
<a class="sourceLine" id="cb900-41" title="41"><span class="co">#&gt; 6        Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb900-42" title="42"><span class="co">#&gt; 7        Non        Non          Oui     Oui    Non    Non   Non       2.9</span></a>
<a class="sourceLine" id="cb900-43" title="43"><span class="co">#&gt; 8        Non        Non          Oui     Oui    Oui    Non   Non       1.0</span></a>
<a class="sourceLine" id="cb900-44" title="44"><span class="co">#&gt; 9        Non        Non          Non     Non    Non    Oui   Non       2.0</span></a>
<a class="sourceLine" id="cb900-45" title="45"><span class="co">#&gt; 10       Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb900-46" title="46"><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1990 rows ]</span></a></code></pre></div>
<p>Certain.es lectrices et lecteurs attentives auront peut-être noté que le même résultat peut être obtenu en utilisant <code>remplace_points()</code> avec la fonction <code>names()</code>.</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb901-1" title="1"><span class="kw">names</span>(hdv2003) &lt;-<span class="st"> </span><span class="kw">remplace_points</span>(<span class="kw">names</span>(hdv2003))</a></code></pre></div>
<p>L’avantage de <code>rename_with()</code>, comme nous allons le voir ci-dessous, c’est qu’elle permet si nécessaire de n’appliquer cette transformation qu’à certaines colonnes seulement.</p>
</div>
</div>
<div id="across" class="section level2">
<h2><span class="header-section-number">17.2</span> <code>across()</code> : appliquer des fonctions à plusieurs colonnes</h2>
<div id="appliquer-une-fonction-à-plusieurs-colonnes" class="section level3">
<h3><span class="header-section-number">17.2.1</span> Appliquer une fonction à plusieurs colonnes</h3>
<p>On a défini précédemment une fonction qui recode les modalités d’une variable “Oui” / “Non” et on a vu comment appliquer ce recodage à deux variables de <code>hdv2003</code>.</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb902-1" title="1">recode_oui_non &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb902-2" title="2">    v <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-3" title="3"><span class="st">        </span><span class="kw">fct_recode</span>(</a>
<a class="sourceLine" id="cb902-4" title="4">            <span class="st">&quot;O&quot;</span> =<span class="st"> &quot;Oui&quot;</span>,</a>
<a class="sourceLine" id="cb902-5" title="5">            <span class="st">&quot;N&quot;</span> =<span class="st"> &quot;Non&quot;</span></a>
<a class="sourceLine" id="cb902-6" title="6">        ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-7" title="7"><span class="st">        </span><span class="kw">fct_explicit_na</span>(<span class="st">&quot;Manquant&quot;</span>)</a>
<a class="sourceLine" id="cb902-8" title="8">}</a>
<a class="sourceLine" id="cb902-9" title="9"></a>
<a class="sourceLine" id="cb902-10" title="10"><span class="kw">data</span>(hdv2003)</a>
<a class="sourceLine" id="cb902-11" title="11">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-12" title="12"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb902-13" title="13">        <span class="dt">cuisine =</span> <span class="kw">recode_oui_non</span>(cuisine),</a>
<a class="sourceLine" id="cb902-14" title="14">        <span class="dt">cinema =</span> <span class="kw">recode_oui_non</span>(cinema)</a>
<a class="sourceLine" id="cb902-15" title="15">    )</a></code></pre></div>
<p>Supposons qu’on souhaite appliquer ce recodage à toutes les variables “Oui” / “Non” de notre tableau. On pourrait évidemment créer autant de lignes que nécessaires dans notre <code>mutate</code>, mais on peut aussi utiliser la fonction <code>across()</code> de <code>dplyr</code>, qui permet justement ce type d’opérations.</p>
<p><code>across()</code> prend deux arguments principaux :</p>
<ul>
<li>la définition d’un ensemble de colonnes de notre tableau de données</li>
<li>une ou plusieurs fonctions à appliquer aux colonnes sélectionnées</li>
</ul>
<p>Il existe de nombreuses manières de définir les colonnes qu’on souhaite transformer : celles-ci sont en fait les mêmes que celles offertes par le verbe <code>select()</code>.</p>
<p>Une première possibilité est d’utiliser <code>c()</code> en lui passant les noms des variables (on notera qu’on n’est pas obligés de mettre ces noms entre guillemets).</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb903-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb903-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb903-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb903-4" title="4">            <span class="kw">c</span>(cinema, cuisine, lecture.bd, bricol),</a>
<a class="sourceLine" id="cb903-5" title="5">            recode_oui_non</a>
<a class="sourceLine" id="cb903-6" title="6">        )</a>
<a class="sourceLine" id="cb903-7" title="7">    )</a></code></pre></div>
<p>Une autre possibilité est d’utiliser <code>:</code>, qui permet de définir une plage de colonnes en lui indiquant la colonne de début et la colonne de fin. Ainsi dans l’exemple suivant notre recodage est appliqué à toutes les colonnes situées entre <code>hard.rock</code> et <code>sport</code> (incluses).</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb904-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb904-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb904-4" title="4">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb904-5" title="5">            recode_oui_non</a>
<a class="sourceLine" id="cb904-6" title="6">        )</a>
<a class="sourceLine" id="cb904-7" title="7">    )</a></code></pre></div>
<p>On peut aussi sélectionner les variables via leurs noms. On peut ainsi choisir les variables qui commencent par une certaine chaîne de caractères via la fonction <code>starts_with()</code>, celles qui se terminent ou qui contiennent certains caractères avec <code>ends_with()</code> et <code>contains()</code>.</p>
<p>Dans l’exemple suivant, on effectue un <code>summarise</code> qui applique la fonction <code>max()</code> à toutes les variables de <code>rp2012</code> qui commencent par <code>dipl</code>.</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb905-1" title="1">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb905-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb905-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb905-4" title="4">            <span class="kw">starts_with</span>(<span class="st">&quot;dipl&quot;</span>),</a>
<a class="sourceLine" id="cb905-5" title="5">            max</a>
<a class="sourceLine" id="cb905-6" title="6">        )</a>
<a class="sourceLine" id="cb905-7" title="7">    )</a>
<a class="sourceLine" id="cb905-8" title="8"><span class="co">#&gt; # A tibble: 1 × 6</span></a>
<a class="sourceLine" id="cb905-9" title="9"><span class="co">#&gt;   dipl_aucun dipl_bepc dipl_capbep dipl_bac dipl_bac2 dipl_sup</span></a>
<a class="sourceLine" id="cb905-10" title="10"><span class="co">#&gt;        &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb905-11" title="11"><span class="co">#&gt; 1       93.4      18.0        43.6     40.4      35.0     54.8</span></a></code></pre></div>
<p>De manière similaire, la fonction <code>num_range()</code> permet de sélectionner des colonnes ayant un préfixe commun suivi d’un indicateur numérique, comme <code>x1</code>, <code>x2</code>… Par exemple la syntaxe suivante sélectionnerait toutes les colonnes de <code>Q01</code> à <code>Q12</code> :</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" title="1"><span class="kw">across</span>(<span class="kw">num_range</span>(<span class="st">&quot;Q&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">width =</span> <span class="dv">2</span>))</a></code></pre></div>
<p>On peut également sélectionner des colonnes via une condition avec la fonction <code>where()</code>. Celle-ci prend elle-même en argument une fonction qui doit renvoyer <code>TRUE</code> ou <code>FALSE</code>, et ne conserve que les colonnes qui correspondent à des <code>TRUE</code>.</p>
<p>Dans l’exemple suivant, on applique la fonction <code>max</code> seulement aux colonnes de <code>hdv2003</code> pour lesquelles la fonction <code>is.numeric</code> renvoie <code>TRUE</code>.</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb907-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb907-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb907-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb907-4" title="4">            <span class="kw">where</span>(is.numeric),</a>
<a class="sourceLine" id="cb907-5" title="5">            max</a>
<a class="sourceLine" id="cb907-6" title="6">        )</a>
<a class="sourceLine" id="cb907-7" title="7">    )</a>
<a class="sourceLine" id="cb907-8" title="8"><span class="co">#&gt;     id age    poids freres.soeurs heures.tv</span></a>
<a class="sourceLine" id="cb907-9" title="9"><span class="co">#&gt; 1 2000  97 31092.14            22        NA</span></a></code></pre></div>
<p>Pour des conditions plus complexes, on doit parfois définir soi-même la fonction passée à <code>where()</code>. Ainsi, si on souhaite appliquer <code>recode_oui_non()</code> à toutes les colonnes de <code>hdv2003</code> contenant la modalité “Oui”, on peut faire :</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb908-1" title="1">detecte_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb908-2" title="2">    <span class="st">&quot;Oui&quot;</span> <span class="op">%in%</span><span class="st"> </span>v</a>
<a class="sourceLine" id="cb908-3" title="3">}</a>
<a class="sourceLine" id="cb908-4" title="4"></a>
<a class="sourceLine" id="cb908-5" title="5">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb908-6" title="6"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb908-7" title="7">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb908-8" title="8">            <span class="kw">where</span>(detecte_oui),</a>
<a class="sourceLine" id="cb908-9" title="9">            recode_oui_non</a>
<a class="sourceLine" id="cb908-10" title="10">        )</a>
<a class="sourceLine" id="cb908-11" title="11">    )</a></code></pre></div>
<p>Il est même possible, pour les cas les plus complexes, de combiner plusieurs sélections avec les opérateurs <code>&amp;</code>, <code>|</code> et <code>!</code>. L’exemple suivant applique la fonction <code>max()</code> à toutes les colonnes numériques de <code>hdv2003</code>, sauf aux colonnes <code>id</code> et <code>poids</code>.</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb909-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb909-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb909-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb909-4" title="4">            <span class="kw">where</span>(is.numeric) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">c</span>(id, poids),</a>
<a class="sourceLine" id="cb909-5" title="5">            max</a>
<a class="sourceLine" id="cb909-6" title="6">        )</a>
<a class="sourceLine" id="cb909-7" title="7">    )</a>
<a class="sourceLine" id="cb909-8" title="8"><span class="co">#&gt;   age freres.soeurs heures.tv</span></a>
<a class="sourceLine" id="cb909-9" title="9"><span class="co">#&gt; 1  97            22        NA</span></a></code></pre></div>
<p>Enfin, la fonction spéciale <code>everything()</code> permet de sélectionner la totalité des colonnes d’un tableau. Dans l’exemple suivant, on applique <code>n_distinct()</code> pour afficher le nombre de valeurs distinctes de toutes les variables de <code>hdv2003</code>.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb910-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb910-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb910-4" title="4">            <span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb910-5" title="5">            n_distinct</a>
<a class="sourceLine" id="cb910-6" title="6">        )</a>
<a class="sourceLine" id="cb910-7" title="7">    )</a>
<a class="sourceLine" id="cb910-8" title="8"><span class="co">#&gt;     id age sexe nivetud poids occup qualif freres.soeurs clso relig trav.imp</span></a>
<a class="sourceLine" id="cb910-9" title="9"><span class="co">#&gt; 1 2000  78    2       9  1877     7      8            19    3     6        5</span></a>
<a class="sourceLine" id="cb910-10" title="10"><span class="co">#&gt;   trav.satisf hard.rock lecture.bd peche.chasse cuisine bricol cinema sport</span></a>
<a class="sourceLine" id="cb910-11" title="11"><span class="co">#&gt; 1           4         2          2            2       2      2      2     2</span></a>
<a class="sourceLine" id="cb910-12" title="12"><span class="co">#&gt;   heures.tv</span></a>
<a class="sourceLine" id="cb910-13" title="13"><span class="co">#&gt; 1        30</span></a></code></pre></div>
<p>Cette manière de sélectionner un ensemble de colonnes est appelée <em>tidy selection</em>. Elle offre encore d’autres possibilités de sélection, pour avoir un aperçu complet on pourra se référer à <a href="https://dplyr.tidyverse.org/reference/select.html">la page de documentation de la fonction select()</a>.</p>
<div class="rmdnote">
<p>
Une erreur de syntaxe fréquente est de mettre la sélection des colonnes dans l’appel à <code>across()</code>, mais pas la fonction qu’on souhaite appliquer.
</p>
<p>
Ainsi le code suivant génèrera une erreur :
</p>
<p>
<code>mutate(across(hard.rock:sport), recode_oui_non)</code>
</p>
<p>
Il faut bien penser à passer la fonction comme argument du <code>across()</code>, donc à l’intérieur de ses parenthèses.
</p>
<p>
<code>mutate(across(hard.rock:sport, recode_oui_non))</code>
</p>
</div>
</div>
<div id="passer-des-arguments-supplémentaires-à-la-fonction-appliquée" class="section level3">
<h3><span class="header-section-number">17.2.2</span> Passer des arguments supplémentaires à la fonction appliquée</h3>
<p>Par défaut, si on passe des arguments supplémentaires à <code>across()</code>, ils seront automatiquement transmis comme arguments à la fonction appliquée.</p>
<p>Dans l’exemple vu précédemment, on appliquait <code>max()</code> à toutes les variables numériques de <code>hdv2003</code>.</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb911-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb911-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb911-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb911-4" title="4">            <span class="kw">where</span>(is.numeric),</a>
<a class="sourceLine" id="cb911-5" title="5">            max</a>
<a class="sourceLine" id="cb911-6" title="6">        )</a>
<a class="sourceLine" id="cb911-7" title="7">    )</a></code></pre></div>
<p>Si on souhaite que <code>max()</code> soit appelé avec l’argument <code>na.rm = TRUE</code>, on pourrait définir explicitement une fonction à part qui utilise cet argument :</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" title="1">max_sans_na &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb912-2" title="2">    <span class="kw">max</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb912-3" title="3">}</a>
<a class="sourceLine" id="cb912-4" title="4"></a>
<a class="sourceLine" id="cb912-5" title="5">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb912-7" title="7">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb912-8" title="8">            <span class="kw">where</span>(is.numeric),</a>
<a class="sourceLine" id="cb912-9" title="9">            max_sans_na</a>
<a class="sourceLine" id="cb912-10" title="10">        )</a>
<a class="sourceLine" id="cb912-11" title="11">    )</a></code></pre></div>
<p>Mais on peut faire plus simple, car tout argument supplémentaire passé à <code>across()</code> est transmis directement à la fonction appelée. Il est donc possible de faire :</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb913-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb913-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb913-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb913-4" title="4">            <span class="kw">where</span>(is.numeric),</a>
<a class="sourceLine" id="cb913-5" title="5">            max,</a>
<a class="sourceLine" id="cb913-6" title="6">            <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb913-7" title="7">        )</a>
<a class="sourceLine" id="cb913-8" title="8">    )</a>
<a class="sourceLine" id="cb913-9" title="9"><span class="co">#&gt;     id age    poids freres.soeurs heures.tv</span></a>
<a class="sourceLine" id="cb913-10" title="10"><span class="co">#&gt; 1 2000  97 31092.14            22        12</span></a></code></pre></div>
</div>
<div id="noms-des-nouvelles-colonnes" class="section level3">
<h3><span class="header-section-number">17.2.3</span> Noms des nouvelles colonnes</h3>
<p>Par défaut, lorsqu’on utilise <code>across()</code> dans un <code>mutate</code>, les nouvelles colonnes portent le même nom que les colonnes d’origine, ce qui signifie que ces dernières sont “écrasées” par les nouvelles valeurs.</p>
<p>Ainsi dans l’exemple suivant, les valeurs d’origine des colonnes entre <code>hard.rock</code> et <code>sport</code> ont été écrasées par le résultat du recodage.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb914-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb914-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb914-4" title="4">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb914-5" title="5">            recode_oui_non</a>
<a class="sourceLine" id="cb914-6" title="6">        )</a>
<a class="sourceLine" id="cb914-7" title="7">    )</a></code></pre></div>
<p>Si on préfère créer de nouvelles colonnes, on doit indiquer la manière de les nommer en utilisant l’argument <code>.names</code> de <code>across()</code>. Celui prend comme valeur une chaîne de caractère dans laquelle le motif <code>{.col}</code> sera remplacé par le nom de la colonne d’origine.</p>
<p>Ainsi, si on souhaite plutôt que les variables recodées soient stockées dans de nouvelles colonnes nommées avec le suffixe <code>_rec</code>, on peut utiliser :</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb915-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb915-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb915-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb915-4" title="4">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb915-5" title="5">            recode_oui_non,</a>
<a class="sourceLine" id="cb915-6" title="6">            <span class="dt">.names =</span> <span class="st">&quot;{.col}_rec&quot;</span></a>
<a class="sourceLine" id="cb915-7" title="7">        )</a>
<a class="sourceLine" id="cb915-8" title="8">    )</a>
<a class="sourceLine" id="cb915-9" title="9"><span class="co">#&gt;   id age  sexe                                              nivetud    poids</span></a>
<a class="sourceLine" id="cb915-10" title="10"><span class="co">#&gt; 1  1  28 Femme Enseignement superieur y compris technique superieur 2634.398</span></a>
<a class="sourceLine" id="cb915-11" title="11"><span class="co">#&gt; 2  2  23 Femme                                                 &lt;NA&gt; 9738.396</span></a>
<a class="sourceLine" id="cb915-12" title="12"><span class="co">#&gt; 3  3  59 Homme                    Derniere annee d&#39;etudes primaires 3994.102</span></a>
<a class="sourceLine" id="cb915-13" title="13"><span class="co">#&gt; 4  4  34 Homme Enseignement superieur y compris technique superieur 5731.662</span></a>
<a class="sourceLine" id="cb915-14" title="14"><span class="co">#&gt; 5  5  71 Femme                    Derniere annee d&#39;etudes primaires 4329.094</span></a>
<a class="sourceLine" id="cb915-15" title="15"><span class="co">#&gt; 6  6  35 Femme        Enseignement technique ou professionnel court 8674.699</span></a>
<a class="sourceLine" id="cb915-16" title="16"><span class="co">#&gt; 7  7  60 Femme                    Derniere annee d&#39;etudes primaires 6165.803</span></a>
<a class="sourceLine" id="cb915-17" title="17"><span class="co">#&gt;                   occup           qualif freres.soeurs clso</span></a>
<a class="sourceLine" id="cb915-18" title="18"><span class="co">#&gt; 1 Exerce une profession          Employe             8  Oui</span></a>
<a class="sourceLine" id="cb915-19" title="19"><span class="co">#&gt; 2       Etudiant, eleve             &lt;NA&gt;             2  Oui</span></a>
<a class="sourceLine" id="cb915-20" title="20"><span class="co">#&gt; 3 Exerce une profession       Technicien             2  Non</span></a>
<a class="sourceLine" id="cb915-21" title="21"><span class="co">#&gt; 4 Exerce une profession       Technicien             1  Non</span></a>
<a class="sourceLine" id="cb915-22" title="22"><span class="co">#&gt; 5              Retraite          Employe             0  Oui</span></a>
<a class="sourceLine" id="cb915-23" title="23"><span class="co">#&gt; 6 Exerce une profession          Employe             5  Non</span></a>
<a class="sourceLine" id="cb915-24" title="24"><span class="co">#&gt; 7              Au foyer Ouvrier qualifie             1  Oui</span></a>
<a class="sourceLine" id="cb915-25" title="25"><span class="co">#&gt;                         relig                     trav.imp    trav.satisf</span></a>
<a class="sourceLine" id="cb915-26" title="26"><span class="co">#&gt; 1 Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb915-27" title="27"><span class="co">#&gt; 2 Ni croyance ni appartenance                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb915-28" title="28"><span class="co">#&gt; 3 Ni croyance ni appartenance Aussi important que le reste      Equilibre</span></a>
<a class="sourceLine" id="cb915-29" title="29"><span class="co">#&gt; 4  Appartenance sans pratique Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb915-30" title="30"><span class="co">#&gt; 5         Pratiquant regulier                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb915-31" title="31"><span class="co">#&gt; 6 Ni croyance ni appartenance            Le plus important      Equilibre</span></a>
<a class="sourceLine" id="cb915-32" title="32"><span class="co">#&gt; 7  Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb915-33" title="33"><span class="co">#&gt;   hard.rock lecture.bd peche.chasse cuisine bricol cinema sport heures.tv</span></a>
<a class="sourceLine" id="cb915-34" title="34"><span class="co">#&gt; 1       Non        Non          Non     Oui    Non    Non   Non       0.0</span></a>
<a class="sourceLine" id="cb915-35" title="35"><span class="co">#&gt; 2       Non        Non          Non     Non    Non    Oui   Oui       1.0</span></a>
<a class="sourceLine" id="cb915-36" title="36"><span class="co">#&gt; 3       Non        Non          Non     Non    Non    Non   Oui       0.0</span></a>
<a class="sourceLine" id="cb915-37" title="37"><span class="co">#&gt; 4       Non        Non          Non     Oui    Oui    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb915-38" title="38"><span class="co">#&gt; 5       Non        Non          Non     Non    Non    Non   Non       3.0</span></a>
<a class="sourceLine" id="cb915-39" title="39"><span class="co">#&gt; 6       Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb915-40" title="40"><span class="co">#&gt; 7       Non        Non          Oui     Oui    Non    Non   Non       2.9</span></a>
<a class="sourceLine" id="cb915-41" title="41"><span class="co">#&gt;   hard.rock_rec lecture.bd_rec peche.chasse_rec cuisine_rec bricol_rec</span></a>
<a class="sourceLine" id="cb915-42" title="42"><span class="co">#&gt; 1             N              N                N           O          N</span></a>
<a class="sourceLine" id="cb915-43" title="43"><span class="co">#&gt; 2             N              N                N           N          N</span></a>
<a class="sourceLine" id="cb915-44" title="44"><span class="co">#&gt; 3             N              N                N           N          N</span></a>
<a class="sourceLine" id="cb915-45" title="45"><span class="co">#&gt; 4             N              N                N           O          O</span></a>
<a class="sourceLine" id="cb915-46" title="46"><span class="co">#&gt; 5             N              N                N           N          N</span></a>
<a class="sourceLine" id="cb915-47" title="47"><span class="co">#&gt; 6             N              N                N           N          N</span></a>
<a class="sourceLine" id="cb915-48" title="48"><span class="co">#&gt; 7             N              N                O           O          N</span></a>
<a class="sourceLine" id="cb915-49" title="49"><span class="co">#&gt;   cinema_rec sport_rec</span></a>
<a class="sourceLine" id="cb915-50" title="50"><span class="co">#&gt; 1          N         N</span></a>
<a class="sourceLine" id="cb915-51" title="51"><span class="co">#&gt; 2          O         O</span></a>
<a class="sourceLine" id="cb915-52" title="52"><span class="co">#&gt; 3          N         O</span></a>
<a class="sourceLine" id="cb915-53" title="53"><span class="co">#&gt; 4          O         O</span></a>
<a class="sourceLine" id="cb915-54" title="54"><span class="co">#&gt; 5          N         N</span></a>
<a class="sourceLine" id="cb915-55" title="55"><span class="co">#&gt; 6          O         O</span></a>
<a class="sourceLine" id="cb915-56" title="56"><span class="co">#&gt; 7          N         N</span></a>
<a class="sourceLine" id="cb915-57" title="57"><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1993 rows ]</span></a></code></pre></div>
</div>
<div id="appliquer-plusieurs-fonctions-à-plusieurs-colonnes" class="section level3">
<h3><span class="header-section-number">17.2.4</span> Appliquer plusieurs fonctions à plusieurs colonnes</h3>
<p><code>across()</code> offre également la possibilité d’appliquer plusieurs fonctions à un ensemble de colonnes. Dans ce cas, plutôt que de lui passer une seule fonction comme deuxième argument, on lui passe une liste nommée de fonctions.</p>
<p>Le code suivant calcule le minimum et le maximum pour trois variables de <code>rp2012</code></p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" title="1">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb916-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb916-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb916-4" title="4">            cadres<span class="op">:</span>empl,</a>
<a class="sourceLine" id="cb916-5" title="5">            <span class="kw">list</span>(<span class="dt">min =</span> min, <span class="dt">max =</span> max)</a>
<a class="sourceLine" id="cb916-6" title="6">        )</a>
<a class="sourceLine" id="cb916-7" title="7">    )</a>
<a class="sourceLine" id="cb916-8" title="8"><span class="co">#&gt; # A tibble: 1 × 6</span></a>
<a class="sourceLine" id="cb916-9" title="9"><span class="co">#&gt;   cadres_min cadres_max interm_min interm_max empl_min empl_max</span></a>
<a class="sourceLine" id="cb916-10" title="10"><span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb916-11" title="11"><span class="co">#&gt; 1       1.15       56.0       6.18       41.6     8.35     65.9</span></a></code></pre></div>
<p>Par défaut les nouvelles variables sont nommées sous la forme <code>{nom_variable}_{nom_fonction}</code>, mais on peut personnaliser cette règle en ajoutant un argument <code>.names</code> à <code>across()</code>. Cet argument est une chaîne de caractères dans laquelle <code>{.col}</code> sera remplacé par le nom de la colonne courante, et <code>{.fn}</code> par le nom de la fonction.</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb917-1" title="1">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb917-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb917-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb917-4" title="4">            cadres<span class="op">:</span>ouvr,</a>
<a class="sourceLine" id="cb917-5" title="5">            <span class="kw">list</span>(<span class="dt">min =</span> min, <span class="dt">max =</span> max),</a>
<a class="sourceLine" id="cb917-6" title="6">            <span class="dt">.names =</span> <span class="st">&quot;{.fn}-{.col}&quot;</span></a>
<a class="sourceLine" id="cb917-7" title="7">        )</a>
<a class="sourceLine" id="cb917-8" title="8">    )</a>
<a class="sourceLine" id="cb917-9" title="9"><span class="co">#&gt; # A tibble: 1 × 8</span></a>
<a class="sourceLine" id="cb917-10" title="10"><span class="co">#&gt;   `min-cadres` `max-cadres` `min-interm` `max-interm` `min-empl` `max-empl`</span></a>
<a class="sourceLine" id="cb917-11" title="11"><span class="co">#&gt;          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb917-12" title="12"><span class="co">#&gt; 1         1.15         56.0         6.18         41.6       8.35       65.9</span></a>
<a class="sourceLine" id="cb917-13" title="13"><span class="co">#&gt; # … with 2 more variables: min-ouvr &lt;dbl&gt;, max-ouvr &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="renommer-plusieurs-colonnes-avec-une-fonction" class="section level3">
<h3><span class="header-section-number">17.2.5</span> Renommer plusieurs colonnes avec une fonction</h3>
<p>On a vu précédemment qu’on peut utiliser <code>rename_with()</code> pour renommer les colonnes d’un tableau de données à l’aide d’une fonction.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" title="1">remplace_points &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb918-2" title="2">    <span class="kw">str_replace_all</span>(v, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>)</a>
<a class="sourceLine" id="cb918-3" title="3">}</a>
<a class="sourceLine" id="cb918-4" title="4"></a>
<a class="sourceLine" id="cb918-5" title="5">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_with</span>(remplace_points)</a></code></pre></div>
<p>Par défaut, <code>rename_with()</code> applique la fonction de renommage à l’ensemble des colonnes du tableau. Il est cependant possible de lui indiquer de ne renommer que certaines de ces colonnes. Pour cela, on peut lui ajouter un argument supplémentaire nommé <code>.cols</code>, dont la syntaxe est exactement la même que pour <code>across()</code> ou <code>select()</code>.</p>
<p>Par exemple, le code suivant convertit en majuscule uniquement les noms des colonnes <code>id</code> et <code>poids</code>.</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb919-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb919-2" title="2"><span class="st">    </span><span class="kw">rename_with</span>(str_to_upper, <span class="dt">.cols =</span> <span class="kw">c</span>(id, poids))</a>
<a class="sourceLine" id="cb919-3" title="3"><span class="co">#&gt;    ID age  sexe                                              nivetud     POIDS</span></a>
<a class="sourceLine" id="cb919-4" title="4"><span class="co">#&gt; 1   1  28 Femme Enseignement superieur y compris technique superieur  2634.398</span></a>
<a class="sourceLine" id="cb919-5" title="5"><span class="co">#&gt; 2   2  23 Femme                                                 &lt;NA&gt;  9738.396</span></a>
<a class="sourceLine" id="cb919-6" title="6"><span class="co">#&gt; 3   3  59 Homme                    Derniere annee d&#39;etudes primaires  3994.102</span></a>
<a class="sourceLine" id="cb919-7" title="7"><span class="co">#&gt; 4   4  34 Homme Enseignement superieur y compris technique superieur  5731.662</span></a>
<a class="sourceLine" id="cb919-8" title="8"><span class="co">#&gt; 5   5  71 Femme                    Derniere annee d&#39;etudes primaires  4329.094</span></a>
<a class="sourceLine" id="cb919-9" title="9"><span class="co">#&gt; 6   6  35 Femme        Enseignement technique ou professionnel court  8674.699</span></a>
<a class="sourceLine" id="cb919-10" title="10"><span class="co">#&gt; 7   7  60 Femme                    Derniere annee d&#39;etudes primaires  6165.803</span></a>
<a class="sourceLine" id="cb919-11" title="11"><span class="co">#&gt; 8   8  47 Homme        Enseignement technique ou professionnel court 12891.641</span></a>
<a class="sourceLine" id="cb919-12" title="12"><span class="co">#&gt; 9   9  20 Femme                                                 &lt;NA&gt;  7808.872</span></a>
<a class="sourceLine" id="cb919-13" title="13"><span class="co">#&gt; 10 10  28 Homme         Enseignement technique ou professionnel long  2277.160</span></a>
<a class="sourceLine" id="cb919-14" title="14"><span class="co">#&gt;                    occup           qualif freres.soeurs clso</span></a>
<a class="sourceLine" id="cb919-15" title="15"><span class="co">#&gt; 1  Exerce une profession          Employe             8  Oui</span></a>
<a class="sourceLine" id="cb919-16" title="16"><span class="co">#&gt; 2        Etudiant, eleve             &lt;NA&gt;             2  Oui</span></a>
<a class="sourceLine" id="cb919-17" title="17"><span class="co">#&gt; 3  Exerce une profession       Technicien             2  Non</span></a>
<a class="sourceLine" id="cb919-18" title="18"><span class="co">#&gt; 4  Exerce une profession       Technicien             1  Non</span></a>
<a class="sourceLine" id="cb919-19" title="19"><span class="co">#&gt; 5               Retraite          Employe             0  Oui</span></a>
<a class="sourceLine" id="cb919-20" title="20"><span class="co">#&gt; 6  Exerce une profession          Employe             5  Non</span></a>
<a class="sourceLine" id="cb919-21" title="21"><span class="co">#&gt; 7               Au foyer Ouvrier qualifie             1  Oui</span></a>
<a class="sourceLine" id="cb919-22" title="22"><span class="co">#&gt; 8  Exerce une profession Ouvrier qualifie             5  Non</span></a>
<a class="sourceLine" id="cb919-23" title="23"><span class="co">#&gt; 9        Etudiant, eleve             &lt;NA&gt;             4  Oui</span></a>
<a class="sourceLine" id="cb919-24" title="24"><span class="co">#&gt; 10 Exerce une profession            Autre             2  Non</span></a>
<a class="sourceLine" id="cb919-25" title="25"><span class="co">#&gt;                          relig                     trav.imp    trav.satisf</span></a>
<a class="sourceLine" id="cb919-26" title="26"><span class="co">#&gt; 1  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb919-27" title="27"><span class="co">#&gt; 2  Ni croyance ni appartenance                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb919-28" title="28"><span class="co">#&gt; 3  Ni croyance ni appartenance Aussi important que le reste      Equilibre</span></a>
<a class="sourceLine" id="cb919-29" title="29"><span class="co">#&gt; 4   Appartenance sans pratique Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb919-30" title="30"><span class="co">#&gt; 5          Pratiquant regulier                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb919-31" title="31"><span class="co">#&gt; 6  Ni croyance ni appartenance            Le plus important      Equilibre</span></a>
<a class="sourceLine" id="cb919-32" title="32"><span class="co">#&gt; 7   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb919-33" title="33"><span class="co">#&gt; 8  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb919-34" title="34"><span class="co">#&gt; 9   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb919-35" title="35"><span class="co">#&gt; 10      Pratiquant occasionnel Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb919-36" title="36"><span class="co">#&gt;    hard.rock lecture.bd peche.chasse cuisine bricol cinema sport heures.tv</span></a>
<a class="sourceLine" id="cb919-37" title="37"><span class="co">#&gt; 1        Non        Non          Non     Oui    Non    Non   Non       0.0</span></a>
<a class="sourceLine" id="cb919-38" title="38"><span class="co">#&gt; 2        Non        Non          Non     Non    Non    Oui   Oui       1.0</span></a>
<a class="sourceLine" id="cb919-39" title="39"><span class="co">#&gt; 3        Non        Non          Non     Non    Non    Non   Oui       0.0</span></a>
<a class="sourceLine" id="cb919-40" title="40"><span class="co">#&gt; 4        Non        Non          Non     Oui    Oui    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb919-41" title="41"><span class="co">#&gt; 5        Non        Non          Non     Non    Non    Non   Non       3.0</span></a>
<a class="sourceLine" id="cb919-42" title="42"><span class="co">#&gt; 6        Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb919-43" title="43"><span class="co">#&gt; 7        Non        Non          Oui     Oui    Non    Non   Non       2.9</span></a>
<a class="sourceLine" id="cb919-44" title="44"><span class="co">#&gt; 8        Non        Non          Oui     Oui    Oui    Non   Non       1.0</span></a>
<a class="sourceLine" id="cb919-45" title="45"><span class="co">#&gt; 9        Non        Non          Non     Non    Non    Oui   Non       2.0</span></a>
<a class="sourceLine" id="cb919-46" title="46"><span class="co">#&gt; 10       Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb919-47" title="47"><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1990 rows ]</span></a></code></pre></div>
<p>Et le code suivant remplace les <code>.</code> par des <code>_</code> uniquement pour les colonnes qui ne sont pas numériques.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb920-2" title="2"><span class="st">    </span><span class="kw">rename_with</span>(remplace_points, <span class="dt">.cols =</span> <span class="op">!</span><span class="kw">where</span>(is.numeric))</a>
<a class="sourceLine" id="cb920-3" title="3"><span class="co">#&gt;    id age  sexe                                              nivetud     poids</span></a>
<a class="sourceLine" id="cb920-4" title="4"><span class="co">#&gt; 1   1  28 Femme Enseignement superieur y compris technique superieur  2634.398</span></a>
<a class="sourceLine" id="cb920-5" title="5"><span class="co">#&gt; 2   2  23 Femme                                                 &lt;NA&gt;  9738.396</span></a>
<a class="sourceLine" id="cb920-6" title="6"><span class="co">#&gt; 3   3  59 Homme                    Derniere annee d&#39;etudes primaires  3994.102</span></a>
<a class="sourceLine" id="cb920-7" title="7"><span class="co">#&gt; 4   4  34 Homme Enseignement superieur y compris technique superieur  5731.662</span></a>
<a class="sourceLine" id="cb920-8" title="8"><span class="co">#&gt; 5   5  71 Femme                    Derniere annee d&#39;etudes primaires  4329.094</span></a>
<a class="sourceLine" id="cb920-9" title="9"><span class="co">#&gt; 6   6  35 Femme        Enseignement technique ou professionnel court  8674.699</span></a>
<a class="sourceLine" id="cb920-10" title="10"><span class="co">#&gt; 7   7  60 Femme                    Derniere annee d&#39;etudes primaires  6165.803</span></a>
<a class="sourceLine" id="cb920-11" title="11"><span class="co">#&gt; 8   8  47 Homme        Enseignement technique ou professionnel court 12891.641</span></a>
<a class="sourceLine" id="cb920-12" title="12"><span class="co">#&gt; 9   9  20 Femme                                                 &lt;NA&gt;  7808.872</span></a>
<a class="sourceLine" id="cb920-13" title="13"><span class="co">#&gt; 10 10  28 Homme         Enseignement technique ou professionnel long  2277.160</span></a>
<a class="sourceLine" id="cb920-14" title="14"><span class="co">#&gt;                    occup           qualif freres.soeurs clso</span></a>
<a class="sourceLine" id="cb920-15" title="15"><span class="co">#&gt; 1  Exerce une profession          Employe             8  Oui</span></a>
<a class="sourceLine" id="cb920-16" title="16"><span class="co">#&gt; 2        Etudiant, eleve             &lt;NA&gt;             2  Oui</span></a>
<a class="sourceLine" id="cb920-17" title="17"><span class="co">#&gt; 3  Exerce une profession       Technicien             2  Non</span></a>
<a class="sourceLine" id="cb920-18" title="18"><span class="co">#&gt; 4  Exerce une profession       Technicien             1  Non</span></a>
<a class="sourceLine" id="cb920-19" title="19"><span class="co">#&gt; 5               Retraite          Employe             0  Oui</span></a>
<a class="sourceLine" id="cb920-20" title="20"><span class="co">#&gt; 6  Exerce une profession          Employe             5  Non</span></a>
<a class="sourceLine" id="cb920-21" title="21"><span class="co">#&gt; 7               Au foyer Ouvrier qualifie             1  Oui</span></a>
<a class="sourceLine" id="cb920-22" title="22"><span class="co">#&gt; 8  Exerce une profession Ouvrier qualifie             5  Non</span></a>
<a class="sourceLine" id="cb920-23" title="23"><span class="co">#&gt; 9        Etudiant, eleve             &lt;NA&gt;             4  Oui</span></a>
<a class="sourceLine" id="cb920-24" title="24"><span class="co">#&gt; 10 Exerce une profession            Autre             2  Non</span></a>
<a class="sourceLine" id="cb920-25" title="25"><span class="co">#&gt;                          relig                     trav_imp    trav_satisf</span></a>
<a class="sourceLine" id="cb920-26" title="26"><span class="co">#&gt; 1  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb920-27" title="27"><span class="co">#&gt; 2  Ni croyance ni appartenance                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb920-28" title="28"><span class="co">#&gt; 3  Ni croyance ni appartenance Aussi important que le reste      Equilibre</span></a>
<a class="sourceLine" id="cb920-29" title="29"><span class="co">#&gt; 4   Appartenance sans pratique Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb920-30" title="30"><span class="co">#&gt; 5          Pratiquant regulier                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb920-31" title="31"><span class="co">#&gt; 6  Ni croyance ni appartenance            Le plus important      Equilibre</span></a>
<a class="sourceLine" id="cb920-32" title="32"><span class="co">#&gt; 7   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb920-33" title="33"><span class="co">#&gt; 8  Ni croyance ni appartenance                Peu important Insatisfaction</span></a>
<a class="sourceLine" id="cb920-34" title="34"><span class="co">#&gt; 9   Appartenance sans pratique                         &lt;NA&gt;           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb920-35" title="35"><span class="co">#&gt; 10      Pratiquant occasionnel Moins important que le reste   Satisfaction</span></a>
<a class="sourceLine" id="cb920-36" title="36"><span class="co">#&gt;    hard_rock lecture_bd peche_chasse cuisine bricol cinema sport heures.tv</span></a>
<a class="sourceLine" id="cb920-37" title="37"><span class="co">#&gt; 1        Non        Non          Non     Oui    Non    Non   Non       0.0</span></a>
<a class="sourceLine" id="cb920-38" title="38"><span class="co">#&gt; 2        Non        Non          Non     Non    Non    Oui   Oui       1.0</span></a>
<a class="sourceLine" id="cb920-39" title="39"><span class="co">#&gt; 3        Non        Non          Non     Non    Non    Non   Oui       0.0</span></a>
<a class="sourceLine" id="cb920-40" title="40"><span class="co">#&gt; 4        Non        Non          Non     Oui    Oui    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb920-41" title="41"><span class="co">#&gt; 5        Non        Non          Non     Non    Non    Non   Non       3.0</span></a>
<a class="sourceLine" id="cb920-42" title="42"><span class="co">#&gt; 6        Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb920-43" title="43"><span class="co">#&gt; 7        Non        Non          Oui     Oui    Non    Non   Non       2.9</span></a>
<a class="sourceLine" id="cb920-44" title="44"><span class="co">#&gt; 8        Non        Non          Oui     Oui    Oui    Non   Non       1.0</span></a>
<a class="sourceLine" id="cb920-45" title="45"><span class="co">#&gt; 9        Non        Non          Non     Non    Non    Oui   Non       2.0</span></a>
<a class="sourceLine" id="cb920-46" title="46"><span class="co">#&gt; 10       Non        Non          Non     Non    Non    Oui   Oui       2.0</span></a>
<a class="sourceLine" id="cb920-47" title="47"><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1990 rows ]</span></a></code></pre></div>
</div>
</div>
<div id="rowwise-et-c_across-appliquer-une-transformation-ligne-par-ligne" class="section level2">
<h2><span class="header-section-number">17.3</span> <code>rowwise()</code> et <code>c_across()</code> : appliquer une transformation ligne par ligne</h2>
<p>Soit le tableau de données suivant, qui contient des évaluations de restaurants sur quatre critères différents (on a initialisé les valeurs de chaque critère en tirant au sort des notes entre 0 et 5)<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>.</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb921-1" title="1">alea &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb921-2" title="2">    <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb921-3" title="3">}</a>
<a class="sourceLine" id="cb921-4" title="4"></a>
<a class="sourceLine" id="cb921-5" title="5">restos &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb921-6" title="6">    <span class="dt">nom =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb921-7" title="7">        <span class="st">&quot;La bonne fourchette&quot;</span>,</a>
<a class="sourceLine" id="cb921-8" title="8">        <span class="st">&quot;La choucroute de l&#39;amer&quot;</span>,</a>
<a class="sourceLine" id="cb921-9" title="9">        <span class="st">&quot;L&#39;Hair de rien&quot;</span>,</a>
<a class="sourceLine" id="cb921-10" title="10">        <span class="st">&quot;La blanquette de Vaulx&quot;</span></a>
<a class="sourceLine" id="cb921-11" title="11">    ),</a>
<a class="sourceLine" id="cb921-12" title="12">    <span class="dt">cuisine =</span> <span class="kw">alea</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb921-13" title="13">    <span class="dt">decor   =</span> <span class="kw">alea</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb921-14" title="14">    <span class="dt">accueil =</span> <span class="kw">alea</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb921-15" title="15">    <span class="dt">prix    =</span> <span class="kw">alea</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb921-16" title="16">)</a>
<a class="sourceLine" id="cb921-17" title="17"></a>
<a class="sourceLine" id="cb921-18" title="18">restos</a>
<a class="sourceLine" id="cb921-19" title="19"><span class="co">#&gt; # A tibble: 4 × 5</span></a>
<a class="sourceLine" id="cb921-20" title="20"><span class="co">#&gt;   nom                     cuisine decor accueil  prix</span></a>
<a class="sourceLine" id="cb921-21" title="21"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb921-22" title="22"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2</span></a>
<a class="sourceLine" id="cb921-23" title="23"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2</span></a>
<a class="sourceLine" id="cb921-24" title="24"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2</span></a>
<a class="sourceLine" id="cb921-25" title="25"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1</span></a></code></pre></div>
<p>Imaginons qu’on souhaite faire la moyenne, pour chaque restaurant, des critères <code>decor</code> et <code>accueil</code>. On pourrait être tentés d’utiliser <code>mean()</code> de la manière suivante :</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb922-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb922-3" title="3">        <span class="dt">decor_accueil =</span> <span class="kw">mean</span>(<span class="kw">c</span>(decor, accueil))</a>
<a class="sourceLine" id="cb922-4" title="4">    )</a>
<a class="sourceLine" id="cb922-5" title="5"><span class="co">#&gt; # A tibble: 4 × 6</span></a>
<a class="sourceLine" id="cb922-6" title="6"><span class="co">#&gt;   nom                     cuisine decor accueil  prix decor_accueil</span></a>
<a class="sourceLine" id="cb922-7" title="7"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb922-8" title="8"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2             2</span></a>
<a class="sourceLine" id="cb922-9" title="9"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2             2</span></a>
<a class="sourceLine" id="cb922-10" title="10"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2             2</span></a>
<a class="sourceLine" id="cb922-11" title="11"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1             2</span></a></code></pre></div>
<p>Si on regarde le résultat, on constate qu’il ne correspond pas à ce que l’on souhaite puisque toutes les valeurs sont les mêmes.</p>
<p>Que s’est-il passé ? En fait le <code>mutate</code> s’est appliqué sur la totalité du tableau. Ceci signifie que dans <code>mean(c(decor, accueil))</code>, les objets <code>decor</code> et <code>accueil</code> correspondent à la totalité des valeurs de chaque variable. On a donc concaténé ces deux vecteurs et calculé la moyenne, qui est du coup la même pour chaque ligne.</p>
<p>La valeur obtenue correspond aux résultat de :</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb923-1" title="1"><span class="kw">mean</span>(<span class="kw">c</span>(restos<span class="op">$</span>decor, restos<span class="op">$</span>accueil))</a>
<a class="sourceLine" id="cb923-2" title="2"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>Ce que nous souhaitons ici, c’est calculer la moyenne non pas pour l’ensemble du tableau mais <em>pour chaque ligne</em>. Pour cela, on va utiliser la fonction <code>rowwise()</code>. Celle-ci est équivalente à un <code>group_by()</code> qui créerait autant de groupes qu’il y a de lignes dans notre tableau.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" title="1">restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowwise</span>() </a>
<a class="sourceLine" id="cb924-2" title="2"><span class="co">#&gt; # A tibble: 4 × 5</span></a>
<a class="sourceLine" id="cb924-3" title="3"><span class="co">#&gt; # Rowwise: </span></a>
<a class="sourceLine" id="cb924-4" title="4"><span class="co">#&gt;   nom                     cuisine decor accueil  prix</span></a>
<a class="sourceLine" id="cb924-5" title="5"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb924-6" title="6"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2</span></a>
<a class="sourceLine" id="cb924-7" title="7"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2</span></a>
<a class="sourceLine" id="cb924-8" title="8"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2</span></a>
<a class="sourceLine" id="cb924-9" title="9"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1</span></a></code></pre></div>
<p>Quant notre tableau est groupé via un <code>rowwise()</code>, les opérations s’effectuent sur un tableau constitué uniquement de la ligne courante. Si on calcule la moyenne précédente, on obtient désormais le bon résultat.</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb925-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb925-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb925-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">decor_accueil =</span> <span class="kw">mean</span>(<span class="kw">c</span>(decor, accueil)))</a>
<a class="sourceLine" id="cb925-4" title="4"><span class="co">#&gt; # A tibble: 4 × 6</span></a>
<a class="sourceLine" id="cb925-5" title="5"><span class="co">#&gt; # Rowwise: </span></a>
<a class="sourceLine" id="cb925-6" title="6"><span class="co">#&gt;   nom                     cuisine decor accueil  prix decor_accueil</span></a>
<a class="sourceLine" id="cb925-7" title="7"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb925-8" title="8"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2           0.5</span></a>
<a class="sourceLine" id="cb925-9" title="9"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2           2.5</span></a>
<a class="sourceLine" id="cb925-10" title="10"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2           2  </span></a>
<a class="sourceLine" id="cb925-11" title="11"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1           3</span></a></code></pre></div>
<p>Supposons qu’on souhaite désormais calculer la moyenne de l’ensemble des critères. On peut évidemment reprendre le code précédent en saisissant toutes les variables concernées.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb926-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb926-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">decor_accueil =</span> <span class="kw">mean</span>(<span class="kw">c</span>(decor, accueil, cuisine, prix)))</a>
<a class="sourceLine" id="cb926-4" title="4"><span class="co">#&gt; # A tibble: 4 × 6</span></a>
<a class="sourceLine" id="cb926-5" title="5"><span class="co">#&gt; # Rowwise: </span></a>
<a class="sourceLine" id="cb926-6" title="6"><span class="co">#&gt;   nom                     cuisine decor accueil  prix decor_accueil</span></a>
<a class="sourceLine" id="cb926-7" title="7"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb926-8" title="8"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2          1.75</span></a>
<a class="sourceLine" id="cb926-9" title="9"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2          2   </span></a>
<a class="sourceLine" id="cb926-10" title="10"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2          2   </span></a>
<a class="sourceLine" id="cb926-11" title="11"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1          2.25</span></a></code></pre></div>
<p>Lister les variables de cette manière peut vite devenir pénible si le nombre de variables est important. C’est pourquoi <code>dplyr</code> propose la fonction <code>c_across()</code> : celle-ci permet de sélectionner des colonnes de la même manière que <code>select()</code> ou <code>across()</code>, et retourne un vecteur constitué des valeurs concaténées de ces colonnes.</p>
<p>L’exemple suivant calcule la moyenne de toutes les colonnes comprises entre <code>decor</code> et <code>prix</code>, en utilisant l’opérateur <code>:</code>.</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb927-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb927-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb927-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb927-4" title="4">        <span class="dt">total =</span> <span class="kw">mean</span>(<span class="kw">c_across</span>(decor<span class="op">:</span>prix))</a>
<a class="sourceLine" id="cb927-5" title="5">    )</a>
<a class="sourceLine" id="cb927-6" title="6"><span class="co">#&gt; # A tibble: 4 × 6</span></a>
<a class="sourceLine" id="cb927-7" title="7"><span class="co">#&gt; # Rowwise: </span></a>
<a class="sourceLine" id="cb927-8" title="8"><span class="co">#&gt;   nom                     cuisine decor accueil  prix total</span></a>
<a class="sourceLine" id="cb927-9" title="9"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb927-10" title="10"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2  1   </span></a>
<a class="sourceLine" id="cb927-11" title="11"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2  2.33</span></a>
<a class="sourceLine" id="cb927-12" title="12"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2  2   </span></a>
<a class="sourceLine" id="cb927-13" title="13"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1  2.33</span></a></code></pre></div>
<p>Comme pour <code>across()</code> ou <code>select()</code>, on peut utiliser la fonction <code>where()</code> pour calculer la moyenne sur toutes les colonnes numériques.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb928-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb928-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb928-4" title="4">        <span class="dt">total =</span> <span class="kw">mean</span>(</a>
<a class="sourceLine" id="cb928-5" title="5">            <span class="kw">c_across</span>(<span class="kw">where</span>(is.numeric))</a>
<a class="sourceLine" id="cb928-6" title="6">        )</a>
<a class="sourceLine" id="cb928-7" title="7">    )</a>
<a class="sourceLine" id="cb928-8" title="8"><span class="co">#&gt; # A tibble: 4 × 6</span></a>
<a class="sourceLine" id="cb928-9" title="9"><span class="co">#&gt; # Rowwise: </span></a>
<a class="sourceLine" id="cb928-10" title="10"><span class="co">#&gt;   nom                     cuisine decor accueil  prix total</span></a>
<a class="sourceLine" id="cb928-11" title="11"><span class="co">#&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb928-12" title="12"><span class="co">#&gt; 1 La bonne fourchette           4     0       1     2  1.75</span></a>
<a class="sourceLine" id="cb928-13" title="13"><span class="co">#&gt; 2 La choucroute de l&#39;amer       1     0       5     2  2   </span></a>
<a class="sourceLine" id="cb928-14" title="14"><span class="co">#&gt; 3 L&#39;Hair de rien                2     2       2     2  2   </span></a>
<a class="sourceLine" id="cb928-15" title="15"><span class="co">#&gt; 4 La blanquette de Vaulx        2     2       4     1  2.25</span></a></code></pre></div>
<p>L’utilisation de <code>rowwise()</code> et <code>c_across()</code> est intéressante principalement quand il n’existe pas de fonction vectorisée pour la transformation qu’on souhaite appliquer. Quand elle existe, il est en général plus simple et plus rapide de l’utiliser.</p>
<p>Par exemple, pour trouver la valeur la plus élevée par restaurant, on pourrait être tenté d’utiliser le code suivant :</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb929-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb929-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb929-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">note_max =</span> <span class="kw">max</span>(<span class="kw">c</span>(decor, accueil)))</a>
<a class="sourceLine" id="cb929-4" title="4"><span class="co">#&gt; # A tibble: 4 × 1</span></a>
<a class="sourceLine" id="cb929-5" title="5"><span class="co">#&gt;   note_max</span></a>
<a class="sourceLine" id="cb929-6" title="6"><span class="co">#&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb929-7" title="7"><span class="co">#&gt; 1        1</span></a>
<a class="sourceLine" id="cb929-8" title="8"><span class="co">#&gt; 2        5</span></a>
<a class="sourceLine" id="cb929-9" title="9"><span class="co">#&gt; 3        2</span></a>
<a class="sourceLine" id="cb929-10" title="10"><span class="co">#&gt; 4        4</span></a></code></pre></div>
<p>Il est cependant plus lisible et plus efficace d’utiliser la fonction <code>pmax</code>, qui a justement pour objectif de parcourir des vecteurs en parallèle et de ne conserver que la plus grande valeur.</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb930-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb930-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">note_max =</span> <span class="kw">pmax</span>(decor, accueil))</a>
<a class="sourceLine" id="cb930-3" title="3"><span class="co">#&gt; # A tibble: 4 × 1</span></a>
<a class="sourceLine" id="cb930-4" title="4"><span class="co">#&gt;   note_max</span></a>
<a class="sourceLine" id="cb930-5" title="5"><span class="co">#&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb930-6" title="6"><span class="co">#&gt; 1        1</span></a>
<a class="sourceLine" id="cb930-7" title="7"><span class="co">#&gt; 2        5</span></a>
<a class="sourceLine" id="cb930-8" title="8"><span class="co">#&gt; 3        2</span></a>
<a class="sourceLine" id="cb930-9" title="9"><span class="co">#&gt; 4        4</span></a></code></pre></div>
<p>Une des limites de <code>pmax</code> cependant est qu’on ne peut pas l’utiliser avec <code>c_across()</code>, et qu’on ne peut donc pas faire de sélection des colonnes : on est obligés de saisir leurs noms.</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb931-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb931-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">note_max =</span> <span class="kw">pmax</span>(cuisine, decor, accueil, prix))</a>
<a class="sourceLine" id="cb931-3" title="3"><span class="co">#&gt; # A tibble: 4 × 1</span></a>
<a class="sourceLine" id="cb931-4" title="4"><span class="co">#&gt;   note_max</span></a>
<a class="sourceLine" id="cb931-5" title="5"><span class="co">#&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb931-6" title="6"><span class="co">#&gt; 1        4</span></a>
<a class="sourceLine" id="cb931-7" title="7"><span class="co">#&gt; 2        5</span></a>
<a class="sourceLine" id="cb931-8" title="8"><span class="co">#&gt; 3        2</span></a>
<a class="sourceLine" id="cb931-9" title="9"><span class="co">#&gt; 4        4</span></a></code></pre></div>
<p>Dans certains cas, notamment lorsque les colonnes sont nombreuses ou qu’on ne les a pas identifiées à l’avance, on pourra utiliser <code>rowwise()</code> et <code>c_across()</code> même quand des alternatives vectorisées existent.</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb932-1" title="1">restos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb932-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb932-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb932-4" title="4">        <span class="dt">note_max =</span> <span class="kw">max</span>(</a>
<a class="sourceLine" id="cb932-5" title="5">            <span class="kw">c_across</span>(<span class="kw">where</span>(is.numeric))</a>
<a class="sourceLine" id="cb932-6" title="6">        )</a>
<a class="sourceLine" id="cb932-7" title="7">    )</a>
<a class="sourceLine" id="cb932-8" title="8"><span class="co">#&gt; # A tibble: 4 × 1</span></a>
<a class="sourceLine" id="cb932-9" title="9"><span class="co">#&gt;   note_max</span></a>
<a class="sourceLine" id="cb932-10" title="10"><span class="co">#&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb932-11" title="11"><span class="co">#&gt; 1        4</span></a>
<a class="sourceLine" id="cb932-12" title="12"><span class="co">#&gt; 2        5</span></a>
<a class="sourceLine" id="cb932-13" title="13"><span class="co">#&gt; 3        2</span></a>
<a class="sourceLine" id="cb932-14" title="14"><span class="co">#&gt; 4        4</span></a></code></pre></div>
</div>
<div id="syntaxes-abregees" class="section level2">
<h2><span class="header-section-number">17.4</span> Fonctions anonymes et syntaxes abrégées</h2>
<p>Dans les sections précédentes, nous avons rencontré plusieurs fonctions, comme <code>rename_with()</code> ou <code>across()</code>, qui prennent une fonction en argument.</p>
<p>Par exemple, dans l’utilisation suivante de <code>rename_with()</code>, on avait créé une fonction <code>remplace_points()</code>.</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb933-1" title="1">remplace_points &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb933-2" title="2">    <span class="kw">str_replace_all</span>(v, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>)</a>
<a class="sourceLine" id="cb933-3" title="3">}</a>
<a class="sourceLine" id="cb933-4" title="4"></a>
<a class="sourceLine" id="cb933-5" title="5">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_with</span>(remplace_points)</a></code></pre></div>
<p>Le fait de créer une fonction à part pour une opération d’une seule ligne ne se justifie pas forcément, surtout si on n’utilise pas cette fonction ailleurs dans notre code. Dans, ce cas, on peut définir notre fonction directement dans l’appel à <code>rename_with()</code> en utilisant une <em>fonction anonyme</em>, déjà introduites section <a href="14-fonctions.html#fonctions-anonymes">14.4.2</a>.</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb934-2" title="2"><span class="st">    </span><span class="kw">rename_with</span>(<span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb934-3" title="3">        <span class="kw">str_replace_all</span>(v, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>)</a>
<a class="sourceLine" id="cb934-4" title="4">    })</a></code></pre></div>
<p>Cette notation est assez pratique et souvent utilisée pour les fonctions à usage unique, ne serait-ce que pour s’économiser le fait de devoir lui trouver un nom pertinent.</p>
<p>La syntaxe étant un peu lourde, il existe deux alternatives permettant une définition plus “compacte”.</p>
<ul>
<li><p>La première alternative est propre aux packages du <em>tidyverse</em> (notamment <code>dplyr</code> et <code>purrr</code>), et ne fonctionnera pas pour les fonctions n’appartenant pas à ces packages. Il s’agit d’utiliser une syntaxe de type “formule” : le corps de la formule contient les instructions de la fonction, et les arguments sont nommés <code>.x</code> (ou <code>.</code>) s’il n’y en a qu’un, <code>.x</code> et <code>.y</code> s’il y en a deux, et <code>..1</code>, <code>..2</code>, etc. s’ils sont plus nombreux.</p></li>
<li><p>La deuxième alternative est une syntaxe apparue avec la version 4.1 de R, qui permet de remplacer <code>function(...)</code> par le raccourci <code>\(...)</code>.</p></li>
</ul>
<p>Ainsi les définitions suivantes sont équivalents :</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb935-1" title="1"><span class="co"># Fonctionne partout et tout le temps</span></a>
<a class="sourceLine" id="cb935-2" title="2"><span class="cf">function</span>(x) { x <span class="op">+</span><span class="st"> </span><span class="dv">2</span> }</a>
<a class="sourceLine" id="cb935-3" title="3"><span class="co"># Fonctionne uniquement dans les fonctions du tidyverse</span></a>
<a class="sourceLine" id="cb935-4" title="4"><span class="op">~</span><span class="st"> </span>{ .x <span class="op">+</span><span class="st"> </span><span class="dv">2</span> }</a>
<a class="sourceLine" id="cb935-5" title="5"><span class="co"># Fonctionne uniquement à partir de R 4.1</span></a>
<a class="sourceLine" id="cb935-6" title="6">\(x) { x <span class="op">+</span><span class="st"> </span><span class="dv">2</span> }</a></code></pre></div>
<p>De même que les définitions suivantes :</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" title="1"><span class="cf">function</span>(v1, v2) {</a>
<a class="sourceLine" id="cb936-2" title="2">    res &lt;-<span class="st"> </span>v1 <span class="op">/</span><span class="st"> </span>v2</a>
<a class="sourceLine" id="cb936-3" title="3">    <span class="kw">round</span>(res, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb936-4" title="4">}</a>
<a class="sourceLine" id="cb936-5" title="5"></a>
<a class="sourceLine" id="cb936-6" title="6"><span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb936-7" title="7">    res &lt;-<span class="st"> </span>.x <span class="op">/</span><span class="st"> </span>.y</a>
<a class="sourceLine" id="cb936-8" title="8">    <span class="kw">round</span>(res, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb936-9" title="9">}</a>
<a class="sourceLine" id="cb936-10" title="10"></a>
<a class="sourceLine" id="cb936-11" title="11">\(v1, v2) {</a>
<a class="sourceLine" id="cb936-12" title="12">    res &lt;-<span class="st"> </span>v1 <span class="op">/</span><span class="st"> </span>v2</a>
<a class="sourceLine" id="cb936-13" title="13">    <span class="kw">round</span>(res, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb936-14" title="14">}</a></code></pre></div>
<p>Quand la fonction anonyme est constituée d’une seule instruction, on peut supprimer les accolades dans sa définition.</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb937-1" title="1"><span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb937-2" title="2"><span class="op">~</span><span class="st"> </span>.x <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb937-3" title="3">\(x) x <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<p>On pourra du coup, si on le souhaite, utiliser ces syntaxes compactes dans notre <code>rename_with()</code> pour définir notre fonction anonyme.</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb938-2" title="2"><span class="st">    </span><span class="kw">rename_with</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_replace_all</span>(.x, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>) )</a>
<a class="sourceLine" id="cb938-3" title="3"></a>
<a class="sourceLine" id="cb938-4" title="4">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb938-5" title="5"><span class="st">    </span><span class="kw">rename_with</span>( \(x) <span class="kw">str_replace_all</span>(x, <span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="st">&quot;_&quot;</span>) )</a></code></pre></div>
<p>Cette syntaxe peut être utilisée partout où on peut passer une fonction comme argument et donc définir des fonctions anonymes. Dans cet exemple déjà vu précédemment, on passe la fonction <code>detecte_oui</code> comme argument de <code>where()</code>.</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb939-1" title="1">detecte_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb939-2" title="2">    <span class="st">&quot;Oui&quot;</span> <span class="op">%in%</span><span class="st"> </span>v</a>
<a class="sourceLine" id="cb939-3" title="3">}</a>
<a class="sourceLine" id="cb939-4" title="4"></a>
<a class="sourceLine" id="cb939-5" title="5">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb939-6" title="6"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb939-7" title="7">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb939-8" title="8">            <span class="kw">where</span>(detecte_oui),</a>
<a class="sourceLine" id="cb939-9" title="9">            recode_oui_non</a>
<a class="sourceLine" id="cb939-10" title="10">        )</a>
<a class="sourceLine" id="cb939-11" title="11">    )</a></code></pre></div>
<p>On peut donc remplacer la fonction <code>detecte_oui</code> par une fonction anonyme définie directement dans le <code>where()</code>.</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb940-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb940-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb940-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb940-4" title="4">            <span class="kw">where</span>(<span class="cf">function</span>(v) { <span class="st">&quot;Oui&quot;</span> <span class="op">%in%</span><span class="st"> </span>v }),</a>
<a class="sourceLine" id="cb940-5" title="5">            recode_oui_non</a>
<a class="sourceLine" id="cb940-6" title="6">        )</a>
<a class="sourceLine" id="cb940-7" title="7">    )</a></code></pre></div>
<p>Et du coup utiliser une des deux syntaxes “compactes”.</p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb941-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb941-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb941-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb941-4" title="4">            <span class="kw">where</span>(<span class="op">~</span><span class="st"> &quot;Oui&quot;</span> <span class="op">%in%</span><span class="st"> </span>.x),</a>
<a class="sourceLine" id="cb941-5" title="5">            recode_oui_non</a>
<a class="sourceLine" id="cb941-6" title="6">        )</a>
<a class="sourceLine" id="cb941-7" title="7">    )</a>
<a class="sourceLine" id="cb941-8" title="8"></a>
<a class="sourceLine" id="cb941-9" title="9">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb941-10" title="10"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb941-11" title="11">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb941-12" title="12">            <span class="kw">where</span>(\(v) <span class="st">&quot;Oui&quot;</span> <span class="op">%in%</span><span class="st"> </span>v),</a>
<a class="sourceLine" id="cb941-13" title="13">            recode_oui_non</a>
<a class="sourceLine" id="cb941-14" title="14">        )</a>
<a class="sourceLine" id="cb941-15" title="15">    )</a></code></pre></div>
</div>
<div id="ressources-8" class="section level2">
<h2><span class="header-section-number">17.5</span> Ressources</h2>
<p><a href="https://dplyr.tidyverse.org/reference/select.html">La page d’aide de la fonction select</a> (en anglais) liste toutes les possibilités offertes pour spécifier des ensembles de colonnes d’un tableau de données.</p>
<p>La vignette <a href="https://dplyr.tidyverse.org/articles/colwise.html">Column-wise operations</a> de <code>dplyr</code> (en anglais) présente en détail l’utilisation et les fonctionnalités de <code>across()</code>.</p>
<p>La vignette <a href="https://dplyr.tidyverse.org/articles/rowwise.html">Row-wise operations</a> de <code>dplyr</code> (toujours en anglais) présente de manière approfondie l’utilisation de <code>rowwise()</code> et <code>c_across()</code> pour opérer individuellement sur les lignes d’un tableau de données.</p>
</div>
<div id="exercices-10" class="section level2">
<h2><span class="header-section-number">17.6</span> Exercices</h2>
<p>Pour certains des exercices qui suivent on utilisera le jeu de données <code>starwars</code> de <code>dplyr</code>. On peut le charger avec les instructions suivantes :</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb942-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb942-2" title="2"><span class="kw">data</span>(starwars)</a></code></pre></div>
<p>Le jeu de données contient les caractéristiques de 87 personnages présents dans les films : espèce, âge, planète d’origine, etc.</p>
<div id="appliquer-ses-propres-fonctions-1" class="section level3">
<h3><span class="header-section-number">17.6.1</span> Appliquer ses propres fonctions</h3>
<p><strong>Exercice 1.1</strong></p>
<p>Créer une fonction <code>imc</code> qui prend en argument un vecteur <code>taille</code> (en cm) et un vecteur <code>poids</code> (en kg) et retourne les valeurs correspondantes de l’indice de masse corporelle, qui se calcule en divisant le poids en kilos par la taille en mètres au carré.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" title="1">imc &lt;-<span class="st"> </span><span class="cf">function</span>(tailles, poids) {</a>
<a class="sourceLine" id="cb943-2" title="2">    tailles_m &lt;-<span class="st"> </span>tailles <span class="op">/</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb943-3" title="3">    poids <span class="op">/</span><span class="st"> </span>tailles_m <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb943-4" title="4">}</a></code></pre></div>
</div>

<p>Utiliser cette fonction pour ajouter une nouvelle variable <code>imc</code> au tableau <code>starwars</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb944-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb944-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">imc =</span> <span class="kw">imc</span>(height, mass))</a></code></pre></div>
</div>

<p>Utiliser à nouveau cette fonction pour calculer l’IMC moyen selon les valeurs de la variable <code>species</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb945-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb945-4" title="4">        <span class="dt">imc =</span> <span class="kw">mean</span>(<span class="kw">imc</span>(height, mass), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb945-5" title="5">    )</a></code></pre></div>
</div>

<p><strong>Exercice 1.2</strong></p>
<p>À l’aide d’un <code>group_by()</code> et d’un <code>summarise()</code>, calculer pour chaque valeur de la variable <code>sex</code> la valeur de l’étendue de la variable <code>height</code> du jeu de données <code>starwars</code>, c’est-à-dire la différence entre sa valeur maximale et sa valeur minimale.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb946-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb946-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb946-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb946-4" title="4">        <span class="dt">etendue_taille =</span> <span class="kw">max</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb946-5" title="5">    )</a></code></pre></div>
</div>

<p>En partant du code précédent, créer une fonction <code>etendue</code> qui prend en argument un vecteur et retourne la différence entre sa valeur maximale et sa valeur minimale. En utilisant cette fonction, calculer pour chaque valeur de <code>sex</code> la valeur de l’étendue des variables <code>height</code> et <code>mass</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb947-1" title="1">etendue &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb947-2" title="2">    <span class="kw">max</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb947-3" title="3">}</a>
<a class="sourceLine" id="cb947-4" title="4">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb947-5" title="5"><span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb947-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb947-7" title="7">        <span class="dt">etendue_taille =</span> <span class="kw">etendue</span>(height),</a>
<a class="sourceLine" id="cb947-8" title="8">        <span class="dt">etendue_poids  =</span> <span class="kw">etendue</span>(mass)</a>
<a class="sourceLine" id="cb947-9" title="9">    )</a></code></pre></div>
</div>

<p><strong>Exercice 1.3</strong></p>
<p>La liste suivante donne, pour chacun des neuf principaux films de la saga <em>Star Wars</em>, la date à laquelle ils se déroulent dans l’univers de la saga.</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb948-1" title="1"><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb948-2" title="2">    <span class="st">&quot;I&quot;</span>    =<span class="st"> </span><span class="dv">-32</span>,</a>
<a class="sourceLine" id="cb948-3" title="3">    <span class="st">&quot;II&quot;</span>   =<span class="st"> </span><span class="dv">-22</span>,</a>
<a class="sourceLine" id="cb948-4" title="4">    <span class="st">&quot;III&quot;</span>  =<span class="st"> </span><span class="dv">-19</span>,</a>
<a class="sourceLine" id="cb948-5" title="5">    <span class="st">&quot;IV&quot;</span>   =<span class="st">   </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb948-6" title="6">    <span class="st">&quot;V&quot;</span>    =<span class="st">   </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb948-7" title="7">    <span class="st">&quot;VI&quot;</span>   =<span class="st">   </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb948-8" title="8">    <span class="st">&quot;VII&quot;</span>  =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb948-9" title="9">    <span class="st">&quot;VIII&quot;</span> =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb948-10" title="10">    <span class="st">&quot;IX&quot;</span>   =<span class="st">  </span><span class="dv">35</span></a>
<a class="sourceLine" id="cb948-11" title="11">)</a></code></pre></div>
<p>Dans le jeu de données <code>starwars</code>, la variable <code>birth_year</code> indique l’année de naissance du personnage en “années avant l’an zéro” (une valeur de 19 signifie donc une année de naissance de -19).</p>
<p>Créer une fonction <code>age_film</code> qui prend en entrée un vecteur d’années de naissance au même format que <code>birth_year</code> ainsi que l’identifiant d’un film, et calcule les âges à la date du film.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" title="1">age_film &lt;-<span class="st"> </span><span class="cf">function</span>(annees, film) {</a>
<a class="sourceLine" id="cb949-2" title="2">    annees_films &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb949-3" title="3">        <span class="st">&quot;I&quot;</span>    =<span class="st"> </span><span class="dv">-32</span>,</a>
<a class="sourceLine" id="cb949-4" title="4">        <span class="st">&quot;II&quot;</span>   =<span class="st"> </span><span class="dv">-22</span>,</a>
<a class="sourceLine" id="cb949-5" title="5">        <span class="st">&quot;III&quot;</span>  =<span class="st"> </span><span class="dv">-19</span>,</a>
<a class="sourceLine" id="cb949-6" title="6">        <span class="st">&quot;IV&quot;</span>   =<span class="st">   </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb949-7" title="7">        <span class="st">&quot;V&quot;</span>    =<span class="st">   </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb949-8" title="8">        <span class="st">&quot;VI&quot;</span>   =<span class="st">   </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb949-9" title="9">        <span class="st">&quot;VII&quot;</span>  =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb949-10" title="10">        <span class="st">&quot;VIII&quot;</span> =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb949-11" title="11">        <span class="st">&quot;IX&quot;</span>   =<span class="st">  </span><span class="dv">35</span></a>
<a class="sourceLine" id="cb949-12" title="12">    )</a>
<a class="sourceLine" id="cb949-13" title="13">    annees_naissance &lt;-<span class="st"> </span><span class="op">-</span>annees</a>
<a class="sourceLine" id="cb949-14" title="14">    annee_ref &lt;-<span class="st"> </span>annees_films[[film]]</a>
<a class="sourceLine" id="cb949-15" title="15">    annee_ref <span class="op">-</span><span class="st"> </span>annees_naissance</a>
<a class="sourceLine" id="cb949-16" title="16">}</a></code></pre></div>
</div>

<p>Modifier la fonction pour qu’elle retourne un message d’erreur si l’identifiant du film n’a pas été reconnu.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb950-1" title="1">age_film &lt;-<span class="st"> </span><span class="cf">function</span>(annees, film) {</a>
<a class="sourceLine" id="cb950-2" title="2">    annees_films &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb950-3" title="3">        <span class="st">&quot;I&quot;</span>    =<span class="st"> </span><span class="dv">-32</span>,</a>
<a class="sourceLine" id="cb950-4" title="4">        <span class="st">&quot;II&quot;</span>   =<span class="st"> </span><span class="dv">-22</span>,</a>
<a class="sourceLine" id="cb950-5" title="5">        <span class="st">&quot;III&quot;</span>  =<span class="st"> </span><span class="dv">-19</span>,</a>
<a class="sourceLine" id="cb950-6" title="6">        <span class="st">&quot;IV&quot;</span>   =<span class="st">   </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb950-7" title="7">        <span class="st">&quot;V&quot;</span>    =<span class="st">   </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb950-8" title="8">        <span class="st">&quot;VI&quot;</span>   =<span class="st">   </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb950-9" title="9">        <span class="st">&quot;VII&quot;</span>  =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb950-10" title="10">        <span class="st">&quot;VIII&quot;</span> =<span class="st">  </span><span class="dv">34</span>,</a>
<a class="sourceLine" id="cb950-11" title="11">        <span class="st">&quot;IX&quot;</span>   =<span class="st">  </span><span class="dv">35</span></a>
<a class="sourceLine" id="cb950-12" title="12">    )</a>
<a class="sourceLine" id="cb950-13" title="13">    <span class="cf">if</span> (<span class="op">!</span>(film <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(annees_films))) {</a>
<a class="sourceLine" id="cb950-14" title="14">        <span class="kw">stop</span>(<span class="st">&quot;L&#39;identifiant du film n&#39;a pas été reconnu&quot;</span>)</a>
<a class="sourceLine" id="cb950-15" title="15">    }</a>
<a class="sourceLine" id="cb950-16" title="16">    annees_naissance &lt;-<span class="st"> </span><span class="op">-</span>annees</a>
<a class="sourceLine" id="cb950-17" title="17">    annee_ref &lt;-<span class="st"> </span>annees_films[[film]]</a>
<a class="sourceLine" id="cb950-18" title="18">    annee_ref <span class="op">-</span><span class="st"> </span>annees_naissance</a>
<a class="sourceLine" id="cb950-19" title="19">}</a></code></pre></div>
</div>

<p>Utiliser la fonction pour ajouter deux nouvelles variables au tableau <code>starwars</code> : <code>age_iv</code> qui correspond à l’âge (potentiel) au moment du film IV, et <code>age_ix</code> qui correspond à l’âge au moment du film IX.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb951-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb951-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb951-3" title="3">        <span class="dt">age_iv =</span> <span class="kw">age_film</span>(birth_year, <span class="st">&quot;IV&quot;</span>),</a>
<a class="sourceLine" id="cb951-4" title="4">        <span class="dt">age_ix =</span> <span class="kw">age_film</span>(birth_year, <span class="st">&quot;IX&quot;</span>),</a>
<a class="sourceLine" id="cb951-5" title="5">    )</a></code></pre></div>
</div>

</div>
<div id="across-1" class="section level3">
<h3><span class="header-section-number">17.6.2</span> <code>across()</code></h3>
<p><strong>Exercice 2.1</strong></p>
<p>Reprendre la fonction <code>etendue</code> de l’exercice 1.2 :</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb952-1" title="1">etendue &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb952-2" title="2">    <span class="kw">max</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb952-3" title="3">}</a></code></pre></div>
<p>À l’aide de <code>across()</code> calculer l’étendue des variables <code>height</code> et <code>mass</code> pour chaque valeur de <code>sex</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb953-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb953-4" title="4">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb953-5" title="5">            <span class="kw">c</span>(height, mass),</a>
<a class="sourceLine" id="cb953-6" title="6">            etendue</a>
<a class="sourceLine" id="cb953-7" title="7">        )</a>
<a class="sourceLine" id="cb953-8" title="8">    )</a></code></pre></div>
</div>

<p>Toujours à l’aide d’<code>across()</code>, appliquer <code>etendue</code> de la même manière à toutes les variables numériques.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb954-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb954-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb954-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb954-4" title="4">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb954-5" title="5">            <span class="kw">where</span>(is.numeric),</a>
<a class="sourceLine" id="cb954-6" title="6">            etendue</a>
<a class="sourceLine" id="cb954-7" title="7">        )</a>
<a class="sourceLine" id="cb954-8" title="8">    )</a></code></pre></div>
</div>

<p>En utilisant <code>&amp;</code> et <code>!</code>, appliquer <code>etendue</code> à toutes les variables numériques sauf à celles qui finissent par “year”.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb955-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-3" title="3"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb955-4" title="4">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb955-5" title="5">            <span class="kw">where</span>(is.numeric) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="st">&quot;year&quot;</span>),</a>
<a class="sourceLine" id="cb955-6" title="6">            etendue</a>
<a class="sourceLine" id="cb955-7" title="7">        )</a>
<a class="sourceLine" id="cb955-8" title="8">    )</a></code></pre></div>
</div>

<p><strong>Exercice 2.2</strong></p>
<p>Dans le jeu de données <code>starwars</code>, appliquer en un seul <code>summarise</code> les fonctions <code>min</code> et <code>max</code> aux variables <code>height</code> et <code>mass</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb956-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb956-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb956-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb956-4" title="4">            <span class="kw">c</span>(height, mass),</a>
<a class="sourceLine" id="cb956-5" title="5">            <span class="kw">list</span>(<span class="dt">min =</span> min, <span class="dt">max =</span> max)</a>
<a class="sourceLine" id="cb956-6" title="6">        )</a>
<a class="sourceLine" id="cb956-7" title="7">    )</a></code></pre></div>
</div>

<p>Modifier le code précédent pour que le calcul des valeurs minimales et maximales ne prennent pas en compte les valeurs manquantes.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" title="1">funs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb957-2" title="2">    <span class="dt">min =</span> <span class="cf">function</span>(v) { <span class="kw">min</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) },</a>
<a class="sourceLine" id="cb957-3" title="3">    <span class="dt">max =</span> <span class="cf">function</span>(v) { <span class="kw">max</span>(v, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) }</a>
<a class="sourceLine" id="cb957-4" title="4">)</a>
<a class="sourceLine" id="cb957-5" title="5">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb957-7" title="7">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb957-8" title="8">            <span class="kw">c</span>(height, mass),</a>
<a class="sourceLine" id="cb957-9" title="9">            funs</a>
<a class="sourceLine" id="cb957-10" title="10">        )</a>
<a class="sourceLine" id="cb957-11" title="11">    )</a>
<a class="sourceLine" id="cb957-12" title="12"><span class="co"># Autre possibilité : les arguments supplémentaires passés à across() sont</span></a>
<a class="sourceLine" id="cb957-13" title="13"><span class="co"># transmis aux fonctions appliquées</span></a>
<a class="sourceLine" id="cb957-14" title="14">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-15" title="15"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb957-16" title="16">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb957-17" title="17">            <span class="kw">c</span>(height, mass),</a>
<a class="sourceLine" id="cb957-18" title="18">            <span class="kw">list</span>(<span class="dt">min =</span> min, <span class="dt">max =</span> max),</a>
<a class="sourceLine" id="cb957-19" title="19">            <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb957-20" title="20">        )</a>
<a class="sourceLine" id="cb957-21" title="21">    )</a></code></pre></div>
</div>

<p><strong>Exercice 2.3</strong></p>
<p>Dans le jeu de données <code>hdv2003</code>, utiliser <code>across()</code> pour transformer les modalités “Oui” et “Non” en <code>TRUE</code> et <code>FALSE</code> pour toutes les variables de <code>hard.rock</code> à <code>sport</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb958-1" title="1">detecte_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb958-2" title="2">    v <span class="op">==</span><span class="st"> &quot;Oui&quot;</span></a>
<a class="sourceLine" id="cb958-3" title="3">}</a>
<a class="sourceLine" id="cb958-4" title="4">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb958-5" title="5"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb958-6" title="6">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb958-7" title="7">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb958-8" title="8">            detecte_oui</a>
<a class="sourceLine" id="cb958-9" title="9">        )</a>
<a class="sourceLine" id="cb958-10" title="10">    )</a></code></pre></div>
</div>

<p>Ajouter un argument <code>.names</code> à <code>across()</code> pour que les variables recodées soient stockées dans de nouvelles colonnes nommées avec le suffixe <code>"_true"</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" title="1">detecte_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb959-2" title="2">    v <span class="op">==</span><span class="st"> &quot;Oui&quot;</span></a>
<a class="sourceLine" id="cb959-3" title="3">}</a>
<a class="sourceLine" id="cb959-4" title="4">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb959-5" title="5"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb959-6" title="6">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb959-7" title="7">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb959-8" title="8">            detecte_oui,</a>
<a class="sourceLine" id="cb959-9" title="9">            <span class="dt">.names =</span> <span class="st">&quot;{.col}_true&quot;</span></a>
<a class="sourceLine" id="cb959-10" title="10">        )</a>
<a class="sourceLine" id="cb959-11" title="11">    )</a></code></pre></div>
</div>

</div>
<div id="rowwise-et-c_across" class="section level3">
<h3><span class="header-section-number">17.6.3</span> <code>rowwise()</code> et <code>c_across()</code></h3>
<p><strong>Exercice 3.1</strong></p>
<p>On repart du code final de l’exercice 2.3, qui recodait une série de variables de <code>hdv2003</code> en valeurs <code>TRUE</code>/<code>FALSE</code> dans de nouvelles variables avec le suffixe "_true".</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb960-1" title="1">detecte_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb960-2" title="2">    v <span class="op">==</span><span class="st"> &quot;Oui&quot;</span></a>
<a class="sourceLine" id="cb960-3" title="3">}</a>
<a class="sourceLine" id="cb960-4" title="4">hdv2003 &lt;-<span class="st"> </span>hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb960-5" title="5"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb960-6" title="6">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb960-7" title="7">            hard.rock<span class="op">:</span>sport,</a>
<a class="sourceLine" id="cb960-8" title="8">            detecte_oui,</a>
<a class="sourceLine" id="cb960-9" title="9">            <span class="dt">.names =</span> <span class="st">&quot;{.col}_true&quot;</span></a>
<a class="sourceLine" id="cb960-10" title="10">        )</a>
<a class="sourceLine" id="cb960-11" title="11">    )</a></code></pre></div>
<p>Calculer le plus simplement possible une nouvelle variable <code>total</code> qui contient, pour chaque ligne, le nombre de valeurs <code>TRUE</code> des deux variables <code>cinema_true</code> et <code>sport_true</code> (si une ligne contient <code>TRUE</code> pour ces deux variables, <code>total</code> doit valoir 2, etc.)</p>

<div class="solution-exo">
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb961-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb961-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">total =</span> cuisine_true <span class="op">+</span><span class="st"> </span>sport_true)</a></code></pre></div>
</div>

<p>Recalculer la variable <code>total</code> pour qu’elle contienne le nombre de <code>TRUE</code> par ligne pour les variables <code>bricol_true</code>, <code>cinema_true</code> et <code>sport_true</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb962-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb962-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb962-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">sum</span>(cuisine_true, sport_true, bricol_true))</a></code></pre></div>
</div>

<p>Recalculer la variable <code>total</code> pour qu’elle contienne le nombre de <code>TRUE</code> par ligne pour toutes les variables se terminant par "_true".</p>

<div class="solution-exo">
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb963-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb963-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb963-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">sum</span>(<span class="kw">c_across</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_true&quot;</span>))))</a></code></pre></div>
</div>

<p>Reprendre le code précédent pour qu’il puisse s’appliquer directement sur les variables <code>hard.rock</code>…<code>sport</code>, sans passer par le recodage en <code>TRUE</code>/<code>FALSE</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb964-1" title="1">count_oui &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb964-2" title="2">    <span class="kw">sum</span>(v <span class="op">==</span><span class="st"> &quot;Oui&quot;</span>)</a>
<a class="sourceLine" id="cb964-3" title="3">}</a>
<a class="sourceLine" id="cb964-4" title="4"></a>
<a class="sourceLine" id="cb964-5" title="5">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb964-6" title="6"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb964-7" title="7"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb964-8" title="8">        <span class="dt">total =</span> <span class="kw">count_oui</span>(<span class="kw">c_across</span>(hard.rock<span class="op">:</span>sport))</a>
<a class="sourceLine" id="cb964-9" title="9">    )</a></code></pre></div>
</div>

<p><strong>Exercice 3.2</strong></p>
<p>Dans le jeu de données <code>starwars</code>, la colonne <code>films</code> contient la liste des films dans lesquels apparaissent les différents personnages. Cette colonne a une forme un peu particulière puisqu’il s’agit d’une “colonne-liste” : les éléments de cette colonne sont eux-mêmes des listes.</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb965-1" title="1"><span class="kw">head</span>(starwars<span class="op">$</span>films, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb965-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb965-3" title="3"><span class="co">#&gt; [1] &quot;The Empire Strikes Back&quot; &quot;Revenge of the Sith&quot;    </span></a>
<a class="sourceLine" id="cb965-4" title="4"><span class="co">#&gt; [3] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             </span></a>
<a class="sourceLine" id="cb965-5" title="5"><span class="co">#&gt; [5] &quot;The Force Awakens&quot;      </span></a>
<a class="sourceLine" id="cb965-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb965-7" title="7"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb965-8" title="8"><span class="co">#&gt; [1] &quot;The Empire Strikes Back&quot; &quot;Attack of the Clones&quot;   </span></a>
<a class="sourceLine" id="cb965-9" title="9"><span class="co">#&gt; [3] &quot;The Phantom Menace&quot;      &quot;Revenge of the Sith&quot;    </span></a>
<a class="sourceLine" id="cb965-10" title="10"><span class="co">#&gt; [5] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             </span></a>
<a class="sourceLine" id="cb965-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb965-12" title="12"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb965-13" title="13"><span class="co">#&gt; [1] &quot;The Empire Strikes Back&quot; &quot;Attack of the Clones&quot;   </span></a>
<a class="sourceLine" id="cb965-14" title="14"><span class="co">#&gt; [3] &quot;The Phantom Menace&quot;      &quot;Revenge of the Sith&quot;    </span></a>
<a class="sourceLine" id="cb965-15" title="15"><span class="co">#&gt; [5] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             </span></a>
<a class="sourceLine" id="cb965-16" title="16"><span class="co">#&gt; [7] &quot;The Force Awakens&quot;</span></a></code></pre></div>
<p>On essaye de calculer le nombre de films pour chaque personnage avec le code suivant. Est-ce que ça fonctionne ? Pourquoi ?</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb966-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb966-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n_films =</span> <span class="kw">length</span>(films))</a></code></pre></div>
<p>Trouver une manière d’obtenir le résultat attendu.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb967-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb967-2" title="2"><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb967-3" title="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n_films =</span> <span class="kw">length</span>(films))</a></code></pre></div>
</div>

</div>
<div id="fonctions-anonymes-et-notations-abrégées" class="section level3">
<h3><span class="header-section-number">17.6.4</span> Fonctions anonymes et notations abrégées</h3>
<p><strong>Exercice 4.1</strong></p>
<p>Soit le code suivant, qui renomme les colonnes du tableau <code>starwars</code> de type liste en leur ajoutant le préfixe “liste_”.</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb968-1" title="1">ajoute_prefixe_liste &lt;-<span class="st"> </span><span class="cf">function</span>(nom) {</a>
<a class="sourceLine" id="cb968-2" title="2">    <span class="kw">paste0</span>(<span class="st">&quot;liste_&quot;</span>, nom)</a>
<a class="sourceLine" id="cb968-3" title="3">}</a>
<a class="sourceLine" id="cb968-4" title="4"></a>
<a class="sourceLine" id="cb968-5" title="5">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-6" title="6"><span class="st">    </span><span class="kw">rename_with</span>(ajoute_prefixe_liste, <span class="dt">.cols =</span> <span class="kw">where</span>(is.list))</a></code></pre></div>
<p>Réécrire ce code avec une fonction anonyme en utilisant les trois notations :</p>
<ul>
<li>classique (avec <code>function()</code>)</li>
<li>formule (du <em>tidyverse</em>)</li>
<li>compacte (à partir de R 4.1)</li>
</ul>

<div class="solution-exo">
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" title="1"><span class="co"># Classique</span></a>
<a class="sourceLine" id="cb969-2" title="2">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-3" title="3"><span class="st">    </span><span class="kw">rename_with</span>(</a>
<a class="sourceLine" id="cb969-4" title="4">        <span class="cf">function</span>(nom) { <span class="kw">paste0</span>(<span class="st">&quot;liste_&quot;</span>, nom) },</a>
<a class="sourceLine" id="cb969-5" title="5">        <span class="dt">.cols =</span> <span class="kw">where</span>(is.list)</a>
<a class="sourceLine" id="cb969-6" title="6">    )</a>
<a class="sourceLine" id="cb969-7" title="7"><span class="co"># Formule</span></a>
<a class="sourceLine" id="cb969-8" title="8">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-9" title="9"><span class="st">    </span><span class="kw">rename_with</span>(</a>
<a class="sourceLine" id="cb969-10" title="10">        <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;liste_&quot;</span>, .x),</a>
<a class="sourceLine" id="cb969-11" title="11">        <span class="dt">.cols =</span> <span class="kw">where</span>(is.list)</a>
<a class="sourceLine" id="cb969-12" title="12">    )</a>
<a class="sourceLine" id="cb969-13" title="13"><span class="co"># Compacte</span></a>
<a class="sourceLine" id="cb969-14" title="14">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-15" title="15"><span class="st">    </span><span class="kw">rename_with</span>(</a>
<a class="sourceLine" id="cb969-16" title="16">        \(nom) <span class="kw">paste0</span>(<span class="st">&quot;liste_&quot;</span>, nom),</a>
<a class="sourceLine" id="cb969-17" title="17">        <span class="dt">.cols =</span> <span class="kw">where</span>(is.list)</a>
<a class="sourceLine" id="cb969-18" title="18">    )</a></code></pre></div>
</div>

<p><strong>Exercice 4.2</strong></p>
<p>Le code suivant indique, pour chaque région du jeu de données <code>rp2012</code>, le nom de la commune ayant la valeur maximale pour les variables <code>dipl_aucun</code> et <code>dipl_sup</code>.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb970-1" title="1">nom_commune_max &lt;-<span class="st"> </span><span class="cf">function</span>(valeurs, communes) {</a>
<a class="sourceLine" id="cb970-2" title="2">    communes[valeurs <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(valeurs)]</a>
<a class="sourceLine" id="cb970-3" title="3">}</a>
<a class="sourceLine" id="cb970-4" title="4"></a>
<a class="sourceLine" id="cb970-5" title="5">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb970-6" title="6"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb970-7" title="7"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb970-8" title="8">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb970-9" title="9">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb970-10" title="10">            nom_commune_max,</a>
<a class="sourceLine" id="cb970-11" title="11">            commune</a>
<a class="sourceLine" id="cb970-12" title="12">        )</a>
<a class="sourceLine" id="cb970-13" title="13">    )</a>
<a class="sourceLine" id="cb970-14" title="14"><span class="co">#&gt; # A tibble: 26 × 3</span></a>
<a class="sourceLine" id="cb970-15" title="15"><span class="co">#&gt;    region            dipl_aucun                  dipl_sup            </span></a>
<a class="sourceLine" id="cb970-16" title="16"><span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                       &lt;chr&gt;               </span></a>
<a class="sourceLine" id="cb970-17" title="17"><span class="co">#&gt;  1 Alsace            Bischwiller                 Strasbourg          </span></a>
<a class="sourceLine" id="cb970-18" title="18"><span class="co">#&gt;  2 Aquitaine         Les Églisottes-et-Chalaures Bordeaux            </span></a>
<a class="sourceLine" id="cb970-19" title="19"><span class="co">#&gt;  3 Auvergne          Aigueperse                  Chamalières         </span></a>
<a class="sourceLine" id="cb970-20" title="20"><span class="co">#&gt;  4 Basse-Normandie   Périers                     Saint-Contest       </span></a>
<a class="sourceLine" id="cb970-21" title="21"><span class="co">#&gt;  5 Bourgogne         Saint-Florentin             Fontaine-lès-Dijon  </span></a>
<a class="sourceLine" id="cb970-22" title="22"><span class="co">#&gt;  6 Bretagne          La Guerche-de-Bretagne      Saint-Grégoire      </span></a>
<a class="sourceLine" id="cb970-23" title="23"><span class="co">#&gt;  7 Centre            Gièvres                     Olivet              </span></a>
<a class="sourceLine" id="cb970-24" title="24"><span class="co">#&gt;  8 Champagne-Ardenne Pargny-sur-Saulx            Taissy              </span></a>
<a class="sourceLine" id="cb970-25" title="25"><span class="co">#&gt;  9 Corse             Ghisonaccia                 Ville-di-Pietrabugno</span></a>
<a class="sourceLine" id="cb970-26" title="26"><span class="co">#&gt; 10 Franche-Comté     Saint-Loup-sur-Semouse      Pirey               </span></a>
<a class="sourceLine" id="cb970-27" title="27"><span class="co">#&gt; # … with 16 more rows</span></a></code></pre></div>
<p>Réécrire ce code en utilisant une fonction anonyme, avec la syntaxe de votre choix (classique, formule ou compacte).</p>

<div class="solution-exo">
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" title="1"><span class="co"># Classique</span></a>
<a class="sourceLine" id="cb971-2" title="2">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-3" title="3"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-4" title="4"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb971-5" title="5">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb971-6" title="6">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb971-7" title="7">            <span class="cf">function</span>(valeurs, communes) { communes[valeurs <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(valeurs)] },</a>
<a class="sourceLine" id="cb971-8" title="8">            commune</a>
<a class="sourceLine" id="cb971-9" title="9">        )</a>
<a class="sourceLine" id="cb971-10" title="10">    )</a>
<a class="sourceLine" id="cb971-11" title="11"><span class="co"># Formule</span></a>
<a class="sourceLine" id="cb971-12" title="12">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-13" title="13"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-14" title="14"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb971-15" title="15">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb971-16" title="16">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb971-17" title="17">            <span class="op">~</span><span class="st"> </span>.y[.x <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(.x)],</a>
<a class="sourceLine" id="cb971-18" title="18">            commune</a>
<a class="sourceLine" id="cb971-19" title="19">        )</a>
<a class="sourceLine" id="cb971-20" title="20">    )</a>
<a class="sourceLine" id="cb971-21" title="21"><span class="co"># Compacte</span></a>
<a class="sourceLine" id="cb971-22" title="22">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-23" title="23"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-24" title="24"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb971-25" title="25">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb971-26" title="26">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb971-27" title="27">            \(valeurs, communes) communes[valeurs <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(valeurs)],</a>
<a class="sourceLine" id="cb971-28" title="28">            commune</a>
<a class="sourceLine" id="cb971-29" title="29">        )</a>
<a class="sourceLine" id="cb971-30" title="30">    )</a></code></pre></div>
</div>

<p>À l’aide d’une fonction anonyme supplémentaire, modifier le code pour qu’il retourne également, pour les mêmes variables, le nom des communes avec les valeurs minimales.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb972-1" title="1"><span class="co"># Formule</span></a>
<a class="sourceLine" id="cb972-2" title="2">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb972-3" title="3"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb972-4" title="4"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb972-5" title="5">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb972-6" title="6">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb972-7" title="7">            <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb972-8" title="8">                <span class="dt">max =</span> <span class="op">~</span><span class="st"> </span>.y[.x <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(.x)],</a>
<a class="sourceLine" id="cb972-9" title="9">                <span class="dt">min =</span> <span class="op">~</span><span class="st"> </span>.y[.x <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(.x)]</a>
<a class="sourceLine" id="cb972-10" title="10">            ),</a>
<a class="sourceLine" id="cb972-11" title="11">            commune</a>
<a class="sourceLine" id="cb972-12" title="12">        )</a>
<a class="sourceLine" id="cb972-13" title="13">    )</a>
<a class="sourceLine" id="cb972-14" title="14"><span class="co"># Compacte</span></a>
<a class="sourceLine" id="cb972-15" title="15">rp2012 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb972-16" title="16"><span class="st">    </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb972-17" title="17"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb972-18" title="18">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb972-19" title="19">            <span class="kw">c</span>(dipl_aucun, dipl_sup),</a>
<a class="sourceLine" id="cb972-20" title="20">            <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb972-21" title="21">                <span class="dt">max =</span> \(valeurs, communes) communes[valeurs <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(valeurs)],</a>
<a class="sourceLine" id="cb972-22" title="22">                <span class="dt">min =</span> \(valeurs, communes) communes[valeurs <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(valeurs)]</a>
<a class="sourceLine" id="cb972-23" title="23">            ),</a>
<a class="sourceLine" id="cb972-24" title="24">            commune</a>
<a class="sourceLine" id="cb972-25" title="25">        )</a>
<a class="sourceLine" id="cb972-26" title="26">    ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">View</span>()</a></code></pre></div>
</div>


</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="34">
<li id="fn34"><p>Attention, le jeu de données ne comporte que les communes de plus de 2000 habitants.<a href="17-dplyr-avance.html#fnref34" class="footnote-back">↩</a></p></li>
<li id="fn35"><p>Un nom de salon de coiffure s’est glissé dans cette liste de restaurants. Saurez-vous le retrouver ?<a href="17-dplyr-avance.html#fnref35" class="footnote-back">↩</a></p></li>
</ol>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="16-boucles-if.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="18-purrr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/juba/tidyverse/blob/main/17-dplyr-avance.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["introduction_au_tidyverse.epub", "introduction_au_tidyverse.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
