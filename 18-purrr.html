<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Partie 18 Itérer avec purrr | Introduction à R et au tidyverse</title>
  <meta name="description" content="Une introduction à R et aux extensions du tidyverse" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Partie 18 Itérer avec purrr | Introduction à R et au tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Une introduction à R et aux extensions du tidyverse" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Partie 18 Itérer avec purrr | Introduction à R et au tidyverse" />
  
  <meta name="twitter:description" content="Une introduction à R et aux extensions du tidyverse" />
  

<meta name="author" content="Julien Barnier" />


<meta name="date" content="2021-11-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="17-if-boucles.html"/>
<link rel="next" href="19-programmer-tidyverse.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Introduction à R et au <em>tidyverse</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>À propos de ce document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01-presentation.html"><a href="01-presentation.html"><i class="fa fa-check"></i><b>1</b> Présentation</a><ul>
<li class="chapter" data-level="1.1" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-de-r"><i class="fa fa-check"></i><b>1.1</b> À propos de R</a></li>
<li class="chapter" data-level="1.2" data-path="01-presentation.html"><a href="01-presentation.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> À propos de RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-du-tidyverse"><i class="fa fa-check"></i><b>1.3</b> À propos du <em>tidyverse</em></a></li>
<li class="chapter" data-level="1.4" data-path="01-presentation.html"><a href="01-presentation.html#structure-du-document"><i class="fa fa-check"></i><b>1.4</b> Structure du document</a></li>
<li class="chapter" data-level="1.5" data-path="01-presentation.html"><a href="01-presentation.html#prérequis"><i class="fa fa-check"></i><b>1.5</b> Prérequis</a></li>
</ul></li>
<li class="part"><span><b>I Introduction à R</b></span></li>
<li class="chapter" data-level="2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html"><i class="fa fa-check"></i><b>2</b> Prise en main</a><ul>
<li class="chapter" data-level="2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#la-console"><i class="fa fa-check"></i><b>2.1</b> La console</a><ul>
<li class="chapter" data-level="2.1.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#linvite-de-commandes"><i class="fa fa-check"></i><b>2.1.1</b> L’invite de commandes</a></li>
<li class="chapter" data-level="2.1.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#précisions-concernant-la-saisie-des-commandes"><i class="fa fa-check"></i><b>2.1.2</b> Précisions concernant la saisie des commandes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets"><i class="fa fa-check"></i><b>2.2</b> Objets</a><ul>
<li class="chapter" data-level="2.2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets-simples"><i class="fa fa-check"></i><b>2.2.1</b> Objets simples</a></li>
<li class="chapter" data-level="2.2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#introvecteurs"><i class="fa fa-check"></i><b>2.2.2</b> Vecteurs</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#fonctions"><i class="fa fa-check"></i><b>2.3</b> Fonctions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#principe"><i class="fa fa-check"></i><b>2.3.1</b> Principe</a></li>
<li class="chapter" data-level="2.3.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#arguments"><i class="fa fa-check"></i><b>2.3.2</b> Arguments</a></li>
<li class="chapter" data-level="2.3.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#aide-sur-une-fonction"><i class="fa fa-check"></i><b>2.3.3</b> Aide sur une fonction</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#regrouper-ses-commandes-dans-des-scripts"><i class="fa fa-check"></i><b>2.4</b> Regrouper ses commandes dans des scripts</a><ul>
<li class="chapter" data-level="2.4.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#commentaires"><i class="fa fa-check"></i><b>2.4.1</b> Commentaires</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#packages"><i class="fa fa-check"></i><b>2.5</b> Installer et charger des extensions (<em>packages</em>)</a></li>
<li class="chapter" data-level="2.6" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#exercices"><i class="fa fa-check"></i><b>2.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-premier_travail.html"><a href="03-premier_travail.html"><i class="fa fa-check"></i><b>3</b> Premier travail avec des données</a><ul>
<li class="chapter" data-level="3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#jeu-de-données-dexemple"><i class="fa fa-check"></i><b>3.1</b> Jeu de données d’exemple</a></li>
<li class="chapter" data-level="3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#tableau-de-données-data-frame"><i class="fa fa-check"></i><b>3.2</b> Tableau de données (<em>data frame</em>)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#structure-du-tableau"><i class="fa fa-check"></i><b>3.2.1</b> Structure du tableau</a></li>
<li class="chapter" data-level="3.2.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#accéder-aux-variables-dun-tableau"><i class="fa fa-check"></i><b>3.2.2</b> Accéder aux variables d’un tableau</a></li>
<li class="chapter" data-level="3.2.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#créer-une-nouvelle-variable"><i class="fa fa-check"></i><b>3.2.3</b> Créer une nouvelle variable</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyse-univariée"><i class="fa fa-check"></i><b>3.3</b> Analyse univariée</a><ul>
<li class="chapter" data-level="3.3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-quantitative"><i class="fa fa-check"></i><b>3.3.1</b> Analyser une variable quantitative</a></li>
<li class="chapter" data-level="3.3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-qualitative"><i class="fa fa-check"></i><b>3.3.2</b> Analyser une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="03-premier_travail.html"><a href="03-premier_travail.html#exercices-1"><i class="fa fa-check"></i><b>3.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-bivarie.html"><a href="04-bivarie.html"><i class="fa fa-check"></i><b>4</b> Analyse bivariée</a><ul>
<li class="chapter" data-level="4.1" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-qualitatives"><i class="fa fa-check"></i><b>4.1</b> Croisement de deux variables qualitatives</a><ul>
<li class="chapter" data-level="4.1.1" data-path="04-bivarie.html"><a href="04-bivarie.html#tableaux-croisés"><i class="fa fa-check"></i><b>4.1.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="4.1.2" data-path="04-bivarie.html"><a href="04-bivarie.html#test-du-χ²"><i class="fa fa-check"></i><b>4.1.2</b> Test du χ²</a></li>
<li class="chapter" data-level="4.1.3" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-1"><i class="fa fa-check"></i><b>4.1.3</b> Représentation graphique</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-dune-variable-quantitative-et-dune-variable-qualitative"><i class="fa fa-check"></i><b>4.2</b> Croisement d’une variable quantitative et d’une variable qualitative</a><ul>
<li class="chapter" data-level="4.2.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-2"><i class="fa fa-check"></i><b>4.2.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.2.2" data-path="04-bivarie.html"><a href="04-bivarie.html#tapply"><i class="fa fa-check"></i><b>4.2.2</b> Calculs d’indicateurs</a></li>
<li class="chapter" data-level="4.2.3" data-path="04-bivarie.html"><a href="04-bivarie.html#tests-statistiques"><i class="fa fa-check"></i><b>4.2.3</b> Tests statistiques</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-quantitatives"><i class="fa fa-check"></i><b>4.3</b> Croisement de deux variables quantitatives</a><ul>
<li class="chapter" data-level="4.3.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-3"><i class="fa fa-check"></i><b>4.3.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.3.2" data-path="04-bivarie.html"><a href="04-bivarie.html#calcul-dindicateurs"><i class="fa fa-check"></i><b>4.3.2</b> Calcul d’indicateurs</a></li>
<li class="chapter" data-level="4.3.3" data-path="04-bivarie.html"><a href="04-bivarie.html#régression-linéaire"><i class="fa fa-check"></i><b>4.3.3</b> Régression linéaire</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="04-bivarie.html"><a href="04-bivarie.html#exercices-2"><i class="fa fa-check"></i><b>4.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-organiser.html"><a href="05-organiser.html"><i class="fa fa-check"></i><b>5</b> Organiser ses scripts</a><ul>
<li class="chapter" data-level="5.1" data-path="05-organiser.html"><a href="05-organiser.html#projets"><i class="fa fa-check"></i><b>5.1</b> Les projets dans RStudio</a></li>
<li class="chapter" data-level="5.2" data-path="05-organiser.html"><a href="05-organiser.html#créer-des-sections-dans-un-script"><i class="fa fa-check"></i><b>5.2</b> Créer des sections dans un script</a></li>
<li class="chapter" data-level="5.3" data-path="05-organiser.html"><a href="05-organiser.html#répartir-son-travail-entre-plusieurs-scripts"><i class="fa fa-check"></i><b>5.3</b> Répartir son travail entre plusieurs scripts</a></li>
<li class="chapter" data-level="5.4" data-path="05-organiser.html"><a href="05-organiser.html#désactiver-la-sauvegarde-de-lespace-de-travail"><i class="fa fa-check"></i><b>5.4</b> Désactiver la sauvegarde de l’espace de travail</a></li>
</ul></li>
<li class="part"><span><b>II Introduction au tidyverse</b></span></li>
<li class="chapter" data-level="6" data-path="06-tidyverse.html"><a href="06-tidyverse.html"><i class="fa fa-check"></i><b>6</b> Le tidyverse</a><ul>
<li class="chapter" data-level="6.1" data-path="06-tidyverse.html"><a href="06-tidyverse.html#extensions"><i class="fa fa-check"></i><b>6.1</b> Extensions</a></li>
<li class="chapter" data-level="6.2" data-path="06-tidyverse.html"><a href="06-tidyverse.html#installation"><i class="fa fa-check"></i><b>6.2</b> Installation</a></li>
<li class="chapter" data-level="6.3" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tidydata"><i class="fa fa-check"></i><b>6.3</b> tidy data</a></li>
<li class="chapter" data-level="6.4" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>6.4</b> tibbles</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-import.html"><a href="07-import.html"><i class="fa fa-check"></i><b>7</b> Importer et exporter des données</a><ul>
<li class="chapter" data-level="7.1" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-textes"><i class="fa fa-check"></i><b>7.1</b> Import de fichiers textes</a><ul>
<li class="chapter" data-level="7.1.1" data-path="07-import.html"><a href="07-import.html#interface-interactive-dimport-de-fichiers"><i class="fa fa-check"></i><b>7.1.1</b> Interface interactive d’import de fichiers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="07-import.html"><a href="07-import.html#import-depuis-un-fichier-excel"><i class="fa fa-check"></i><b>7.2</b> Import depuis un fichier Excel</a></li>
<li class="chapter" data-level="7.3" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-sas-spss-et-stata"><i class="fa fa-check"></i><b>7.3</b> Import de fichiers SAS, SPSS et Stata</a></li>
<li class="chapter" data-level="7.4" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-dbase"><i class="fa fa-check"></i><b>7.4</b> Import de fichiers dBase</a></li>
<li class="chapter" data-level="7.5" data-path="07-import.html"><a href="07-import.html#connexion-à-des-bases-de-données"><i class="fa fa-check"></i><b>7.5</b> Connexion à des bases de données</a><ul>
<li class="chapter" data-level="7.5.1" data-path="07-import.html"><a href="07-import.html#interfaçage-via-lextension-dbi"><i class="fa fa-check"></i><b>7.5.1</b> Interfaçage via l’extension <code>DBI</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="07-import.html"><a href="07-import.html#utilisation-de-dplyr-et-dbplyr"><i class="fa fa-check"></i><b>7.5.2</b> Utilisation de <code>dplyr</code> et <code>dbplyr</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="07-import.html"><a href="07-import.html#ressources"><i class="fa fa-check"></i><b>7.5.3</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="07-import.html"><a href="07-import.html#export-de-données"><i class="fa fa-check"></i><b>7.6</b> Export de données</a><ul>
<li class="chapter" data-level="7.6.1" data-path="07-import.html"><a href="07-import.html#export-de-tableaux-de-données"><i class="fa fa-check"></i><b>7.6.1</b> Export de tableaux de données</a></li>
<li class="chapter" data-level="7.6.2" data-path="07-import.html"><a href="07-import.html#sauvegarder-des-objets"><i class="fa fa-check"></i><b>7.6.2</b> Sauvegarder des objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-ggplot2.html"><a href="08-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Visualiser avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="8.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#préparation"><i class="fa fa-check"></i><b>8.1</b> Préparation</a></li>
<li class="chapter" data-level="8.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#initialisation"><i class="fa fa-check"></i><b>8.2</b> Initialisation</a></li>
<li class="chapter" data-level="8.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-geom"><i class="fa fa-check"></i><b>8.3</b> Exemples de <code>geom</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_boxplot"><i class="fa fa-check"></i><b>8.3.1</b> <code>geom_boxplot</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_violin"><i class="fa fa-check"></i><b>8.3.2</b> <code>geom_violin</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar"><i class="fa fa-check"></i><b>8.3.3</b> <code>geom_bar</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_text"><i class="fa fa-check"></i><b>8.3.4</b> <code>geom_text</code></a></li>
<li class="chapter" data-level="8.3.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_label"><i class="fa fa-check"></i><b>8.3.5</b> <code>geom_label</code></a></li>
<li class="chapter" data-level="8.3.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_density"><i class="fa fa-check"></i><b>8.3.6</b> <code>geom_density</code></a></li>
<li class="chapter" data-level="8.3.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_line"><i class="fa fa-check"></i><b>8.3.7</b> <code>geom_line</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#mappages"><i class="fa fa-check"></i><b>8.4</b> Mappages</a><ul>
<li class="chapter" data-level="8.4.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-mappages"><i class="fa fa-check"></i><b>8.4.1</b> Exemples de mappages</a></li>
<li class="chapter" data-level="8.4.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#aes-or-not-aes"><i class="fa fa-check"></i><b>8.4.2</b> <code>aes()</code> or not <code>aes()</code> ?</a></li>
<li class="chapter" data-level="8.4.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar-et-position"><i class="fa fa-check"></i><b>8.4.3</b> <code>geom_bar</code> et <code>position</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#représentation-de-plusieurs-geom"><i class="fa fa-check"></i><b>8.5</b> Représentation de plusieurs <code>geom</code></a><ul>
<li class="chapter" data-level="8.5.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#plusieurs-sources-de-données"><i class="fa fa-check"></i><b>8.5.1</b> Plusieurs sources de données</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#faceting"><i class="fa fa-check"></i><b>8.6</b> Faceting</a></li>
<li class="chapter" data-level="8.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scales"><i class="fa fa-check"></i><b>8.7</b> Scales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_size"><i class="fa fa-check"></i><b>8.7.1</b> <code>scale_size</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_x-scale_y"><i class="fa fa-check"></i><b>8.7.2</b> <code>scale_x</code>, <code>scale_y</code></a></li>
<li class="chapter" data-level="8.7.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scalecolor"><i class="fa fa-check"></i><b>8.7.3</b> <code>scale_color</code>, <code>scale_fill</code></a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="08-ggplot2.html"><a href="08-ggplot2.html#thèmes"><i class="fa fa-check"></i><b>8.8</b> Thèmes</a></li>
<li class="chapter" data-level="8.9" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ladd-in-esquisse"><i class="fa fa-check"></i><b>8.9</b> L’add-in <code>esquisse</code></a></li>
<li class="chapter" data-level="8.10" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ressources-1"><i class="fa fa-check"></i><b>8.10</b> Ressources</a></li>
<li class="chapter" data-level="8.11" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exercices-3"><i class="fa fa-check"></i><b>8.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-recodages.html"><a href="09-recodages.html"><i class="fa fa-check"></i><b>9</b> Recoder des variables</a><ul>
<li class="chapter" data-level="9.1" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs"><i class="fa fa-check"></i><b>9.1</b> Rappel sur les variables et les vecteurs</a></li>
<li class="chapter" data-level="9.2" data-path="09-recodages.html"><a href="09-recodages.html#tests"><i class="fa fa-check"></i><b>9.2</b> Tests et comparaison</a></li>
<li class="chapter" data-level="9.3" data-path="09-recodages.html"><a href="09-recodages.html#recoder-une-variable-qualitative"><i class="fa fa-check"></i><b>9.3</b> Recoder une variable qualitative</a><ul>
<li class="chapter" data-level="9.3.1" data-path="09-recodages.html"><a href="09-recodages.html#facteurs"><i class="fa fa-check"></i><b>9.3.1</b> Facteurs et <code>forcats</code></a></li>
<li class="chapter" data-level="9.3.2" data-path="09-recodages.html"><a href="09-recodages.html#recode"><i class="fa fa-check"></i><b>9.3.2</b> Modifier les modalités d’une variable qualitative</a></li>
<li class="chapter" data-level="9.3.3" data-path="09-recodages.html"><a href="09-recodages.html#ordonner-les-modalités-dune-variable-qualitative"><i class="fa fa-check"></i><b>9.3.3</b> Ordonner les modalités d’une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables"><i class="fa fa-check"></i><b>9.4</b> Combiner plusieurs variables</a><ul>
<li class="chapter" data-level="9.4.1" data-path="09-recodages.html"><a href="09-recodages.html#if-else"><i class="fa fa-check"></i><b>9.4.1</b> <code>if_else</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="09-recodages.html"><a href="09-recodages.html#case_when"><i class="fa fa-check"></i><b>9.4.2</b> <code>case_when</code></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique-en-classes"><i class="fa fa-check"></i><b>9.5</b> Découper une variable numérique en classes</a><ul>
<li class="chapter" data-level="9.5.1" data-path="09-recodages.html"><a href="09-recodages.html#interface-graphique"><i class="fa fa-check"></i><b>9.5.1</b> Interface graphique</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="09-recodages.html"><a href="09-recodages.html#exercices-4"><i class="fa fa-check"></i><b>9.6</b> Exercices</a><ul>
<li class="chapter" data-level="9.6.1" data-path="09-recodages.html"><a href="09-recodages.html#préparation-1"><i class="fa fa-check"></i><b>9.6.1</b> Préparation</a></li>
<li class="chapter" data-level="9.6.2" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs-et-tests"><i class="fa fa-check"></i><b>9.6.2</b> Vecteurs et tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="09-recodages.html"><a href="09-recodages.html#recodages-de-variable-qualitative"><i class="fa fa-check"></i><b>9.6.3</b> Recodages de variable qualitative</a></li>
<li class="chapter" data-level="9.6.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables-1"><i class="fa fa-check"></i><b>9.6.4</b> Combiner plusieurs variables</a></li>
<li class="chapter" data-level="9.6.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique"><i class="fa fa-check"></i><b>9.6.5</b> Découper une variable numérique</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-dplyr.html"><a href="10-dplyr.html"><i class="fa fa-check"></i><b>10</b> Manipuler les données avec <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.1" data-path="10-dplyr.html"><a href="10-dplyr.html#préparation-2"><i class="fa fa-check"></i><b>10.1</b> Préparation</a></li>
<li class="chapter" data-level="10.2" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-dplyr"><i class="fa fa-check"></i><b>10.2</b> Les verbes de <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice"><i class="fa fa-check"></i><b>10.2.1</b> <code>slice</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="10-dplyr.html"><a href="10-dplyr.html#filter"><i class="fa fa-check"></i><b>10.2.2</b> <code>filter</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="10-dplyr.html"><a href="10-dplyr.html#select-rename"><i class="fa fa-check"></i><b>10.2.3</b> <code>select</code> et <code>rename</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="10-dplyr.html"><a href="10-dplyr.html#arrange"><i class="fa fa-check"></i><b>10.2.4</b> <code>arrange</code></a></li>
<li class="chapter" data-level="10.2.5" data-path="10-dplyr.html"><a href="10-dplyr.html#mutate"><i class="fa fa-check"></i><b>10.2.5</b> <code>mutate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="10-dplyr.html"><a href="10-dplyr.html#pipe"><i class="fa fa-check"></i><b>10.3</b> Enchaîner les opérations avec le <em>pipe</em></a></li>
<li class="chapter" data-level="10.4" data-path="10-dplyr.html"><a href="10-dplyr.html#opérations-groupées"><i class="fa fa-check"></i><b>10.4</b> Opérations groupées</a><ul>
<li class="chapter" data-level="10.4.1" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by"><i class="fa fa-check"></i><b>10.4.1</b> <code>group_by</code></a></li>
<li class="chapter" data-level="10.4.2" data-path="10-dplyr.html"><a href="10-dplyr.html#summarise-et-count"><i class="fa fa-check"></i><b>10.4.2</b> <code>summarise</code> et <code>count</code></a></li>
<li class="chapter" data-level="10.4.3" data-path="10-dplyr.html"><a href="10-dplyr.html#grouper-selon-plusieurs-variables"><i class="fa fa-check"></i><b>10.4.3</b> Grouper selon plusieurs variables</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="10-dplyr.html"><a href="10-dplyr.html#autres-fonctions-utiles"><i class="fa fa-check"></i><b>10.5</b> Autres fonctions utiles</a><ul>
<li class="chapter" data-level="10.5.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_sample"><i class="fa fa-check"></i><b>10.5.1</b> <code>slice_sample</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_head-slice_tail-slice_min-slice_max"><i class="fa fa-check"></i><b>10.5.2</b> <code>slice_head</code>, <code>slice_tail</code>, <code>slice_min</code>, <code>slice_max</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="10-dplyr.html"><a href="10-dplyr.html#lead-et-lag"><i class="fa fa-check"></i><b>10.5.3</b> <code>lead</code> et <code>lag</code></a></li>
<li class="chapter" data-level="10.5.4" data-path="10-dplyr.html"><a href="10-dplyr.html#distinct-et-n_distinct"><i class="fa fa-check"></i><b>10.5.4</b> <code>distinct</code> et <code>n_distinct</code></a></li>
<li class="chapter" data-level="10.5.5" data-path="10-dplyr.html"><a href="10-dplyr.html#relocate"><i class="fa fa-check"></i><b>10.5.5</b> <code>relocate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="10-dplyr.html"><a href="10-dplyr.html#tables-multiples"><i class="fa fa-check"></i><b>10.6</b> Tables multiples</a><ul>
<li class="chapter" data-level="10.6.1" data-path="10-dplyr.html"><a href="10-dplyr.html#concaténation-bind_rows-et-bind_cols"><i class="fa fa-check"></i><b>10.6.1</b> Concaténation : <code>bind_rows</code> et <code>bind_cols</code></a></li>
<li class="chapter" data-level="10.6.2" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures"><i class="fa fa-check"></i><b>10.6.2</b> Jointures</a></li>
<li class="chapter" data-level="10.6.3" data-path="10-dplyr.html"><a href="10-dplyr.html#types-de-jointures"><i class="fa fa-check"></i><b>10.6.3</b> Types de jointures</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="10-dplyr.html"><a href="10-dplyr.html#ressources-2"><i class="fa fa-check"></i><b>10.7</b> Ressources</a></li>
<li class="chapter" data-level="10.8" data-path="10-dplyr.html"><a href="10-dplyr.html#exercices-5"><i class="fa fa-check"></i><b>10.8</b> Exercices</a><ul>
<li class="chapter" data-level="10.8.1" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-base-de-dplyr"><i class="fa fa-check"></i><b>10.8.1</b> Les verbes de base de <code>dplyr</code></a></li>
<li class="chapter" data-level="10.8.2" data-path="10-dplyr.html"><a href="10-dplyr.html#enchaîner-des-opérations"><i class="fa fa-check"></i><b>10.8.2</b> Enchaîner des opérations</a></li>
<li class="chapter" data-level="10.8.3" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by-et-summarise"><i class="fa fa-check"></i><b>10.8.3</b> <code>group_by</code> et <code>summarise</code></a></li>
<li class="chapter" data-level="10.8.4" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures-1"><i class="fa fa-check"></i><b>10.8.4</b> Jointures</a></li>
<li class="chapter" data-level="10.8.5" data-path="10-dplyr.html"><a href="10-dplyr.html#bonus"><i class="fa fa-check"></i><b>10.8.5</b> Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-stringr.html"><a href="11-stringr.html"><i class="fa fa-check"></i><b>11</b> Manipuler du texte avec <code>stringr</code></a><ul>
<li class="chapter" data-level="11.1" data-path="11-stringr.html"><a href="11-stringr.html#expressions-régulières"><i class="fa fa-check"></i><b>11.1</b> Expressions régulières</a></li>
<li class="chapter" data-level="11.2" data-path="11-stringr.html"><a href="11-stringr.html#concat"><i class="fa fa-check"></i><b>11.2</b> Concaténer des chaînes</a></li>
<li class="chapter" data-level="11.3" data-path="11-stringr.html"><a href="11-stringr.html#convertir-en-majuscules-minuscules"><i class="fa fa-check"></i><b>11.3</b> Convertir en majuscules / minuscules</a></li>
<li class="chapter" data-level="11.4" data-path="11-stringr.html"><a href="11-stringr.html#découper-des-chaînes"><i class="fa fa-check"></i><b>11.4</b> Découper des chaînes</a></li>
<li class="chapter" data-level="11.5" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-sous-chaînes-par-position"><i class="fa fa-check"></i><b>11.5</b> Extraire des sous-chaînes par position</a></li>
<li class="chapter" data-level="11.6" data-path="11-stringr.html"><a href="11-stringr.html#str-detect"><i class="fa fa-check"></i><b>11.6</b> Détecter des motifs</a></li>
<li class="chapter" data-level="11.7" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-motifs"><i class="fa fa-check"></i><b>11.7</b> Extraire des motifs</a></li>
<li class="chapter" data-level="11.8" data-path="11-stringr.html"><a href="11-stringr.html#remplacer-des-motifs"><i class="fa fa-check"></i><b>11.8</b> Remplacer des motifs</a></li>
<li class="chapter" data-level="11.9" data-path="11-stringr.html"><a href="11-stringr.html#modificateurs"><i class="fa fa-check"></i><b>11.9</b> Modificateurs de motifs</a></li>
<li class="chapter" data-level="11.10" data-path="11-stringr.html"><a href="11-stringr.html#ressources-3"><i class="fa fa-check"></i><b>11.10</b> Ressources</a></li>
<li class="chapter" data-level="11.11" data-path="11-stringr.html"><a href="11-stringr.html#exercices-6"><i class="fa fa-check"></i><b>11.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-tidyr.html"><a href="12-tidyr.html"><i class="fa fa-check"></i><b>12</b> Mettre en ordre avec <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.1" data-path="12-tidyr.html"><a href="12-tidyr.html#tidy-data"><i class="fa fa-check"></i><b>12.1</b> Tidy data</a></li>
<li class="chapter" data-level="12.2" data-path="12-tidyr.html"><a href="12-tidyr.html#trois-règles-pour-des-données-bien-rangées"><i class="fa fa-check"></i><b>12.2</b> Trois règles pour des données bien rangées</a></li>
<li class="chapter" data-level="12.3" data-path="12-tidyr.html"><a href="12-tidyr.html#les-verbes-de-tidyr"><i class="fa fa-check"></i><b>12.3</b> Les verbes de <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.3.1" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>12.3.1</b> <code>pivot_longer</code> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="12.3.2" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>12.3.2</b> <code>pivot_wider</code> : transformer des lignes en colonnes</a></li>
<li class="chapter" data-level="12.3.3" data-path="12-tidyr.html"><a href="12-tidyr.html#separate"><i class="fa fa-check"></i><b>12.3.3</b> <code>separate</code> : séparer une colonne en plusieurs colonnes</a></li>
<li class="chapter" data-level="12.3.4" data-path="12-tidyr.html"><a href="12-tidyr.html#separate-rows"><i class="fa fa-check"></i><b>12.3.4</b> <code>separate_rows</code> : séparer une colonne en plusieurs lignes</a></li>
<li class="chapter" data-level="12.3.5" data-path="12-tidyr.html"><a href="12-tidyr.html#unite-regrouper-plusieurs-colonnes-en-une-seule"><i class="fa fa-check"></i><b>12.3.5</b> <code>unite</code> : regrouper plusieurs colonnes en une seule</a></li>
<li class="chapter" data-level="12.3.6" data-path="12-tidyr.html"><a href="12-tidyr.html#extract"><i class="fa fa-check"></i><b>12.3.6</b> <code>extract</code> : créer de nouvelles colonnes à partir d’une colonne de texte</a></li>
<li class="chapter" data-level="12.3.7" data-path="12-tidyr.html"><a href="12-tidyr.html#complete-compléter-des-combinaisons-de-variables-manquantes"><i class="fa fa-check"></i><b>12.3.7</b> <code>complete</code> : compléter des combinaisons de variables manquantes</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="12-tidyr.html"><a href="12-tidyr.html#ressources-4"><i class="fa fa-check"></i><b>12.4</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html"><i class="fa fa-check"></i><b>13</b> Diffuser et publier avec <code>rmarkdown</code></a><ul>
<li class="chapter" data-level="13.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#créer-un-nouveau-document"><i class="fa fa-check"></i><b>13.1</b> Créer un nouveau document</a></li>
<li class="chapter" data-level="13.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#éléments-dun-document-r-markdown"><i class="fa fa-check"></i><b>13.2</b> Éléments d’un document R Markdown</a><ul>
<li class="chapter" data-level="13.2.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#en-tête-préambule"><i class="fa fa-check"></i><b>13.2.1</b> En-tête (préambule)</a></li>
<li class="chapter" data-level="13.2.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#texte-du-document"><i class="fa fa-check"></i><b>13.2.2</b> Texte du document</a></li>
<li class="chapter" data-level="13.2.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#blocs-de-code-r"><i class="fa fa-check"></i><b>13.2.3</b> Blocs de code R</a></li>
<li class="chapter" data-level="13.2.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#compiler-un-document-knit"><i class="fa fa-check"></i><b>13.2.4</b> Compiler un document (<em>Knit</em>)</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#personnaliser-le-document-généré"><i class="fa fa-check"></i><b>13.3</b> Personnaliser le document généré</a></li>
<li class="chapter" data-level="13.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-des-blocs-de-code-r"><i class="fa fa-check"></i><b>13.4</b> Options des blocs de code R</a><ul>
<li class="chapter" data-level="13.4.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#nom-du-bloc"><i class="fa fa-check"></i><b>13.4.1</b> Nom du bloc</a></li>
<li class="chapter" data-level="13.4.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options"><i class="fa fa-check"></i><b>13.4.2</b> Options</a></li>
<li class="chapter" data-level="13.4.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#modifier-les-options"><i class="fa fa-check"></i><b>13.4.3</b> Modifier les options</a></li>
<li class="chapter" data-level="13.4.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-globales"><i class="fa fa-check"></i><b>13.4.4</b> Options globales</a></li>
<li class="chapter" data-level="13.4.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#mise-en-cache-des-résultats"><i class="fa fa-check"></i><b>13.4.5</b> Mise en cache des résultats</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#rendu-des-tableaux"><i class="fa fa-check"></i><b>13.5</b> Rendu des tableaux</a><ul>
<li class="chapter" data-level="13.5.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-croisés-1"><i class="fa fa-check"></i><b>13.5.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="13.5.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-de-données-et-tris-à-plat"><i class="fa fa-check"></i><b>13.5.2</b> Tableaux de données et tris à plat</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates"><i class="fa fa-check"></i><b>13.6</b> Modèles de documents</a><ul>
<li class="chapter" data-level="13.6.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#slides"><i class="fa fa-check"></i><b>13.6.1</b> Slides</a></li>
<li class="chapter" data-level="13.6.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates-1"><i class="fa fa-check"></i><b>13.6.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#ressources-5"><i class="fa fa-check"></i><b>13.7</b> Ressources</a></li>
</ul></li>
<li class="part"><span><b>III Aller plus loin</b></span></li>
<li class="chapter" data-level="14" data-path="14-fonctions.html"><a href="14-fonctions.html"><i class="fa fa-check"></i><b>14</b> Écrire ses propres fonctions</a><ul>
<li class="chapter" data-level="14.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples"><i class="fa fa-check"></i><b>14.1</b> Introduction et exemples</a><ul>
<li class="chapter" data-level="14.1.1" data-path="14-fonctions.html"><a href="14-fonctions.html#structure-dune-fonction"><i class="fa fa-check"></i><b>14.1.1</b> Structure d’une fonction</a></li>
<li class="chapter" data-level="14.1.2" data-path="14-fonctions.html"><a href="14-fonctions.html#exemple-de-fonction"><i class="fa fa-check"></i><b>14.1.2</b> Exemple de fonction</a></li>
<li class="chapter" data-level="14.1.3" data-path="14-fonctions.html"><a href="14-fonctions.html#effets-de-bord-et-affichage-de-messages"><i class="fa fa-check"></i><b>14.1.3</b> Effets de bord et affichage de messages</a></li>
<li class="chapter" data-level="14.1.4" data-path="14-fonctions.html"><a href="14-fonctions.html#utilité-des-fonctions"><i class="fa fa-check"></i><b>14.1.4</b> Utilité des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultat-dune-fonction"><i class="fa fa-check"></i><b>14.2</b> Arguments et résultat d’une fonction</a><ul>
<li class="chapter" data-level="14.2.1" data-path="14-fonctions.html"><a href="14-fonctions.html#définition-des-arguments"><i class="fa fa-check"></i><b>14.2.1</b> Définition des arguments</a></li>
<li class="chapter" data-level="14.2.2" data-path="14-fonctions.html"><a href="14-fonctions.html#valeurs-par-défaut"><i class="fa fa-check"></i><b>14.2.2</b> Valeurs par défaut</a></li>
<li class="chapter" data-level="14.2.3" data-path="14-fonctions.html"><a href="14-fonctions.html#arg-oblig"><i class="fa fa-check"></i><b>14.2.3</b> Arguments obligatoires et arguments facultatifs</a></li>
<li class="chapter" data-level="14.2.4" data-path="14-fonctions.html"><a href="14-fonctions.html#largument-..."><i class="fa fa-check"></i><b>14.2.4</b> L’argument <code>...</code></a></li>
<li class="chapter" data-level="14.2.5" data-path="14-fonctions.html"><a href="14-fonctions.html#resfunc"><i class="fa fa-check"></i><b>14.2.5</b> Résultat d’une fonction</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables"><i class="fa fa-check"></i><b>14.3</b> Portée des variables</a><ul>
<li class="chapter" data-level="14.3.1" data-path="14-fonctions.html"><a href="14-fonctions.html#une-fonction-peut-accéder-à-un-objet-extérieur"><i class="fa fa-check"></i><b>14.3.1</b> Une fonction peut accéder à un objet extérieur</a></li>
<li class="chapter" data-level="14.3.2" data-path="14-fonctions.html"><a href="14-fonctions.html#les-arguments-et-les-objets-créés-dans-la-fonction-sont-prioritaires"><i class="fa fa-check"></i><b>14.3.2</b> Les arguments et les objets créés dans la fonction sont prioritaires</a></li>
<li class="chapter" data-level="14.3.3" data-path="14-fonctions.html"><a href="14-fonctions.html#un-objet-créé-dans-une-fonction-nexiste-que-dans-cette-fonction"><i class="fa fa-check"></i><b>14.3.3</b> Un objet créé dans une fonction n’existe que dans cette fonction</a></li>
<li class="chapter" data-level="14.3.4" data-path="14-fonctions.html"><a href="14-fonctions.html#on-ne-peut-pas-modifier-un-objet-global-dans-une-fonction"><i class="fa fa-check"></i><b>14.3.4</b> On ne peut pas modifier un objet global dans une fonction</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets"><i class="fa fa-check"></i><b>14.4</b> Les fonctions comme objets</a><ul>
<li class="chapter" data-level="14.4.1" data-path="14-fonctions.html"><a href="14-fonctions.html#passer-des-fonctions-comme-argument"><i class="fa fa-check"></i><b>14.4.1</b> Passer des fonctions comme argument</a></li>
<li class="chapter" data-level="14.4.2" data-path="14-fonctions.html"><a href="14-fonctions.html#fonctions-anonymes"><i class="fa fa-check"></i><b>14.4.2</b> Fonctions anonymes</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="14-fonctions.html"><a href="14-fonctions.html#ressources-6"><i class="fa fa-check"></i><b>14.5</b> Ressources</a></li>
<li class="chapter" data-level="14.6" data-path="14-fonctions.html"><a href="14-fonctions.html#exercices-7"><i class="fa fa-check"></i><b>14.6</b> Exercices</a><ul>
<li class="chapter" data-level="14.6.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples-1"><i class="fa fa-check"></i><b>14.6.1</b> Introduction et exemples</a></li>
<li class="chapter" data-level="14.6.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultat"><i class="fa fa-check"></i><b>14.6.2</b> Arguments et résultat</a></li>
<li class="chapter" data-level="14.6.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables-1"><i class="fa fa-check"></i><b>14.6.3</b> Portée des variables</a></li>
<li class="chapter" data-level="14.6.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets-1"><i class="fa fa-check"></i><b>14.6.4</b> Les fonctions comme objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html"><i class="fa fa-check"></i><b>15</b> <code>dplyr</code> avancé</a><ul>
<li class="chapter" data-level="15.1" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#appliquer-ses-propres-fonctions"><i class="fa fa-check"></i><b>15.1</b> Appliquer ses propres fonctions</a><ul>
<li class="chapter" data-level="15.1.1" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#exemple-avec-mutate"><i class="fa fa-check"></i><b>15.1.1</b> Exemple avec <code>mutate</code></a></li>
<li class="chapter" data-level="15.1.2" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#exemple-avec-summarise"><i class="fa fa-check"></i><b>15.1.2</b> Exemple avec <code>summarise</code></a></li>
<li class="chapter" data-level="15.1.3" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#exemple-avec-rename_with"><i class="fa fa-check"></i><b>15.1.3</b> Exemple avec <code>rename_with</code></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#across"><i class="fa fa-check"></i><b>15.2</b> <code>across()</code> : appliquer des fonctions à plusieurs colonnes</a><ul>
<li class="chapter" data-level="15.2.1" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#appliquer-une-fonction-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>15.2.1</b> Appliquer une fonction à plusieurs colonnes</a></li>
<li class="chapter" data-level="15.2.2" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#passer-des-arguments-supplémentaires-à-la-fonction-appliquée"><i class="fa fa-check"></i><b>15.2.2</b> Passer des arguments supplémentaires à la fonction appliquée</a></li>
<li class="chapter" data-level="15.2.3" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#noms-des-colonnes-créées-par-un-mutate"><i class="fa fa-check"></i><b>15.2.3</b> Noms des colonnes créées par un <code>mutate</code></a></li>
<li class="chapter" data-level="15.2.4" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#appliquer-plusieurs-fonctions-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>15.2.4</b> Appliquer plusieurs fonctions à plusieurs colonnes</a></li>
<li class="chapter" data-level="15.2.5" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#renommer-plusieurs-colonnes-avec-une-fonction"><i class="fa fa-check"></i><b>15.2.5</b> Renommer plusieurs colonnes avec une fonction</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#syntaxes-abregees"><i class="fa fa-check"></i><b>15.3</b> Fonctions anonymes et syntaxes abrégées</a></li>
<li class="chapter" data-level="15.4" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#rowwise-et-c_across-appliquer-une-transformation-ligne-par-ligne"><i class="fa fa-check"></i><b>15.4</b> <code>rowwise()</code> et <code>c_across()</code> : appliquer une transformation ligne par ligne</a></li>
<li class="chapter" data-level="15.5" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#ressources-7"><i class="fa fa-check"></i><b>15.5</b> Ressources</a></li>
<li class="chapter" data-level="15.6" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#exercices-8"><i class="fa fa-check"></i><b>15.6</b> Exercices</a><ul>
<li class="chapter" data-level="15.6.1" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#appliquer-ses-propres-fonctions-1"><i class="fa fa-check"></i><b>15.6.1</b> Appliquer ses propres fonctions</a></li>
<li class="chapter" data-level="15.6.2" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#across-1"><i class="fa fa-check"></i><b>15.6.2</b> <code>across()</code></a></li>
<li class="chapter" data-level="15.6.3" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#fonctions-anonymes-et-notations-abrégées"><i class="fa fa-check"></i><b>15.6.3</b> Fonctions anonymes et notations abrégées</a></li>
<li class="chapter" data-level="15.6.4" data-path="15-dplyr-avance.html"><a href="15-dplyr-avance.html#rowwise-et-c_across"><i class="fa fa-check"></i><b>15.6.4</b> <code>rowwise()</code> et <code>c_across()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html"><i class="fa fa-check"></i><b>16</b> Structures de données</a><ul>
<li class="chapter" data-level="16.1" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#vecteurs-atomiques"><i class="fa fa-check"></i><b>16.1</b> Vecteurs atomiques</a><ul>
<li class="chapter" data-level="16.1.1" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#création-dun-vecteur"><i class="fa fa-check"></i><b>16.1.1</b> Création d’un vecteur</a></li>
<li class="chapter" data-level="16.1.2" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#vecteurs-nommés"><i class="fa fa-check"></i><b>16.1.2</b> Vecteurs nommés</a></li>
<li class="chapter" data-level="16.1.3" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#types-de-vecteurs"><i class="fa fa-check"></i><b>16.1.3</b> Types de vecteurs</a></li>
<li class="chapter" data-level="16.1.4" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#sélection-déléments"><i class="fa fa-check"></i><b>16.1.4</b> Sélection d’éléments</a></li>
<li class="chapter" data-level="16.1.5" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#modification"><i class="fa fa-check"></i><b>16.1.5</b> Modification</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#listes"><i class="fa fa-check"></i><b>16.2</b> Listes</a><ul>
<li class="chapter" data-level="16.2.1" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#création"><i class="fa fa-check"></i><b>16.2.1</b> Création</a></li>
<li class="chapter" data-level="16.2.2" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#ajout-déléments"><i class="fa fa-check"></i><b>16.2.2</b> Ajout d’éléments</a></li>
<li class="chapter" data-level="16.2.3" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#sélection-déléments-1"><i class="fa fa-check"></i><b>16.2.3</b> Sélection d’éléments</a></li>
<li class="chapter" data-level="16.2.4" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#modification-1"><i class="fa fa-check"></i><b>16.2.4</b> Modification</a></li>
<li class="chapter" data-level="16.2.5" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#utilisation"><i class="fa fa-check"></i><b>16.2.5</b> Utilisation</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#data-frame-tibbles"><i class="fa fa-check"></i><b>16.3</b> Tableaux de données (<em>data frame</em> et <em>tibble</em>)</a><ul>
<li class="chapter" data-level="16.3.1" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#création-1"><i class="fa fa-check"></i><b>16.3.1</b> Création</a></li>
<li class="chapter" data-level="16.3.2" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#noms-de-colonnes-et-de-lignes"><i class="fa fa-check"></i><b>16.3.2</b> Noms de colonnes et de lignes</a></li>
<li class="chapter" data-level="16.3.3" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#df-sel"><i class="fa fa-check"></i><b>16.3.3</b> Sélection de lignes et de colonnes</a></li>
<li class="chapter" data-level="16.3.4" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#modification-2"><i class="fa fa-check"></i><b>16.3.4</b> Modification</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#ressources-8"><i class="fa fa-check"></i><b>16.4</b> Ressources</a></li>
<li class="chapter" data-level="16.5" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#exercices-9"><i class="fa fa-check"></i><b>16.5</b> Exercices</a><ul>
<li class="chapter" data-level="16.5.1" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#vecteurs-atomiques-1"><i class="fa fa-check"></i><b>16.5.1</b> Vecteurs atomiques</a></li>
<li class="chapter" data-level="16.5.2" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#listes-1"><i class="fa fa-check"></i><b>16.5.2</b> Listes</a></li>
<li class="chapter" data-level="16.5.3" data-path="16-structures-donnees.html"><a href="16-structures-donnees.html#tableaux-de-données"><i class="fa fa-check"></i><b>16.5.3</b> Tableaux de données</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="17-if-boucles.html"><a href="17-if-boucles.html"><i class="fa fa-check"></i><b>17</b> Exécution conditionnelle et boucles</a><ul>
<li class="chapter" data-level="17.1" data-path="17-if-boucles.html"><a href="17-if-boucles.html#if-et-else-exécuter-du-code-sous-certaines-conditions"><i class="fa fa-check"></i><b>17.1</b> <code>if</code> et <code>else</code> : exécuter du code sous certaines conditions</a><ul>
<li class="chapter" data-level="17.1.1" data-path="17-if-boucles.html"><a href="17-if-boucles.html#if"><i class="fa fa-check"></i><b>17.1.1</b> <code>if</code></a></li>
<li class="chapter" data-level="17.1.2" data-path="17-if-boucles.html"><a href="17-if-boucles.html#if-else-1"><i class="fa fa-check"></i><b>17.1.2</b> <code>if</code> / <code>else</code></a></li>
<li class="chapter" data-level="17.1.3" data-path="17-if-boucles.html"><a href="17-if-boucles.html#if-else-if-else"><i class="fa fa-check"></i><b>17.1.3</b> “<code>if</code>” / “<code>else if</code>” / “<code>else</code>”</a></li>
<li class="chapter" data-level="17.1.4" data-path="17-if-boucles.html"><a href="17-if-boucles.html#construction-de-conditions-complexes"><i class="fa fa-check"></i><b>17.1.4</b> Construction de conditions complexes</a></li>
<li class="chapter" data-level="17.1.5" data-path="17-if-boucles.html"><a href="17-if-boucles.html#différence-entre-if-else-et-ifelse"><i class="fa fa-check"></i><b>17.1.5</b> Différence entre <code>if</code> / <code>else</code> et <code>ifelse</code></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="17-if-boucles.html"><a href="17-if-boucles.html#contrôle-de-lexécution-et-gestion-des-erreurs"><i class="fa fa-check"></i><b>17.2</b> Contrôle de l’exécution et gestion des erreurs</a><ul>
<li class="chapter" data-level="17.2.1" data-path="17-if-boucles.html"><a href="17-if-boucles.html#utilisation-de-return-pour-sortir-de-la-fonction"><i class="fa fa-check"></i><b>17.2.1</b> Utilisation de <code>return</code> pour sortir de la fonction</a></li>
<li class="chapter" data-level="17.2.2" data-path="17-if-boucles.html"><a href="17-if-boucles.html#warning"><i class="fa fa-check"></i><b>17.2.2</b> <code>warning</code></a></li>
<li class="chapter" data-level="17.2.3" data-path="17-if-boucles.html"><a href="17-if-boucles.html#stop-et-stopifnot"><i class="fa fa-check"></i><b>17.2.3</b> <code>stop</code> et <code>stopifnot</code></a></li>
<li class="chapter" data-level="17.2.4" data-path="17-if-boucles.html"><a href="17-if-boucles.html#test-arg"><i class="fa fa-check"></i><b>17.2.4</b> Tester la présence d’un argument facultatif</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="17-if-boucles.html"><a href="17-if-boucles.html#for-et-while-répéter-des-instructions-dans-une-boucle"><i class="fa fa-check"></i><b>17.3</b> <code>for</code> et <code>while</code> : répéter des instructions dans une boucle</a><ul>
<li class="chapter" data-level="17.3.1" data-path="17-if-boucles.html"><a href="17-if-boucles.html#for"><i class="fa fa-check"></i><b>17.3.1</b> <code>for</code></a></li>
<li class="chapter" data-level="17.3.2" data-path="17-if-boucles.html"><a href="17-if-boucles.html#while"><i class="fa fa-check"></i><b>17.3.2</b> <code>while</code></a></li>
<li class="chapter" data-level="17.3.3" data-path="17-if-boucles.html"><a href="17-if-boucles.html#next-et-break"><i class="fa fa-check"></i><b>17.3.3</b> <code>next</code> et <code>break</code></a></li>
<li class="chapter" data-level="17.3.4" data-path="17-if-boucles.html"><a href="17-if-boucles.html#no-boucles"><i class="fa fa-check"></i><b>17.3.4</b> Quand (ne pas) utiliser des boucles</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="17-if-boucles.html"><a href="17-if-boucles.html#ressources-boucles"><i class="fa fa-check"></i><b>17.4</b> Ressources</a></li>
<li class="chapter" data-level="17.5" data-path="17-if-boucles.html"><a href="17-if-boucles.html#exercices-10"><i class="fa fa-check"></i><b>17.5</b> Exercices</a><ul>
<li class="chapter" data-level="17.5.1" data-path="17-if-boucles.html"><a href="17-if-boucles.html#if-et-else"><i class="fa fa-check"></i><b>17.5.1</b> <code>if</code> et <code>else</code></a></li>
<li class="chapter" data-level="17.5.2" data-path="17-if-boucles.html"><a href="17-if-boucles.html#contrôle-de-lexécution"><i class="fa fa-check"></i><b>17.5.2</b> Contrôle de l’exécution</a></li>
<li class="chapter" data-level="17.5.3" data-path="17-if-boucles.html"><a href="17-if-boucles.html#boucles"><i class="fa fa-check"></i><b>17.5.3</b> Boucles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="18-purrr.html"><a href="18-purrr.html"><i class="fa fa-check"></i><b>18</b> Itérer avec <code>purrr</code></a><ul>
<li class="chapter" data-level="18.1" data-path="18-purrr.html"><a href="18-purrr.html#exemple-dapplication"><i class="fa fa-check"></i><b>18.1</b> Exemple d’application</a></li>
<li class="chapter" data-level="18.2" data-path="18-purrr.html"><a href="18-purrr.html#map-et-ses-variantes"><i class="fa fa-check"></i><b>18.2</b> <code>map</code> et ses variantes</a><ul>
<li class="chapter" data-level="18.2.1" data-path="18-purrr.html"><a href="18-purrr.html#modes-dappel-de-map"><i class="fa fa-check"></i><b>18.2.1</b> Modes d’appel de <code>map</code></a></li>
<li class="chapter" data-level="18.2.2" data-path="18-purrr.html"><a href="18-purrr.html#variantes-de-map"><i class="fa fa-check"></i><b>18.2.2</b> Variantes de <code>map</code></a></li>
<li class="chapter" data-level="18.2.3" data-path="18-purrr.html"><a href="18-purrr.html#map_dfr-et-map_dfc"><i class="fa fa-check"></i><b>18.2.3</b> <code>map_dfr()</code> et <code>map_dfc()</code></a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="18-purrr.html"><a href="18-purrr.html#itérer-sur-les-colonnes-dun-tableau-de-données"><i class="fa fa-check"></i><b>18.3</b> Itérer sur les colonnes d’un tableau de données</a></li>
<li class="chapter" data-level="18.4" data-path="18-purrr.html"><a href="18-purrr.html#modify"><i class="fa fa-check"></i><b>18.4</b> <code>modify</code></a></li>
<li class="chapter" data-level="18.5" data-path="18-purrr.html"><a href="18-purrr.html#imap"><i class="fa fa-check"></i><b>18.5</b> <code>imap</code></a></li>
<li class="chapter" data-level="18.6" data-path="18-purrr.html"><a href="18-purrr.html#walk"><i class="fa fa-check"></i><b>18.6</b> <code>walk</code></a></li>
<li class="chapter" data-level="18.7" data-path="18-purrr.html"><a href="18-purrr.html#map2-et-pmap-itérer-sur-plusieurs-vecteurs-en-parallèle"><i class="fa fa-check"></i><b>18.7</b> <code>map2</code> et <code>pmap</code> : itérer sur plusieurs vecteurs en parallèle</a></li>
<li class="chapter" data-level="18.8" data-path="18-purrr.html"><a href="18-purrr.html#répéter-une-opération"><i class="fa fa-check"></i><b>18.8</b> Répéter une opération</a></li>
<li class="chapter" data-level="18.9" data-path="18-purrr.html"><a href="18-purrr.html#quand-ne-pas-utiliser-map"><i class="fa fa-check"></i><b>18.9</b> Quand (ne pas) utiliser <code>map</code></a></li>
<li class="chapter" data-level="18.10" data-path="18-purrr.html"><a href="18-purrr.html#purrr-vs-apply"><i class="fa fa-check"></i><b>18.10</b> <code>purrr</code> vs <code>*apply</code></a></li>
<li class="chapter" data-level="18.11" data-path="18-purrr.html"><a href="18-purrr.html#ressources-9"><i class="fa fa-check"></i><b>18.11</b> Ressources</a></li>
<li class="chapter" data-level="18.12" data-path="18-purrr.html"><a href="18-purrr.html#exercices-11"><i class="fa fa-check"></i><b>18.12</b> Exercices</a><ul>
<li class="chapter" data-level="18.12.1" data-path="18-purrr.html"><a href="18-purrr.html#map-et-ses-variantes-1"><i class="fa fa-check"></i><b>18.12.1</b> <code>map</code> et ses variantes</a></li>
<li class="chapter" data-level="18.12.2" data-path="18-purrr.html"><a href="18-purrr.html#modify-et-itération-sur-les-colonnes-dun-tableau"><i class="fa fa-check"></i><b>18.12.2</b> <code>modify</code> et itération sur les colonnes d’un tableau</a></li>
<li class="chapter" data-level="18.12.3" data-path="18-purrr.html"><a href="18-purrr.html#imap-et-walk"><i class="fa fa-check"></i><b>18.12.3</b> <code>imap</code> et <code>walk</code></a></li>
<li class="chapter" data-level="18.12.4" data-path="18-purrr.html"><a href="18-purrr.html#map2-et-pmap"><i class="fa fa-check"></i><b>18.12.4</b> <code>map2</code> et <code>pmap</code></a></li>
<li class="chapter" data-level="18.12.5" data-path="18-purrr.html"><a href="18-purrr.html#répéter-une-opération-1"><i class="fa fa-check"></i><b>18.12.5</b> Répéter une opération</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html"><i class="fa fa-check"></i><b>19</b> Programmer avec le <em>tidyverse</em></a><ul>
<li class="chapter" data-level="19.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#spécificités-du-tidyverse"><i class="fa fa-check"></i><b>19.1</b> Spécificités du <em>tidyverse</em></a><ul>
<li class="chapter" data-level="19.1.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#data-masking"><i class="fa fa-check"></i><b>19.1.1</b> <em>data masking</em></a></li>
<li class="chapter" data-level="19.1.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#tidy-selection"><i class="fa fa-check"></i><b>19.1.2</b> <em>tidy selection</em></a></li>
<li class="chapter" data-level="19.1.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utilisation-dans-des-fonctions"><i class="fa fa-check"></i><b>19.1.3</b> Utilisation dans des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#programmer-avec-dplyr-et-tidyr"><i class="fa fa-check"></i><b>19.2</b> Programmer avec <code>dplyr</code> et <code>tidyr</code></a><ul>
<li class="chapter" data-level="19.2.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utiliser-une-colonne-passée-en-argument"><i class="fa fa-check"></i><b>19.2.1</b> Utiliser une colonne passée en argument</a></li>
<li class="chapter" data-level="19.2.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#utiliser-une-sélection-de-colonnes-passée-en-argument"><i class="fa fa-check"></i><b>19.2.2</b> Utiliser une sélection de colonnes passée en argument</a></li>
<li class="chapter" data-level="19.2.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#nommer-de-nouvelles-colonnes-à-partir-dun-argument"><i class="fa fa-check"></i><b>19.2.3</b> Nommer de nouvelles colonnes à partir d’un argument</a></li>
<li class="chapter" data-level="19.2.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#désambiguïser-data-et-env"><i class="fa fa-check"></i><b>19.2.4</b> Désambiguïser data et env</a></li>
<li class="chapter" data-level="19.2.5" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#quand-les-arguments-sont-des-chaînes-de-caractères"><i class="fa fa-check"></i><b>19.2.5</b> Quand les arguments sont des chaînes de caractères</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#programmer-avec-ggplot2"><i class="fa fa-check"></i><b>19.3</b> Programmer avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="19.3.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#sélection-de-colonnes-avec-aes"><i class="fa fa-check"></i><b>19.3.1</b> Sélection de colonnes avec <code>aes()</code></a></li>
<li class="chapter" data-level="19.3.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#faceting-1"><i class="fa fa-check"></i><b>19.3.2</b> Faceting</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#aide-mémoire"><i class="fa fa-check"></i><b>19.4</b> Aide-mémoire</a></li>
<li class="chapter" data-level="19.5" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ressources-10"><i class="fa fa-check"></i><b>19.5</b> Ressources</a></li>
<li class="chapter" data-level="19.6" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#exercices-12"><i class="fa fa-check"></i><b>19.6</b> Exercices</a><ul>
<li class="chapter" data-level="19.6.1" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#dplyr-et-tidyr"><i class="fa fa-check"></i><b>19.6.1</b> <code>dplyr</code> et <code>tidyr</code></a></li>
<li class="chapter" data-level="19.6.2" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#noms-de-colonnes-en-chaînes-de-caractères"><i class="fa fa-check"></i><b>19.6.2</b> Noms de colonnes en chaînes de caractères</a></li>
<li class="chapter" data-level="19.6.3" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ambiguïté-data-env"><i class="fa fa-check"></i><b>19.6.3</b> Ambiguïté <code>data</code> / <code>env</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="19-programmer-tidyverse.html"><a href="19-programmer-tidyverse.html#ggplot2-1"><i class="fa fa-check"></i><b>19.6.4</b> <code>ggplot2</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html"><i class="fa fa-check"></i><b>20</b> Débuggage et performance</a><ul>
<li class="chapter" data-level="20.1" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#débugguer-une-fonction"><i class="fa fa-check"></i><b>20.1</b> Débugguer une fonction</a><ul>
<li class="chapter" data-level="20.1.1" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#print"><i class="fa fa-check"></i><b>20.1.1</b> print()</a></li>
<li class="chapter" data-level="20.1.2" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#localiser-une-erreur"><i class="fa fa-check"></i><b>20.1.2</b> Localiser une erreur</a></li>
<li class="chapter" data-level="20.1.3" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#browser"><i class="fa fa-check"></i><b>20.1.3</b> browser()</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#benchmarking-mesurer-et-comparer-les-temps-dexécution"><i class="fa fa-check"></i><b>20.2</b> benchmarking : mesurer et comparer les temps d’exécution</a></li>
<li class="chapter" data-level="20.3" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#quelques-conseils-doptimisation"><i class="fa fa-check"></i><b>20.3</b> Quelques conseils d’optimisation</a><ul>
<li class="chapter" data-level="20.3.1" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#privilégier-les-fonctions-vectorisées"><i class="fa fa-check"></i><b>20.3.1</b> Privilégier les fonctions vectorisées</a></li>
<li class="chapter" data-level="20.3.2" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#mettre-le-minimum-dopérations-dans-les-boucles"><i class="fa fa-check"></i><b>20.3.2</b> Mettre le minimum d’opérations dans les boucles</a></li>
<li class="chapter" data-level="20.3.3" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#choisir-un-format-de-fichier-adapté"><i class="fa fa-check"></i><b>20.3.3</b> Choisir un format de fichier adapté</a></li>
<li class="chapter" data-level="20.3.4" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#repérer-les-opérations-coûteuses-avec-du-profiling"><i class="fa fa-check"></i><b>20.3.4</b> Repérer les opérations coûteuses avec du <em>profiling</em></a></li>
<li class="chapter" data-level="20.3.5" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#mettre-en-cache-des-résultats-intermédiaires"><i class="fa fa-check"></i><b>20.3.5</b> Mettre en cache des résultats intermédiaires</a></li>
<li class="chapter" data-level="20.3.6" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#utiliser-dautres-extensions"><i class="fa fa-check"></i><b>20.3.6</b> Utiliser d’autres extensions</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="20-debuggage-performance.html"><a href="20-debuggage-performance.html#ressources-11"><i class="fa fa-check"></i><b>20.4</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="21-targets.html"><a href="21-targets.html"><i class="fa fa-check"></i><b>21</b> Organiser un projet avec <code>targets</code></a><ul>
<li class="chapter" data-level="21.1" data-path="21-targets.html"><a href="21-targets.html#définition-du-pipeline"><i class="fa fa-check"></i><b>21.1</b> Définition du pipeline</a><ul>
<li class="chapter" data-level="21.1.1" data-path="21-targets.html"><a href="21-targets.html#projet-dexemple"><i class="fa fa-check"></i><b>21.1.1</b> Projet d’exemple</a></li>
<li class="chapter" data-level="21.1.2" data-path="21-targets.html"><a href="21-targets.html#targets.r"><i class="fa fa-check"></i><b>21.1.2</b> <code>_targets.R</code></a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="21-targets.html"><a href="21-targets.html#exécution-du-pipeline"><i class="fa fa-check"></i><b>21.2</b> Exécution du pipeline</a></li>
<li class="chapter" data-level="21.3" data-path="21-targets.html"><a href="21-targets.html#modification-du-pipeline"><i class="fa fa-check"></i><b>21.3</b> Modification du pipeline</a></li>
<li class="chapter" data-level="21.4" data-path="21-targets.html"><a href="21-targets.html#rmarkdown"><i class="fa fa-check"></i><b>21.4</b> RMarkdown</a></li>
<li class="chapter" data-level="21.5" data-path="21-targets.html"><a href="21-targets.html#gestion-des-données-en-cache"><i class="fa fa-check"></i><b>21.5</b> Gestion des données en cache</a></li>
<li class="chapter" data-level="21.6" data-path="21-targets.html"><a href="21-targets.html#avantages-et-limites"><i class="fa fa-check"></i><b>21.6</b> Avantages et limites</a><ul>
<li class="chapter" data-level="21.6.1" data-path="21-targets.html"><a href="21-targets.html#avantages"><i class="fa fa-check"></i><b>21.6.1</b> Avantages</a></li>
<li class="chapter" data-level="21.6.2" data-path="21-targets.html"><a href="21-targets.html#interactivité-et-développement-du-pipeline"><i class="fa fa-check"></i><b>21.6.2</b> Interactivité et développement du pipeline</a></li>
</ul></li>
<li class="chapter" data-level="21.7" data-path="21-targets.html"><a href="21-targets.html#ressources-12"><i class="fa fa-check"></i><b>21.7</b> Ressources</a></li>
</ul></li>
<li class="appendix"><span><b>Annexes</b></span></li>
<li class="chapter" data-level="A" data-path="22-ressources.html"><a href="22-ressources.html"><i class="fa fa-check"></i><b>A</b> Ressources</a><ul>
<li class="chapter" data-level="A.1" data-path="22-ressources.html"><a href="22-ressources.html#aide"><i class="fa fa-check"></i><b>A.1</b> Aide</a><ul>
<li class="chapter" data-level="A.1.1" data-path="22-ressources.html"><a href="22-ressources.html#aide-de-r-et-rstudio"><i class="fa fa-check"></i><b>A.1.1</b> Aide de R et RStudio</a></li>
<li class="chapter" data-level="A.1.2" data-path="22-ressources.html"><a href="22-ressources.html#aide-en-ligne"><i class="fa fa-check"></i><b>A.1.2</b> Aide en ligne</a></li>
<li class="chapter" data-level="A.1.3" data-path="22-ressources.html"><a href="22-ressources.html#antisèches"><i class="fa fa-check"></i><b>A.1.3</b> Antisèches</a></li>
<li class="chapter" data-level="A.1.4" data-path="22-ressources.html"><a href="22-ressources.html#où-poser-des-questions"><i class="fa fa-check"></i><b>A.1.4</b> Où poser des questions</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="22-ressources.html"><a href="22-ressources.html#ouvrages-blogs-moocs"><i class="fa fa-check"></i><b>A.2</b> Ouvrages, blogs, MOOCs…</a><ul>
<li class="chapter" data-level="A.2.1" data-path="22-ressources.html"><a href="22-ressources.html#francophones"><i class="fa fa-check"></i><b>A.2.1</b> Francophones</a></li>
<li class="chapter" data-level="A.2.2" data-path="22-ressources.html"><a href="22-ressources.html#anglophones"><i class="fa fa-check"></i><b>A.2.2</b> Anglophones</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="22-ressources.html"><a href="22-ressources.html#extensions-1"><i class="fa fa-check"></i><b>A.3</b> Extensions</a><ul>
<li class="chapter" data-level="A.3.1" data-path="22-ressources.html"><a href="22-ressources.html#où-trouver-des-extensions-intéressantes"><i class="fa fa-check"></i><b>A.3.1</b> Où trouver des extensions intéressantes ?</a></li>
<li class="chapter" data-level="A.3.2" data-path="22-ressources.html"><a href="22-ressources.html#lextension-questionr"><i class="fa fa-check"></i><b>A.3.2</b> L’extension <code>questionr</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction à R et au tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="purrr" class="section level1">
<h1><span class="header-section-number">Partie 18</span> Itérer avec <code>purrr</code></h1>
<p><code>purrr</code> est une extension du <em>tidyverse</em> qui fournit des outils pour travailler avec les vecteurs et les fonctions, et notamment pour itérer sur les éléments de vecteurs ou de listes en leur appliquant une fonction.</p>
<p>Dans cette section on aura besoin des extensions du <em>tidyverse</em> (dont <code>purrr</code> fait partie), que nous chargeons donc immédiatement, de même que les jeux de données <code>rp2012</code> et <code>hdv2003</code> de <code>questionr</code>.</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="18-purrr.html#cb969-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb969-2"><a href="18-purrr.html#cb969-2"></a><span class="kw">library</span>(questionr)</span>
<span id="cb969-3"><a href="18-purrr.html#cb969-3"></a><span class="kw">data</span>(hdv2003)</span>
<span id="cb969-4"><a href="18-purrr.html#cb969-4"></a><span class="kw">data</span>(rp2012)</span></code></pre></div>
<div id="exemple-dapplication" class="section level2">
<h2><span class="header-section-number">18.1</span> Exemple d’application</h2>
<p>Pour mieux appréhender de quoi il s’agit, on part du vecteur suivant, qui contient des extraits (fictifs ?) de discours politiques.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="18-purrr.html#cb970-1"></a>discours &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb970-2"><a href="18-purrr.html#cb970-2"></a>    <span class="st">&quot;nous privilégierons une intergouvernementalisation sans agir anticonstitutionnellement&quot;</span>,</span>
<span id="cb970-3"><a href="18-purrr.html#cb970-3"></a>    <span class="st">&quot;le souffle de la nation est le vent qui agite les drapeaux de nos libertés&quot;</span>,</span>
<span id="cb970-4"><a href="18-purrr.html#cb970-4"></a>    <span class="st">&quot;nous devons faire preuve de plus de pédagogie pour cette réforme&quot;</span>,</span>
<span id="cb970-5"><a href="18-purrr.html#cb970-5"></a>    <span class="st">&quot;mon compte twitter a été piraté&quot;</span></span>
<span id="cb970-6"><a href="18-purrr.html#cb970-6"></a>)</span></code></pre></div>
<p>On souhaite calculer la longueur de chaque extrait, en nombre de mots.</p>
<p>On commence par découper grossièrement chaque extrait en mots en utilisant la fonction <code>str_split()</code> de <code>stringr</code><a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>.</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="18-purrr.html#cb971-1"></a>mots &lt;-<span class="st"> </span><span class="kw">str_split</span>(discours, <span class="st">&quot; &quot;</span>)</span>
<span id="cb971-2"><a href="18-purrr.html#cb971-2"></a><span class="kw">str</span>(mots)</span>
<span id="cb971-3"><a href="18-purrr.html#cb971-3"></a><span class="co">#&gt; List of 4</span></span>
<span id="cb971-4"><a href="18-purrr.html#cb971-4"></a><span class="co">#&gt;  $ : chr [1:7] &quot;nous&quot; &quot;privilégierons&quot; &quot;une&quot; &quot;intergouvernementalisation&quot; ...</span></span>
<span id="cb971-5"><a href="18-purrr.html#cb971-5"></a><span class="co">#&gt;  $ : chr [1:15] &quot;le&quot; &quot;souffle&quot; &quot;de&quot; &quot;la&quot; ...</span></span>
<span id="cb971-6"><a href="18-purrr.html#cb971-6"></a><span class="co">#&gt;  $ : chr [1:11] &quot;nous&quot; &quot;devons&quot; &quot;faire&quot; &quot;preuve&quot; ...</span></span>
<span id="cb971-7"><a href="18-purrr.html#cb971-7"></a><span class="co">#&gt;  $ : chr [1:6] &quot;mon&quot; &quot;compte&quot; &quot;twitter&quot; &quot;a&quot; ...</span></span></code></pre></div>
<p>L’objet <code>mots</code> est une liste de vecteurs de chaînes de caractères qui contiennent les mots des différents extraits.</p>
<p>Calculer le nombre de mots de chaque extrait revient à calculer la longueur de chaque élément de <code>mots</code>. Pour cela on pourrait vouloir utiliser la fonction <code>length()</code> directement :</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="18-purrr.html#cb972-1"></a><span class="kw">length</span>(mots)</span>
<span id="cb972-2"><a href="18-purrr.html#cb972-2"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>Ceci ne fonctionne pas, car <code>length()</code> nous retourne le nombre d’éléments de <code>mots</code>, pas celui de chacun de ses éléments : ce qu’on veut, ça n’est pas <code>length(mots)</code> mais <code>length(mots[[1]])</code>, <code>length(mots[[2]])</code>, etc.</p>
<p>On a vu section <a href="17-if-boucles.html#no-boucles">17.3.4</a> qu’on peut pour cela utiliser une boucle <code>for</code>, par exemple de la manière suivante.</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="18-purrr.html#cb973-1"></a>resultat &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb973-2"><a href="18-purrr.html#cb973-2"></a><span class="cf">for</span> (item <span class="cf">in</span> mots) {</span>
<span id="cb973-3"><a href="18-purrr.html#cb973-3"></a>    resultat &lt;-<span class="st"> </span><span class="kw">c</span>(resultat, <span class="kw">length</span>(item))</span>
<span id="cb973-4"><a href="18-purrr.html#cb973-4"></a>}</span>
<span id="cb973-5"><a href="18-purrr.html#cb973-5"></a>resultat</span>
<span id="cb973-6"><a href="18-purrr.html#cb973-6"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb973-7"><a href="18-purrr.html#cb973-7"></a><span class="co">#&gt; [1] 7</span></span>
<span id="cb973-8"><a href="18-purrr.html#cb973-8"></a><span class="co">#&gt; </span></span>
<span id="cb973-9"><a href="18-purrr.html#cb973-9"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb973-10"><a href="18-purrr.html#cb973-10"></a><span class="co">#&gt; [1] 15</span></span>
<span id="cb973-11"><a href="18-purrr.html#cb973-11"></a><span class="co">#&gt; </span></span>
<span id="cb973-12"><a href="18-purrr.html#cb973-12"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb973-13"><a href="18-purrr.html#cb973-13"></a><span class="co">#&gt; [1] 11</span></span>
<span id="cb973-14"><a href="18-purrr.html#cb973-14"></a><span class="co">#&gt; </span></span>
<span id="cb973-15"><a href="18-purrr.html#cb973-15"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb973-16"><a href="18-purrr.html#cb973-16"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>Ça fonctionne, mais la syntaxe est un peu “lourde”.</p>
<p>La fonction <code>map()</code> de <code>purrr</code> propose exactement cette fonctionnalité. Elle prend deux arguments principaux :</p>
<ol style="list-style-type: decimal">
<li>un vecteur ou une liste</li>
<li>une fonction</li>
</ol>
<p>et elle retourne une liste contenant le résultat de la fonction appliquée à chaque élément du vecteur ou de la liste.</p>
<p>En utilisant <code>map()</code> on peut remplacer notre boucle <code>for</code> par un simple :</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="18-purrr.html#cb974-1"></a><span class="kw">map</span>(mots, length)</span>
<span id="cb974-2"><a href="18-purrr.html#cb974-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb974-3"><a href="18-purrr.html#cb974-3"></a><span class="co">#&gt; [1] 7</span></span>
<span id="cb974-4"><a href="18-purrr.html#cb974-4"></a><span class="co">#&gt; </span></span>
<span id="cb974-5"><a href="18-purrr.html#cb974-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb974-6"><a href="18-purrr.html#cb974-6"></a><span class="co">#&gt; [1] 15</span></span>
<span id="cb974-7"><a href="18-purrr.html#cb974-7"></a><span class="co">#&gt; </span></span>
<span id="cb974-8"><a href="18-purrr.html#cb974-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb974-9"><a href="18-purrr.html#cb974-9"></a><span class="co">#&gt; [1] 11</span></span>
<span id="cb974-10"><a href="18-purrr.html#cb974-10"></a><span class="co">#&gt; </span></span>
<span id="cb974-11"><a href="18-purrr.html#cb974-11"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb974-12"><a href="18-purrr.html#cb974-12"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p><code>map</code> va itérer sur les éléments de <code>mots</code>, leur appliquer tour à tour la fonction <code>length</code> passée en argument, et regrouper les résultats dans une liste.</p>
<p>À noter qu’on peut évidemment utiliser le <em>pipe</em>.</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="18-purrr.html#cb975-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(length)</span>
<span id="cb975-2"><a href="18-purrr.html#cb975-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb975-3"><a href="18-purrr.html#cb975-3"></a><span class="co">#&gt; [1] 7</span></span>
<span id="cb975-4"><a href="18-purrr.html#cb975-4"></a><span class="co">#&gt; </span></span>
<span id="cb975-5"><a href="18-purrr.html#cb975-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb975-6"><a href="18-purrr.html#cb975-6"></a><span class="co">#&gt; [1] 15</span></span>
<span id="cb975-7"><a href="18-purrr.html#cb975-7"></a><span class="co">#&gt; </span></span>
<span id="cb975-8"><a href="18-purrr.html#cb975-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb975-9"><a href="18-purrr.html#cb975-9"></a><span class="co">#&gt; [1] 11</span></span>
<span id="cb975-10"><a href="18-purrr.html#cb975-10"></a><span class="co">#&gt; </span></span>
<span id="cb975-11"><a href="18-purrr.html#cb975-11"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb975-12"><a href="18-purrr.html#cb975-12"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>Ici notre résultat est une liste. Or il pourrait être simplifié sous forme de vecteur atomique, puisque tous ses éléments sont des nombres.</p>
<p>Si on souhaitait obtenir un vecteur numérique avec une boucle <code>for</code>, il faut soit convertir le résultat de la boucle précédente en vecteur atomique (avec <code>unlist()</code> ou <code>purrr::flatten_int()</code>), soit modifier cette boucle pour qu’elle génère plutôt un vecteur numérique :</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="18-purrr.html#cb976-1"></a>resultat &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(discours))</span>
<span id="cb976-2"><a href="18-purrr.html#cb976-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(mots)) {</span>
<span id="cb976-3"><a href="18-purrr.html#cb976-3"></a>    resultat[i] &lt;-<span class="st"> </span><span class="kw">length</span>(mots[[i]])</span>
<span id="cb976-4"><a href="18-purrr.html#cb976-4"></a>}</span>
<span id="cb976-5"><a href="18-purrr.html#cb976-5"></a>resultat</span>
<span id="cb976-6"><a href="18-purrr.html#cb976-6"></a><span class="co">#&gt; [1]  7 15 11  6</span></span></code></pre></div>
<p>Mais <code>purrr</code> propose des variantes de la fonction <code>map</code> qui permettent justement de s’assurer du type de résultat obtenu. Ainsi, <code>map_dbl()</code> renverra toujours un vecteur de nombres flottants, et <code>map_int()</code> un vecteur de nombres entiers. En remplacement de la boucle <code>for</code> ci-dessus, on peut donc utiliser :</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="18-purrr.html#cb977-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</span>
<span id="cb977-2"><a href="18-purrr.html#cb977-2"></a><span class="co">#&gt; [1]  7 15 11  6</span></span></code></pre></div>
</div>
<div id="map-et-ses-variantes" class="section level2">
<h2><span class="header-section-number">18.2</span> <code>map</code> et ses variantes</h2>
<div id="modes-dappel-de-map" class="section level3">
<h3><span class="header-section-number">18.2.1</span> Modes d’appel de <code>map</code></h3>
<p>L’objectif de <code>map</code> est donc d’appliquer une fonction à l’ensemble des éléments d’un vecteur ou d’une liste.</p>
<p>On a vu qu’on pouvait l’utiliser pour appliquer la fonction <code>length</code> à chacun des vecteurs contenus par la liste <code>mots</code>. En utilisant <code>map_int</code> on s’assure de récupérer un simple vecteur numérique, plus facile à utiliser par la suite si on souhaite par exemple calculer une moyenne.</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="18-purrr.html#cb978-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</span>
<span id="cb978-2"><a href="18-purrr.html#cb978-2"></a><span class="co">#&gt; [1]  7 15 11  6</span></span></code></pre></div>
<p>Si on souhaitait plutôt extraire le dernier mot de chaque vecteur, on pourrait créer une fonction spécifique et l’appliquer avec <code>map()</code>.</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="18-purrr.html#cb979-1"></a>dernier_mot &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</span>
<span id="cb979-2"><a href="18-purrr.html#cb979-2"></a>    <span class="kw">tail</span>(v, <span class="dv">1</span>)</span>
<span id="cb979-3"><a href="18-purrr.html#cb979-3"></a>}</span>
<span id="cb979-4"><a href="18-purrr.html#cb979-4"></a></span>
<span id="cb979-5"><a href="18-purrr.html#cb979-5"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(dernier_mot)</span>
<span id="cb979-6"><a href="18-purrr.html#cb979-6"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb979-7"><a href="18-purrr.html#cb979-7"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot;</span></span>
<span id="cb979-8"><a href="18-purrr.html#cb979-8"></a><span class="co">#&gt; </span></span>
<span id="cb979-9"><a href="18-purrr.html#cb979-9"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb979-10"><a href="18-purrr.html#cb979-10"></a><span class="co">#&gt; [1] &quot;libertés&quot;</span></span>
<span id="cb979-11"><a href="18-purrr.html#cb979-11"></a><span class="co">#&gt; </span></span>
<span id="cb979-12"><a href="18-purrr.html#cb979-12"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb979-13"><a href="18-purrr.html#cb979-13"></a><span class="co">#&gt; [1] &quot;réforme&quot;</span></span>
<span id="cb979-14"><a href="18-purrr.html#cb979-14"></a><span class="co">#&gt; </span></span>
<span id="cb979-15"><a href="18-purrr.html#cb979-15"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb979-16"><a href="18-purrr.html#cb979-16"></a><span class="co">#&gt; [1] &quot;piraté&quot;</span></span></code></pre></div>
<p>Comme notre résultat est une liste de chaînes de caractères simples, on peut forcer le résultat à être plutôt un vecteur de type <em>character</em> en utilisant <code>map_chr()</code> :</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="18-purrr.html#cb980-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(dernier_mot)</span>
<span id="cb980-2"><a href="18-purrr.html#cb980-2"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></span>
<span id="cb980-3"><a href="18-purrr.html#cb980-3"></a><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></span></code></pre></div>
<p>Comme notre fonction est très courte, on peut aussi préférer utiliser une <em>fonction anonyme</em>, introduites section <a href="14-fonctions.html#fonctions-anonymes">14.4.2</a>.</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="18-purrr.html#cb981-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="cf">function</span>(v) { <span class="kw">tail</span>(v, <span class="dv">1</span>) })</span>
<span id="cb981-2"><a href="18-purrr.html#cb981-2"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></span>
<span id="cb981-3"><a href="18-purrr.html#cb981-3"></a><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></span></code></pre></div>
<p>On peut aussi utiliser la notation abrégée sous forme de formule, propre aux fonctions du <em>tidyverse</em>, présentée section <a href="15-dplyr-avance.html#syntaxes-abregees">15.3</a>.</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="18-purrr.html#cb982-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">tail</span>(.x, <span class="dv">1</span>) )</span>
<span id="cb982-2"><a href="18-purrr.html#cb982-2"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></span>
<span id="cb982-3"><a href="18-purrr.html#cb982-3"></a><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></span></code></pre></div>
<p>On peut également utiliser la notation compacte pour les fonctions anonymes disponible sous R à partir de la version 4.1.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="18-purrr.html#cb983-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(\(v) <span class="kw">tail</span>(v, <span class="dv">1</span>))</span>
<span id="cb983-2"><a href="18-purrr.html#cb983-2"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></span>
<span id="cb983-3"><a href="18-purrr.html#cb983-3"></a><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></span></code></pre></div>
<p>Enfin, si on fournit des arguments supplémentaires à <code>map</code>, ils sont passés comme argument à la fonction qu’il applique, on peut donc également utiliser la notation suivante :</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="18-purrr.html#cb984-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(tail, <span class="dv">1</span>)</span>
<span id="cb984-2"><a href="18-purrr.html#cb984-2"></a><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></span>
<span id="cb984-3"><a href="18-purrr.html#cb984-3"></a><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></span></code></pre></div>
<p>Dans ce qui suit on utilisera de préférence la notation “formule”, mais toutes les versions ci-dessus sont équivalentes et donnent le même résultat.</p>
<div class="rmdnote">
<p>
Petite astuce à noter, si on transmet à <code>map()</code> autre chose qu’une fonction, elle utilisera cette information pour extraire des éléments. Ainsi, <code>v %&gt;% map(1)</code> extraiera le premier élément de chaque élément du vecteur <code>v</code>, <code>v %&gt;% map(“foo”)</code> extraiera les éléments nommés “foo”, etc.
</p>
</div>
</div>
<div id="variantes-de-map" class="section level3">
<h3><span class="header-section-number">18.2.2</span> Variantes de <code>map</code></h3>
<p>On a vu que <code>map</code> propose plusieurs variantes qui permettent de contrôler le type de résultat qu’elle retourne :</p>
<ul>
<li><code>map()</code> retourne une liste</li>
<li><code>map_int()</code> retourne un vecteur atomique d’entiers</li>
<li><code>map_dbl()</code> retourne un vecteur atomique de nombres flottants</li>
<li><code>map_chr()</code> retourne un vecteur atomique de chaînes de caractères</li>
<li><code>map_lgl()</code> retourne un vecteur atomique de <code>TRUE</code> / <code>FALSE</code></li>
</ul>
<p>Attention, ces variantes sont très strictes : si la fonction appelée retourne un résultat qui n’est pas compatible avec le résultat attendu, elle génère une erreur. C’est le cas si dans le code précédent on essaie de récupérer chaque dernier mot sous forme d’un vecteur de nombres :</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="18-purrr.html#cb985-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(tail, <span class="dv">1</span>)</span>
<span id="cb985-2"><a href="18-purrr.html#cb985-2"></a><span class="co">#&gt; Error: Can&#39;t coerce element 1 from a character to a double</span></span></code></pre></div>
<p>Pour pouvoir utiliser ces variantes et obtenir un vecteur atomique, chaque résultat retourné par la fonction appliquée doit être de longueur 1. Ainsi, si on souhaitait extraire plutôt la liste des mots contenant un “f”, certains résultats ne contiennent aucun élément, et d’autres en contiennent deux :</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="18-purrr.html#cb986-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) )</span>
<span id="cb986-2"><a href="18-purrr.html#cb986-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb986-3"><a href="18-purrr.html#cb986-3"></a><span class="co">#&gt; character(0)</span></span>
<span id="cb986-4"><a href="18-purrr.html#cb986-4"></a><span class="co">#&gt; </span></span>
<span id="cb986-5"><a href="18-purrr.html#cb986-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb986-6"><a href="18-purrr.html#cb986-6"></a><span class="co">#&gt; [1] &quot;souffle&quot;</span></span>
<span id="cb986-7"><a href="18-purrr.html#cb986-7"></a><span class="co">#&gt; </span></span>
<span id="cb986-8"><a href="18-purrr.html#cb986-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb986-9"><a href="18-purrr.html#cb986-9"></a><span class="co">#&gt; [1] &quot;faire&quot;   &quot;réforme&quot;</span></span>
<span id="cb986-10"><a href="18-purrr.html#cb986-10"></a><span class="co">#&gt; </span></span>
<span id="cb986-11"><a href="18-purrr.html#cb986-11"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb986-12"><a href="18-purrr.html#cb986-12"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>Dans ce cas on ne peut pas utiliser <code>map_chr()</code> : si on essaie on obtient un message d’erreur nous indiquant que certains résultats de <code>str_subset()</code> ne sont pas au bon format.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="18-purrr.html#cb987-1"></a>mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) )</span>
<span id="cb987-2"><a href="18-purrr.html#cb987-2"></a><span class="co">#&gt; Error: Result 1 must be a single string, not a character vector of length 0</span></span></code></pre></div>
<p>Dans ce cas, on doit donc utiliser <code>map()</code> et conserver le résultat sous forme de liste, qui elle peut contenir des éléments de longueurs différentes.</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="18-purrr.html#cb988-1"></a>mots <span class="op">%&gt;%</span></span>
<span id="cb988-2"><a href="18-purrr.html#cb988-2"></a><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) )</span>
<span id="cb988-3"><a href="18-purrr.html#cb988-3"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb988-4"><a href="18-purrr.html#cb988-4"></a><span class="co">#&gt; character(0)</span></span>
<span id="cb988-5"><a href="18-purrr.html#cb988-5"></a><span class="co">#&gt; </span></span>
<span id="cb988-6"><a href="18-purrr.html#cb988-6"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb988-7"><a href="18-purrr.html#cb988-7"></a><span class="co">#&gt; [1] &quot;souffle&quot;</span></span>
<span id="cb988-8"><a href="18-purrr.html#cb988-8"></a><span class="co">#&gt; </span></span>
<span id="cb988-9"><a href="18-purrr.html#cb988-9"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb988-10"><a href="18-purrr.html#cb988-10"></a><span class="co">#&gt; [1] &quot;faire&quot;   &quot;réforme&quot;</span></span>
<span id="cb988-11"><a href="18-purrr.html#cb988-11"></a><span class="co">#&gt; </span></span>
<span id="cb988-12"><a href="18-purrr.html#cb988-12"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb988-13"><a href="18-purrr.html#cb988-13"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>On notera qu’on peut tout à fait enchaîner les <code>map()</code> si on veut effectuer des opérations supplémentaires.</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="18-purrr.html#cb989-1"></a>mots <span class="op">%&gt;%</span></span>
<span id="cb989-2"><a href="18-purrr.html#cb989-2"></a><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) ) <span class="op">%&gt;%</span></span>
<span id="cb989-3"><a href="18-purrr.html#cb989-3"></a><span class="st">    </span><span class="kw">map_int</span>(length)</span>
<span id="cb989-4"><a href="18-purrr.html#cb989-4"></a><span class="co">#&gt; [1] 0 1 2 0</span></span></code></pre></div>
</div>
<div id="map_dfr-et-map_dfc" class="section level3">
<h3><span class="header-section-number">18.2.3</span> <code>map_dfr()</code> et <code>map_dfc()</code></h3>
<p>La page suivante contient les données du jeu de données <code>rp2012</code> sous la forme de fichiers CSV, avec un fichier par département :</p>
<p><a href="https://github.com/juba/tidyverse/tree/main/resources/data/rp2012" class="uri">https://github.com/juba/tidyverse/tree/main/resources/data/rp2012</a></p>
<p>À partir de cette page, on peut télécharger les fichiers CSV en utilisant des adresses de la forme :</p>
<p><a href="https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_01.csv" class="uri">https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_01.csv</a></p>
<p>En remplaçant “01” par le code du département souhaité.</p>
<p>On peut créer une fonction <code>genere_url()</code> qui, à partir d’une liste de codes de départements, retourne les adresses des fichiers correspondant.</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="18-purrr.html#cb990-1"></a>genere_url &lt;-<span class="st"> </span><span class="cf">function</span>(codes) {</span>
<span id="cb990-2"><a href="18-purrr.html#cb990-2"></a>    <span class="kw">paste0</span>(</span>
<span id="cb990-3"><a href="18-purrr.html#cb990-3"></a>        <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_&quot;</span>,</span>
<span id="cb990-4"><a href="18-purrr.html#cb990-4"></a>        codes,</span>
<span id="cb990-5"><a href="18-purrr.html#cb990-5"></a>        <span class="st">&quot;.csv&quot;</span></span>
<span id="cb990-6"><a href="18-purrr.html#cb990-6"></a>    )</span>
<span id="cb990-7"><a href="18-purrr.html#cb990-7"></a>}</span>
<span id="cb990-8"><a href="18-purrr.html#cb990-8"></a></span>
<span id="cb990-9"><a href="18-purrr.html#cb990-9"></a><span class="kw">genere_url</span>(<span class="kw">c</span>(<span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>))</span>
<span id="cb990-10"><a href="18-purrr.html#cb990-10"></a><span class="co">#&gt; [1] &quot;https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_42.csv&quot;</span></span>
<span id="cb990-11"><a href="18-purrr.html#cb990-11"></a><span class="co">#&gt; [2] &quot;https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_69.csv&quot;</span></span></code></pre></div>
<p>Grâce à la fonction <code>read_csv()</code>, on peut charger directement dans notre session R un fichier en indiquant son URL.</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="18-purrr.html#cb991-1"></a>data69 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">genere_url</span>(<span class="st">&quot;69&quot;</span>))</span></code></pre></div>
<p>Comment faire si l’on souhaite charger les fichiers de plusieurs départements ? La fonction <code>read_csv()</code> n’accepte qu’une seule URL à la fois, elle n’est pas vectorisée.</p>
<p>Dans ce cas on peut utiliser <code>map()</code> pour l’appliquer tour à tour à plusieurs URL.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="18-purrr.html#cb992-1"></a>departements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;38&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>)</span>
<span id="cb992-2"><a href="18-purrr.html#cb992-2"></a>urls &lt;-<span class="st"> </span><span class="kw">genere_url</span>(departements)</span>
<span id="cb992-3"><a href="18-purrr.html#cb992-3"></a></span>
<span id="cb992-4"><a href="18-purrr.html#cb992-4"></a>dfs &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_csv)</span></code></pre></div>
<p>Le résultat <code>dfs</code> est une liste de trois tableaux de données. Chacun de ces éléments est un <em>tibble</em> : d’abord celui du fichier CSV des données de l’Isère, puis celui de la Loire, et enfin celui du Rhône.</p>
<p>On peut itérer sur cette liste <code>dfs</code> pour appliquer une fonction à chacun de ces tableaux.</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="18-purrr.html#cb993-1"></a><span class="co"># Affichage des dimensions de chaque tableau</span></span>
<span id="cb993-2"><a href="18-purrr.html#cb993-2"></a>dfs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(dim)</span>
<span id="cb993-3"><a href="18-purrr.html#cb993-3"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb993-4"><a href="18-purrr.html#cb993-4"></a><span class="co">#&gt; [1] 129  36</span></span>
<span id="cb993-5"><a href="18-purrr.html#cb993-5"></a><span class="co">#&gt; </span></span>
<span id="cb993-6"><a href="18-purrr.html#cb993-6"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb993-7"><a href="18-purrr.html#cb993-7"></a><span class="co">#&gt; [1] 56 36</span></span>
<span id="cb993-8"><a href="18-purrr.html#cb993-8"></a><span class="co">#&gt; </span></span>
<span id="cb993-9"><a href="18-purrr.html#cb993-9"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb993-10"><a href="18-purrr.html#cb993-10"></a><span class="co">#&gt; [1] 119  36</span></span></code></pre></div>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="18-purrr.html#cb994-1"></a><span class="co"># Calcul de la moyenne de la variable dipl_aucun</span></span>
<span id="cb994-2"><a href="18-purrr.html#cb994-2"></a>dfs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.x<span class="op">$</span>dipl_aucun))</span>
<span id="cb994-3"><a href="18-purrr.html#cb994-3"></a><span class="co">#&gt; [1] 16.03841 18.14102 14.73050</span></span></code></pre></div>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="18-purrr.html#cb995-1"></a><span class="co"># Calcul du coefficient associé à la variable dipl_sup dans</span></span>
<span id="cb995-2"><a href="18-purrr.html#cb995-2"></a><span class="co"># la régression linéaire de cadres en fonction de dipl_sup</span></span>
<span id="cb995-3"><a href="18-purrr.html#cb995-3"></a>dfs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="op">~</span><span class="st"> </span>{</span>
<span id="cb995-4"><a href="18-purrr.html#cb995-4"></a>    reg &lt;-<span class="st"> </span><span class="kw">lm</span>(cadres <span class="op">~</span><span class="st"> </span>dipl_sup, <span class="dt">data =</span> .x)</span>
<span id="cb995-5"><a href="18-purrr.html#cb995-5"></a>    reg<span class="op">$</span>coefficients[<span class="st">&quot;dipl_sup&quot;</span>]</span>
<span id="cb995-6"><a href="18-purrr.html#cb995-6"></a>})</span>
<span id="cb995-7"><a href="18-purrr.html#cb995-7"></a><span class="co">#&gt; [1] 1.007805 1.154655 1.065431</span></span></code></pre></div>
<p>Si on souhaite réunir ces trois <em>tibbles</em> en un seul, on peut utiliser la fonction <code>bind_rows()</code> de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="18-purrr.html#cb996-1"></a>departements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;38&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>)</span>
<span id="cb996-2"><a href="18-purrr.html#cb996-2"></a>urls &lt;-<span class="st"> </span><span class="kw">genere_url</span>(departements)</span>
<span id="cb996-3"><a href="18-purrr.html#cb996-3"></a></span>
<span id="cb996-4"><a href="18-purrr.html#cb996-4"></a>df &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span></span>
<span id="cb996-5"><a href="18-purrr.html#cb996-5"></a><span class="st">    </span><span class="kw">map</span>(read_csv) <span class="op">%&gt;%</span></span>
<span id="cb996-6"><a href="18-purrr.html#cb996-6"></a><span class="st">    </span><span class="kw">bind_rows</span>()</span></code></pre></div>
<p>Mais on peut aussi utiliser une autre variante de <code>map()</code>, nommée <code>map_dfr()</code>, qui considère les résultats obtenus par l’application de la fonction comme les lignes d’un tableau de données qu’elle va automatiquement rassembler en un seul tableau, de la même manière qu’avec un <code>bind_rows()</code>.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="18-purrr.html#cb997-1"></a>df &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(read_csv)</span>
<span id="cb997-2"><a href="18-purrr.html#cb997-2"></a></span>
<span id="cb997-3"><a href="18-purrr.html#cb997-3"></a>df</span>
<span id="cb997-4"><a href="18-purrr.html#cb997-4"></a><span class="co">#&gt; # A tibble: 304 × 36</span></span>
<span id="cb997-5"><a href="18-purrr.html#cb997-5"></a><span class="co">#&gt;    code_insee commune  code_region region departement log_rp log_proprio log_loc</span></span>
<span id="cb997-6"><a href="18-purrr.html#cb997-6"></a><span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb997-7"><a href="18-purrr.html#cb997-7"></a><span class="co">#&gt;  1      38001 Les Abr…          82 Rhône… Isère         1432         814     588</span></span>
<span id="cb997-8"><a href="18-purrr.html#cb997-8"></a><span class="co">#&gt;  2      38006 Allevard          82 Rhône… Isère         1684        1033     610</span></span>
<span id="cb997-9"><a href="18-purrr.html#cb997-9"></a><span class="co">#&gt;  3      38012 Aoste             82 Rhône… Isère         1083         733     331</span></span>
<span id="cb997-10"><a href="18-purrr.html#cb997-10"></a><span class="co">#&gt;  4      38013 Apprieu           82 Rhône… Isère         1197        1007     172</span></span>
<span id="cb997-11"><a href="18-purrr.html#cb997-11"></a><span class="co">#&gt;  5      38022 Les Ave…          82 Rhône… Isère         2320        1596     679</span></span>
<span id="cb997-12"><a href="18-purrr.html#cb997-12"></a><span class="co">#&gt;  6      38034 Beaurep…          82 Rhône… Isère         1985        1080     861</span></span>
<span id="cb997-13"><a href="18-purrr.html#cb997-13"></a><span class="co">#&gt;  7      38039 Bernin            82 Rhône… Isère         1117         922     172</span></span>
<span id="cb997-14"><a href="18-purrr.html#cb997-14"></a><span class="co">#&gt;  8      38045 Biviers           82 Rhône… Isère          942         801     131</span></span>
<span id="cb997-15"><a href="18-purrr.html#cb997-15"></a><span class="co">#&gt;  9      38052 Le Bour…          82 Rhône… Isère         1363         843     476</span></span>
<span id="cb997-16"><a href="18-purrr.html#cb997-16"></a><span class="co">#&gt; 10      38053 Bourgoi…          82 Rhône… Isère        12129        4924    6913</span></span>
<span id="cb997-17"><a href="18-purrr.html#cb997-17"></a><span class="co">#&gt; # … with 294 more rows, and 28 more variables: log_hlm &lt;dbl&gt;, log_sec &lt;dbl&gt;,</span></span>
<span id="cb997-18"><a href="18-purrr.html#cb997-18"></a><span class="co">#&gt; #   log_maison &lt;dbl&gt;, log_appart &lt;dbl&gt;, age_0_14 &lt;dbl&gt;, age_15_29 &lt;dbl&gt;,</span></span>
<span id="cb997-19"><a href="18-purrr.html#cb997-19"></a><span class="co">#&gt; #   age_75p &lt;dbl&gt;, femmes &lt;dbl&gt;, chom &lt;dbl&gt;, agric &lt;dbl&gt;, indep &lt;dbl&gt;,</span></span>
<span id="cb997-20"><a href="18-purrr.html#cb997-20"></a><span class="co">#&gt; #   cadres &lt;dbl&gt;, interm &lt;dbl&gt;, empl &lt;dbl&gt;, ouvr &lt;dbl&gt;, etud &lt;dbl&gt;,</span></span>
<span id="cb997-21"><a href="18-purrr.html#cb997-21"></a><span class="co">#&gt; #   dipl_aucun &lt;dbl&gt;, dipl_bepc &lt;dbl&gt;, dipl_capbep &lt;dbl&gt;, dipl_bac &lt;dbl&gt;,</span></span>
<span id="cb997-22"><a href="18-purrr.html#cb997-22"></a><span class="co">#&gt; #   dipl_bac2 &lt;dbl&gt;, dipl_sup &lt;dbl&gt;, resid_sec &lt;dbl&gt;, proprio &lt;dbl&gt;,</span></span>
<span id="cb997-23"><a href="18-purrr.html#cb997-23"></a><span class="co">#&gt; #   locataire &lt;dbl&gt;, hlm &lt;dbl&gt;, maison &lt;dbl&gt;, appart &lt;dbl&gt;</span></span></code></pre></div>
<p>Les deux lignes de code ci-dessus partent donc d’une liste d’identifiants de départements, génèrent les URL des fichiers CSV correspondant, les importent dans R et assemblent le résultat en un seul tableau. Plutôt efficace !</p>
<p>Une fonction utile en complément de <code>map_dfr()</code> est la fonction <code>list.files()</code>, qui peut lister les fichiers ayant une certaine extension dans un dossier spécifique. Par exemple, l’instruction suivante liste tous les fichiers se terminant par <code>.csv</code> du sous-dossier <code>data</code>.</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="18-purrr.html#cb998-1"></a>fichiers &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;*.csv&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>On peut dès lors utiliser <code>map_dfr()</code> et <code>read_csv()</code> pour lire tous ces fichiers en une seule fois et les concaténer en un seul tableau de données.</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="18-purrr.html#cb999-1"></a>d &lt;-<span class="st"> </span>fichiers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(read_csv)</span></code></pre></div>
<div class="rmdnote">
<p>
Il existe également une variante <code>map_dfc()</code> qui considère les résultats comme des colonnes d’un tableau de données et les rassemble en un seul tableau comme le ferait la fonction <code>bind_cols()</code> de <code>dplyr</code>.
</p>
</div>
</div>
</div>
<div id="itérer-sur-les-colonnes-dun-tableau-de-données" class="section level2">
<h2><span class="header-section-number">18.3</span> Itérer sur les colonnes d’un tableau de données</h2>
<p>On a vu section <a href="16-structures-donnees.html#data-frame-tibbles">16.3</a> que les tableaux de données (<em>data frame</em> ou <em>tibble</em>) sont en fait des listes dont les éléments sont les colonnes du tableau. Si on applique <code>map()</code> à un tableau, celle-ci itérera donc sur ses colonnes.</p>
<p>Par exemple, on peut appliquer <code>n_distinct</code> au jeu de données <code>starwars</code> et obtenir le nombre de valeurs distinctes de chacune de ses colonnes.</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="18-purrr.html#cb1000-1"></a>starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(n_distinct)</span>
<span id="cb1000-2"><a href="18-purrr.html#cb1000-2"></a><span class="co">#&gt;       name     height       mass hair_color skin_color  eye_color birth_year </span></span>
<span id="cb1000-3"><a href="18-purrr.html#cb1000-3"></a><span class="co">#&gt;         87         46         39         13         31         15         37 </span></span>
<span id="cb1000-4"><a href="18-purrr.html#cb1000-4"></a><span class="co">#&gt;        sex     gender  homeworld    species      films   vehicles  starships </span></span>
<span id="cb1000-5"><a href="18-purrr.html#cb1000-5"></a><span class="co">#&gt;          5          3         49         38         24         11         17</span></span></code></pre></div>
<p>Le résultat est équivalent à celui qu’on obtient en faisant un <code>summarise()</code> sur l’ensemble des colonnes, comme vu section <a href="15-dplyr-avance.html#across">15.2</a>, sauf que <code>map_int()</code> retourne un vecteur numérique tandis que <code>summarise()</code> renvoie un <em>tibble</em> à une ligne.</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="18-purrr.html#cb1001-1"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb1001-2"><a href="18-purrr.html#cb1001-2"></a><span class="st">    </span><span class="kw">summarise</span>(</span>
<span id="cb1001-3"><a href="18-purrr.html#cb1001-3"></a>        <span class="kw">across</span>(<span class="kw">everything</span>(), n_distinct)</span>
<span id="cb1001-4"><a href="18-purrr.html#cb1001-4"></a>    )</span>
<span id="cb1001-5"><a href="18-purrr.html#cb1001-5"></a><span class="co">#&gt; # A tibble: 1 × 14</span></span>
<span id="cb1001-6"><a href="18-purrr.html#cb1001-6"></a><span class="co">#&gt;    name height  mass hair_color skin_color eye_color birth_year   sex gender</span></span>
<span id="cb1001-7"><a href="18-purrr.html#cb1001-7"></a><span class="co">#&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;int&gt;     &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span id="cb1001-8"><a href="18-purrr.html#cb1001-8"></a><span class="co">#&gt; 1    87     46    39         13         31        15         37     5      3</span></span>
<span id="cb1001-9"><a href="18-purrr.html#cb1001-9"></a><span class="co">#&gt; # … with 5 more variables: homeworld &lt;int&gt;, species &lt;int&gt;, films &lt;int&gt;,</span></span>
<span id="cb1001-10"><a href="18-purrr.html#cb1001-10"></a><span class="co">#&gt; #   vehicles &lt;int&gt;, starships &lt;int&gt;</span></span></code></pre></div>
<p>De la même manière, si on veut connaître le nombre de valeurs manquantes pour chaque variable :</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="18-purrr.html#cb1002-1"></a>starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) )</span>
<span id="cb1002-2"><a href="18-purrr.html#cb1002-2"></a><span class="co">#&gt;       name     height       mass hair_color skin_color  eye_color birth_year </span></span>
<span id="cb1002-3"><a href="18-purrr.html#cb1002-3"></a><span class="co">#&gt;          0          6         28          5          0          0         44 </span></span>
<span id="cb1002-4"><a href="18-purrr.html#cb1002-4"></a><span class="co">#&gt;        sex     gender  homeworld    species      films   vehicles  starships </span></span>
<span id="cb1002-5"><a href="18-purrr.html#cb1002-5"></a><span class="co">#&gt;          4          4         10          4          0          0          0</span></span></code></pre></div>
<p>Contrairement à <code>across()</code>, on ne peut pas spécifier directement une sélection de colonnes à <code>map()</code>. On peut par contre utiliser des fonctions comme <code>keep()</code> ou <code>discard()</code> qui “filtrent” les éléments d’une liste via une fonction qui renvoie <code>TRUE</code> ou <code>FALSE</code>.</p>
<p>On peut par exemple utiliser <code>discard()</code> après <code>map()</code> pour ne conserver que les colonnes ayant au moins une valeur <code>NA</code>.</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="18-purrr.html#cb1003-1"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb1003-2"><a href="18-purrr.html#cb1003-2"></a><span class="st">    </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) ) <span class="op">%&gt;%</span></span>
<span id="cb1003-3"><a href="18-purrr.html#cb1003-3"></a><span class="st">    </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span>.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span> )</span>
<span id="cb1003-4"><a href="18-purrr.html#cb1003-4"></a><span class="co">#&gt;     height       mass hair_color birth_year        sex     gender  homeworld </span></span>
<span id="cb1003-5"><a href="18-purrr.html#cb1003-5"></a><span class="co">#&gt;          6         28          5         44          4          4         10 </span></span>
<span id="cb1003-6"><a href="18-purrr.html#cb1003-6"></a><span class="co">#&gt;    species </span></span>
<span id="cb1003-7"><a href="18-purrr.html#cb1003-7"></a><span class="co">#&gt;          4</span></span></code></pre></div>
<p>Ou bien utiliser <code>keep()</code> pour n’appliquer <code>mean()</code> qu’aux variables numériques.</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="18-purrr.html#cb1004-1"></a>starwars <span class="op">%&gt;%</span></span>
<span id="cb1004-2"><a href="18-purrr.html#cb1004-2"></a><span class="st">    </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span></span>
<span id="cb1004-3"><a href="18-purrr.html#cb1004-3"></a><span class="st">    </span><span class="kw">map_dbl</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1004-4"><a href="18-purrr.html#cb1004-4"></a><span class="co">#&gt;     height       mass birth_year </span></span>
<span id="cb1004-5"><a href="18-purrr.html#cb1004-5"></a><span class="co">#&gt;  174.35802   97.31186   87.56512</span></span></code></pre></div>
</div>
<div id="modify" class="section level2">
<h2><span class="header-section-number">18.4</span> <code>modify</code></h2>
<p><code>modify()</code> est une variante de <code>map()</code> qui a pour particularité de renvoyer un résultat du même type que la liste ou le vecteur donné en entrée.</p>
<p>Ainsi, si on l’applique à un vecteur de chaînes de caractères, le résultat sera aussi un vecteur de chaînes de caractères même si la fonction appliquée retourne un résultat numérique.</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="18-purrr.html#cb1005-1"></a>v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</span>
<span id="cb1005-2"><a href="18-purrr.html#cb1005-2"></a>v <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify</span>(length)</span>
<span id="cb1005-3"><a href="18-purrr.html#cb1005-3"></a><span class="co">#&gt; [1] &quot;1&quot; &quot;1&quot; &quot;1&quot;</span></span></code></pre></div>
<p>Si on l’applique à une liste, le résultat sera aussi une liste.</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="18-purrr.html#cb1006-1"></a>v &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</span>
<span id="cb1006-2"><a href="18-purrr.html#cb1006-2"></a>v <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify</span>(length)</span>
<span id="cb1006-3"><a href="18-purrr.html#cb1006-3"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb1006-4"><a href="18-purrr.html#cb1006-4"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb1006-5"><a href="18-purrr.html#cb1006-5"></a><span class="co">#&gt; </span></span>
<span id="cb1006-6"><a href="18-purrr.html#cb1006-6"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb1006-7"><a href="18-purrr.html#cb1006-7"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb1006-8"><a href="18-purrr.html#cb1006-8"></a><span class="co">#&gt; </span></span>
<span id="cb1006-9"><a href="18-purrr.html#cb1006-9"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb1006-10"><a href="18-purrr.html#cb1006-10"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>L’objectif de <code>modify()</code> est de permettre de “modifier” une liste ou un vecteur en lui appliquant une fonction tout en étant sûr qu’on ne va pas modifier son type.</p>
<p>L’intérêt principal de <code>modify()</code> est qu’elle propose deux variantes, <code>modify_if()</code> et <code>modify_at()</code>, qui sélectionnent les éléments respectivement via une fonction et via leur nom ou leur position, et qui n’appliquent la fonction de transformation qu’aux éléments sélectionnés.</p>
<p>Cela peut être particulièrement utile quand on l’applique à un tableau de données. Par exemple le code suivant utilise <code>modify_if()</code> pour transformer uniquement les colonnes de type <code>factor</code> de <code>hdv2003</code> en <code>character</code>, et laisser les autres inchangées.</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="18-purrr.html#cb1007-1"></a>hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify_if</span>(is.factor, as.character)</span></code></pre></div>
<p>On notera qu’on obtient le même résultat avec le code suivant qui utilise <code>across()</code> de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="18-purrr.html#cb1008-1"></a>hdv2003 <span class="op">%&gt;%</span></span>
<span id="cb1008-2"><a href="18-purrr.html#cb1008-2"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb1008-3"><a href="18-purrr.html#cb1008-3"></a>        <span class="kw">across</span>(</span>
<span id="cb1008-4"><a href="18-purrr.html#cb1008-4"></a>            <span class="kw">where</span>(is.factor),</span>
<span id="cb1008-5"><a href="18-purrr.html#cb1008-5"></a>            as.character</span>
<span id="cb1008-6"><a href="18-purrr.html#cb1008-6"></a>        )</span>
<span id="cb1008-7"><a href="18-purrr.html#cb1008-7"></a>    )</span></code></pre></div>
<p><code>modify_at</code> permet d’appliquer une fonction à certaines variables à partir de leurs noms.</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="18-purrr.html#cb1009-1"></a>hdv2003 <span class="op">%&gt;%</span></span>
<span id="cb1009-2"><a href="18-purrr.html#cb1009-2"></a><span class="st">    </span><span class="kw">modify_at</span>(<span class="kw">c</span>(<span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;qualif&quot;</span>), as.character)</span></code></pre></div>
<p>En utilisant <code>vars()</code>, on peut sélectionner les variables avec toutes les possibilités offertes par la <em>tidy selection</em>.</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="18-purrr.html#cb1010-1"></a>hdv2003 <span class="op">%&gt;%</span></span>
<span id="cb1010-2"><a href="18-purrr.html#cb1010-2"></a><span class="st">    </span><span class="kw">modify_at</span>(<span class="kw">vars</span>(hard.rock<span class="op">:</span>sport), as.character)</span></code></pre></div>
<p>Là aussi, on peut obtenir le même résultat en utilisant <code>across()</code>.</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="18-purrr.html#cb1011-1"></a>hdv2003 <span class="op">%&gt;%</span></span>
<span id="cb1011-2"><a href="18-purrr.html#cb1011-2"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb1011-3"><a href="18-purrr.html#cb1011-3"></a>        <span class="kw">across</span>(</span>
<span id="cb1011-4"><a href="18-purrr.html#cb1011-4"></a>            hard.rock<span class="op">:</span>sport,</span>
<span id="cb1011-5"><a href="18-purrr.html#cb1011-5"></a>            as.character</span>
<span id="cb1011-6"><a href="18-purrr.html#cb1011-6"></a>        )</span>
<span id="cb1011-7"><a href="18-purrr.html#cb1011-7"></a>    )</span></code></pre></div>
</div>
<div id="imap" class="section level2">
<h2><span class="header-section-number">18.5</span> <code>imap</code></h2>
<p>Imaginons que nous avons récupéré les données suivantes, qui représentent des évaluations obtenues par quatre restaurants, sous la forme d’une liste.</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="18-purrr.html#cb1012-1"></a>restos &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1012-2"><a href="18-purrr.html#cb1012-2"></a>    <span class="st">&quot;La bonne fourchette&quot;</span>     =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb1012-3"><a href="18-purrr.html#cb1012-3"></a>    <span class="st">&quot;La choucroute de l&#39;amer&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb1012-4"><a href="18-purrr.html#cb1012-4"></a>    <span class="st">&quot;L&#39;Hair de rien&quot;</span>          =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb1012-5"><a href="18-purrr.html#cb1012-5"></a>    <span class="st">&quot;La blanquette de Vaulx&quot;</span>  =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb1012-6"><a href="18-purrr.html#cb1012-6"></a>)</span></code></pre></div>
<p>À partir de cette liste, on souhaite créer un tableau de données comportant la moyenne et l’écart-type des notes de chaque restaurant. Comme on l’a vu précédemment, cela peut se faire avec l’aide de <code>map_dfr()</code>.</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="18-purrr.html#cb1013-1"></a>restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">tibble</span>(<span class="dt">moyenne =</span> <span class="kw">mean</span>(.x), <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x)) )</span>
<span id="cb1013-2"><a href="18-purrr.html#cb1013-2"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb1013-3"><a href="18-purrr.html#cb1013-3"></a><span class="co">#&gt;   moyenne ecart_type</span></span>
<span id="cb1013-4"><a href="18-purrr.html#cb1013-4"></a><span class="co">#&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb1013-5"><a href="18-purrr.html#cb1013-5"></a><span class="co">#&gt; 1    2.8        1.14</span></span>
<span id="cb1013-6"><a href="18-purrr.html#cb1013-6"></a><span class="co">#&gt; 2    2.86       1.46</span></span>
<span id="cb1013-7"><a href="18-purrr.html#cb1013-7"></a><span class="co">#&gt; 3    3.11       1.90</span></span>
<span id="cb1013-8"><a href="18-purrr.html#cb1013-8"></a><span class="co">#&gt; 4    2.7        1.42</span></span></code></pre></div>
<p>On obtient le tableau souhaité, mais il manque une information : le nom du restaurant correspondant à chaque ligne. Cette information est incluse dans les noms des éléments de la liste <code>restos</code>, or la fonction passée à <code>map_dfr</code> n’y a pas accès, elle n’a accès qu’à leurs valeurs.</p>
<p>C’est pour ce type de cas de figure que <code>purrr</code> propose la famille de fonctions <code>imap()</code>. Celle-ci fonctionne de la même manière que <code>map()</code>, sauf que la fonction appliquée prend deux arguments : d’abord la valeur de l’élément courant, puis son nom.</p>
<p>Dans l’exemple suivant, on applique <code>imap()</code> à une liste simple et on affiche un message avec le nom et la valeur de chaque élément.</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="18-purrr.html#cb1014-1"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nom1 =</span> <span class="dv">1</span>, <span class="dt">nom2 =</span> <span class="dv">3</span>)</span>
<span id="cb1014-2"><a href="18-purrr.html#cb1014-2"></a></span>
<span id="cb1014-3"><a href="18-purrr.html#cb1014-3"></a>l2 &lt;-<span class="st"> </span>l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap</span>(<span class="cf">function</span>(valeur, nom) {</span>
<span id="cb1014-4"><a href="18-purrr.html#cb1014-4"></a>   <span class="kw">message</span>(<span class="st">&quot;La valeur de &quot;</span>, nom, <span class="st">&quot; est &quot;</span>, valeur)</span>
<span id="cb1014-5"><a href="18-purrr.html#cb1014-5"></a>})</span>
<span id="cb1014-6"><a href="18-purrr.html#cb1014-6"></a><span class="co">#&gt; La valeur de nom1 est 1</span></span>
<span id="cb1014-7"><a href="18-purrr.html#cb1014-7"></a><span class="co">#&gt; La valeur de nom2 est 3</span></span></code></pre></div>
<p>On peut évidemment utiliser la notation “formule” de <code>purrr</code>, il faut juste se souvenir que dans ce cas <code>.x</code> correspond à la valeur, et <code>.y</code> au nom.</p>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="18-purrr.html#cb1015-1"></a>l2 &lt;-<span class="st"> </span>l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap</span>(<span class="op">~</span><span class="st"> </span>{</span>
<span id="cb1015-2"><a href="18-purrr.html#cb1015-2"></a>   <span class="kw">message</span>(<span class="st">&quot;La valeur de &quot;</span>, .y, <span class="st">&quot; est &quot;</span>, .x)</span>
<span id="cb1015-3"><a href="18-purrr.html#cb1015-3"></a>})</span>
<span id="cb1015-4"><a href="18-purrr.html#cb1015-4"></a><span class="co">#&gt; La valeur de nom1 est 1</span></span>
<span id="cb1015-5"><a href="18-purrr.html#cb1015-5"></a><span class="co">#&gt; La valeur de nom2 est 3</span></span></code></pre></div>
<p>Tout comme <code>map()</code> proposait les variantes <code>map_int()</code>, <code>map_chr()</code> ou <code>map_dfr()</code>, on peut également utiliser <code>imap_dbl()</code>, <code>imap_chr()</code> et autres <code>imap_dfc()</code> pour forcer le type de résultat retourné.</p>
<p>Pour reprendre notre exemple de départ, on peut donc, en utilisant <code>imap</code>, récupérer le nom de l’élément courant de la liste <code>restos</code> et l’utiliser pour rajouter le nom du restaurant dans notre <em>tibble</em> de résultats.</p>
<p>On peut le faire avec une fonction anonyme “classique” :</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="18-purrr.html#cb1016-1"></a>restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap_dfr</span>(<span class="cf">function</span>(notes, nom) {</span>
<span id="cb1016-2"><a href="18-purrr.html#cb1016-2"></a>    <span class="kw">tibble</span>(<span class="dt">resto =</span> nom, <span class="dt">moyenne =</span> <span class="kw">mean</span>(notes), <span class="dt">ecart_type =</span> <span class="kw">sd</span>(notes))</span>
<span id="cb1016-3"><a href="18-purrr.html#cb1016-3"></a>})</span>
<span id="cb1016-4"><a href="18-purrr.html#cb1016-4"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb1016-5"><a href="18-purrr.html#cb1016-5"></a><span class="co">#&gt;   resto                   moyenne ecart_type</span></span>
<span id="cb1016-6"><a href="18-purrr.html#cb1016-6"></a><span class="co">#&gt;   &lt;chr&gt;                     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb1016-7"><a href="18-purrr.html#cb1016-7"></a><span class="co">#&gt; 1 La bonne fourchette        2.8        1.14</span></span>
<span id="cb1016-8"><a href="18-purrr.html#cb1016-8"></a><span class="co">#&gt; 2 La choucroute de l&#39;amer    2.86       1.46</span></span>
<span id="cb1016-9"><a href="18-purrr.html#cb1016-9"></a><span class="co">#&gt; 3 L&#39;Hair de rien             3.11       1.90</span></span>
<span id="cb1016-10"><a href="18-purrr.html#cb1016-10"></a><span class="co">#&gt; 4 La blanquette de Vaulx     2.7        1.42</span></span></code></pre></div>
<p>On peut aussi utiliser la notation compacte de type formule, en se souvenant à nouveau que <code>.x</code> correspond à la valeur de l’élément courant, et <code>.y</code> à son nom.</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="18-purrr.html#cb1017-1"></a>restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap_dfr</span>(<span class="op">~</span><span class="st"> </span>{</span>
<span id="cb1017-2"><a href="18-purrr.html#cb1017-2"></a>    <span class="kw">tibble</span>(<span class="dt">resto =</span> .y, <span class="dt">moyenne =</span> <span class="kw">mean</span>(.x), <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x))</span>
<span id="cb1017-3"><a href="18-purrr.html#cb1017-3"></a>})</span>
<span id="cb1017-4"><a href="18-purrr.html#cb1017-4"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb1017-5"><a href="18-purrr.html#cb1017-5"></a><span class="co">#&gt;   resto                   moyenne ecart_type</span></span>
<span id="cb1017-6"><a href="18-purrr.html#cb1017-6"></a><span class="co">#&gt;   &lt;chr&gt;                     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb1017-7"><a href="18-purrr.html#cb1017-7"></a><span class="co">#&gt; 1 La bonne fourchette        2.8        1.14</span></span>
<span id="cb1017-8"><a href="18-purrr.html#cb1017-8"></a><span class="co">#&gt; 2 La choucroute de l&#39;amer    2.86       1.46</span></span>
<span id="cb1017-9"><a href="18-purrr.html#cb1017-9"></a><span class="co">#&gt; 3 L&#39;Hair de rien             3.11       1.90</span></span>
<span id="cb1017-10"><a href="18-purrr.html#cb1017-10"></a><span class="co">#&gt; 4 La blanquette de Vaulx     2.7        1.42</span></span></code></pre></div>
<div class="rmdnote">
<p>
Si on utilise <code>imap()</code> sur une liste ou un vecteur qui n’a pas de noms, le deuxième argument passé à la fonction appliquée sera l’indice de l’élément courant : 1 pour le premier, 2 pour le deuxième, etc.
</p>
</div>
</div>
<div id="walk" class="section level2">
<h2><span class="header-section-number">18.6</span> <code>walk</code></h2>
<p><code>walk()</code> est une variante de <code>map()</code> qui a pour particularité de ne pas retourner de résultat. On l’utilise lorsqu’on souhaite parcourir un vecteur ou une liste et appliquer à ses éléments une fonction dont on ne souhaite conserver que les “effets de bord” : afficher un message, générer un graphique, enregistrer un fichier…</p>
<p>Par exemple, le code suivant génère quatre diagrammes en barre indiquant la répartition des notes des différents restaurants vus dans la section précédente.</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="18-purrr.html#cb1018-1"></a><span class="kw">walk</span>(restos, <span class="op">~</span><span class="st"> </span><span class="kw">barplot</span>(<span class="kw">table</span>(.x)) )</span></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1062-1.svg" width="672" /></p>
<p>Comme pour <code>map()</code>, la variante <code>iwalk()</code> permet d’itérer à la fois sur les valeurs et sur les noms des éléments du vecteur ou de la liste. Ceci permet par exemple d’afficher le nom du restaurant comme titre de chaque graphique.</p>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="18-purrr.html#cb1019-1"></a><span class="kw">iwalk</span>(restos, <span class="op">~</span><span class="st"> </span><span class="kw">barplot</span>(<span class="kw">table</span>(.x), <span class="dt">main =</span> .y) )</span></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1064-1.svg" width="672" /></p>
<p>Au final, on notera que l’utilisation de <code>walk()</code>, comme elle ne retourne pas de résultats, est très proche de celle d’une boucle <code>for</code>.</p>
</div>
<div id="map2-et-pmap-itérer-sur-plusieurs-vecteurs-en-parallèle" class="section level2">
<h2><span class="header-section-number">18.7</span> <code>map2</code> et <code>pmap</code> : itérer sur plusieurs vecteurs en parallèle</h2>
<p>Supposons qu’un.e collègue, qui travaille avec nous sur le jeu de données <code>rp2012</code>, nous a envoyé une liste de variables dont elle voudrait connaître les corrélations. Cette liste a été saisie dans un tableur sur deux colonnes, chaque ligne indiquant deux variables pour lesquelles elle souhaite qu’on effectue ce calcul.</p>
<p>Après importation dans R on obtient le tableau de données suivant.</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="18-purrr.html#cb1020-1"></a>correlations &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1020-2"><a href="18-purrr.html#cb1020-2"></a>    <span class="op">~</span>var1,       <span class="op">~</span>var2,</span>
<span id="cb1020-3"><a href="18-purrr.html#cb1020-3"></a>    <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;dipl_aucun&quot;</span>,</span>
<span id="cb1020-4"><a href="18-purrr.html#cb1020-4"></a>    <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;cadres&quot;</span>,</span>
<span id="cb1020-5"><a href="18-purrr.html#cb1020-5"></a>    <span class="st">&quot;hlm&quot;</span>,      <span class="st">&quot;cadres&quot;</span>,</span>
<span id="cb1020-6"><a href="18-purrr.html#cb1020-6"></a>    <span class="st">&quot;hlm&quot;</span>,      <span class="st">&quot;ouvr&quot;</span>,</span>
<span id="cb1020-7"><a href="18-purrr.html#cb1020-7"></a>    <span class="st">&quot;proprio&quot;</span>,  <span class="st">&quot;hlm&quot;</span></span>
<span id="cb1020-8"><a href="18-purrr.html#cb1020-8"></a>)</span>
<span id="cb1020-9"><a href="18-purrr.html#cb1020-9"></a></span>
<span id="cb1020-10"><a href="18-purrr.html#cb1020-10"></a>correlations</span>
<span id="cb1020-11"><a href="18-purrr.html#cb1020-11"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb1020-12"><a href="18-purrr.html#cb1020-12"></a><span class="co">#&gt;   var1     var2      </span></span>
<span id="cb1020-13"><a href="18-purrr.html#cb1020-13"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     </span></span>
<span id="cb1020-14"><a href="18-purrr.html#cb1020-14"></a><span class="co">#&gt; 1 dipl_sup dipl_aucun</span></span>
<span id="cb1020-15"><a href="18-purrr.html#cb1020-15"></a><span class="co">#&gt; 2 dipl_sup cadres    </span></span>
<span id="cb1020-16"><a href="18-purrr.html#cb1020-16"></a><span class="co">#&gt; 3 hlm      cadres    </span></span>
<span id="cb1020-17"><a href="18-purrr.html#cb1020-17"></a><span class="co">#&gt; 4 hlm      ouvr      </span></span>
<span id="cb1020-18"><a href="18-purrr.html#cb1020-18"></a><span class="co">#&gt; 5 proprio  hlm</span></span></code></pre></div>
<p>Pour pouvoir calculer les corrélations souhaitées, on doit itérer sur les deux vecteurs <code>var1</code> et <code>var2</code> <em>en parallèle</em>, et calculer la corrélation entre la colonne de <code>rp2012</code> correspondant à la valeur courante de <code>var1</code> et celle correspondant à la valeur courante de <code>var2</code>.</p>
<p>C’est précisément ce que fait la fonction <code>map2()</code>. Celle-ci prend trois arguments en entrée :</p>
<ol style="list-style-type: decimal">
<li>deux listes ou vecteurs qui seront itérés en parallèle</li>
<li>une fonction qui accepte deux arguments : ceux-ci prendront tour à tour les deux valeurs courantes des deux listes ou vecteurs itérés</li>
</ol>
<p>On peut donc utiliser <code>map2</code> pour itérer parallèlement sur les deux colonnes <code>var1</code> et <code>var2</code> de notre tableau <code>correlations</code>, et calculer la corrélation des deux colonnes correspondantes de <code>rp2012</code>.</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="18-purrr.html#cb1021-1"></a><span class="kw">map2</span>(</span>
<span id="cb1021-2"><a href="18-purrr.html#cb1021-2"></a>    correlations<span class="op">$</span>var1,</span>
<span id="cb1021-3"><a href="18-purrr.html#cb1021-3"></a>    correlations<span class="op">$</span>var2, </span>
<span id="cb1021-4"><a href="18-purrr.html#cb1021-4"></a>    <span class="op">~</span><span class="st"> </span><span class="kw">cor</span>(rp2012[[.x]], rp2012[[.y]])</span>
<span id="cb1021-5"><a href="18-purrr.html#cb1021-5"></a>)</span>
<span id="cb1021-6"><a href="18-purrr.html#cb1021-6"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb1021-7"><a href="18-purrr.html#cb1021-7"></a><span class="co">#&gt; [1] -0.5337366</span></span>
<span id="cb1021-8"><a href="18-purrr.html#cb1021-8"></a><span class="co">#&gt; </span></span>
<span id="cb1021-9"><a href="18-purrr.html#cb1021-9"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb1021-10"><a href="18-purrr.html#cb1021-10"></a><span class="co">#&gt; [1] 0.9371629</span></span>
<span id="cb1021-11"><a href="18-purrr.html#cb1021-11"></a><span class="co">#&gt; </span></span>
<span id="cb1021-12"><a href="18-purrr.html#cb1021-12"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb1021-13"><a href="18-purrr.html#cb1021-13"></a><span class="co">#&gt; [1] -0.1452185</span></span>
<span id="cb1021-14"><a href="18-purrr.html#cb1021-14"></a><span class="co">#&gt; </span></span>
<span id="cb1021-15"><a href="18-purrr.html#cb1021-15"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb1021-16"><a href="18-purrr.html#cb1021-16"></a><span class="co">#&gt; [1] 0.2526703</span></span>
<span id="cb1021-17"><a href="18-purrr.html#cb1021-17"></a><span class="co">#&gt; </span></span>
<span id="cb1021-18"><a href="18-purrr.html#cb1021-18"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb1021-19"><a href="18-purrr.html#cb1021-19"></a><span class="co">#&gt; [1] -0.7878005</span></span></code></pre></div>
<p><code>map2()</code> propose les mêmes variantes <code>map2_int()</code>, <code>mapr2_chr()</code>, etc. que <code>map()</code>. On peut donc utiliser <code>map2_dbl()</code> pour récupérer un vecteur numérique plutôt qu’une liste, et l’utiliser par exemple pour rajouter une colonne à notre tableau de départ.</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="18-purrr.html#cb1022-1"></a>correlations<span class="op">$</span>corr &lt;-<span class="st"> </span><span class="kw">map2_dbl</span>(</span>
<span id="cb1022-2"><a href="18-purrr.html#cb1022-2"></a>    correlations<span class="op">$</span>var1,</span>
<span id="cb1022-3"><a href="18-purrr.html#cb1022-3"></a>    correlations<span class="op">$</span>var2,</span>
<span id="cb1022-4"><a href="18-purrr.html#cb1022-4"></a>    <span class="op">~</span><span class="st"> </span><span class="kw">cor</span>(rp2012[[.x]], rp2012[[.y]])</span>
<span id="cb1022-5"><a href="18-purrr.html#cb1022-5"></a>)</span>
<span id="cb1022-6"><a href="18-purrr.html#cb1022-6"></a></span>
<span id="cb1022-7"><a href="18-purrr.html#cb1022-7"></a>correlations</span>
<span id="cb1022-8"><a href="18-purrr.html#cb1022-8"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb1022-9"><a href="18-purrr.html#cb1022-9"></a><span class="co">#&gt;   var1     var2         corr</span></span>
<span id="cb1022-10"><a href="18-purrr.html#cb1022-10"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span id="cb1022-11"><a href="18-purrr.html#cb1022-11"></a><span class="co">#&gt; 1 dipl_sup dipl_aucun -0.534</span></span>
<span id="cb1022-12"><a href="18-purrr.html#cb1022-12"></a><span class="co">#&gt; 2 dipl_sup cadres      0.937</span></span>
<span id="cb1022-13"><a href="18-purrr.html#cb1022-13"></a><span class="co">#&gt; 3 hlm      cadres     -0.145</span></span>
<span id="cb1022-14"><a href="18-purrr.html#cb1022-14"></a><span class="co">#&gt; 4 hlm      ouvr        0.253</span></span>
<span id="cb1022-15"><a href="18-purrr.html#cb1022-15"></a><span class="co">#&gt; 5 proprio  hlm        -0.788</span></span></code></pre></div>
<p>Si on souhaite uniquement capturer les effets de bord sans récupérer les résultats de la fonctions appliquée, on peut aussi utiliser la variante <code>walk2()</code>.</p>
<p>Supposons maintenant que notre collègue nous a envoyé, toujours sous la même forme, une liste de variables dont elle souhaite obtenir un nuage de points, mais en fournissant également un titre à ajouter au graphique. On obtient le tableau suivant :</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="18-purrr.html#cb1023-1"></a>nuages &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1023-2"><a href="18-purrr.html#cb1023-2"></a>    <span class="op">~</span>var1,       <span class="op">~</span>var2,       <span class="op">~</span>titre,</span>
<span id="cb1023-3"><a href="18-purrr.html#cb1023-3"></a>    <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;dipl_aucun&quot;</span>, <span class="st">&quot;Diplômés du supérieur x sans diplôme&quot;</span>,</span>
<span id="cb1023-4"><a href="18-purrr.html#cb1023-4"></a>    <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;cadres&quot;</span>,     <span class="st">&quot;Pourcentage de cadres x diplômés du supérieur&quot;</span>,</span>
<span id="cb1023-5"><a href="18-purrr.html#cb1023-5"></a>    <span class="st">&quot;hlm&quot;</span>,      <span class="st">&quot;cadres&quot;</span>,     <span class="st">&quot;Pas facile de trouver un titre&quot;</span>,</span>
<span id="cb1023-6"><a href="18-purrr.html#cb1023-6"></a>    <span class="st">&quot;proprio&quot;</span>,  <span class="st">&quot;cadres&quot;</span>,     <span class="st">&quot;Oui non vraiment c&#39;est pas simple&quot;</span></span>
<span id="cb1023-7"><a href="18-purrr.html#cb1023-7"></a>)</span>
<span id="cb1023-8"><a href="18-purrr.html#cb1023-8"></a></span>
<span id="cb1023-9"><a href="18-purrr.html#cb1023-9"></a>nuages</span>
<span id="cb1023-10"><a href="18-purrr.html#cb1023-10"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb1023-11"><a href="18-purrr.html#cb1023-11"></a><span class="co">#&gt;   var1     var2       titre                                        </span></span>
<span id="cb1023-12"><a href="18-purrr.html#cb1023-12"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;                                        </span></span>
<span id="cb1023-13"><a href="18-purrr.html#cb1023-13"></a><span class="co">#&gt; 1 dipl_sup dipl_aucun Diplômés du supérieur x sans diplôme         </span></span>
<span id="cb1023-14"><a href="18-purrr.html#cb1023-14"></a><span class="co">#&gt; 2 dipl_sup cadres     Pourcentage de cadres x diplômés du supérieur</span></span>
<span id="cb1023-15"><a href="18-purrr.html#cb1023-15"></a><span class="co">#&gt; 3 hlm      cadres     Pas facile de trouver un titre               </span></span>
<span id="cb1023-16"><a href="18-purrr.html#cb1023-16"></a><span class="co">#&gt; 4 proprio  cadres     Oui non vraiment c&#39;est pas simple</span></span></code></pre></div>
<p>On est dans une situation similaire à la précédente, sauf que cette fois on doit itérer sur trois vecteurs en parallèle. On va donc utiliser la fonction <code>pmap()</code> qui permet d’itérer sur autant de listes ou vecteurs que l’on souhaite. Plus précisément, comme on souhaite générer des graphiques on va utiliser la variante <code>pwalk()</code> qui ne retourne pas de résultat.</p>
<p><code>pmap()</code> et <code>pwalk()</code> prennent deux arguments principaux :</p>
<ul>
<li>les vecteurs et listes sur lesquels itérer, eux-mêmes regroupés dans une liste</li>
<li>une fonction acceptant autant d’arguments que de vecteur ou listes sur lesquels on itère</li>
</ul>
<p>Dans notre exemple on aurait donc un appel de la forme suivante.</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="18-purrr.html#cb1024-1"></a><span class="kw">pwalk</span>(</span>
<span id="cb1024-2"><a href="18-purrr.html#cb1024-2"></a>    <span class="kw">list</span>(nuages<span class="op">$</span>var1, nuages<span class="op">$</span>var2, nuages<span class="op">$</span>titre),</span>
<span id="cb1024-3"><a href="18-purrr.html#cb1024-3"></a>    <span class="cf">function</span>(var1, var2, titre) {</span>
<span id="cb1024-4"><a href="18-purrr.html#cb1024-4"></a>        <span class="kw">plot</span>(</span>
<span id="cb1024-5"><a href="18-purrr.html#cb1024-5"></a>            rp2012[[var1]], rp2012[[var2]],</span>
<span id="cb1024-6"><a href="18-purrr.html#cb1024-6"></a>            <span class="dt">xlab =</span> var1, <span class="dt">ylab =</span> var2, <span class="dt">main =</span> titre</span>
<span id="cb1024-7"><a href="18-purrr.html#cb1024-7"></a>        )</span>
<span id="cb1024-8"><a href="18-purrr.html#cb1024-8"></a>    }</span>
<span id="cb1024-9"><a href="18-purrr.html#cb1024-9"></a>)</span></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1071-1.svg" width="672" /></p>
<p>Petite précision, si la liste est nommée, il faut que les noms des arguments de la fonction correspondent aux noms de la liste.</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="18-purrr.html#cb1025-1"></a><span class="kw">pwalk</span>(</span>
<span id="cb1025-2"><a href="18-purrr.html#cb1025-2"></a>    <span class="kw">list</span>(<span class="dt">v1 =</span> nuages<span class="op">$</span>var1, <span class="dt">v2 =</span> nuages<span class="op">$</span>var2, <span class="dt">titre =</span> nuages<span class="op">$</span>titre),</span>
<span id="cb1025-3"><a href="18-purrr.html#cb1025-3"></a>    <span class="cf">function</span>(v1, v2, titre) {</span>
<span id="cb1025-4"><a href="18-purrr.html#cb1025-4"></a>        <span class="kw">plot</span>(</span>
<span id="cb1025-5"><a href="18-purrr.html#cb1025-5"></a>            rp2012[[v1]], rp2012[[v2]],</span>
<span id="cb1025-6"><a href="18-purrr.html#cb1025-6"></a>            <span class="dt">xlab =</span> v1, <span class="dt">ylab =</span> v2, <span class="dt">main =</span> titre</span>
<span id="cb1025-7"><a href="18-purrr.html#cb1025-7"></a>        )</span>
<span id="cb1025-8"><a href="18-purrr.html#cb1025-8"></a>    }</span>
<span id="cb1025-9"><a href="18-purrr.html#cb1025-9"></a>)</span></code></pre></div>
<p>À noter que comme <code>nuages</code> est un tableau de données, donc une liste dont les éléments sont ses colonnes, on obtient le même résultat avec :</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="18-purrr.html#cb1026-1"></a><span class="kw">pwalk</span>(</span>
<span id="cb1026-2"><a href="18-purrr.html#cb1026-2"></a>    nuages,</span>
<span id="cb1026-3"><a href="18-purrr.html#cb1026-3"></a>    <span class="cf">function</span>(var1, var2, titre) {</span>
<span id="cb1026-4"><a href="18-purrr.html#cb1026-4"></a>        <span class="kw">plot</span>(</span>
<span id="cb1026-5"><a href="18-purrr.html#cb1026-5"></a>            rp2012[[var1]], rp2012[[var2]],</span>
<span id="cb1026-6"><a href="18-purrr.html#cb1026-6"></a>            <span class="dt">xlab =</span> var1, <span class="dt">ylab =</span> var2, <span class="dt">main =</span> titre</span>
<span id="cb1026-7"><a href="18-purrr.html#cb1026-7"></a>        )</span>
<span id="cb1026-8"><a href="18-purrr.html#cb1026-8"></a>    }</span>
<span id="cb1026-9"><a href="18-purrr.html#cb1026-9"></a>)</span></code></pre></div>
<p>On peut utiliser la syntaxe “formule” pour la fonction anonyme, dans ce cas les arguments sont accessibles avec la notation <code>..1</code>, <code>..2</code>, etc. On notera que dans ce cas la syntaxe “formule” est sans doute moins lisible que la syntaxe classique avec <code>function()</code> qui permet de nommer les paramètres.</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="18-purrr.html#cb1027-1"></a><span class="kw">pwalk</span>(</span>
<span id="cb1027-2"><a href="18-purrr.html#cb1027-2"></a>    nuages,</span>
<span id="cb1027-3"><a href="18-purrr.html#cb1027-3"></a>    <span class="op">~</span><span class="st"> </span>{</span>
<span id="cb1027-4"><a href="18-purrr.html#cb1027-4"></a>        <span class="kw">plot</span>(</span>
<span id="cb1027-5"><a href="18-purrr.html#cb1027-5"></a>            rp2012[[..<span class="dv">1</span>]], rp2012[[..<span class="dv">2</span>]],</span>
<span id="cb1027-6"><a href="18-purrr.html#cb1027-6"></a>            <span class="dt">xlab =</span> ..<span class="dv">1</span>, <span class="dt">ylab =</span> ..<span class="dv">2</span>, <span class="dt">main =</span> ..<span class="dv">3</span></span>
<span id="cb1027-7"><a href="18-purrr.html#cb1027-7"></a>        )</span>
<span id="cb1027-8"><a href="18-purrr.html#cb1027-8"></a>    }</span>
<span id="cb1027-9"><a href="18-purrr.html#cb1027-9"></a>)</span></code></pre></div>
<p>Comme pour <code>map()</code> et <code>map2()</code>, <code>pmap()</code> propose aussi les variantes <code>pmap_int()</code>, <code>pmap_chr()</code>, etc.</p>
</div>
<div id="répéter-une-opération" class="section level2">
<h2><span class="header-section-number">18.8</span> Répéter une opération</h2>
<p>Les fonctions de <code>purrr</code> peuvent être utilisées quand on souhaite juste répéter une opération un certain nombre de fois, à la place d’une boucle <code>for</code>.</p>
<p>Par exemple si on souhaite générer 10 vecteurs de 100 nombre aléatoires, on pourra remplacer la boucle suivante :</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="18-purrr.html#cb1028-1"></a>res &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb1028-2"><a href="18-purrr.html#cb1028-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) {</span>
<span id="cb1028-3"><a href="18-purrr.html#cb1028-3"></a>    res &lt;-<span class="st"> </span><span class="kw">c</span>(res, <span class="kw">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb1028-4"><a href="18-purrr.html#cb1028-4"></a>}</span></code></pre></div>
<p>Par un appel à <code>map()</code> :</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="18-purrr.html#cb1029-1"></a>res &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>))</span></code></pre></div>
<p>Ce qui donne un code un peu plus compact et plus lisible.</p>
<div class="rmdnote">
<p>
De la même manière, si on s’intéresse juste aux effets de bord, on pourra éventuellement remplacer une boucle <code>for</code> par un appel à <code>walk()</code>.
</p>
</div>
</div>
<div id="quand-ne-pas-utiliser-map" class="section level2">
<h2><span class="header-section-number">18.9</span> Quand (ne pas) utiliser <code>map</code></h2>
<p>Une fois qu’on a compris la logique de <code>map()</code> et de ses variantes, on peut être tenté.es de l’appliquer un peu systématiquement. Il faut cependant garder en tête que son usage n’est pas toujours conseillé notamment dans les cas où il existe déjà une fonction vectorisée qui permet d’obtenir le même résultat.</p>
<p>Ainsi cela n’aurait pas de sens de faire :</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="18-purrr.html#cb1030-1"></a>v &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb1030-2"><a href="18-purrr.html#cb1030-2"></a><span class="kw">map_dbl</span>(v, <span class="op">~</span><span class="st"> </span>.x <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb1030-3"><a href="18-purrr.html#cb1030-3"></a><span class="co">#&gt; [1] 11 12 13 14 15</span></span></code></pre></div>
<p>Quand on peut simplement faire :</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="18-purrr.html#cb1031-1"></a>v <span class="op">+</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb1031-2"><a href="18-purrr.html#cb1031-2"></a><span class="co">#&gt; [1] 11 12 13 14 15</span></span></code></pre></div>
<p>Pour prendre un exemple un peu moins caricatural, de nombreuses fonctions de <code>stringr</code> sont vectorisées, il n’est donc pas utile de faire :</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="18-purrr.html#cb1032-1"></a>textes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fantastique&quot;</span>, <span class="st">&quot;effectivement&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</span>
<span id="cb1032-2"><a href="18-purrr.html#cb1032-2"></a><span class="kw">map_int</span>(textes, <span class="op">~</span><span class="st"> </span><span class="kw">str_count</span>(.x, <span class="st">&quot;f&quot;</span>))</span>
<span id="cb1032-3"><a href="18-purrr.html#cb1032-3"></a><span class="co">#&gt; [1] 1 2 0</span></span></code></pre></div>
<p>Quand on peut faire simplement :</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="18-purrr.html#cb1033-1"></a><span class="kw">str_count</span>(textes, <span class="st">&quot;f&quot;</span>)</span>
<span id="cb1033-2"><a href="18-purrr.html#cb1033-2"></a><span class="co">#&gt; [1] 1 2 0</span></span></code></pre></div>
<p>Par contre <code>map()</code> est utile quand on souhaite appliquer une fonction qui n’est pas vectorisée à plusieurs valeurs, comme c’est le cas par exemple avec <code>read_csv()</code>, qui ne permet pas de charger plusieurs fichiers d’un coup :</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="18-purrr.html#cb1034-1"></a>fichiers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fichier1.csv&quot;</span>, <span class="st">&quot;fichier2.csv&quot;</span>)</span>
<span id="cb1034-2"><a href="18-purrr.html#cb1034-2"></a>l &lt;-<span class="st"> </span>fichiers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_csv)</span></code></pre></div>
<p>Ou quand on veut itérer sur un argument non vectorisé, par exemple ici sur l’argument <code>pattern</code> de <code>str_count()</code> :</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="18-purrr.html#cb1035-1"></a>voyelle &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">e =</span> <span class="st">&quot;e&quot;</span>, <span class="dt">i =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb1035-2"><a href="18-purrr.html#cb1035-2"></a>textes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</span>
<span id="cb1035-3"><a href="18-purrr.html#cb1035-3"></a>voyelle <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_count</span>(textes, <span class="dt">pattern =</span> .x))</span>
<span id="cb1035-4"><a href="18-purrr.html#cb1035-4"></a><span class="co">#&gt; $a</span></span>
<span id="cb1035-5"><a href="18-purrr.html#cb1035-5"></a><span class="co">#&gt; [1] 0 0 0</span></span>
<span id="cb1035-6"><a href="18-purrr.html#cb1035-6"></a><span class="co">#&gt; </span></span>
<span id="cb1035-7"><a href="18-purrr.html#cb1035-7"></a><span class="co">#&gt; $e</span></span>
<span id="cb1035-8"><a href="18-purrr.html#cb1035-8"></a><span class="co">#&gt; [1] 2 0 0</span></span>
<span id="cb1035-9"><a href="18-purrr.html#cb1035-9"></a><span class="co">#&gt; </span></span>
<span id="cb1035-10"><a href="18-purrr.html#cb1035-10"></a><span class="co">#&gt; $i</span></span>
<span id="cb1035-11"><a href="18-purrr.html#cb1035-11"></a><span class="co">#&gt; [1] 0 0 1</span></span></code></pre></div>
<p>On l’utilise également quand on veut appliquer une fonction non pas à une liste, mais aux éléments qu’elle contient :</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="18-purrr.html#cb1036-1"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>))</span>
<span id="cb1036-2"><a href="18-purrr.html#cb1036-2"></a>l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</span>
<span id="cb1036-3"><a href="18-purrr.html#cb1036-3"></a><span class="co">#&gt; [1] 3 2</span></span></code></pre></div>
<p>À noter qu’en termes de performance, <code>map()</code> n’est pas forcément plus rapide qu’une boucle <code>for</code>, puisque dans les deux cas on itère sur un ensemble de valeurs. Par contre une fonction vectorisée existante sera toujours (beaucoup) plus rapide.</p>
</div>
<div id="purrr-vs-apply" class="section level2">
<h2><span class="header-section-number">18.10</span> <code>purrr</code> vs <code>*apply</code></h2>
<p>Les fonctions de <code>purrr</code> ont des équivalents dans R “de base”, ce sont notamment les fonctions de la famille <code>apply</code> : <code>lapply</code>, <code>sapply</code>, <code>mapply</code>…</p>
<p>L’avantage de <code>map()</code> et des autres fonctions fournies par <code>purrr</code> et qu’elles sont plus explicites : on a des fonctions différentes selon qu’on veut seulement appliquer une fonction (<code>map()</code>), générer des effets de bord (<code>walk</code>), modifier une liste sans changer son type (<code>modify()</code>), etc. <code>purrr</code> propose également de nombreuses fonctions utiles qui facilite le travail avec les vecteurs et listes.</p>
<p>Mais un des avantages principaux des fonctions de la famille <code>map()</code> est qu’elles sont consistantes et cohérentes dans le type de résultat qu’elles retournent : on est certain que <code>map()</code> ou <code>imap()</code> retourneront une liste, que <code>map_chr()</code> ou <code>map2_chr()</code> retourneront un vecteur de chaînes de caractères, etc.</p>
<p>Là encore, il n’est pas question de dire qu’il ne faut pas utiliser les fonctions <code>*apply</code>. Si vous en avez l’habitude et qu’elles fonctionnent pour vous, il n’y a pas spécialement de raison de changer. Mais si vous n’avez pas l’habitude de ce type d’opérations ou si vous préférez une syntaxe plus cohérente et plus facile à retenir, les fonctions de <code>purrr</code> peuvent être intéressantes.</p>
<p>Si vous souhaitez en savoir plus, l’ouvrage en ligne <em>R for data science</em> contient <a href="https://r4ds.had.co.nz/iteration.html#base-r">une comparaison plus détaillée</a> des deux familles de fonctions.</p>
</div>
<div id="ressources-9" class="section level2">
<h2><span class="header-section-number">18.11</span> Ressources</h2>
<p>Au-delà de celles présentées ici, <code>purrr</code> propose de nombreuses autres fonctions facilitant la manipulation et les itérations sur les listes et les vecteurs. On peut en trouver la <a href="https://purrr.tidyverse.org/reference/index.html">liste complète</a> et la documentation associée (en anglais) sur <a href="https://purrr.tidyverse.org">le site de l’extension</a>.</p>
<p>La section <em>Iteration</em> de l’ouvrage en ligne <em>R for data science</em> (en anglais) propose <a href="https://r4ds.had.co.nz/iteration.html#the-map-functions">une présentation de plusieurs fonctions de purrr</a>.</p>
<p>RStudio propose une <a href="https://github.com/rstudio/cheatsheets/blob/master/purrr.pdf">antisèche</a> (en anglais, format PDF) qui résume les différentes fonctions de <code>purrr</code>.</p>
<p>Sur le blog en français de Lise Vaudor, on trouvera un billet <a href="https://perso.ens-lyon.fr/lise.vaudor/iterer-des-fonctions-avec-purrr/">Itérer des fonctions avec purrr</a> et une suite <a href="https://perso.ens-lyon.fr/lise.vaudor/practice-makes-purrr-fect/">practice makes purrr-fect</a>.</p>
</div>
<div id="exercices-11" class="section level2">
<h2><span class="header-section-number">18.12</span> Exercices</h2>
<div id="map-et-ses-variantes-1" class="section level3">
<h3><span class="header-section-number">18.12.1</span> <code>map</code> et ses variantes</h3>
<p><strong>Exercice 1.1</strong></p>
<p>La liste suivante rassemble les notes obtenues par un élève dans différentes matières.</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="18-purrr.html#cb1037-1"></a>notes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1037-2"><a href="18-purrr.html#cb1037-2"></a>    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</span>
<span id="cb1037-3"><a href="18-purrr.html#cb1037-3"></a>    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</span>
<span id="cb1037-4"><a href="18-purrr.html#cb1037-4"></a>    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</span>
<span id="cb1037-5"><a href="18-purrr.html#cb1037-5"></a>    <span class="dt">musique =</span> <span class="dv">14</span></span>
<span id="cb1037-6"><a href="18-purrr.html#cb1037-6"></a>)</span></code></pre></div>
<p>En utilisant <code>map()</code>, calculer une liste indiquant la moyenne dans chaque matière.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="18-purrr.html#cb1038-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(mean)</span></code></pre></div>
</div>

<p>En utilisant une variante de <code>map()</code>, simplifier le résultat pour obtenir un vecteur numérique.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="18-purrr.html#cb1039-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean)</span></code></pre></div>
</div>

<p>On a rajouté à la liste les notes obtenues en technologie, parmi lesquelles une note est manquante.</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="18-purrr.html#cb1040-1"></a>notes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1040-2"><a href="18-purrr.html#cb1040-2"></a>    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</span>
<span id="cb1040-3"><a href="18-purrr.html#cb1040-3"></a>    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</span>
<span id="cb1040-4"><a href="18-purrr.html#cb1040-4"></a>    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</span>
<span id="cb1040-5"><a href="18-purrr.html#cb1040-5"></a>    <span class="dt">musique =</span> <span class="dv">14</span>,</span>
<span id="cb1040-6"><a href="18-purrr.html#cb1040-6"></a>    <span class="dt">techno =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="ot">NA</span>)</span>
<span id="cb1040-7"><a href="18-purrr.html#cb1040-7"></a>)</span></code></pre></div>
<p>Calculer à nouveau un vecteur numérique des moyennes par matière, mais sans tenir compte de la valeur manquante.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="18-purrr.html#cb1041-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) )</span>
<span id="cb1041-2"><a href="18-purrr.html#cb1041-2"></a><span class="co"># Ou bien</span></span>
<span id="cb1041-3"><a href="18-purrr.html#cb1041-3"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>

<p>Calculer une liste qui contient pour chaque matière le nombre de notes, leur moyenne et leur écart-type.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="18-purrr.html#cb1042-1"></a><span class="co"># On peut aussi utiliser list() plutôt que c()</span></span>
<span id="cb1042-2"><a href="18-purrr.html#cb1042-2"></a>notes <span class="op">%&gt;%</span></span>
<span id="cb1042-3"><a href="18-purrr.html#cb1042-3"></a><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1042-4"><a href="18-purrr.html#cb1042-4"></a>            <span class="dt">nb_notes =</span> <span class="kw">length</span>(.x),</span>
<span id="cb1042-5"><a href="18-purrr.html#cb1042-5"></a>            <span class="dt">moyenne =</span> <span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1042-6"><a href="18-purrr.html#cb1042-6"></a>            <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1042-7"><a href="18-purrr.html#cb1042-7"></a>        )</span>
<span id="cb1042-8"><a href="18-purrr.html#cb1042-8"></a>    )</span></code></pre></div>
</div>

<p><strong>Exercice 1.2</strong></p>
<p>La liste suivante comporte les parcours biographiques de 5 personnes sous la forme de vecteurs indiquant leurs communes de résidence successives.</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="18-purrr.html#cb1043-1"></a>parcours &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1043-2"><a href="18-purrr.html#cb1043-2"></a>    <span class="kw">c</span>(<span class="st">&quot;Lyon&quot;</span>, <span class="st">&quot;Flixevile&quot;</span>, <span class="st">&quot;Saint-Dié-en-Pouilly&quot;</span>),</span>
<span id="cb1043-3"><a href="18-purrr.html#cb1043-3"></a>    <span class="kw">c</span>(<span class="st">&quot;Sainte-Gabelle-sur-Sarthe&quot;</span>),</span>
<span id="cb1043-4"><a href="18-purrr.html#cb1043-4"></a>    <span class="kw">c</span>(<span class="st">&quot;Décines&quot;</span>, <span class="st">&quot;Meyzieu&quot;</span>, <span class="st">&quot;Demptezieu&quot;</span>),</span>
<span id="cb1043-5"><a href="18-purrr.html#cb1043-5"></a>    <span class="kw">c</span>(<span class="st">&quot;Meyzieu&quot;</span>, <span class="st">&quot;Lyon&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Flixevile&quot;</span>, <span class="st">&quot;Lyon&quot;</span>),</span>
<span id="cb1043-6"><a href="18-purrr.html#cb1043-6"></a>    <span class="kw">c</span>(<span class="st">&quot;La Bâtie-Divisin&quot;</span>, <span class="st">&quot;Versailles&quot;</span>)</span>
<span id="cb1043-7"><a href="18-purrr.html#cb1043-7"></a>)</span></code></pre></div>
<p>À l’aide de <code>map()</code>, calculer une nouvelle liste comportant le nombre de villes de résidence pour chaque parcours.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="18-purrr.html#cb1044-1"></a>parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(length)</span></code></pre></div>
</div>

<p>Utiliser une variante de <code>map()</code> pour simplifier le résultat et obtenir un vecteur numérique plutôt qu’une liste.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="18-purrr.html#cb1045-1"></a>parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</span></code></pre></div>
</div>

<p>Déterminer pour chaque parcours le nombre de fois où la personne a résidé à Lyon.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="18-purrr.html#cb1046-1"></a>parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x <span class="op">==</span><span class="st"> &quot;Lyon&quot;</span>))</span></code></pre></div>
</div>

<p>L’équipe chargée de l’enquête vient de repérer une erreur de saisie : “Flixevile” s’écrit en réalité “Flixeville”. Utiliser <code>map()</code> pour corriger la liste <code>parcours</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="18-purrr.html#cb1047-1"></a>parcours &lt;-<span class="st"> </span>parcours <span class="op">%&gt;%</span></span>
<span id="cb1047-2"><a href="18-purrr.html#cb1047-2"></a><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> &quot;Flixevile&quot;</span>, <span class="st">&quot;Flixeville&quot;</span>, .x))</span>
<span id="cb1047-3"><a href="18-purrr.html#cb1047-3"></a><span class="co"># Ou bien</span></span>
<span id="cb1047-4"><a href="18-purrr.html#cb1047-4"></a>parcours &lt;-<span class="st"> </span>parcours <span class="op">%&gt;%</span></span>
<span id="cb1047-5"><a href="18-purrr.html#cb1047-5"></a><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_replace</span>(.x, <span class="st">&quot;Flixevile&quot;</span>, <span class="st">&quot;Flixeville&quot;</span>))</span></code></pre></div>
</div>

<p><strong>Exercice 1.3</strong></p>
<p>Le vecteur suivant contient les adresses de deux fichiers CSV contenant les données de <code>rp2012</code> pour les départements de l’Ain et du Rhône :</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="18-purrr.html#cb1048-1"></a>urls &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1048-2"><a href="18-purrr.html#cb1048-2"></a>    <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_01.csv&quot;</span>,</span>
<span id="cb1048-3"><a href="18-purrr.html#cb1048-3"></a>    <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/main/resources/data/rp2012/rp2012_69.csv&quot;</span></span>
<span id="cb1048-4"><a href="18-purrr.html#cb1048-4"></a>)</span></code></pre></div>
<p>Utiliser <code>map()</code> pour charger ces deux tableaux de données dans une liste nommée <code>dfs</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="18-purrr.html#cb1049-1"></a>dfs &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_csv)</span></code></pre></div>
</div>

<p>Utiliser <code>map_dfr()</code> pour charger ces deux tableaux de données et les regrouper en une seule table <code>d</code>. Que constatez-vous ?</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="18-purrr.html#cb1050-1"></a><span class="co"># Génère une erreur !</span></span>
<span id="cb1050-2"><a href="18-purrr.html#cb1050-2"></a>d &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(read_csv)</span></code></pre></div>
</div>

<p>À l’aide de <code>map()</code>, afficher la variable <code>code_insee</code> des deux tableaux de <code>dfs</code>. D’où vient le problème ?</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="18-purrr.html#cb1051-1"></a><span class="co"># Une variable a été importée en character, l&#39;autre en numérique</span></span>
<span id="cb1051-2"><a href="18-purrr.html#cb1051-2"></a>dfs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>.x<span class="op">$</span>code_insee)</span></code></pre></div>
</div>

<p>Trouver une solution pour corriger le problème.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="18-purrr.html#cb1052-1"></a><span class="co"># En convertissant manuellement code_insee en character</span></span>
<span id="cb1052-2"><a href="18-purrr.html#cb1052-2"></a>d &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1052-3"><a href="18-purrr.html#cb1052-3"></a><span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span>{</span>
<span id="cb1052-4"><a href="18-purrr.html#cb1052-4"></a>        tab &lt;-<span class="st"> </span><span class="kw">read_csv</span>(.x)</span>
<span id="cb1052-5"><a href="18-purrr.html#cb1052-5"></a>        tab<span class="op">$</span>code_insee &lt;-<span class="st"> </span><span class="kw">as.character</span>(tab<span class="op">$</span>code_insee)</span>
<span id="cb1052-6"><a href="18-purrr.html#cb1052-6"></a>        tab</span>
<span id="cb1052-7"><a href="18-purrr.html#cb1052-7"></a>    })</span>
<span id="cb1052-8"><a href="18-purrr.html#cb1052-8"></a></span>
<span id="cb1052-9"><a href="18-purrr.html#cb1052-9"></a><span class="co"># Ou bien en utilisant l&#39;option col_types de read_csv</span></span>
<span id="cb1052-10"><a href="18-purrr.html#cb1052-10"></a>d &lt;-<span class="st"> </span>urls <span class="op">%&gt;%</span></span>
<span id="cb1052-11"><a href="18-purrr.html#cb1052-11"></a><span class="st">    </span><span class="kw">map_dfr</span>(read_csv, <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">&quot;code_insee&quot;</span> =<span class="st"> &quot;character&quot;</span>))</span></code></pre></div>
</div>

</div>
<div id="modify-et-itération-sur-les-colonnes-dun-tableau" class="section level3">
<h3><span class="header-section-number">18.12.2</span> <code>modify</code> et itération sur les colonnes d’un tableau</h3>
<p><strong>Exercice 2.1</strong></p>
<p>Soit le tableau de données <code>d</code> suivant :</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="18-purrr.html#cb1053-1"></a>d &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1053-2"><a href="18-purrr.html#cb1053-2"></a>    <span class="op">~</span>prenom,              <span class="op">~</span>nom,                <span class="op">~</span>age, <span class="op">~</span>taille,</span>
<span id="cb1053-3"><a href="18-purrr.html#cb1053-3"></a>    <span class="st">&quot;pierre-edmond&quot;</span>,      <span class="st">&quot;rateau&quot;</span>,            <span class="dv">19</span>,   <span class="dv">151</span>,</span>
<span id="cb1053-4"><a href="18-purrr.html#cb1053-4"></a>    <span class="st">&quot;YVONNE&quot;</span>,             <span class="st">&quot;de la grappinière&quot;</span>, <span class="dv">73</span>,   <span class="dv">182</span>,</span>
<span id="cb1053-5"><a href="18-purrr.html#cb1053-5"></a>    <span class="st">&quot;charlotte-adélaïde&quot;</span>, <span class="st">&quot;QUIGNON&quot;</span>,           <span class="dv">27</span>,   <span class="ot">NA</span></span>
<span id="cb1053-6"><a href="18-purrr.html#cb1053-6"></a>)</span></code></pre></div>
<p>Utliser <code>typeof()</code> et <code>map()</code> pour afficher le type de toutes les colonnes de <code>d</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="18-purrr.html#cb1054-1"></a>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(typeof)</span></code></pre></div>
</div>

<p>En utilisant <code>keep()</code> et <code>map()</code>, calculer la moyenne de toutes les variables numériques de <code>d</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="18-purrr.html#cb1055-1"></a>d <span class="op">%&gt;%</span></span>
<span id="cb1055-2"><a href="18-purrr.html#cb1055-2"></a><span class="st">    </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span></span>
<span id="cb1055-3"><a href="18-purrr.html#cb1055-3"></a><span class="st">    </span><span class="kw">map</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>

<p>En utilisant <code>modify_if()</code>, appliquer <code>str_to_title()</code> à toutes les colonnes de type <code>character</code> pour corriger la capitalisation des noms et prénoms.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="18-purrr.html#cb1056-1"></a>d &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify_if</span>(is.character, str_to_title)</span></code></pre></div>
</div>

<p>À l’aide de la fonction <code>discard()</code>, supprimer de <code>d</code> les colonnes qui comportent des <code>NA</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="18-purrr.html#cb1057-1"></a>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1057-2"><a href="18-purrr.html#cb1057-2"></a><span class="co"># Ou bien</span></span>
<span id="cb1057-3"><a href="18-purrr.html#cb1057-3"></a>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(.x)))</span></code></pre></div>
</div>

</div>
<div id="imap-et-walk" class="section level3">
<h3><span class="header-section-number">18.12.3</span> <code>imap</code> et <code>walk</code></h3>
<p><strong>Exercice 3.1</strong></p>
<p>On reprend la liste de notes vue dans un exercice précédent.</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="18-purrr.html#cb1058-1"></a>notes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1058-2"><a href="18-purrr.html#cb1058-2"></a>    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</span>
<span id="cb1058-3"><a href="18-purrr.html#cb1058-3"></a>    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</span>
<span id="cb1058-4"><a href="18-purrr.html#cb1058-4"></a>    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</span>
<span id="cb1058-5"><a href="18-purrr.html#cb1058-5"></a>    <span class="dt">musique =</span> <span class="dv">14</span>,</span>
<span id="cb1058-6"><a href="18-purrr.html#cb1058-6"></a>    <span class="dt">techno =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="ot">NA</span>)</span>
<span id="cb1058-7"><a href="18-purrr.html#cb1058-7"></a>)</span></code></pre></div>
<p>Sans utiliser de boucle <code>for</code>, afficher avec la fonction <code>message()</code> les valeurs de chaque moyenne tour à tour de manière à obtenir le résultat suivant :</p>
<pre><code>#&gt; 11.25
#&gt; 12.6666666666667
#&gt; 9
#&gt; 14
#&gt; 12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="18-purrr.html#cb1060-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(<span class="op">~</span><span class="st"> </span><span class="kw">message</span>(<span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span></code></pre></div>
</div>

<p>De la même manière afficher pour chaque matière les messages suivants :</p>
<pre><code>#&gt; Votre moyenne en maths est 11.25
#&gt; Votre moyenne en anglais est 12.6666666666667
#&gt; Votre moyenne en sport est 9
#&gt; Votre moyenne en musique est 14
#&gt; Votre moyenne en techno est 12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="18-purrr.html#cb1062-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">iwalk</span>(<span class="cf">function</span>(notes, matiere) {</span>
<span id="cb1062-2"><a href="18-purrr.html#cb1062-2"></a>    <span class="kw">message</span>(<span class="st">&quot;Votre moyenne en &quot;</span>, matiere, <span class="st">&quot; est &quot;</span>, <span class="kw">mean</span>(notes, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1062-3"><a href="18-purrr.html#cb1062-3"></a>})</span></code></pre></div>
</div>

<p>Construire un tableau de données avec une matière par ligne et deux colonnes contenant le nom de la matière et la valeur de la moyenne.</p>
<pre><code>#&gt; # A tibble: 5 × 2
#&gt;   matiere moyenne
#&gt;   &lt;chr&gt;     &lt;dbl&gt;
#&gt; 1 maths      11.2
#&gt; 2 anglais    12.7
#&gt; 3 sport       9  
#&gt; 4 musique    14  
#&gt; 5 techno     12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="18-purrr.html#cb1064-1"></a>notes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1064-2"><a href="18-purrr.html#cb1064-2"></a><span class="st">    </span><span class="kw">imap_dfr</span>(<span class="cf">function</span>(notes, matiere) {</span>
<span id="cb1064-3"><a href="18-purrr.html#cb1064-3"></a>        <span class="kw">tibble</span>(</span>
<span id="cb1064-4"><a href="18-purrr.html#cb1064-4"></a>            <span class="dt">matiere =</span> matiere,</span>
<span id="cb1064-5"><a href="18-purrr.html#cb1064-5"></a>            <span class="dt">moyenne =</span> <span class="kw">mean</span>(notes, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1064-6"><a href="18-purrr.html#cb1064-6"></a>        )</span>
<span id="cb1064-7"><a href="18-purrr.html#cb1064-7"></a>    })</span></code></pre></div>
</div>

<p><strong>Exercice 3.2</strong></p>
<p>Lors de la présentation des boucles <code>for</code>, on a vu la fonction suivante qui affiche les dimensions de chaque tableau de données contenu dans une liste.</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="18-purrr.html#cb1065-1"></a>affiche_dimensions &lt;-<span class="st"> </span><span class="cf">function</span>(dfs) {</span>
<span id="cb1065-2"><a href="18-purrr.html#cb1065-2"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(dfs)) {</span>
<span id="cb1065-3"><a href="18-purrr.html#cb1065-3"></a>        name &lt;-<span class="st"> </span><span class="kw">names</span>(dfs)[[i]]</span>
<span id="cb1065-4"><a href="18-purrr.html#cb1065-4"></a>        df &lt;-<span class="st"> </span>dfs[[i]]</span>
<span id="cb1065-5"><a href="18-purrr.html#cb1065-5"></a>        <span class="kw">message</span>(<span class="st">&quot;Dimensions de &quot;</span>, name, <span class="st">&quot; : &quot;</span>, <span class="kw">nrow</span>(df), <span class="st">&quot;x&quot;</span>, <span class="kw">ncol</span>(df))</span>
<span id="cb1065-6"><a href="18-purrr.html#cb1065-6"></a>    }</span>
<span id="cb1065-7"><a href="18-purrr.html#cb1065-7"></a>}</span>
<span id="cb1065-8"><a href="18-purrr.html#cb1065-8"></a></span>
<span id="cb1065-9"><a href="18-purrr.html#cb1065-9"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1065-10"><a href="18-purrr.html#cb1065-10"></a>    <span class="dt">hdv =</span> hdv2003,</span>
<span id="cb1065-11"><a href="18-purrr.html#cb1065-11"></a>    <span class="dt">rp =</span> rp2012</span>
<span id="cb1065-12"><a href="18-purrr.html#cb1065-12"></a>)</span>
<span id="cb1065-13"><a href="18-purrr.html#cb1065-13"></a></span>
<span id="cb1065-14"><a href="18-purrr.html#cb1065-14"></a><span class="kw">affiche_dimensions</span>(l)</span>
<span id="cb1065-15"><a href="18-purrr.html#cb1065-15"></a><span class="co">#&gt; Dimensions de hdv : 2000x20</span></span>
<span id="cb1065-16"><a href="18-purrr.html#cb1065-16"></a><span class="co">#&gt; Dimensions de rp : 5170x60</span></span></code></pre></div>
<p>Réécrire <code>affiche_dimensions()</code> en utilisant <code>iwalk()</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="18-purrr.html#cb1066-1"></a>affiche_dimensions &lt;-<span class="st"> </span><span class="cf">function</span>(dfs) {</span>
<span id="cb1066-2"><a href="18-purrr.html#cb1066-2"></a>    <span class="kw">iwalk</span>(dfs, <span class="cf">function</span>(df, name) {</span>
<span id="cb1066-3"><a href="18-purrr.html#cb1066-3"></a>        <span class="kw">message</span>(<span class="st">&quot;Dimensions de &quot;</span>, name, <span class="st">&quot; : &quot;</span>, <span class="kw">nrow</span>(df), <span class="st">&quot;x&quot;</span>, <span class="kw">ncol</span>(df))</span>
<span id="cb1066-4"><a href="18-purrr.html#cb1066-4"></a>    })</span>
<span id="cb1066-5"><a href="18-purrr.html#cb1066-5"></a>}</span></code></pre></div>
</div>

<p><strong>Exercice 3.3</strong></p>
<p>Lors de la présentation des boucles, on a vu la fonction <code>summaries</code> suivante, qui prend en paramètre un tableau de données et une liste de noms de colonnes, et applique la fonction <code>summary()</code> à ces colonnes.</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="18-purrr.html#cb1067-1"></a>summaries &lt;-<span class="st"> </span><span class="cf">function</span>(d, vars) {</span>
<span id="cb1067-2"><a href="18-purrr.html#cb1067-2"></a>    <span class="cf">for</span> (var <span class="cf">in</span> vars) {</span>
<span id="cb1067-3"><a href="18-purrr.html#cb1067-3"></a>        <span class="kw">message</span>(<span class="st">&quot;--- &quot;</span>, var, <span class="st">&quot; ---&quot;</span>)</span>
<span id="cb1067-4"><a href="18-purrr.html#cb1067-4"></a>        <span class="kw">print</span>(<span class="kw">summary</span>(d[, var]))</span>
<span id="cb1067-5"><a href="18-purrr.html#cb1067-5"></a>    }</span>
<span id="cb1067-6"><a href="18-purrr.html#cb1067-6"></a>}</span>
<span id="cb1067-7"><a href="18-purrr.html#cb1067-7"></a></span>
<span id="cb1067-8"><a href="18-purrr.html#cb1067-8"></a><span class="kw">summaries</span>(hdv2003, <span class="kw">c</span>(<span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;age&quot;</span>))</span></code></pre></div>
<p>Réécrire la fonction sans utiliser de boucle <code>for</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="18-purrr.html#cb1068-1"></a>summaries &lt;-<span class="st"> </span><span class="cf">function</span>(d, vars) {</span>
<span id="cb1068-2"><a href="18-purrr.html#cb1068-2"></a>    vars <span class="op">%&gt;%</span></span>
<span id="cb1068-3"><a href="18-purrr.html#cb1068-3"></a><span class="st">        </span><span class="kw">walk</span>(<span class="op">~</span>{</span>
<span id="cb1068-4"><a href="18-purrr.html#cb1068-4"></a>            <span class="kw">message</span>(<span class="st">&quot;--- &quot;</span>, .x, <span class="st">&quot; ---&quot;</span>)</span>
<span id="cb1068-5"><a href="18-purrr.html#cb1068-5"></a>            <span class="kw">print</span>(<span class="kw">summary</span>(d[, .x]))</span>
<span id="cb1068-6"><a href="18-purrr.html#cb1068-6"></a>        })</span>
<span id="cb1068-7"><a href="18-purrr.html#cb1068-7"></a>}</span></code></pre></div>
</div>

<p>Modifier cette nouvelle fonction en utilisant <code>keep()</code> ou <code>discard()</code>, pour qu’elle fonctionne sans erreur même si l’une des variables passées en arguments n’existe pas.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="18-purrr.html#cb1069-1"></a><span class="kw">summaries</span>(hdv2003, <span class="kw">c</span>(<span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;igloo&quot;</span>, <span class="st">&quot;age&quot;</span>))</span>
<span id="cb1069-2"><a href="18-purrr.html#cb1069-2"></a><span class="co">#&gt; --- sexe ---</span></span>
<span id="cb1069-3"><a href="18-purrr.html#cb1069-3"></a><span class="co">#&gt;     sexe     </span></span>
<span id="cb1069-4"><a href="18-purrr.html#cb1069-4"></a><span class="co">#&gt;  Homme: 899  </span></span>
<span id="cb1069-5"><a href="18-purrr.html#cb1069-5"></a><span class="co">#&gt;  Femme:1101</span></span>
<span id="cb1069-6"><a href="18-purrr.html#cb1069-6"></a><span class="co">#&gt; --- age ---</span></span>
<span id="cb1069-7"><a href="18-purrr.html#cb1069-7"></a><span class="co">#&gt;       age       </span></span>
<span id="cb1069-8"><a href="18-purrr.html#cb1069-8"></a><span class="co">#&gt;  Min.   :18.00  </span></span>
<span id="cb1069-9"><a href="18-purrr.html#cb1069-9"></a><span class="co">#&gt;  1st Qu.:35.00  </span></span>
<span id="cb1069-10"><a href="18-purrr.html#cb1069-10"></a><span class="co">#&gt;  Median :48.00  </span></span>
<span id="cb1069-11"><a href="18-purrr.html#cb1069-11"></a><span class="co">#&gt;  Mean   :48.16  </span></span>
<span id="cb1069-12"><a href="18-purrr.html#cb1069-12"></a><span class="co">#&gt;  3rd Qu.:60.00  </span></span>
<span id="cb1069-13"><a href="18-purrr.html#cb1069-13"></a><span class="co">#&gt;  Max.   :97.00</span></span></code></pre></div>

<div class="solution-exo">
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="18-purrr.html#cb1070-1"></a>summaries &lt;-<span class="st"> </span><span class="cf">function</span>(d, vars) {</span>
<span id="cb1070-2"><a href="18-purrr.html#cb1070-2"></a>    vars <span class="op">%&gt;%</span></span>
<span id="cb1070-3"><a href="18-purrr.html#cb1070-3"></a><span class="st">        </span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span>.x <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(d) ) <span class="op">%&gt;%</span></span>
<span id="cb1070-4"><a href="18-purrr.html#cb1070-4"></a><span class="st">        </span><span class="kw">walk</span>(<span class="op">~</span>{</span>
<span id="cb1070-5"><a href="18-purrr.html#cb1070-5"></a>            <span class="kw">message</span>(<span class="st">&quot;--- &quot;</span>, .x, <span class="st">&quot; ---&quot;</span>)</span>
<span id="cb1070-6"><a href="18-purrr.html#cb1070-6"></a>            <span class="kw">print</span>(<span class="kw">summary</span>(d[, .x]))</span>
<span id="cb1070-7"><a href="18-purrr.html#cb1070-7"></a>        })</span>
<span id="cb1070-8"><a href="18-purrr.html#cb1070-8"></a>}</span></code></pre></div>
</div>

</div>
<div id="map2-et-pmap" class="section level3">
<h3><span class="header-section-number">18.12.4</span> <code>map2</code> et <code>pmap</code></h3>
<p><strong>Exercice 4.1</strong></p>
<p>Soit le tableau de données suivant, qui indique des couples de variables du jeu de données <code>hdv2003</code>.</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="18-purrr.html#cb1071-1"></a>croisements &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1071-2"><a href="18-purrr.html#cb1071-2"></a>    <span class="op">~</span>v1,      <span class="op">~</span>v2,</span>
<span id="cb1071-3"><a href="18-purrr.html#cb1071-3"></a>    <span class="st">&quot;qualif&quot;</span>, <span class="st">&quot;clso&quot;</span>,</span>
<span id="cb1071-4"><a href="18-purrr.html#cb1071-4"></a>    <span class="st">&quot;qualif&quot;</span>, <span class="st">&quot;cinema&quot;</span>,</span>
<span id="cb1071-5"><a href="18-purrr.html#cb1071-5"></a>    <span class="st">&quot;sexe&quot;</span>,   <span class="st">&quot;clso&quot;</span>,</span>
<span id="cb1071-6"><a href="18-purrr.html#cb1071-6"></a>    <span class="st">&quot;sexe&quot;</span>,   <span class="st">&quot;cinema&quot;</span></span>
<span id="cb1071-7"><a href="18-purrr.html#cb1071-7"></a>)</span>
<span id="cb1071-8"><a href="18-purrr.html#cb1071-8"></a></span>
<span id="cb1071-9"><a href="18-purrr.html#cb1071-9"></a>croisements</span>
<span id="cb1071-10"><a href="18-purrr.html#cb1071-10"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb1071-11"><a href="18-purrr.html#cb1071-11"></a><span class="co">#&gt;   v1     v2    </span></span>
<span id="cb1071-12"><a href="18-purrr.html#cb1071-12"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; </span></span>
<span id="cb1071-13"><a href="18-purrr.html#cb1071-13"></a><span class="co">#&gt; 1 qualif clso  </span></span>
<span id="cb1071-14"><a href="18-purrr.html#cb1071-14"></a><span class="co">#&gt; 2 qualif cinema</span></span>
<span id="cb1071-15"><a href="18-purrr.html#cb1071-15"></a><span class="co">#&gt; 3 sexe   clso  </span></span>
<span id="cb1071-16"><a href="18-purrr.html#cb1071-16"></a><span class="co">#&gt; 4 sexe   cinema</span></span></code></pre></div>
<p>À l’aide de <code>map2()</code>, calculer une liste qui contient les tableaux croisés des quatre couples de variables de <code>croisements</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="18-purrr.html#cb1072-1"></a><span class="kw">map2</span>(croisements<span class="op">$</span>v1, croisements<span class="op">$</span>v2,</span>
<span id="cb1072-2"><a href="18-purrr.html#cb1072-2"></a>    <span class="op">~</span><span class="kw">table</span>(hdv2003[[.x]], hdv2003[[.y]])</span>
<span id="cb1072-3"><a href="18-purrr.html#cb1072-3"></a>)</span></code></pre></div>
</div>

<p>Modifier le code précédent pour obtenir une liste comportant, pour chaque couple de variables :</p>
<ol style="list-style-type: decimal">
<li>les noms des deux variables croisées</li>
<li>le résultat du test du <span class="math inline">\(\chi^2\)</span> appliqué aux deux variables</li>
</ol>

<div class="solution-exo">
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="18-purrr.html#cb1073-1"></a>khi2 &lt;-<span class="st"> </span><span class="kw">map2</span>(croisements<span class="op">$</span>v1, croisements<span class="op">$</span>v2,</span>
<span id="cb1073-2"><a href="18-purrr.html#cb1073-2"></a>    <span class="op">~</span><span class="kw">list</span>(</span>
<span id="cb1073-3"><a href="18-purrr.html#cb1073-3"></a>        <span class="dt">variables =</span> <span class="kw">paste</span>(.x, .y),</span>
<span id="cb1073-4"><a href="18-purrr.html#cb1073-4"></a>        <span class="dt">chisq =</span> <span class="kw">chisq.test</span>(hdv2003[[.x]], hdv2003[[.y]])</span>
<span id="cb1073-5"><a href="18-purrr.html#cb1073-5"></a>    )</span>
<span id="cb1073-6"><a href="18-purrr.html#cb1073-6"></a>)</span></code></pre></div>
</div>

<p><em>Facultatif :</em> filtrer la liste obtenue à l’étape précédente pour ne conserver que les éléments dont la p-value du test du <span class="math inline">\(\chi^2\)</span> est inférieure à 0.001.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="18-purrr.html#cb1074-1"></a>khi2 &lt;-<span class="st"> </span><span class="kw">map2</span>(croisements<span class="op">$</span>v1, croisements<span class="op">$</span>v2,</span>
<span id="cb1074-2"><a href="18-purrr.html#cb1074-2"></a>    <span class="op">~</span><span class="kw">list</span>(</span>
<span id="cb1074-3"><a href="18-purrr.html#cb1074-3"></a>        <span class="dt">variables =</span> <span class="kw">paste</span>(.x, .y),</span>
<span id="cb1074-4"><a href="18-purrr.html#cb1074-4"></a>        <span class="dt">chisq =</span> <span class="kw">chisq.test</span>(hdv2003[[.x]], hdv2003[[.y]])</span>
<span id="cb1074-5"><a href="18-purrr.html#cb1074-5"></a>    )</span>
<span id="cb1074-6"><a href="18-purrr.html#cb1074-6"></a>) <span class="op">%&gt;%</span></span>
<span id="cb1074-7"><a href="18-purrr.html#cb1074-7"></a><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span>.x<span class="op">$</span>chisq<span class="op">$</span>p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.001</span>)</span></code></pre></div>
</div>

<p><strong>Exercice 4.2</strong></p>
<p>Pour rappel, on peut simuler un tirage au sort de type “pile ou face” avec la fonction <code>sample()</code> de la manière suivante :</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="18-purrr.html#cb1075-1"></a><span class="kw">sample</span>(</span>
<span id="cb1075-2"><a href="18-purrr.html#cb1075-2"></a>    <span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>),</span>
<span id="cb1075-3"><a href="18-purrr.html#cb1075-3"></a>    <span class="dt">size =</span> <span class="dv">10</span>,</span>
<span id="cb1075-4"><a href="18-purrr.html#cb1075-4"></a>    <span class="dt">replace =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1075-5"><a href="18-purrr.html#cb1075-5"></a>    <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb1075-6"><a href="18-purrr.html#cb1075-6"></a>)</span>
<span id="cb1075-7"><a href="18-purrr.html#cb1075-7"></a><span class="co">#&gt;  [1] &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot;</span></span></code></pre></div>
<p>Le tableau de données suivant définit trois types de tirages aléatoires différents. <code>elements</code> contient les éléments parmi lesquels on tire, <code>probas</code> les probabilités de chaque élément d’être tiré, et <code>n</code> le nombre de tirages.</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="18-purrr.html#cb1076-1"></a>tirages &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb1076-2"><a href="18-purrr.html#cb1076-2"></a>    <span class="op">~</span>elements,           <span class="op">~</span>probas,     <span class="op">~</span>n,</span>
<span id="cb1076-3"><a href="18-purrr.html#cb1076-3"></a>    <span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>),   <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dv">1000</span>,</span>
<span id="cb1076-4"><a href="18-purrr.html#cb1076-4"></a>    <span class="kw">c</span>(<span class="st">&quot;rouge&quot;</span>, <span class="st">&quot;noire&quot;</span>), <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="dv">500</span>,</span>
<span id="cb1076-5"><a href="18-purrr.html#cb1076-5"></a>    <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,                 <span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">6</span>), <span class="dv">800</span></span>
<span id="cb1076-6"><a href="18-purrr.html#cb1076-6"></a>)</span></code></pre></div>
<p>À l’aide de <code>pmap()</code> et de <code>sample()</code>, créer une liste contenant les résultats des simumations de ces trois séries de tirages.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="18-purrr.html#cb1077-1"></a>resultats &lt;-<span class="st"> </span>tirages <span class="op">%&gt;%</span></span>
<span id="cb1077-2"><a href="18-purrr.html#cb1077-2"></a><span class="st">    </span><span class="kw">pmap</span>(</span>
<span id="cb1077-3"><a href="18-purrr.html#cb1077-3"></a>        <span class="cf">function</span>(elements, probas, n) {</span>
<span id="cb1077-4"><a href="18-purrr.html#cb1077-4"></a>            <span class="kw">sample</span>(elements, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> probas)</span>
<span id="cb1077-5"><a href="18-purrr.html#cb1077-5"></a>        }</span>
<span id="cb1077-6"><a href="18-purrr.html#cb1077-6"></a>    )</span></code></pre></div>
</div>

<p>Représenter avec <code>barplot()</code> les résultats obtenus.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="18-purrr.html#cb1078-1"></a>resultats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(<span class="op">~</span><span class="kw">barplot</span>(<span class="kw">table</span>(.x)))</span></code></pre></div>
</div>

</div>
<div id="répéter-une-opération-1" class="section level3">
<h3><span class="header-section-number">18.12.5</span> Répéter une opération</h3>
<p><strong>Exercice 5.1</strong></p>
<p>La fonction suivante simule le lancer de <code>n</code> dés à 6 faces.</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="18-purrr.html#cb1079-1"></a>lancer_des &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</span>
<span id="cb1079-2"><a href="18-purrr.html#cb1079-2"></a>    <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1079-3"><a href="18-purrr.html#cb1079-3"></a>}</span>
<span id="cb1079-4"><a href="18-purrr.html#cb1079-4"></a></span>
<span id="cb1079-5"><a href="18-purrr.html#cb1079-5"></a><span class="kw">lancer_des</span>(<span class="dv">3</span>)</span>
<span id="cb1079-6"><a href="18-purrr.html#cb1079-6"></a><span class="co">#&gt; [1] 1 1 4</span></span></code></pre></div>
<p>On souhaite utiliser cette fonction pour générer 10 lancers de 4 dés. On essaie avec le code suivant :</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="18-purrr.html#cb1080-1"></a><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, lancer_des, <span class="dv">4</span>)</span></code></pre></div>
<p>Est-ce que cela fonctionne ? Pourquoi ?</p>

<div class="solution-exo">
<p>Ça ne fonctionne pas car <code>lancer_des()</code> est appelée à chaque itération avec deux arguments : la valeur courante de l’itérateur, et 4. Ainsi dans sa première itération, <code>map()</code> exécute <code>lancer_des(1, 4)</code>, ce qui génère un message d’erreur puisque <code>lancer_des()</code> n’accepte qu’un argument.</p>
</div>

<p>Trouver une solution en corrigeant le code.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="18-purrr.html#cb1081-1"></a><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="kw">lancer_des</span>(<span class="dv">4</span>))</span></code></pre></div>
</div>

<p><strong>Exercice 5.2</strong></p>
<p>Comme vu précédemment, la fonction suivante permet de simuler 20 lancers de pièces et de stocker le résultat dans un vecteur de chaînes de caractères.</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="18-purrr.html#cb1082-1"></a><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>), <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1082-2"><a href="18-purrr.html#cb1082-2"></a><span class="co">#&gt;  [1] &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot; &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot;</span></span>
<span id="cb1082-3"><a href="18-purrr.html#cb1082-3"></a><span class="co">#&gt; [11] &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot;</span></span></code></pre></div>
<p>À l’aide de <code>map()</code> et de ce code, créer une liste nommée <code>sims</code> contenant le résultat de 100 simulations de 20 lancers.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="18-purrr.html#cb1083-1"></a>sims &lt;-<span class="st"> </span><span class="kw">map</span>(</span>
<span id="cb1083-2"><a href="18-purrr.html#cb1083-2"></a>    <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,</span>
<span id="cb1083-3"><a href="18-purrr.html#cb1083-3"></a>    <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>), <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1083-4"><a href="18-purrr.html#cb1083-4"></a>)</span></code></pre></div>
</div>

<p>Toujours à l’aide de <code>map()</code>, calculer le nombre de “pile” obtenus pour chaque simulation de <code>sims</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="18-purrr.html#cb1084-1"></a>n_piles &lt;-<span class="st"> </span>sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x <span class="op">==</span><span class="st"> &quot;pile&quot;</span>))</span></code></pre></div>
</div>

<p>Déterminer le nombre minimal et le nombre maximal de “pile” obtenus parmi toutes les simulations de <code>sims</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="18-purrr.html#cb1085-1"></a><span class="kw">range</span>(n_piles)</span></code></pre></div>
</div>

<p><em>Facultatif :</em> à l’aide de la fonction <a href="https://purrr.tidyverse.org/reference/head_while.html">head_while()</a>, déterminer pour chaque simulation de <code>sims</code> le nombre de “pile” consécutifs obtenus avant le premier “face”.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="18-purrr.html#cb1086-1"></a>sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(</span>
<span id="cb1086-2"><a href="18-purrr.html#cb1086-2"></a>    <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">head_while</span>(.x, <span class="op">~</span><span class="st"> </span>.x <span class="op">==</span><span class="st"> &quot;pile&quot;</span>))</span>
<span id="cb1086-3"><a href="18-purrr.html#cb1086-3"></a>)</span></code></pre></div>
</div>

<p><em>Facultatif :</em> la fonction <code>rle()</code> permet de calculer les <em>run length encoding</em> d’un vecteur.</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="18-purrr.html#cb1087-1"></a><span class="kw">rle</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>, <span class="st">&quot;face&quot;</span>, <span class="st">&quot;face&quot;</span>, <span class="st">&quot;pile&quot;</span>, <span class="st">&quot;pile&quot;</span>))</span>
<span id="cb1087-2"><a href="18-purrr.html#cb1087-2"></a><span class="co">#&gt; Run Length Encoding</span></span>
<span id="cb1087-3"><a href="18-purrr.html#cb1087-3"></a><span class="co">#&gt;   lengths: int [1:3] 1 3 2</span></span>
<span id="cb1087-4"><a href="18-purrr.html#cb1087-4"></a><span class="co">#&gt;   values : chr [1:3] &quot;pile&quot; &quot;face&quot; &quot;pile&quot;</span></span></code></pre></div>
<p>À l’aide de cette fonction et de <code>map_int()</code>, calculer pour chaque simulation la longueur de la plus grande série consécutive de “pile”.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="18-purrr.html#cb1088-1"></a>sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span>{</span>
<span id="cb1088-2"><a href="18-purrr.html#cb1088-2"></a>    r &lt;-<span class="st"> </span><span class="kw">rle</span>(.x)</span>
<span id="cb1088-3"><a href="18-purrr.html#cb1088-3"></a>    longueurs_pile &lt;-<span class="st"> </span>r<span class="op">$</span>lengths[r<span class="op">$</span>values <span class="op">==</span><span class="st"> &quot;pile&quot;</span>]</span>
<span id="cb1088-4"><a href="18-purrr.html#cb1088-4"></a>    <span class="kw">max</span>(longueurs_pile)</span>
<span id="cb1088-5"><a href="18-purrr.html#cb1088-5"></a>})</span></code></pre></div>
</div>


</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="35">
<li id="fn35"><p>Pour une application sérieuse on utilisera des fonctions spécifiques de “tokenization” d’extensions dédiées à l’analyse textuelle, comme <code>quanteda</code>.<a href="18-purrr.html#fnref35" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="17-if-boucles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="19-programmer-tidyverse.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/juba/tidyverse/blob/main/18-purrr.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["introduction_au_tidyverse.epub", "introduction_au_tidyverse.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
