<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.264">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction à R et au tidyverse - 10&nbsp; Manipuler les données avec dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-stringr.html" rel="next">
<link href="./09-recodages.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/bookup_fonts_embed-0.0/fonts-download.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.2/leaflet.js"></script>


<link rel="stylesheet" href="css/tidyverse.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-tidyverse.html">Introduction au tidyverse</a></li><li class="breadcrumb-item"><a href="./10-dplyr.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Manipuler les données avec <code>dplyr</code></span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction à R et au tidyverse</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/juba/tidyverse/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./introduction_au_tidyverse.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./introduction_au_tidyverse.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Basculer en mode lecteur">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos de ce document</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Présentation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Introduction à R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-prise_en_main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Prise en main</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-premier_travail.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Premier travail avec des données</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-bivarie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Analyse bivariée</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-organiser.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Organiser ses scripts</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Introduction au tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Le tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Importer et exporter des données</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualiser avec <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-recodages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Recoder des variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Manipuler les données avec <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Manipuler du texte avec <code>stringr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Mettre en ordre avec <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Diffuser et publier avec <code>rmarkdown</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Aller plus loin</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-fonctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Écrire ses propres fonctions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-dplyr-avance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><code>dplyr</code> avancé</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-structures-donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Structures de données</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-if-boucles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Exécution conditionnelle et boucles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Itérer avec <code>purrr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-programmer-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Programmer avec le <em>tidyverse</em></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-debuggage-performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Débuggage et performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-targets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Organiser un projet avec <code>targets</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Annexes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-ressources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Ressources</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#préparation" id="toc-préparation" class="nav-link active" data-scroll-target="#préparation"><span class="header-section-number">10.1</span> Préparation</a></li>
  <li><a href="#les-verbes-de-dplyr" id="toc-les-verbes-de-dplyr" class="nav-link" data-scroll-target="#les-verbes-de-dplyr"><span class="header-section-number">10.2</span> Les verbes de <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#slice" id="toc-slice" class="nav-link" data-scroll-target="#slice"><span class="header-section-number">10.2.1</span> <code>slice</code></a></li>
  <li><a href="#sec-filter" id="toc-sec-filter" class="nav-link" data-scroll-target="#sec-filter"><span class="header-section-number">10.2.2</span> <code>filter</code></a></li>
  <li><a href="#sec-select-rename" id="toc-sec-select-rename" class="nav-link" data-scroll-target="#sec-select-rename"><span class="header-section-number">10.2.3</span> <code>select</code> et <code>rename</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">10.2.4</span> <code>arrange</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">10.2.5</span> <code>mutate</code></a></li>
  </ul></li>
  <li><a href="#sec-pipe" id="toc-sec-pipe" class="nav-link" data-scroll-target="#sec-pipe"><span class="header-section-number">10.3</span> Enchaîner les opérations avec le <em>pipe</em></a></li>
  <li><a href="#opérations-groupées" id="toc-opérations-groupées" class="nav-link" data-scroll-target="#opérations-groupées"><span class="header-section-number">10.4</span> Opérations groupées</a>
  <ul class="collapse">
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">10.4.1</span> <code>group_by</code></a></li>
  <li><a href="#summarise-et-count" id="toc-summarise-et-count" class="nav-link" data-scroll-target="#summarise-et-count"><span class="header-section-number">10.4.2</span> <code>summarise</code> et <code>count</code></a></li>
  <li><a href="#grouper-selon-plusieurs-variables" id="toc-grouper-selon-plusieurs-variables" class="nav-link" data-scroll-target="#grouper-selon-plusieurs-variables"><span class="header-section-number">10.4.3</span> Grouper selon plusieurs variables</a></li>
  <li><a href="#dégroupage" id="toc-dégroupage" class="nav-link" data-scroll-target="#dégroupage"><span class="header-section-number">10.4.4</span> Dégroupage</a></li>
  </ul></li>
  <li><a href="#autres-fonctions-utiles" id="toc-autres-fonctions-utiles" class="nav-link" data-scroll-target="#autres-fonctions-utiles"><span class="header-section-number">10.5</span> Autres fonctions utiles</a>
  <ul class="collapse">
  <li><a href="#slice_sample" id="toc-slice_sample" class="nav-link" data-scroll-target="#slice_sample"><span class="header-section-number">10.5.1</span> <code>slice_sample</code></a></li>
  <li><a href="#lead-et-lag" id="toc-lead-et-lag" class="nav-link" data-scroll-target="#lead-et-lag"><span class="header-section-number">10.5.2</span> <code>lead</code> et <code>lag</code></a></li>
  <li><a href="#distinct-et-n_distinct" id="toc-distinct-et-n_distinct" class="nav-link" data-scroll-target="#distinct-et-n_distinct"><span class="header-section-number">10.5.3</span> <code>distinct</code> et <code>n_distinct</code></a></li>
  <li><a href="#relocate" id="toc-relocate" class="nav-link" data-scroll-target="#relocate"><span class="header-section-number">10.5.4</span> <code>relocate</code></a></li>
  </ul></li>
  <li><a href="#tables-multiples" id="toc-tables-multiples" class="nav-link" data-scroll-target="#tables-multiples"><span class="header-section-number">10.6</span> Tables multiples</a>
  <ul class="collapse">
  <li><a href="#concaténation-bind_rows-et-bind_cols" id="toc-concaténation-bind_rows-et-bind_cols" class="nav-link" data-scroll-target="#concaténation-bind_rows-et-bind_cols"><span class="header-section-number">10.6.1</span> Concaténation&nbsp;: <code>bind_rows</code> et <code>bind_cols</code></a></li>
  <li><a href="#jointures" id="toc-jointures" class="nav-link" data-scroll-target="#jointures"><span class="header-section-number">10.6.2</span> Jointures</a></li>
  <li><a href="#types-de-jointures" id="toc-types-de-jointures" class="nav-link" data-scroll-target="#types-de-jointures"><span class="header-section-number">10.6.3</span> Types de jointures</a></li>
  </ul></li>
  <li><a href="#ressources" id="toc-ressources" class="nav-link" data-scroll-target="#ressources"><span class="header-section-number">10.7</span> Ressources</a></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">10.8</span> Exercices</a>
  <ul class="collapse">
  <li><a href="#les-verbes-de-base-de-dplyr" id="toc-les-verbes-de-base-de-dplyr" class="nav-link" data-scroll-target="#les-verbes-de-base-de-dplyr"><span class="header-section-number">10.8.1</span> Les verbes de base de <code>dplyr</code></a></li>
  <li><a href="#enchaîner-des-opérations" id="toc-enchaîner-des-opérations" class="nav-link" data-scroll-target="#enchaîner-des-opérations"><span class="header-section-number">10.8.2</span> Enchaîner des opérations</a></li>
  <li><a href="#group_by-et-summarise" id="toc-group_by-et-summarise" class="nav-link" data-scroll-target="#group_by-et-summarise"><span class="header-section-number">10.8.3</span> <code>group_by</code> et <code>summarise</code></a></li>
  <li><a href="#jointures-1" id="toc-jointures-1" class="nav-link" data-scroll-target="#jointures-1"><span class="header-section-number">10.8.4</span> Jointures</a></li>
  <li><a href="#bonus" id="toc-bonus" class="nav-link" data-scroll-target="#bonus"><span class="header-section-number">10.8.5</span> Bonus</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/juba/tidyverse/edit/main/10-dplyr.qmd" class="toc-action">Modifier cette page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-dplyr" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Manipuler les données avec <code>dplyr</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><code>dplyr</code> est une extension facilitant le traitement et la manipulation de données contenues dans une ou plusieurs tables. Elle propose une syntaxe claire et cohérente, sous formes de verbes, pour la plupart des opérations de ce type.</p>
<p><code>dplyr</code> part du principe que les données sont organisées selon le modèle des <em>tidy data</em> (voir <a href="06-tidyverse.html#sec-tidydata"><span>Section&nbsp;6.3</span></a>). Les fonctions de l’extension peuvent s’appliquer à des tableaux de type <code>data.frame</code> ou <code>tibble</code>, et elles retournent systématiquement un <code>tibble</code> (voir <a href="06-tidyverse.html#sec-tibbles"><span>Section&nbsp;6.4</span></a>).</p>
<p>Le code présent dans ce document nécessite d’avoir installé la version 1.0 de <code>dplyr</code> (ou plus récente).</p>
<section id="préparation" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="préparation"><span class="header-section-number">10.1</span> Préparation</h2>
<p><code>dplyr</code> fait partie du coeur du <em>tidyverse</em>, elle est donc chargée automatiquement avec&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut également la charger individuellement.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-3_93962c675fa2b4ed80c501063e5c263a">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans ce qui suit on va utiliser le jeu de données <code>nycflights13</code>, contenu dans l’extension du même nom (qu’il faut donc avoir installé). Celui-ci correspond aux données de tous les vols au départ d’un des trois aéroports de New-York en 2013. Il a la particularité d’être réparti en trois tables&nbsp;:</p>
<ul>
<li><code>flights</code> contient des informations sur les vols&nbsp;: date, départ, destination, horaires, retard…</li>
<li><code>airports</code> contient des informations sur les aéroports</li>
<li><code>airlines</code> contient des données sur les compagnies aériennes</li>
</ul>
<p>On va charger les trois tables du jeu de données&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Chargement des trois tables</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airports)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airlines)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Trois objets correspondant aux trois tables ont dû apparaître dans votre environnement.</p>
</section>
<section id="les-verbes-de-dplyr" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="les-verbes-de-dplyr"><span class="header-section-number">10.2</span> Les verbes de <code>dplyr</code></h2>
<p>La manipulation de données avec <code>dplyr</code> se fait en utilisant un nombre réduit de verbes, qui correspondent chacun à une action différente appliquée à un tableau de données.</p>
<section id="slice" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="slice"><span class="header-section-number">10.2.1</span> <code>slice</code></h3>
<p>Le verbe <code>slice</code> sélectionne des lignes du tableau selon leur position. On lui passe un chiffre ou un vecteur de chiffres.</p>
<p>Si on souhaite sélectionner la 345e ligne du tableau <code>airports</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-5_9d972dd37b829bdf1a6c1843a393fcfb">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(airports, <span class="dv">345</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                lat   lon   alt    tz dst   tzone            </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 CYF   Chefornak Airport  60.1 -164.    40    -9 A     America/Anchorage</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on veut sélectionner les 5 premières lignes&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-6_cd1775c024e7fd04f1435cee7d4540ed">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(airports, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                            lat   lon   alt    tz dst   tzone       </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;       </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 04G   Lansdowne Airport              41.1 -80.6  1044    -5 A     America/New…</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 06A   Moton Field Municipal Airport  32.5 -85.7   264    -6 A     America/Chi…</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 06C   Schaumburg Regional            42.0 -88.1   801    -6 A     America/Chi…</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 06N   Randall Airport                41.4 -74.4   523    -5 A     America/New…</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 09J   Jekyll Island Airport          31.1 -81.4    11    -5 A     America/New…</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>slice</code> propose plusieurs variantes utiles, dont <code>slice_head</code> et <code>slice_tail</code>, qui permettent de sélectionner les premières ou les dernières lignes du tableau (on peut spécifier le nombre de lignes souhaitées avec <code>n</code>, ou la proportion avec <code>prop</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-7_7615c30ee5e6217c3a28650ed2cf9aa4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(airports, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 8</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                        lat   lon   alt    tz dst   tzone           </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ZWI   Wilmington Amtrak Station  39.7 -75.6     0    -5 A     America/New_York</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ZWU   Washington Union Station   38.9 -77.0    76    -5 A     America/New_York</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 ZYP   Penn Station               40.8 -74.0    35    -5 A     America/New_York</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-8_6fa4622f7915a9b845e7ef2fab7e7a4f">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(airlines, <span class="at">prop =</span> <span class="fl">0.2</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   carrier name                  </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                 </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 9E      Endeavor Air Inc.     </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 AA      American Airlines Inc.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 AS      Alaska Airlines Inc.</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Autres variantes utiles, <code>slice_min</code> et <code>slice_max</code> permettent de sélectionner les lignes avec les valeurs les plus grandes ou les plus petite d’une variable donnée. Ainsi, la commande suivante sélectionne le vol ayant le retard au départ le plus faible.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-9_ca46e334f26e0b78e8bb9dc4229a6ac6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_min</span>(flights, dep_delay)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 19</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    year month   day dep_time sched_dep…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;       &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2013    12     7     2040        2123     -43      40    2352      48 B6     </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   time_hour &lt;dttm&gt;, and abbreviated variable names ¹​sched_dep_time,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut aussi spécifier le nombre de lignes souhaitées, par exemple la commande suivante retourne les 5 aéroports avec l’altitude la plus élevée (en cas de valeurs ex-aequo, il se peut que le nombre de lignes retournées soit plus élevé que celui demandé).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-10_eccfbb83400277f8d358b22bd77a75b9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(airports, alt, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                              lat   lon   alt    tz dst   tzone     </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 TEX   Telluride                        38.0 -108.  9078    -7 A     America/D…</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 TVL   Lake Tahoe Airport               38.9 -120.  8544    -8 A     America/L…</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 ASE   Aspen Pitkin County Sardy Field  39.2 -107.  7820    -7 A     America/D…</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 GUC   Gunnison - Crested Butte         38.5 -107.  7678    -7 A     America/D…</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 BCE   Bryce Canyon                     37.7 -112.  7590    -7 A     America/D…</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-filter" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="sec-filter"><span class="header-section-number">10.2.2</span> <code>filter</code></h3>
<p><code>filter</code> sélectionne des lignes d’une table selon une condition. On lui passe en paramètre un test, et seules les lignes pour lesquelles ce test renvoie <code>TRUE</code> (vrai) sont conservées. Pour plus d’informations sur les tests et leur syntaxe, voir <a href="09-recodages.html#sec-tests"><span>Section&nbsp;9.2</span></a>.</p>
<p>Par exemple, si on veut sélectionner les vols du mois de janvier, on peut filtrer sur la variable <code>month</code> de la manière suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-11_cc3722d8b5e91371cd068d6f0638e700">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 27,004 × 19</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1      554        600      -6     812     837     -25 DL     </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1      554        558      -4     740     728      12 UA     </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1      555        600      -5     913     854      19 B6     </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1      557        600      -3     709     723     -14 EV     </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1      557        600      -3     838     846      -8 B6     </span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1      558        600      -2     753     745       8 AA     </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 26,994 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on veut uniquement les vols avec un retard au départ (variable <code>dep_delay</code>) compris entre 10 et 15 minutes&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-12_48f10f2e2dbfaf66403a1aeca477628d">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> dep_delay <span class="sc">&lt;=</span> <span class="dv">15</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14,919 × 19</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      611        600      11     945     931      14 UA     </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1      623        610      13     920     915       5 AA     </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      743        730      13    1107    1100       7 AA     </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1      743        730      13    1059    1056       3 DL     </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1      851        840      11    1215    1206       9 UA     </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1      912        900      12    1241    1220      21 AA     </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1      914        900      14    1058    1043      15 UA     </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1      920        905      15    1039    1025      14 B6     </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1     1011       1001      10    1133    1128       5 EV     </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1     1112       1100      12    1440    1438       2 UA     </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 14,909 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on passe plusieurs arguments à <code>filter</code>, celui-ci rajoute automatiquement une condition <em>et</em> entre les conditions. La commande précédente peut donc être écrite de la manière suivante, avec le même résultat&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-13_88c53499ccd109ec0c01a4de6a54b5e5">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;=</span> <span class="dv">10</span>, dep_delay <span class="sc">&lt;=</span> <span class="dv">15</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut également placer des fonctions dans les tests, qui nous permettent par exemple de sélectionner les vols ayant une distance supérieure à la distance médiane&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-14_3943ae25ce1f0aaf677f5ed6edca700a">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, distance <span class="sc">&gt;</span> <span class="fu">median</span>(distance))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 167,133 × 19</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1      555        600      -5     913     854      19 B6     </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1      557        600      -3     838     846      -8 B6     </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1      558        600      -2     849     851      -2 B6     </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1      558        600      -2     853     856      -3 B6     </span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1      558        600      -2     924     917       7 UA     </span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1      558        600      -2     923     937     -14 UA     </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 167,123 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-select-rename" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="sec-select-rename"><span class="header-section-number">10.2.3</span> <code>select</code> et <code>rename</code></h3>
<p><code>select</code> permet de sélectionner des colonnes d’un tableau de données. Ainsi, si on veut extraire les colonnes <code>lat</code> et <code>lon</code> du tableau airports&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-15_79ab83da6a24d6b224fc378ed6c0a724">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, lat, lon)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,458 × 2</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      lat    lon</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  41.1  -80.6</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  32.5  -85.7</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  42.0  -88.1</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  41.4  -74.4</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  31.1  -81.4</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  36.4  -82.2</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  41.5  -84.5</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  42.9  -76.8</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  39.8  -76.6</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  48.1 -123. </span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,448 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on fait précéder le nom d’un <code>-</code>, la colonne est éliminée plutôt que sélectionnée&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-16_77d98beed613286751350d9aa99c757a">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, <span class="sc">-</span>lat, <span class="sc">-</span>lon)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,458 × 6</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    faa   name                             alt    tz dst   tzone              </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 04G   Lansdowne Airport               1044    -5 A     America/New_York   </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 06A   Moton Field Municipal Airport    264    -6 A     America/Chicago    </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 06C   Schaumburg Regional              801    -6 A     America/Chicago    </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 06N   Randall Airport                  523    -5 A     America/New_York   </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 09J   Jekyll Island Airport             11    -5 A     America/New_York   </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 0A9   Elizabethton Municipal Airport  1593    -5 A     America/New_York   </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 0G6   Williams County Airport          730    -5 A     America/New_York   </span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 0G7   Finger Lakes Regional Airport    492    -5 A     America/New_York   </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 0P2   Shoestring Aviation Airfield    1000    -5 U     America/New_York   </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 0S9   Jefferson County Intl            108    -8 A     America/Los_Angeles</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,448 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>select</code> comprend toute une série de fonctions facilitant la sélection de colonnes multiples. Par exemple, <code>starts_with</code>, <code>ends_width</code>, <code>contains</code> ou <code>matches</code> permettent d’exprimer des conditions sur les noms de variables.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-17_892e1e4ce35e62a71f57d34864bdf44c">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, <span class="fu">starts_with</span>(<span class="st">"dep_"</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 2</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    dep_time dep_delay</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1      517         2</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2      533         4</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3      542         2</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4      544        -1</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5      554        -6</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6      554        -4</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7      555        -5</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8      557        -3</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9      557        -3</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10      558        -2</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La syntaxe <code>colonne1:colonne2</code> permet de sélectionner toutes les colonnes situées entre <code>colonne1</code> et <code>colonne2</code> incluses<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-18_cb5c2c395a930dd63e460f7ce95f3014">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, year<span class="sc">:</span>day)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>select</code> propose de nombreuses autres possibilités de sélection qui sont décrites dans <a href="https://tidyselect.r-lib.org/reference/language.html">la documentation de l’extension <code>tidyselect</code></a>.</p>
<p>Une variante de <code>select</code> est <code>rename</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, qui permet de renommer des colonnes. On l’utilise en lui passant des paramètres de la forme <code>nouveau_nom = ancien_nom</code>. Ainsi, si on veut renommer les colonnes <code>lon</code> et <code>lat</code> de <code>airports</code> en <code>longitude</code> et <code>latitude</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-19_64307808433ac408be1877cab67eef59">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(airports, <span class="at">longitude =</span> lon, <span class="at">latitude =</span> lat)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,458 × 8</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    faa   name                           latitude longi…¹   alt    tz dst   tzone</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                             &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 04G   Lansdowne Airport                  41.1   -80.6  1044    -5 A     Amer…</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 06A   Moton Field Municipal Airport      32.5   -85.7   264    -6 A     Amer…</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 06C   Schaumburg Regional                42.0   -88.1   801    -6 A     Amer…</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 06N   Randall Airport                    41.4   -74.4   523    -5 A     Amer…</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 09J   Jekyll Island Airport              31.1   -81.4    11    -5 A     Amer…</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 0A9   Elizabethton Municipal Airport     36.4   -82.2  1593    -5 A     Amer…</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 0G6   Williams County Airport            41.5   -84.5   730    -5 A     Amer…</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 0G7   Finger Lakes Regional Airport      42.9   -76.8   492    -5 A     Amer…</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 0P2   Shoestring Aviation Airfield       39.8   -76.6  1000    -5 U     Amer…</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 0S9   Jefferson County Intl              48.1  -123.    108    -8 A     Amer…</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,448 more rows, and abbreviated variable name ¹​longitude</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si les noms de colonnes comportent des espaces ou des caractères spéciaux, on peut les entourer de guillemets (<code>"</code>) ou de quotes inverses (<code>`</code>)&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-20_0d95f09037efb102827c0a7aff6cf70d">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rename</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"retard départ"</span> <span class="ot">=</span> dep_delay,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"retard arrivée"</span> <span class="ot">=</span> arr_delay</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(tmp, <span class="st">`</span><span class="at">retard départ</span><span class="st">`</span>, <span class="st">`</span><span class="at">retard arrivée</span><span class="st">`</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 2</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    `retard départ` `retard arrivée`</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1               2               11</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2               4               20</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3               2               33</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4              -1              -18</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5              -6              -25</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6              -4               12</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7              -5               19</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8              -3              -14</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9              -3               -8</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10              -2                8</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arrange" class="level3" data-number="10.2.4">
<h3 data-number="10.2.4" class="anchored" data-anchor-id="arrange"><span class="header-section-number">10.2.4</span> <code>arrange</code></h3>
<p><code>arrange</code> réordonne les lignes d’un tableau selon une ou plusieurs colonnes.</p>
<p>Ainsi, si on veut trier le tableau <code>flights</code> selon le retard au départ croissant&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-21_7465c05e491a9bc24088ef4b69eb9705">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, dep_delay)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013    12     7     2040       2123     -43      40    2352      48 B6     </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     2     3     2022       2055     -33    2240    2338     -58 DL     </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013    11    10     1408       1440     -32    1549    1559     -10 EV     </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1    11     1900       1930     -30    2233    2243     -10 DL     </span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1    29     1703       1730     -27    1947    1957     -10 F9     </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     8     9      729        755     -26    1002     955       7 MQ     </span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013    10    23     1907       1932     -25    2143    2143       0 EV     </span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     3    30     2030       2055     -25    2213    2250     -37 MQ     </span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     3     2     1431       1455     -24    1601    1631     -30 9E     </span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     5     5      934        958     -24    1225    1309     -44 B6     </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut trier selon plusieurs colonnes. Par exemple selon le mois, puis selon le retard au départ&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-22_7d24f953308e0402a153edc6c2f9bb4f">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, month, dep_delay)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1    11     1900       1930     -30    2233    2243     -10 DL     </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1    29     1703       1730     -27    1947    1957     -10 F9     </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1    12     1354       1416     -22    1606    1650     -44 FL     </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1    21     2137       2159     -22    2232    2316     -44 DL     </span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1    20      704        725     -21    1025    1035     -10 AS     </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1    12     2050       2110     -20    2310    2355     -45 B6     </span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1    12     2134       2154     -20       4      50     -46 B6     </span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1    14     2050       2110     -20    2329    2355     -26 B6     </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     4     2140       2159     -19    2241    2316     -35 DL     </span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1    11     1947       2005     -18    2209    2230     -21 9E     </span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on veut trier selon une colonne par ordre décroissant, on lui applique la fonction <code>desc()</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-23_34b0fe954a2d13b14b82e1d5820f50b1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     9      641        900    1301    1242    1530    1272 HA     </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     6    15     1432       1935    1137    1607    2120    1127 MQ     </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1    10     1121       1635    1126    1239    1810    1109 MQ     </span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     9    20     1139       1845    1014    1457    2210    1007 AA     </span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     7    22      845       1600    1005    1044    1815     989 MQ     </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     4    10     1100       1900     960    1342    2211     931 DL     </span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     3    17     2321        810     911     135    1020     915 DL     </span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     6    27      959       1900     899    1236    2226     850 DL     </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     7    22     2257        759     898     121    1026     895 DL     </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013    12     5      756       1700     896    1058    2020     878 AA     </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combiné avec <code>slice</code>, <code>arrange</code> permet par exemple de sélectionner les trois vols ayant eu le plus de retard&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-24_3524a02a78d18dbec9040a8b081cc917">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(tmp, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 19</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    year month   day dep_time sched_dep…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;       &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2013     1     9      641         900    1301    1242    1530    1272 HA     </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2013     6    15     1432        1935    1137    1607    2120    1127 MQ     </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2013     1    10     1121        1635    1126    1239    1810    1109 MQ     </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   time_hour &lt;dttm&gt;, and abbreviated variable names ¹​sched_dep_time,</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutate" class="level3" data-number="10.2.5">
<h3 data-number="10.2.5" class="anchored" data-anchor-id="mutate"><span class="header-section-number">10.2.5</span> <code>mutate</code></h3>
<p><code>mutate</code> permet de créer de nouvelles colonnes dans le tableau de données, en général à partir de variables existantes.</p>
<p>Par exemple, la table <code>flights</code> contient la durée du vol en minutes.. Si on veut créer une nouvelle variable <code>duree_h</code> avec cette durée en heures, on peut faire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-25_5aa90ec8afbbe3297ee247b55fd3dcf1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">duree_h =</span> air_time <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, air_time, duree_h)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 2</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    air_time duree_h</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1      227   3.78 </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2      227   3.78 </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3      160   2.67 </span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4      183   3.05 </span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5      116   1.93 </span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6      150   2.5  </span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7      158   2.63 </span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       53   0.883</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9      140   2.33 </span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10      138   2.3  </span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut créer plusieurs nouvelles colonnes en une seule commande, et les expressions successives peuvent prendre en compte les résultats des calculs précédents. L’exemple suivant convertit d’abord la durée en heures dans une variable <code>duree_h</code> et la distance en kilomètres dans une variable <code>distance_km</code>, puis utilise ces nouvelles colonnes pour calculer la vitesse en km/h.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-26_5dae1728b632daa48e18e05789be4054">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">duree_h =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_km =</span> distance <span class="sc">/</span> <span class="fl">0.62137</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">vitesse =</span> distance_km <span class="sc">/</span> duree_h</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, air_time, duree_h, distance, distance_km, vitesse)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 5</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    air_time duree_h distance distance_km vitesse</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1      227   3.78      1400       2253.    596.</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2      227   3.78      1416       2279.    602.</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3      160   2.67      1089       1753.    657.</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4      183   3.05      1576       2536.    832.</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5      116   1.93       762       1226.    634.</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6      150   2.5        719       1157.    463.</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7      158   2.63      1065       1714.    651.</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       53   0.883      229        369.    417.</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9      140   2.33       944       1519.    651.</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10      138   2.3        733       1180.    513.</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À noter que <code>mutate</code> est évidemment parfaitement compatible avec les fonctions vues <a href="09-recodages.html"><span>Chapitre&nbsp;9</span></a> sur les recodages&nbsp;: <code>fct_recode</code>, <code>ifelse</code>, <code>case_when</code>…</p>
<p>L’avantage d’utiliser <code>mutate</code> est double. D’abord il permet d’éviter d’avoir à saisir le nom du tableau de données dans les conditions d’un <code>ifelse</code> ou d’un <code>case_when</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-27_12357f47b5e0684cd38a0fc8a85a440d">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    flights,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">type_retard =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard départ et arrivée"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard départ"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        dep_delay <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Retard arrivée"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Aucun retard"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ensuite, il permet aussi d’intégrer ces recodages dans un <em>pipeline</em> de traitement de données, concept présenté dans la section suivante.</p>
</section>
</section>
<section id="sec-pipe" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="sec-pipe"><span class="header-section-number">10.3</span> Enchaîner les opérations avec le <em>pipe</em></h2>
<p>Quand on manipule un tableau de données, il est très fréquent d’enchaîner plusieurs opérations. On va par exemple extraire une sous-population avec <code>filter</code>, sélectionner des colonnes avec <code>select</code> puis trier selon une variable avec <code>arrange</code>, etc.</p>
<p>Quand on veut enchaîner des opérations, on peut le faire de différentes manières. La première est d’effectuer toutes les opérations en une fois en les “emboîtant”&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-28_f6d86bbebdce29fab3587efabcb28ff5">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">select</span>(<span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>), dep_delay, arr_delay), dep_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette notation a plusieurs inconvénients&nbsp;:</p>
<ul>
<li>elle est peu lisible</li>
<li>les opérations apparaissent dans l’ordre inverse de leur réalisation. Ici on effectue d’abord le <code>filter</code>, puis le <code>select</code>, puis le <code>arrange</code>, alors qu’à la lecture du code c’est le <code>arrange</code> qui apparaît en premier.</li>
<li>Il est difficile de voir quel paramètre se rapporte à quelle fonction</li>
</ul>
<p>Une autre manière de faire est d’effectuer les opérations les unes après les autres, en stockant les résultats intermédiaires dans un objet temporaire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-29_7222f6120a320f872e582758c528fce3">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">select</span>(tmp, dep_delay, arr_delay)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(tmp, dep_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>C’est nettement plus lisible, l’ordre des opérations est le bon, et les paramètres sont bien rattachés à leur fonction. Par contre, ça reste un peu “verbeux”, et on crée un objet temporaire <code>tmp</code> dont on n’a pas réellement besoin.</p>
<p>Pour simplifier et améliorer encore la lisibilité du code, on va utiliser un nouvel opérateur, baptisé <em>pipe</em><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Le <em>pipe</em> se note <code>%&gt;%</code>, et son fonctionnement est le suivant&nbsp;: si j’exécute <code>expr %&gt;% f</code>, alors le résultat de l’expression <code>expr</code>, à gauche du <em>pipe</em>, sera passé comme premier argument à la fonction <code>f</code>, à droite du <em>pipe</em>, ce qui revient à exécuter <code>f(expr)</code>.</p>
<p>Ainsi les deux expressions suivantes sont rigoureusement équivalentes&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-30_b42829711aaa9268da5d97e2f4feb2a1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-31_0189202ad3400e168ca57f0cc82988e2">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce qui est particulièrement intéressant, c’est qu’on va pouvoir enchaîner les <em>pipes</em>. Plutôt que d’écrire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-32_3b0ea3d06b4361ed3ab73b3587f22557">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">filter</span>(flights, dest <span class="sc">==</span> <span class="st">"LAX"</span>), dep_delay, arr_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On va pouvoir faire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-33_cdf7ec84de34d3d588075ff018cd9b71">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, arr_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À chaque fois, le résultat de ce qui se trouve à gauche du <em>pipe</em> est passé comme premier argument à ce qui se trouve à droite&nbsp;: on part de l’objet <code>flights</code>, qu’on passe comme premier argument à la fonction <code>filter</code>, puis on passe le résultat de ce <code>filter</code> comme premier argument du <code>select</code>.</p>
<p>Le résultat final est le même avec les deux syntaxes, mais avec le <em>pipe</em> l’ordre des opérations correspond à l’ordre naturel de leur exécution, et on n’a pas eu besoin de créer d’objet intermédiaire.</p>
<p>Si la liste des fonctions enchaînées est longue, on peut les répartir sur plusieurs lignes à condition que l’opérateur <code>%&gt;%</code> soit en fin de ligne&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-34_6649e617d6d12237c53ce21e7c8e7838">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>On appelle une suite d’instructions de ce type un <em>pipeline</em>.</p>
</div>
</div>
<p>Évidemment, il est naturel de vouloir récupérer le résultat final d’un <em>pipeline</em> pour le stocker dans un objet. On peut stocker le résultat du <em>pipeline</em> ci-dessus dans un nouveau tableau <code>delay_la</code> de la manière suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-35_b7bed43f49216fdd6acd108a1b09d3d5">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans ce cas, <code>delay_la</code> contiendra le tableau final, obtenu après application des trois instructions <code>filter</code>, <code>select</code> et <code>arrange</code>.</p>
<p>Cette notation n’est pas forcément très intuitive au départ : il faut bien comprendre que c’est le résultat final, une fois application de toutes les opérations du <em>pipeline</em>, qui est renvoyé et stocké dans l’objet en début de ligne.</p>
<p>Une manière de le comprendre peut être de voir que la notation suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-36_3bbf3543e8048b87715c71ea3dd2b732">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, arr_delay)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>est équivalente à&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-37_402124997aee93ce453e06720f452bd9">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>delay_la <span class="ot">&lt;-</span> (flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, arr_delay))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>L’utilisation du <em>pipe</em> n’est pas obligatoire, mais elle rend les scripts plus lisibles et plus rapides à saisir. On l’utilisera donc dans ce qui suit.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Avertissement
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depuis la version 4.1, R propose un <em>pipe</em> “natif”, qui fonctionne partout, même si on n’utilise pas les extensions du <em>tidyverse</em>. Celui-ci est noté <code>|&gt;</code>.</p>
<p>Il s’utilise de la même manière que <code>%&gt;%</code> :</p>
<p><code>flights |&gt; filter(dest == "LAX")</code></p>
<p>Ce <em>pipe</em> natif est à la fois un peu plus rapide et un peu moins souple. Par exemple, il est possible avec <code>%&gt;%</code> d’appeler une fonction sans mettre de parenthèses :</p>
<p><code>df %&gt;% View</code></p>
<p>Ce n’est pas possible d’omettre les parenthèses avec <code>|&gt;</code>, on doit obligatoirement faire :</p>
<p><code>df |&gt; View()</code></p>
<p>Dans la suite de ce document on privilégiera (pour l’instant) le <em>pipe</em> du <em>tidyverse</em> <code>%&gt;%</code>, pour des raisons de compatibilité avec des versions de R moins récentes.</p>
</div>
</div>
</section>
<section id="opérations-groupées" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="opérations-groupées"><span class="header-section-number">10.4</span> Opérations groupées</h2>
<section id="group_by" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="group_by"><span class="header-section-number">10.4.1</span> <code>group_by</code></h3>
<p>Un élément très important de <code>dplyr</code> est la fonction <code>group_by</code>. Elle permet de définir des groupes de lignes à partir des valeurs d’une ou plusieurs colonnes. Par exemple, on peut grouper les vols selon leur mois&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-38_63a932013d94ed13c54da84c6fc0e8e1">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 22</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     </span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     </span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     </span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     </span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1      554        600      -6     812     837     -25 DL     </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1      554        558      -4     740     728      12 UA     </span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1      555        600      -5     913     854      19 B6     </span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1      557        600      -3     709     723     -14 EV     </span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1      557        600      -3     838     846      -8 B6     </span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1      558        600      -2     753     745       8 AA     </span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Par défaut ceci ne fait rien de visible, à part l’apparition d’une mention <code>Groups</code> dans l’affichage du résultat. Mais à partir du moment où des groupes ont été définis, les verbes comme <code>slice</code>, <code>mutate</code> ou <code>summarise</code> vont en tenir compte lors de leurs opérations.</p>
<p>Par exemple, si on applique <code>slice</code> à un tableau préalablement groupé, il va sélectionner les lignes aux positions indiquées <em>pour chaque groupe</em>. Ainsi la commande suivante affiche le premier vol de chaque mois, selon leur ordre d’apparition dans le tableau&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-39_be727e98d5b1e63bad735aa38a2390c5">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 22</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     </span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     2     1      456        500      -4     652     648       4 US     </span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     3     1        4       2159     125     318      56     142 B6     </span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     4     1      454        500      -6     636     640      -4 US     </span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     5     1        9       1655     434     308    2020     408 VX     </span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     6     1        2       2359       3     341     350      -9 B6     </span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     7     1        1       2029     212     236    2359     157 B6     </span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     8     1       12       2130     162     257      14     163 B6     </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     9     1        9       2359      10     343     340       3 B6     </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013    10     1      447        500     -13     614     648     -34 US     </span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11  2013    11     1        5       2359       6     352     345       7 B6     </span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12  2013    12     1       13       2359      14     446     445       1 B6     </span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;, and</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   abbreviated variable names ¹​sched_dep_time, ²​dep_delay, ³​arr_time,</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plus utile, en utilisant une variante comme <code>slice_min</code> ou <code>slice_max</code>, on peut sélectionner les lignes ayant les valeurs les plus grandes ou les plus petites <em>pour chaque groupe</em>. Par exemple la commande suivant sélectionne, pour chaque mois de l’année, le vol ayant eu le retard le plus important.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-40_e06d7f16561091c16a5c48a1ac20a2d8">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(dep_delay)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 22</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     9      641        900    1301    1242    1530    1272 HA     </span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     2    10     2243        830     853     100    1106     834 F9     </span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     3    17     2321        810     911     135    1020     915 DL     </span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     4    10     1100       1900     960    1342    2211     931 DL     </span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     5     3     1133       2055     878    1250    2215     875 MQ     </span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     6    15     1432       1935    1137    1607    2120    1127 MQ     </span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     7    22      845       1600    1005    1044    1815     989 MQ     </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     8     8     2334       1454     520     120    1710     490 EV     </span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     9    20     1139       1845    1014    1457    2210    1007 AA     </span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013    10    14     2042        900     702    2255    1127     688 DL     </span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11  2013    11     3      603       1645     798     829    1913     796 DL     </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12  2013    12     5      756       1700     896    1058    2020     878 AA     </span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;, vitesse &lt;dbl&gt;, and</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   abbreviated variable names ¹​sched_dep_time, ²​dep_delay, ³​arr_time,</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Idem pour <code>mutate</code>&nbsp;: les opérations appliquées lors du calcul des valeurs des nouvelles colonnes sont appliquées groupe de lignes par groupe de lignes. Dans l’exemple suivant, on ajoute une nouvelle colonne qui contient le retard moyen <em>pour chaque compagnie aérienne</em>. Cette valeur est donc différente d’une compagnie à une autre, mais identique pour tous les vols d’une même compagnie&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-41_71500b33976af69145238c930283cb33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_delay_carrier =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, mean_delay_carrier)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Adding missing grouping variables: `carrier`</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   carrier [16]</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    carrier dep_delay mean_delay_carrier</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 UA              2              12.1 </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 UA              4              12.1 </span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AA              2               8.59</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 B6             -1              13.0 </span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 DL             -6               9.26</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 UA             -4              12.1 </span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 B6             -5              13.0 </span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 EV             -3              20.0 </span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 B6             -3              13.0 </span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 AA             -2               8.59</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ceci peut permettre, par exemple, de déterminer si un retard donné est supérieur ou inférieur au retard médian de la compagnie&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-42_fd6b7b77773504e9f5d40efb50a59727">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_delay =</span> <span class="fu">median</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">delay_carrier =</span> <span class="fu">ifelse</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>          dep_delay <span class="sc">&gt;</span> median_delay,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Supérieur"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inférieur ou égal"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay, median_delay, delay_carrier)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Adding missing grouping variables: `carrier`</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 4</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   carrier [16]</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    carrier dep_delay median_delay delay_carrier    </span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;            </span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 UA              2            0 Supérieur        </span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 UA              4            0 Supérieur        </span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AA              2           -3 Supérieur        </span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 B6             -1           -1 Inférieur ou égal</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 DL             -6           -2 Inférieur ou égal</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 UA             -4            0 Inférieur ou égal</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 B6             -5           -1 Inférieur ou égal</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 EV             -3           -1 Inférieur ou égal</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 B6             -3           -1 Inférieur ou égal</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 AA             -2           -3 Supérieur        </span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>group_by</code> peut aussi être utile avec <code>filter</code>, par exemple pour sélectionner <em>pour chaque mois</em> les vols avec un retard au départ plus élevé que le retard moyen ce mois-ci.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-43_73669f9d763fe939b41d18b783d4b251">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dep_delay <span class="sc">&gt;=</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 78,164 × 22</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      611        600      11     945     931      14 UA     </span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     1      623        610      13     920     915       5 AA     </span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      632        608      24     740     728      12 EV     </span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     1      732        645      47    1011     941      30 UA     </span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     1      743        730      13    1107    1100       7 AA     </span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     1      743        730      13    1059    1056       3 DL     </span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     1      749        710      39     939     850      49 MQ     </span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1      811        630     101    1047     830     137 MQ     </span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     1      826        715      71    1136    1045      51 AA     </span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     1      848       1835     853    1001    1950     851 MQ     </span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 78,154 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Avertissement
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Attention&nbsp;:</strong> la clause <code>group_by</code> marche pour les verbes déjà vus précédemment, <em>sauf</em> pour <code>arrange</code>, qui par défaut trie la table sans tenir compte des groupes. Pour obtenir un tri par groupe, il faut lui ajouter l’argument <code>.by_group = TRUE</code>.</p>
</div>
</div>
<p>On peut voir la différence en comparant les deux résultats suivants&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-44_b1fb213a07655a9967819106f8359925">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 22</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     9      641        900    1301    1242    1530    1272 HA     </span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     6    15     1432       1935    1137    1607    2120    1127 MQ     </span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1    10     1121       1635    1126    1239    1810    1109 MQ     </span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     9    20     1139       1845    1014    1457    2210    1007 AA     </span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     7    22      845       1600    1005    1044    1815     989 MQ     </span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     4    10     1100       1900     960    1342    2211     931 DL     </span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     3    17     2321        810     911     135    1020     915 DL     </span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     6    27      959       1900     899    1236    2226     850 DL     </span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     7    22     2257        759     898     121    1026     895 DL     </span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013    12     5      756       1700     896    1058    2020     878 AA     </span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-45_cb6712a1f66bd077850a66573b0e7476">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay), <span class="at">.by_group =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 22</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     9      641        900    1301    1242    1530    1272 HA     </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1    10     1121       1635    1126    1239    1810    1109 MQ     </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     1      848       1835     853    1001    1950     851 MQ     </span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1    13     1809        810     599    2054    1042     612 DL     </span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1    16     1622        800     502    1911    1054     497 B6     </span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1    23     1551        753     478    1812    1006     486 DL     </span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1    10     1525        900     385    1713    1039     394 UA     </span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     1     2343       1724     379     314    1938     456 EV     </span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     2     2131       1512     379    2340    1741     359 UA     </span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1     7     2021       1415     366    2332    1724     368 B6     </span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarise-et-count" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="summarise-et-count"><span class="header-section-number">10.4.2</span> <code>summarise</code> et <code>count</code></h3>
<p><code>summarise</code> permet d’agréger les lignes du tableau en effectuant une opération “résumée” sur une ou plusieurs colonnes. Par exemple, si on souhaite connaître les retards moyens au départ et à l’arrivée pour l’ensemble des vols du tableau <code>flights</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-46_c51a13a3a28f86903f86c402b16ac45b">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">retard_dep =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">retard_arr =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   retard_dep retard_arr</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       12.6       6.90</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction est en général utilisée avec <code>group_by</code>, puisqu’elle permet du coup d’agréger et résumer les lignes du tableau groupe par groupe. Si on souhaite calculer le délai maximum, le délai minimum et le délai moyen au départ pour chaque mois, on pourra faire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-47_05fa021226ba4ed5677e1e94a0fbdada">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_delay =</span> <span class="fu">max</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_delay =</span> <span class="fu">min</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month max_delay min_delay mean_delay</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1      1301       -30      10.0 </span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2       853       -33      10.8 </span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3       911       -25      13.2 </span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4       960       -21      13.9 </span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5       878       -24      13.0 </span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6      1137       -21      20.8 </span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7      1005       -22      21.7 </span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8       520       -26      12.6 </span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9      1014       -24       6.72</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10       702       -25       6.24</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11    11       798       -32       5.44</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12    12       896       -43      16.6</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>summarise</code> dispose d’un opérateur spécial, <code>n()</code>, qui retourne le nombre de lignes du groupe. Ainsi si on veut le nombre de vols par destination, on peut utiliser&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-48_6db17ece446a12f553bef7f66891e5c7">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>())</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    dest     nb</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ABQ     254</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 ACK     265</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 ALB     439</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 ANC       8</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 ATL   17215</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 AUS    2439</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 AVL     275</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 BDL     443</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 BGR     375</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 BHM     297</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 95 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>n()</code> peut aussi être utilisée avec <code>filter</code> et <code>mutate</code>.</p>
<p>À noter que quand on veut compter le nombre de lignes par groupe, il est plus simple d’utiliser directement la fonction <code>count</code>. Ainsi le code suivant est identique au précédent&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-49_b51fe742cd549400c6c8bec6a51183f1">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    dest      n</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ABQ     254</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 ACK     265</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 ALB     439</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 ANC       8</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 ATL   17215</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 AUS    2439</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 AVL     275</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 BDL     443</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 BGR     375</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 BHM     297</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 95 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouper-selon-plusieurs-variables" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="grouper-selon-plusieurs-variables"><span class="header-section-number">10.4.3</span> Grouper selon plusieurs variables</h3>
<p>On peut grouper selon plusieurs variables à la fois, il suffit de les indiquer dans la clause du <code>group_by</code>. Le <em>pipeline</em> suivant calcule le retard moyen au départ pour chaque mois et pour chaque destination, et trie le résultat par retard décroissant&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-50_dce2d9c4a0b7d42601bc3c291f9e9386">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(retard_moyen))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'month'. You can override using the</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,113 × 3</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month dest  retard_moyen</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1    12 BZN           75  </span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     7 TUL           72.6</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3 DSM           71.0</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     7 CAE           69.4</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5    11 SBN           67.5</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     7 BHM           64.6</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7 TYS           60.6</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     6 BHM           57.2</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1 TUL           55.2</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1 SAV           54.8</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,103 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut également utiliser <code>count</code> sur plusieurs variables. Les commandes suivantes comptent le nombre de vols pour chaque couple aéroport de départ / aéroport d’arrivée, et trie le résultat par nombre de vols décroissant. Ici la colonne qui contient le nombre de vols, créée par <code>count</code>, s’appelle <code>n</code> par défaut&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-51_a22e741f590e33d428ffce064e941fd2">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 224 × 3</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    origin dest      n</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 JFK    LAX   11262</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 LGA    ATL   10263</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 LGA    ORD    8857</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 JFK    SFO    8204</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 LGA    CLT    6168</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 EWR    ORD    6100</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 JFK    BOS    5898</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 LGA    MIA    5781</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 JFK    MCO    5464</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 EWR    BOS    5327</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 214 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut utiliser plusieurs opérations de groupage dans le même <em>pipeline</em>. Ainsi, si on souhaite déterminer le couple aéroport de départ / aéroport d’arrivée ayant le retard moyen au départ le plus élevé pour chaque mois de l’année, on devra procéder en deux étapes&nbsp;:</p>
<ul>
<li>d’abord grouper selon mois, aéroports d’origine et d’arrivée pour calculer le retard moyen</li>
<li>puis grouper uniquement selon le mois pour sélectionner le mois avec le retard moyen maximal.</li>
</ul>
<p>Au final, on obtient le code suivant&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-52_7d8d664c7825374ccddb43312252bea5">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'month', 'origin'. You can override using</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; the `.groups` argument.</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month origin dest  retard_moyen</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 EWR    TUL           55.2</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2 EWR    DSM           48.6</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3 EWR    DSM           71.0</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4 EWR    OKC           47.0</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5 EWR    TYS           60.6</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6 EWR    TYS           68.2</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7 EWR    CAE           81.5</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8 LGA    GSO           50.1</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9 LGA    MSN           24.7</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10 EWR    CAE           50.1</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11    11 LGA    SBN           67.5</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12    12 EWR    BZN           75</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dégroupage" class="level3" data-number="10.4.4">
<h3 data-number="10.4.4" class="anchored" data-anchor-id="dégroupage"><span class="header-section-number">10.4.4</span> Dégroupage</h3>
<p>Lorsqu’on effectue un <code>group_by</code> suivi d’un <code>summarise</code>, le tableau résultat est automatiquement dégroupé <em>de la dernière variable de regroupement</em>. Ainsi le tableau généré par le code suivant est seulement groupé par <code>month</code> et <code>origin</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-53_62fc5c87c8e362264f28d1a5656fab34">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'month', 'origin'. You can override using</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; the `.groups` argument.</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2,313 × 4</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month, origin [36]</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month origin dest  retard_moyen</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 EWR    ALB          41.4 </span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1 EWR    ATL           8.07</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1 EWR    AUS           6.67</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1 EWR    AVL          25.5 </span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1 EWR    BDL          21.1 </span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1 EWR    BNA          16.3 </span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1 EWR    BOS           8.99</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1 EWR    BQN          12.3 </span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1 EWR    BTV          20.5 </span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1 EWR    BUF          23.1 </span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2,303 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>dplyr</code> nous le signale d’ailleurs via un message d’avertissement : <code>summarise() has grouped output by 'month', 'origin'</code>.</p>
<p>Ce dégroupage progressif peut permettre “d’enchaîner” les opérations groupées. Dans l’exemple suivant on calcule le retard moyen au départ par destination et on conserve les trois retards les plus importants <em>pour chaque mois</em>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-54_2b1252430bfd4036dd6f6dd5185af938">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'month'. You can override using the</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 36 × 3</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   month [12]</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month dest  retard_moyen</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 TUL           55.2</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1 SAV           54.8</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1 DSM           42.2</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     2 DSM           48.6</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     2 TUL           34.2</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     2 GSP           32.4</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     3 DSM           71.0</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     3 PVD           47.5</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     3 CAE           46.9</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     4 OKC           47.0</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 26 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut à tout moment “dégrouper” un tableau à l’aide de <code>ungroup</code>. C’est nécessaire, dans l’exemple précédent, si on veut seulement récupérer les trois retards les plus importants pour l’ensemble des couples mois / destination.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-55_58b4f62118e6828512a02842f35fd273">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_moyen, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'month'. You can override using the</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   month dest  retard_moyen</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    12 BZN           75  </span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     7 TUL           72.6</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 DSM           71.0</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut aussi spécifier précisément le comportement de dégroupage de <code>summarise</code> en lui fournissant un argument supplémentaire <code>.groups</code> qui peut prendre notamment les valeurs suivantes&nbsp;:</p>
<ul>
<li><code>"drop_last"</code> : dégroupe seulement de la dernière variable de groupage</li>
<li><code>"drop"</code> : dégroupe totalement le tableau résultat (équivaut à l’application d’un <code>ungroup</code>)</li>
<li><code>"keep"</code> : conserve toutes les variables de groupage</li>
</ul>
<p>Ce concept de dégroupage successif peut être un peu déroutant de prime abord. Il est donc utile de faire attention aux avertissements affichés par ces opérations, et il ne faut pas hésiter à ajouter un <code>ungroup</code> en fin de pipeline si on sait qu’on ne souhaite pas utiliser les groupes encore existants par la suite.</p>
<p>À noter que la fonction <code>count</code>, de son côté, renvoie un tableau non groupé.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-56_f39746b2c483f1fce0de525722a3e58c">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, dest)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,113 × 3</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month dest      n</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 ALB      64</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1 ATL    1396</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1 AUS     169</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1 AVL       2</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1 BDL      37</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1 BHM      25</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1 BNA     399</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1 BOS    1245</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1 BQN      93</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1 BTV     223</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,103 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="autres-fonctions-utiles" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="autres-fonctions-utiles"><span class="header-section-number">10.5</span> Autres fonctions utiles</h2>
<p><code>dplyr</code> contient beaucoup d’autres fonctions utiles pour la manipulation de données.</p>
<section id="slice_sample" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="slice_sample"><span class="header-section-number">10.5.1</span> <code>slice_sample</code></h3>
<p>Ce verbe permet de sélectionner aléatoirement un nombre de lignes (avec l’argument <code>n</code>) ou une fraction des lignes (avec l’argument <code>prop</code>) d’un tableau.</p>
<p>Ainsi si on veut choisir 5 lignes au hasard dans le tableau <code>airports</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-57_31c5245a39e31e040f188a9263f2e052">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                            lat    lon   alt    tz dst   tzone      </span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      </span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 TWF   Magic Valley Regional Airport  42.5 -114.   4151    -7 A     America/De…</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 AUS   Austin Bergstrom Intl          30.2  -97.7   542    -6 A     America/Ch…</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 CAK   Akron Canton Regional Airport  40.9  -81.4  1228    -5 A     America/Ne…</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 CPS   St. Louis Downtown Airport     38.6  -90.2   413    -6 U     America/Ch…</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ARB   Ann Arbor Municipal Airport    42.1  -83.4   839    -5 A     America/Ne…</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on veut tirer au hasard 10% des lignes de <code>flights</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-58_e4aa81a848de1008a4f04b57a85002b9">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.1</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 33,677 × 22</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     9     4      740        749      -9    1025    1043     -18 B6     </span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     9    16      905        905       0    1115    1117      -2 DL     </span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     4    15     1359       1359       0    1656    1714     -18 AA     </span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013    11    21     1452       1446       6    1802    1753       9 B6     </span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     7     9      833        825       8    1100    1108      -8 DL     </span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013    11     9     1157       1135      22    1445    1438       7 DL     </span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013    11    22     1017       1023      -6    1219    1218       1 US     </span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     2    10     1500       1500       0    1745    1742       3 DL     </span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     5    22     1320       1300      20    1433    1410      23 US     </span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     6    30     1932       1825      67    2148    2029      79 DL     </span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 33,667 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ces fonctions sont utiles notamment pour faire de “l’échantillonnage” en tirant au hasard un certain nombre d’observations du tableau.</p>
</section>
<section id="lead-et-lag" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="lead-et-lag"><span class="header-section-number">10.5.2</span> <code>lead</code> et <code>lag</code></h3>
<p><code>lead</code> et <code>lag</code> permettent de décaler les observations d’une variable d’un cran vers l’arrière (pour <code>lead</code>) ou vers l’avant (pour <code>lag</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-59_2346a149e3974cbbbcc5a0f38aa3e0e2">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lead</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  2  3  4  5 NA</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lag</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA  1  2  3  4</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ceci peut être utile pour des données de type “séries temporelles”. Par exemple, on peut facilement calculer l’écart entre le retard au départ de chaque vol et celui du vol précédent&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-60_67a5f619f3d5273cdb08b760bb6ec842">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">dep_delay_prev =</span> <span class="fu">lag</span>(dep_delay),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">dep_delay_diff =</span> dep_delay <span class="sc">-</span> dep_delay_prev</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_delay_prev, dep_delay, dep_delay_diff)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    dep_delay_prev dep_delay dep_delay_diff</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1             NA         2             NA</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2              2         4              2</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3              4         2             -2</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4              2        -1             -3</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5             -1        -6             -5</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6             -6        -4              2</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7             -4        -5             -1</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8             -5        -3              2</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9             -3        -3              0</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10             -3        -2              1</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinct-et-n_distinct" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="distinct-et-n_distinct"><span class="header-section-number">10.5.3</span> <code>distinct</code> et <code>n_distinct</code></h3>
<p><code>distinct</code> filtre les lignes du tableau pour ne conserver que les lignes distinctes, en supprimant toutes les lignes en double.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-61_a5a2fde5a4dd5a9d0c7a7f3850b5c5d8">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(day, month) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 365 × 2</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      day month</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2     1</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3     1</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4     1</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5     1</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6     1</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7     1</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8     1</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9     1</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10     1</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 355 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut lui spécifier une liste de variables&nbsp;: dans ce cas, pour toutes les observations ayant des valeurs identiques pour les variables en question, <code>distinct</code> ne conservera que la première d’entre elles.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-62_5c9d54ac1bad0f8d423bda6864803b19">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(month, day)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 365 × 2</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month   day</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1     2</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     3</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1     4</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1     5</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1     6</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1     7</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1     8</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     9</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1    10</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 355 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’option <code>.keep_all</code> permet, dans l’opération précédente, de conserver l’ensemble des colonnes du tableau&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-63_6e716e05cb89dcdc571022b995c7ea4b">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(month, day, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 365 × 22</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     </span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  2013     1     2       42       2359      43     518     442      36 B6     </span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  2013     1     3       32       2359      33     504     442      22 B6     </span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  2013     1     4       25       2359      26     505     442      23 B6     </span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  2013     1     5       14       2359      15     503     445      18 B6     </span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  2013     1     6       16       2359      17     451     442       9 B6     </span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  2013     1     7       49       2359      50     531     444      47 B6     </span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  2013     1     8      454        500      -6     625     648     -23 US     </span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  2013     1     9        2       2359       3     432     444     -12 B6     </span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  2013     1    10        3       2359       4     426     437     -11 B6     </span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 355 more rows, 12 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, duree_h &lt;dbl&gt;, distance_km &lt;dbl&gt;,</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   vitesse &lt;dbl&gt;, and abbreviated variable names ¹​sched_dep_time, ²​dep_delay,</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La fonction <code>n_distinct</code>, elle, renvoie le nombre de valeurs distinctes d’un vecteur. On peut notamment l’utiliser dans un <code>summarise</code>.</p>
<p>Dans l’exemple qui suit on calcule, pour les trois aéroports de départ de la table <code>flights</code> le nombre de valeurs distinctes de l’aéroport d’arrivée&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-64_e999d768ce91406a5d9f2490c2c634f9">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_dest =</span> <span class="fu">n_distinct</span>(dest))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   origin n_dest</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 EWR        86</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 JFK        70</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 LGA        68</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="relocate" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4" class="anchored" data-anchor-id="relocate"><span class="header-section-number">10.5.4</span> <code>relocate</code></h3>
<p><code>relocate</code> peut être utilisé pour réordonner les colonnes d’une table. Par défaut, si on lui passe un ou plusieurs noms de colonnes, <code>relocate</code> les place en début de tableau.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-65_fd01ce9cbcb032c74bfb395d244d5ef4">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(lat, lon)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,458 × 8</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      lat    lon faa   name                             alt    tz dst   tzone    </span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    </span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  41.1  -80.6 04G   Lansdowne Airport               1044    -5 A     America/…</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  32.5  -85.7 06A   Moton Field Municipal Airport    264    -6 A     America/…</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  42.0  -88.1 06C   Schaumburg Regional              801    -6 A     America/…</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  41.4  -74.4 06N   Randall Airport                  523    -5 A     America/…</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  31.1  -81.4 09J   Jekyll Island Airport             11    -5 A     America/…</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  36.4  -82.2 0A9   Elizabethton Municipal Airport  1593    -5 A     America/…</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  41.5  -84.5 0G6   Williams County Airport          730    -5 A     America/…</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  42.9  -76.8 0G7   Finger Lakes Regional Airport    492    -5 A     America/…</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  39.8  -76.6 0P2   Shoestring Aviation Airfield    1000    -5 U     America/…</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  48.1 -123.  0S9   Jefferson County Intl            108    -8 A     America/…</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,448 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les arguments supplémentaires <code>.before</code> et <code>.after</code> permettent de préciser à quel endroit déplacer la ou les colonnes indiquées.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-66_aa92867d37e003e161621eaa848ab72b">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">'tz'</span>), <span class="at">.after =</span> name)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,458 × 8</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    faa   name                              tz tzone       lat    lon   alt dst  </span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 04G   Lansdowne Airport                 -5 America/…  41.1  -80.6  1044 A    </span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 06A   Moton Field Municipal Airport     -6 America/…  32.5  -85.7   264 A    </span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 06C   Schaumburg Regional               -6 America/…  42.0  -88.1   801 A    </span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 06N   Randall Airport                   -5 America/…  41.4  -74.4   523 A    </span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 09J   Jekyll Island Airport             -5 America/…  31.1  -81.4    11 A    </span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 0A9   Elizabethton Municipal Airport    -5 America/…  36.4  -82.2  1593 A    </span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 0G6   Williams County Airport           -5 America/…  41.5  -84.5   730 A    </span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 0G7   Finger Lakes Regional Airport     -5 America/…  42.9  -76.8   492 A    </span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 0P2   Shoestring Aviation Airfield      -5 America/…  39.8  -76.6  1000 U    </span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 0S9   Jefferson County Intl             -8 America/…  48.1 -123.    108 A    </span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,448 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tables-multiples" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="tables-multiples"><span class="header-section-number">10.6</span> Tables multiples</h2>
<p>Le jeu de données <code>nycflights13</code> est un exemple de données réparties en plusieurs tables. Ici on en a trois&nbsp;: les informations sur les vols dans <code>flights</code>, celles sur les aéroports dans <code>airports</code> et celles sur les compagnies aériennes dans <code>airlines</code>.</p>
<p><code>dplyr</code> propose différentes fonctions permettant de travailler avec des données structurées de cette manière.</p>
<section id="concaténation-bind_rows-et-bind_cols" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="concaténation-bind_rows-et-bind_cols"><span class="header-section-number">10.6.1</span> Concaténation&nbsp;: <code>bind_rows</code> et <code>bind_cols</code></h3>
<p>Les fonctions <code>bind_rows</code> et <code>bind_cols</code> permettent d’ajouter des lignes (respectivement des colonnes) à une table à partir d’une ou plusieurs autres tables.</p>
<p>L’exemple suivant (certes très artificiel) montre l’utilisation de <code>bind_rows</code>. On commence par créer trois tableaux <code>t1</code>, <code>t2</code> et <code>t3</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-67_cf89200b7f977c31091ba8e830793a02">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name, lat, lon) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>t1</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                            lat   lon</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 04G   Lansdowne Airport              41.1 -80.6</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 06A   Moton Field Municipal Airport  32.5 -85.7</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-68_97edfafb39dab22a9dd775f1972963b4">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name, lat, lon) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>t2</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                             lat   lon</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 09J   Jekyll Island Airport           31.1 -81.4</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0A9   Elizabethton Municipal Airport  36.4 -82.2</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-69_96406a10f234eee01e9ddb0526fdd3a5">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(faa, name) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">101</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>t3</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name             </span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;            </span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ADW   Andrews Afb      </span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 AET   Allakaket Airport</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On concaténe ensuite les trois tables avec <code>bind_rows</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-70_87b5f7f54a8d75d9441369c302db854e">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(t1, t2, t3)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   faa   name                             lat   lon</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 04G   Lansdowne Airport               41.1 -80.6</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 06A   Moton Field Municipal Airport   32.5 -85.7</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 09J   Jekyll Island Airport           31.1 -81.4</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0A9   Elizabethton Municipal Airport  36.4 -82.2</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ADW   Andrews Afb                     NA    NA  </span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 AET   Allakaket Airport               NA    NA</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On remarquera que si des colonnes sont manquantes pour certaines tables, comme les colonnes <code>lat</code> et <code>lon</code> de <code>t3</code>, des <code>NA</code> sont automatiquement insérées.</p>
<p>Il peut être utile, quand on concatène des lignes, de garder une trace du tableau d’origine de chacune des lignes dans le tableau final. C’est possible grâce à l’argument <code>.id</code> de <code>bind_rows</code>. On passe à cet argument le nom d’une colonne qui contiendra l’indicateur d’origine des lignes&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-71_216b955242c2bd86420e502b65c5bef4">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(t1, t2, t3, <span class="at">.id =</span> <span class="st">"source"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   source faa   name                             lat   lon</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1      04G   Lansdowne Airport               41.1 -80.6</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1      06A   Moton Field Municipal Airport   32.5 -85.7</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 2      09J   Jekyll Island Airport           31.1 -81.4</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 2      0A9   Elizabethton Municipal Airport  36.4 -82.2</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 3      ADW   Andrews Afb                     NA    NA  </span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 3      AET   Allakaket Airport               NA    NA</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Par défaut la colonne <code>.id</code> ne contient qu’un nombre, différent pour chaque tableau. On peut lui spécifier des valeurs plus explicites en “nommant” les tables dans <code>bind_rows</code> de la manière suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-72_b3834183dda00ebcddd6cdc2fb7f2bc5">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">table1 =</span> t1, <span class="at">table2 =</span> t2, <span class="at">table3 =</span> t3, <span class="at">.id =</span> <span class="st">"source"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   source faa   name                             lat   lon</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 table1 04G   Lansdowne Airport               41.1 -80.6</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 table1 06A   Moton Field Municipal Airport   32.5 -85.7</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 table2 09J   Jekyll Island Airport           31.1 -81.4</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 table2 0A9   Elizabethton Municipal Airport  36.4 -82.2</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 table3 ADW   Andrews Afb                     NA    NA  </span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 table3 AET   Allakaket Airport               NA    NA</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>bind_cols</code> permet de concaténer des colonnes et fonctionne de manière similaire&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-73_c4c659c232b403ec476a69788bb5ebdd">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(dep_delay, dep_time)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(origin, dest)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(arr_delay, arr_time)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(t1, t2, t3)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   dep_delay dep_time origin dest  arr_delay arr_time</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;    &lt;int&gt;</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         2      517 EWR    IAH          11      830</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         4      533 LGA    IAH          20      850</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         2      542 JFK    MIA          33      923</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        -1      544 JFK    BQN         -18     1004</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        -6      554 LGA    ATL         -25      812</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À noter que <code>bind_cols</code> associe les lignes uniquement <em>par position</em>. Les lignes des différents tableaux associés doivent donc correspondre (et leur nombre doit être identique). Pour associer des tables <em>par valeur</em>, on doit utiliser des jointures.</p>
</section>
<section id="jointures" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="jointures"><span class="header-section-number">10.6.2</span> Jointures</h3>
<section id="clés-implicites" class="level4" data-number="10.6.2.1">
<h4 data-number="10.6.2.1" class="anchored" data-anchor-id="clés-implicites"><span class="header-section-number">10.6.2.1</span> Clés implicites</h4>
<p>Très souvent, les données relatives à une analyse sont réparties dans plusieurs tables différentes. Dans notre exemple, on peut voir que la table <code>flights</code> contient le code de la compagnie aérienne du vol dans la variable <code>carrier</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-74_8da7dc9d1bd870f35fb6266f23fb0c6a">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(carrier)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 1</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    carrier</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 UA     </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 UA     </span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AA     </span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 B6     </span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 DL     </span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 UA     </span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 B6     </span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 EV     </span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 B6     </span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 AA     </span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Et que par ailleurs la table <code>airlines</code> contient une information supplémentaire relative à ces compagnies, à savoir le nom complet.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-75_5956247b548adbcbf46f0a3bebdd8959">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>airlines</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 16 × 2</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    carrier name                       </span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                      </span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 9E      Endeavor Air Inc.          </span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 AA      American Airlines Inc.     </span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 AS      Alaska Airlines Inc.       </span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 B6      JetBlue Airways            </span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 DL      Delta Air Lines Inc.       </span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 EV      ExpressJet Airlines Inc.   </span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 F9      Frontier Airlines Inc.     </span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 FL      AirTran Airways Corporation</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 HA      Hawaiian Airlines Inc.     </span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 MQ      Envoy Air                  </span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 OO      SkyWest Airlines Inc.      </span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 UA      United Air Lines Inc.      </span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 US      US Airways Inc.            </span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 VX      Virgin America             </span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 WN      Southwest Airlines Co.     </span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 YV      Mesa Airlines Inc.</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est donc naturel de vouloir associer les deux, ici pour ajouter les noms complets des compagnies à la table <code>flights</code>. Pour cela on va effectuer une <em>jointure</em>&nbsp;: les lignes d’une table seront associées à une autre en se basant non pas sur leur position, mais sur les valeurs d’une ou plusieurs colonnes. Ces colonnes sont appelées des <em>clés</em>.</p>
<p>Pour faire une jointure de ce type, on va utiliser la fonction <code>left_join</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-76_c4005e66009f455a43493208649e0966">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(flights, airlines)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour faciliter la lecture, on va afficher seulement certaines colonnes du résultat&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-77_db58928d21e01930baa379a9998183e0">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(flights, airlines) <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month, day, carrier, name)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(carrier)`</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 4</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month   day carrier name                    </span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                   </span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1 UA      United Air Lines Inc.   </span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1     1 UA      United Air Lines Inc.   </span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     1 AA      American Airlines Inc.  </span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1     1 B6      JetBlue Airways         </span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1     1 DL      Delta Air Lines Inc.    </span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1     1 UA      United Air Lines Inc.   </span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1     1 B6      JetBlue Airways         </span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1     1 EV      ExpressJet Airlines Inc.</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     1 B6      JetBlue Airways         </span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1     1 AA      American Airlines Inc.  </span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On voit que la table résultat est bien la fusion des deux tables d’origine selon les valeurs des deux colonnes clés <code>carrier</code>. On est parti de la table <code>flights</code>, et pour chaque ligne de celle-ci on a ajouté les colonnes de <code>airlines</code> pour lesquelles la valeur de <code>carrier</code> est la même. On a donc bien une nouvelle colonne <code>name</code> dans notre table résultat, avec le nom complet de la compagnie aérienne.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>À noter qu’on peut tout à fait utiliser le <em>pipe</em> avec les fonctions de jointure&nbsp;:</p>
<p><code>flights %&gt;% left_join(airlines)</code>.</p>
</div>
</div>
<p>Nous sommes ici dans le cas le plus simple concernant les clés de jointure&nbsp;: les deux clés sont uniques et portent le même nom dans les deux tables. Par défaut, si on ne lui spécifie pas explicitement les clés, <code>dplyr</code> fusionne en utilisant l’ensemble des colonnes communes aux deux tables. On peut d’ailleurs voir dans cet exemple qu’un message a été affiché précisant que la jointure s’est bien faite sur la variable <code>carrier</code>.</p>
</section>
<section id="clés-explicites" class="level4" data-number="10.6.2.2">
<h4 data-number="10.6.2.2" class="anchored" data-anchor-id="clés-explicites"><span class="header-section-number">10.6.2.2</span> Clés explicites</h4>
<p>La table <code>airports</code>, contient des informations supplémentaires sur les aéroports&nbsp;: nom complet, altitude, position géographique, etc. Chaque aéroport est identifié par un code contenu dans la colonne <code>faa</code>.</p>
<p>Si on regarde la table <code>flights</code>, on voit que le code d’identification des aéroports apparaît à deux endroits différents&nbsp;: pour l’aéroport de départ dans la colonne <code>origin</code>, et pour celui d’arrivée dans la colonne <code>dest</code>. On a donc deux clés de jointure possibles, et qui portent un nom différent de la clé de <code>airports</code>.</p>
<p>On va commencer par fusionner les données concernant l’aéroport de départ. Pour simplifier l’affichage des résultats, on va se contenter d’un sous-ensemble des deux tables&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-78_b0d6b84b97d016ced765e2df0154028c">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(month, day, origin, dest)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>airports_ex <span class="ot">&lt;-</span> airports <span class="sc">%&gt;%</span> <span class="fu">select</span>(faa, alt, name)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on se contente d’un <code>left_join</code> comme à l’étape précédente, on obtient un message d’erreur car aucune colonne commune ne peut être identifiée comme clé de jointure&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-79_908b75d1dce23a5e1497472365f96e5e">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(airports_ex)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `left_join()`:</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! `by` must be supplied when `x` and `y` have no common variables.</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use `cross_join()` to perform a cross-join.</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On doit donc spécifier explicitement les clés avec l’argument <code>by</code> de <code>left_join</code>. Ici la clé est nommée <code>origin</code> dans la première table, et <code>faa</code> dans la seconde. La syntaxe est donc la suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-80_c63216046cd5da37bd1be7b9d2e57b7c">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 6</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month   day origin dest    alt name               </span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1 EWR    IAH      18 Newark Liberty Intl</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1     1 LGA    IAH      22 La Guardia         </span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     1 JFK    MIA      13 John F Kennedy Intl</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1     1 JFK    BQN      13 John F Kennedy Intl</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1     1 LGA    ATL      22 La Guardia         </span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1     1 EWR    ORD      18 Newark Liberty Intl</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1     1 EWR    FLL      18 Newark Liberty Intl</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1     1 LGA    IAD      22 La Guardia         </span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     1 JFK    MCO      13 John F Kennedy Intl</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1     1 LGA    ORD      22 La Guardia         </span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On constate que les deux nouvelles colonnes <code>name</code> et <code>alt</code> contiennent bien les données correspondant à l’aéroport de départ.</p>
<p>On va stocker le résultat de cette jointure dans la table <code>flights_ex</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-81_630e12d5062a37d0bb9f8588fbba0421">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="ot">&lt;-</span> flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Supposons qu’on souhaite maintenant fusionner à nouveau les informations de la table <code>airports</code>, mais cette fois pour les aéroports d’arrivée de notre nouvelle table <code>flights_ex</code>. Les deux clés sont donc désormais <code>dest</code> dans la première table, et <code>faa</code> dans la deuxième. La syntaxe est donc la suivante&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-82_4cc225eb504049577d223d9cd25b4741">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports_ex, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 8</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month   day origin dest  alt.x name.x              alt.y name.y              </span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1 EWR    IAH      18 Newark Liberty Intl    97 George Bush Interco…</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1     1 LGA    IAH      22 La Guardia             97 George Bush Interco…</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     1 JFK    MIA      13 John F Kennedy Intl     8 Miami Intl          </span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1     1 JFK    BQN      13 John F Kennedy Intl    NA &lt;NA&gt;                </span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1     1 LGA    ATL      22 La Guardia           1026 Hartsfield Jackson …</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1     1 EWR    ORD      18 Newark Liberty Intl   668 Chicago Ohare Intl  </span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1     1 EWR    FLL      18 Newark Liberty Intl     9 Fort Lauderdale Hol…</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1     1 LGA    IAD      22 La Guardia            313 Washington Dulles I…</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     1 JFK    MCO      13 John F Kennedy Intl    96 Orlando Intl        </span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1     1 LGA    ORD      22 La Guardia            668 Chicago Ohare Intl  </span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cela fonctionne, les informations de l’aéroport d’arrivée ont bien été ajoutées, mais on constate que les colonnes ont été renommées. En effet, ici les deux tables fusionnées contenaient toutes les deux des colonnes <code>name</code> et <code>alt</code>. Comme on ne peut pas avoir deux colonnes avec le même nom dans un tableau, <code>dplyr</code> a renommé les colonnes de la première table en <code>name.x</code> et <code>alt.x</code>, et celles de la deuxième en <code>name.y</code> et <code>alt.y</code>.</p>
<p>C’est pratique, mais pas forcément très parlant. On pourrait renommer manuellement les colonnes avec <code>rename</code> avant de faire la jointure pour avoir des intitulés plus explicites, mais on peut aussi utiliser l’argument <code>suffix</code> de <code>left_join</code>, qui permet d’indiquer les suffixes à ajouter aux colonnes.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-83_759ade9e446d85ac95489421e8475396">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>flights_ex <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    airports_ex,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_depart"</span>, <span class="st">"_arrivee"</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 336,776 × 8</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    month   day origin dest  alt_depart name_depart         alt_arrivee name_ar…¹</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1 EWR    IAH           18 Newark Liberty Intl          97 George B…</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1     1 LGA    IAH           22 La Guardia                   97 George B…</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     1 JFK    MIA           13 John F Kennedy Intl           8 Miami In…</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1     1 JFK    BQN           13 John F Kennedy Intl          NA &lt;NA&gt;     </span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1     1 LGA    ATL           22 La Guardia                 1026 Hartsfie…</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1     1 EWR    ORD           18 Newark Liberty Intl         668 Chicago …</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1     1 EWR    FLL           18 Newark Liberty Intl           9 Fort Lau…</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1     1 LGA    IAD           22 La Guardia                  313 Washingt…</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     1 JFK    MCO           13 John F Kennedy Intl          96 Orlando …</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1     1 LGA    ORD           22 La Guardia                  668 Chicago …</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 336,766 more rows, and abbreviated variable name ¹​name_arrivee</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On obtient ainsi directement des noms de colonnes nettement plus clairs.</p>
</section>
</section>
<section id="types-de-jointures" class="level3" data-number="10.6.3">
<h3 data-number="10.6.3" class="anchored" data-anchor-id="types-de-jointures"><span class="header-section-number">10.6.3</span> Types de jointures</h3>
<p>Jusqu’à présent nous avons utilisé la fonction <code>left_join</code>, mais il existe plusieurs types de jointures.</p>
<p>Partons de deux tables d’exemple, <code>personnes</code> et <code>voitures</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-84_4ca1791bda036c683d646b49738e953e">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">"Sylvie"</span>, <span class="st">"Sylvie"</span>, <span class="st">"Monique"</span>, <span class="st">"Gunter"</span>, <span class="st">"Rayan"</span>, <span class="st">"Rayan"</span>),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">voiture =</span> <span class="fu">c</span>(<span class="st">"Twingo"</span>, <span class="st">"Ferrari"</span>, <span class="st">"Scenic"</span>, <span class="st">"Lada"</span>, <span class="st">"Twingo"</span>, <span class="st">"Clio"</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-85_4fe32166419b3e044a59594d8b451e66">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-86_c70bc5b733f7aadfa77476c4e8a44039">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>voitures <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">voiture =</span> <span class="fu">c</span>(<span class="st">"Twingo"</span>, <span class="st">"Ferrari"</span>, <span class="st">"Clio"</span>, <span class="st">"Lada"</span>, <span class="st">"208"</span>),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">vitesse =</span> <span class="fu">c</span>(<span class="st">"140"</span>, <span class="st">"280"</span>, <span class="st">"160"</span>, <span class="st">"85"</span>, <span class="st">"160"</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-87_7f1bd92c02b13a3a229898204bb0865a">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="left_join" class="level4" data-number="10.6.3.1">
<h4 data-number="10.6.3.1" class="anchored" data-anchor-id="left_join"><span class="header-section-number">10.6.3.1</span> left_join</h4>
<p>Si on fait un <code>left_join</code> de <code>voitures</code> sur <code>personnes</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-88_3aef362a6120517037f0e1785285c6c2">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-89_adc420df8844d181fc77e353057da4be">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On voit que chaque ligne de <code>personnes</code> est bien présente, et qu’on lui a ajouté une ligne de <code>voitures</code> correspondante si elle existe. Dans le cas du <code>Scenic</code>, il n’y a avait pas de ligne dans <code>voitures</code>, donc <code>vitesse</code> a été mise à <code>NA</code>. Dans le cas de <code>208</code>, présente dans <code>voitures</code> mais pas dans <code>personnes</code>, la ligne n’apparaît pas.</p>
<p>Si on fait un <code>left_join</code> cette fois de <code>personnes</code> sur <code>voitures</code>, c’est l’inverse&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-90_60d8258ca7577115a8fbfb8e61566e63">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>voitures <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(personnes)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-91_16eba85d5a60a23b4d40031f4eea15bc">
<pre><code>#&gt; Joining with `by = join_by(voiture)`
#&gt; Warning in left_join(., personnes): Each row in `x` is expected to match at most 1 row in `y`.
#&gt; ℹ Row 1 of `x` matches multiple rows.
#&gt; ℹ If multiple matches are expected, set `multiple = "all"` to silence this
#&gt;   warning.</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
<th style="text-align: left;">nom</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
<td style="text-align: left;">Sylvie</td>
</tr>
<tr class="even">
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
<td style="text-align: left;">Rayan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
<td style="text-align: left;">Sylvie</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">Rayan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">Gunter</td>
</tr>
<tr class="even">
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>La ligne <code>208</code> est là, mais <code>nom</code> est à <code>NA</code>. Par contre <code>Monique</code> est absente. Et on remarquera que la ligne <code>Twingo</code>, présente deux fois dans <code>personnes</code>, a été dupliquée pour être associée aux deux lignes de données de <code>Sylvie</code> et <code>Rayan</code>.</p>
<p>En résumé, quand on fait un <code>left_join(x, y)</code>, toutes les lignes de <code>x</code> sont présentes, et dupliquées si nécessaire quand elles apparaissent plusieurs fois dans <code>y</code>. Les lignes de <code>y</code> non présentes dans <code>x</code> disparaissent. Les lignes de <code>x</code> non présentes dans <code>y</code> se voient attribuer des <code>NA</code> pour les nouvelles colonnes.</p>
<p>Intuitivement, on pourrait considérer que <code>left_join(x, y)</code> signifie “ramener l’information de la table <code>y</code> sur la table <code>x</code>”.</p>
<p>En général, <code>left_join</code> sera le type de jointures le plus fréquemment utilisé.</p>
</section>
<section id="right_join" class="level4" data-number="10.6.3.2">
<h4 data-number="10.6.3.2" class="anchored" data-anchor-id="right_join"><span class="header-section-number">10.6.3.2</span> right_join</h4>
<p>La jointure <code>right_join</code> est l’exacte symétrique de <code>left_join</code>, c’est-à dire que <code>right_join(x, y)</code> est équivalent à <code>left_join(y, x)</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-92_757cc6b46a4bff2acf3279af31fdf22e">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-93_464284b5c889c5194eab48b830bfae0c">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="inner_join" class="level4" data-number="10.6.3.3">
<h4 data-number="10.6.3.3" class="anchored" data-anchor-id="inner_join"><span class="header-section-number">10.6.3.3</span> inner_join</h4>
<p>Dans le cas de <code>inner_join(x, y)</code>, seules les lignes présentes à la fois dans <code>x</code> et <code>y</code> sont conservées (et si nécessaire dupliquées) dans la table résultat&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-94_000f36dce294955cf1b72aefb7966ac3">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-95_d41e26aca0841172441f1f972d1b8bca">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Ici la ligne <code>208</code> est absente, ainsi que la ligne <code>Monique</code>, qui dans le cas d’un <code>left_join</code> avait été conservée et s’était vue attribuer une <code>vitesse</code> à <code>NA</code>.</p>
</section>
<section id="full_join" class="level4" data-number="10.6.3.4">
<h4 data-number="10.6.3.4" class="anchored" data-anchor-id="full_join"><span class="header-section-number">10.6.3.4</span> full_join</h4>
<p>Dans le cas de <code>full_join(x, y)</code>, toutes les lignes de <code>x</code> et toutes les lignes de <code>y</code> sont conservées (avec des <code>NA</code> ajoutés si nécessaire) même si elles sont absentes de l’autre table&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-96_7af5854c8dd0bc9f9a391fafcb7b5f57">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-97_e1c108976205241fd0c0540cd6e7853b">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
<th style="text-align: left;">vitesse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
<td style="text-align: left;">280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
<td style="text-align: left;">85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
<td style="text-align: left;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">208</td>
<td style="text-align: left;">160</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="semi_join-et-anti_join" class="level4" data-number="10.6.3.5">
<h4 data-number="10.6.3.5" class="anchored" data-anchor-id="semi_join-et-anti_join"><span class="header-section-number">10.6.3.5</span> semi_join et anti_join</h4>
<p><code>semi_join</code> et <code>anti_join</code> sont des jointures <em>filtrantes</em>, c’est-à-dire qu’elles sélectionnent les lignes de <code>x</code> sans ajouter les colonnes de <code>y</code>.</p>
<p>Ainsi, <code>semi_join</code> ne conservera que les lignes de <code>x</code> pour lesquelles une ligne de <code>y</code> existe également, et supprimera les autres. Dans notre exemple, la ligne <code>Monique</code> est donc supprimée&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-98_d7fdb349659dc686e8062775fec55d00">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-99_aab03d4a1b14122e5ae16db95e3a6948">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sylvie</td>
<td style="text-align: left;">Ferrari</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gunter</td>
<td style="text-align: left;">Lada</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Twingo</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rayan</td>
<td style="text-align: left;">Clio</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Un <code>anti_join</code> fait l’inverse, il ne conserve que les lignes de <code>x</code> absentes de <code>y</code>. Dans notre exemple, on ne garde donc que la ligne <code>Monique</code>&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-100_1d437fcbf1d4322645b9fefee0390f19">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>personnes <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(voitures)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-101_6db57f337629dad608a8229811b2c694">
<pre><code>#&gt; Joining with `by = join_by(voiture)`</code></pre>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">nom</th>
<th style="text-align: left;">voiture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Monique</td>
<td style="text-align: left;">Scenic</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="ressources" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="ressources"><span class="header-section-number">10.7</span> Ressources</h2>
<p>Toutes les ressources ci-dessous sont en anglais…</p>
<p>Le livre <em>R for data science</em>, librement accessible en ligne, contient plusieurs chapitres très complets sur la manipulation des données, notamment&nbsp;:</p>
<ul>
<li><a href="http://r4ds.had.co.nz/transform.html">Data transformation</a> pour les manipulations</li>
<li><a href="http://r4ds.had.co.nz/relational-data.html">Relational data</a> pour les tables multiples</li>
</ul>
<p>Le <a href="http://dplyr.tidyverse.org/">site de l’extension</a> comprend une <a href="http://dplyr.tidyverse.org/reference/index.html">liste des fonctions</a> et les pages d’aide associées, mais aussi une <a href="http://dplyr.tidyverse.org/articles/dplyr.html">introduction</a> au package et plusieurs articles dont un spécifiquement sur les <a href="http://dplyr.tidyverse.org/articles/two-table.html">jointures</a>.</p>
<p>Enfin, une “antisèche” très synthétique est également accessible depuis RStudio, en allant dans le menu <em>Help</em> puis <em>Cheatsheets</em> et <em>Data Transformation with dplyr</em>.</p>
</section>
<section id="exercices" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="exercices"><span class="header-section-number">10.8</span> Exercices</h2>
<p>On commence par charger les extensions et les données nécessaires.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-102_da7e081a9ef4a1f9566db8cfd20dacd4">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(flights)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airports)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airlines)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="les-verbes-de-base-de-dplyr" class="level3" data-number="10.8.1">
<h3 data-number="10.8.1" class="anchored" data-anchor-id="les-verbes-de-base-de-dplyr"><span class="header-section-number">10.8.1</span> Les verbes de base de <code>dplyr</code></h3>
<p><strong>Exercice 1.1</strong></p>
<p>Sélectionner la dixième ligne du tableau des aéroports (<code>airports</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-103_2453044c767c2d9ea422218fd6085b7f">
<pre><code>#&gt; # A tibble: 1 × 8
#&gt;   faa   name                    lat   lon   alt    tz dst   tzone              
#&gt;   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              
#&gt; 1 0S9   Jefferson County Intl  48.1 -123.   108    -8 A     America/Los_Angeles</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp11_9d881416e5b47e70db004e4385ff56ea">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(airports, <span class="dv">10</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionner les 5 premières lignes de la table <code>airlines</code>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-104_186958fd7b0ce2f581c499cf9df95e60">
<pre><code>#&gt; # A tibble: 5 × 2
#&gt;   carrier name                  
#&gt;   &lt;chr&gt;   &lt;chr&gt;                 
#&gt; 1 9E      Endeavor Air Inc.     
#&gt; 2 AA      American Airlines Inc.
#&gt; 3 AS      Alaska Airlines Inc.  
#&gt; 4 B6      JetBlue Airways       
#&gt; 5 DL      Delta Air Lines Inc.</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp11b_39e88f9119991c105c5111e7b669e3ce">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(airlines, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionner l’aéroport avec l’altitude la plus basse.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-105_ce86a7812ed85da91985c94713edc88a">
<pre><code>#&gt; # A tibble: 1 × 8
#&gt;   faa   name          lat   lon   alt    tz dst   tzone              
#&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              
#&gt; 1 IPL   Imperial Co  32.8 -116.   -54    -8 A     America/Los_Angeles</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp11c_193f3424755c3bc685e3f679b25b62c0">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_min</span>(airports, alt)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 1.2</strong></p>
<p>Sélectionnez les vols du mois de juillet (variable <code>month</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-106_6a03fc140a85b41ab60d8a6f48ad0fbe">
<pre><code>#&gt; # A tibble: 29,425 × 19
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     7     1        1       2029     212     236    2359     157 B6     
#&gt;  2  2013     7     1        2       2359       3     344     344       0 B6     
#&gt;  3  2013     7     1       29       2245     104     151       1     110 B6     
#&gt;  4  2013     7     1       43       2130     193     322      14     188 B6     
#&gt;  5  2013     7     1       44       2150     174     300     100     120 AA     
#&gt;  6  2013     7     1       46       2051     235     304    2358     186 B6     
#&gt;  7  2013     7     1       48       2001     287     308    2305     243 VX     
#&gt;  8  2013     7     1       58       2155     183     335      43     172 B6     
#&gt;  9  2013     7     1      100       2146     194     327      30     177 B6     
#&gt; 10  2013     7     1      100       2245     135     337     135     122 B6     
#&gt; # … with 29,415 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp12_0cb76510f0afc4e170c67af62924e317">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">7</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionnez les vols avec un retard à l’arrivée (variable <code>arr_delay</code>) compris entre 5 et 15 minutes.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-107_641df207eb82dea1b6cceff1dfd0401e">
<pre><code>#&gt; # A tibble: 36,392 × 19
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     
#&gt;  2  2013     1     1      554        558      -4     740     728      12 UA     
#&gt;  3  2013     1     1      558        600      -2     753     745       8 AA     
#&gt;  4  2013     1     1      558        600      -2     924     917       7 UA     
#&gt;  5  2013     1     1      600        600       0     837     825      12 MQ     
#&gt;  6  2013     1     1      611        600      11     945     931      14 UA     
#&gt;  7  2013     1     1      623        610      13     920     915       5 AA     
#&gt;  8  2013     1     1      624        630      -6     840     830      10 MQ     
#&gt;  9  2013     1     1      629        630      -1     824     810      14 AA     
#&gt; 10  2013     1     1      632        608      24     740     728      12 EV     
#&gt; # … with 36,382 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp12b_104a665f9215f18249272e2324769593">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, arr_delay <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> arr_delay <span class="sc">&lt;=</span> <span class="dv">15</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionnez les vols des compagnies Delta, United et American (codes <code>DL</code>, <code>UA</code> et <code>AA</code> de la variable <code>carrier</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-108_189ba7d6caf3d7edeb008bfa070dce39">
<pre><code>#&gt; # A tibble: 139,504 × 19
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     
#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     
#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     
#&gt;  4  2013     1     1      554        600      -6     812     837     -25 DL     
#&gt;  5  2013     1     1      554        558      -4     740     728      12 UA     
#&gt;  6  2013     1     1      558        600      -2     753     745       8 AA     
#&gt;  7  2013     1     1      558        600      -2     924     917       7 UA     
#&gt;  8  2013     1     1      558        600      -2     923     937     -14 UA     
#&gt;  9  2013     1     1      559        600      -1     941     910      31 AA     
#&gt; 10  2013     1     1      559        600      -1     854     902      -8 UA     
#&gt; # … with 139,494 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp12c_08136b3e2fc829550a7e56d85ee9268d">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, carrier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DL"</span>, <span class="st">"UA"</span>, <span class="st">"AA"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 1.3</strong></p>
<p>Triez la table <code>flights</code> par retard au départ décroissant.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-109_c3de481135e4b95d2ffe397189b8d823">
<pre><code>#&gt; # A tibble: 336,776 × 19
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     1     9      641        900    1301    1242    1530    1272 HA     
#&gt;  2  2013     6    15     1432       1935    1137    1607    2120    1127 MQ     
#&gt;  3  2013     1    10     1121       1635    1126    1239    1810    1109 MQ     
#&gt;  4  2013     9    20     1139       1845    1014    1457    2210    1007 AA     
#&gt;  5  2013     7    22      845       1600    1005    1044    1815     989 MQ     
#&gt;  6  2013     4    10     1100       1900     960    1342    2211     931 DL     
#&gt;  7  2013     3    17     2321        810     911     135    1020     915 DL     
#&gt;  8  2013     6    27      959       1900     899    1236    2226     850 DL     
#&gt;  9  2013     7    22     2257        759     898     121    1026     895 DL     
#&gt; 10  2013    12     5      756       1700     896    1058    2020     878 AA     
#&gt; # … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp13_8f66b9bdbc685bdbbd3fbca9aa3dfa57">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 1.4</strong></p>
<p>Sélectionnez les colonnes <code>name</code>, <code>lat</code> et <code>lon</code> de la table <code>airports</code></p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-110_42c72f31255698c66d331f6c47a1588a">
<pre><code>#&gt; # A tibble: 1,458 × 3
#&gt;    name                             lat    lon
#&gt;    &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 Lansdowne Airport               41.1  -80.6
#&gt;  2 Moton Field Municipal Airport   32.5  -85.7
#&gt;  3 Schaumburg Regional             42.0  -88.1
#&gt;  4 Randall Airport                 41.4  -74.4
#&gt;  5 Jekyll Island Airport           31.1  -81.4
#&gt;  6 Elizabethton Municipal Airport  36.4  -82.2
#&gt;  7 Williams County Airport         41.5  -84.5
#&gt;  8 Finger Lakes Regional Airport   42.9  -76.8
#&gt;  9 Shoestring Aviation Airfield    39.8  -76.6
#&gt; 10 Jefferson County Intl           48.1 -123. 
#&gt; # … with 1,448 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp14_d7682b31eb8d22aa3680d31f0b6459c1">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, name, lat, lon)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionnez toutes les colonnes de la table <code>airports</code> sauf les colonnes <code>tz</code> et <code>tzone</code></p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-111_2ce6da212cbdd06fbbc88cf985da1219">
<pre><code>#&gt; # A tibble: 1,458 × 6
#&gt;    faa   name                             lat    lon   alt dst  
#&gt;    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
#&gt;  1 04G   Lansdowne Airport               41.1  -80.6  1044 A    
#&gt;  2 06A   Moton Field Municipal Airport   32.5  -85.7   264 A    
#&gt;  3 06C   Schaumburg Regional             42.0  -88.1   801 A    
#&gt;  4 06N   Randall Airport                 41.4  -74.4   523 A    
#&gt;  5 09J   Jekyll Island Airport           31.1  -81.4    11 A    
#&gt;  6 0A9   Elizabethton Municipal Airport  36.4  -82.2  1593 A    
#&gt;  7 0G6   Williams County Airport         41.5  -84.5   730 A    
#&gt;  8 0G7   Finger Lakes Regional Airport   42.9  -76.8   492 A    
#&gt;  9 0P2   Shoestring Aviation Airfield    39.8  -76.6  1000 U    
#&gt; 10 0S9   Jefferson County Intl           48.1 -123.    108 A    
#&gt; # … with 1,448 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp14b_04ba2f03fe69a65f11a78bfe8bb80dbe">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(airports, <span class="sc">-</span>tz, <span class="sc">-</span>tzone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sélectionnez toutes les colonnes de la table <code>flights</code> dont les noms se terminent par “delay”.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-112_310e42747c0330b145fbf395e7a7db93">
<pre><code>#&gt; # A tibble: 336,776 × 2
#&gt;    dep_delay arr_delay
#&gt;        &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1         2        11
#&gt;  2         4        20
#&gt;  3         2        33
#&gt;  4        -1       -18
#&gt;  5        -6       -25
#&gt;  6        -4        12
#&gt;  7        -5        19
#&gt;  8        -3       -14
#&gt;  9        -3        -8
#&gt; 10        -2         8
#&gt; # … with 336,766 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp14c_f5dc5689d159b6d35568c1c639133bf7">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, <span class="fu">ends_with</span>(<span class="st">"delay"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Dans la table <code>airports</code>, renommez la colonne <code>alt</code> en <code>altitude</code> et la colonne <code>tzone</code> en <code>fuseau_horaire</code>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-113_e995b3a596504e63704d57a2558941e2">
<pre><code>#&gt; # A tibble: 1,458 × 8
#&gt;    faa   name                             lat    lon altit…¹    tz dst   fusea…²
#&gt;    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
#&gt;  1 04G   Lansdowne Airport               41.1  -80.6    1044    -5 A     Americ…
#&gt;  2 06A   Moton Field Municipal Airport   32.5  -85.7     264    -6 A     Americ…
#&gt;  3 06C   Schaumburg Regional             42.0  -88.1     801    -6 A     Americ…
#&gt;  4 06N   Randall Airport                 41.4  -74.4     523    -5 A     Americ…
#&gt;  5 09J   Jekyll Island Airport           31.1  -81.4      11    -5 A     Americ…
#&gt;  6 0A9   Elizabethton Municipal Airport  36.4  -82.2    1593    -5 A     Americ…
#&gt;  7 0G6   Williams County Airport         41.5  -84.5     730    -5 A     Americ…
#&gt;  8 0G7   Finger Lakes Regional Airport   42.9  -76.8     492    -5 A     Americ…
#&gt;  9 0P2   Shoestring Aviation Airfield    39.8  -76.6    1000    -5 U     Americ…
#&gt; 10 0S9   Jefferson County Intl           48.1 -123.      108    -8 A     Americ…
#&gt; # … with 1,448 more rows, and abbreviated variable names ¹​altitude,
#&gt; #   ²​fuseau_horaire</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp14d_5da82f28afd1a2bf81fa6d54732a8f18">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(airports, <span class="at">altitude =</span> alt, <span class="at">fuseau_horaire =</span> tzone)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 1.5</strong></p>
<p>Dans la table <code>airports</code>, la colonne <code>alt</code> contient l’altitude de l’aéroport en pieds. Créer une nouvelle variable <code>alt_m</code> contenant l’altitude en mètres (on convertit des pieds en mètres en les divisant par 3.2808). Sélectionner dans la table obtenue uniquement les deux colonnes <code>alt</code> et <code>alt_m</code>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-114_44b457e3f80bd700d26c298a2ea434af">
<pre><code>#&gt; # A tibble: 1,458 × 2
#&gt;      alt  alt_m
#&gt;    &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1  1044 318.  
#&gt;  2   264  80.5 
#&gt;  3   801 244.  
#&gt;  4   523 159.  
#&gt;  5    11   3.35
#&gt;  6  1593 486.  
#&gt;  7   730 223.  
#&gt;  8   492 150.  
#&gt;  9  1000 305.  
#&gt; 10   108  32.9 
#&gt; # … with 1,448 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp15_7ea730f39995a77817a17192eee8dd68">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">mutate</span>(airports, <span class="at">alt_m =</span> alt <span class="sc">/</span> <span class="fl">3.2808</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(tmp, alt, alt_m)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="enchaîner-des-opérations" class="level3" data-number="10.8.2">
<h3 data-number="10.8.2" class="anchored" data-anchor-id="enchaîner-des-opérations"><span class="header-section-number">10.8.2</span> Enchaîner des opérations</h3>
<p><strong>Exercice 2.1</strong></p>
<p>Réécrire le code de l’exercice précédent en utilisant le <em>pipe</em> <code>%&gt;%</code>.</p>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp21_d6b5e6a4bffe90b9e4f142594208a2a2">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alt_m =</span> alt <span class="sc">/</span> <span class="fl">3.2808</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(alt, alt_m)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 2.2</strong></p>
<p>En utilisant le <em>pipe</em>, sélectionnez les vols à destination de San Francico (code <code>SFO</code> de la variable <code>dest</code>) et triez-les selon le retard au départ décroissant (variable <code>dep_delay</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-116_e1901fe8aaac1dabc31d8bd77e56d326">
<pre><code>#&gt; # A tibble: 13,331 × 19
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     9    20     1139       1845    1014    1457    2210    1007 AA     
#&gt;  2  2013     7     7     2123       1030     653      17    1345     632 VX     
#&gt;  3  2013     7     7     2059       1030     629     106    1350     676 VX     
#&gt;  4  2013     7     6      149       1600     589     456    1935     561 DL     
#&gt;  5  2013     7    10      133       1800     453     455    2130     445 B6     
#&gt;  6  2013     7    10     2342       1630     432     312    1959     433 VX     
#&gt;  7  2013     7     7     2204       1525     399     107    1823     404 UA     
#&gt;  8  2013     7     7     2306       1630     396     250    1959     411 VX     
#&gt;  9  2013     6    23     1833       1200     393      NA    1507      NA UA     
#&gt; 10  2013     7    10     2232       1609     383     138    1928     370 UA     
#&gt; # … with 13,321 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp22_24048389675510d27ac54ee818e03518">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"SFO"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 2.3</strong></p>
<p>Sélectionnez les vols des mois de septembre et octobre, conservez les colonnes <code>dest</code> et <code>dep_delay</code>, créez une nouvelle variable <code>retard_h</code> contenant le retard au départ en heures, et conservez uniquement les 5 lignes avec les plus grandes valeurs de <code>retard_h</code>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-117_9264bc37329e3d80babc9c72c2cbf18f">
<pre><code>#&gt; # A tibble: 5 × 3
#&gt;   dest  dep_delay retard_h
#&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 SFO        1014    16.9 
#&gt; 2 ATL         702    11.7 
#&gt; 3 DTW         696    11.6 
#&gt; 4 ATL         602    10.0 
#&gt; 5 MSP         593     9.88</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp23_5ea50d94b6a04e964c7bf4adb89ebb1f">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dest, dep_delay) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">retard_h =</span> dep_delay <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(retard_h, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="group_by-et-summarise" class="level3" data-number="10.8.3">
<h3 data-number="10.8.3" class="anchored" data-anchor-id="group_by-et-summarise"><span class="header-section-number">10.8.3</span> <code>group_by</code> et <code>summarise</code></h3>
<p><strong>Exercice 3.1</strong></p>
<p>Affichez le nombre de vols par mois.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-118_743c6e2fb22888ce2a1fcdede4bb2bfc">
<pre><code>#&gt; # A tibble: 12 × 2
#&gt;    month     n
#&gt;    &lt;int&gt; &lt;int&gt;
#&gt;  1     1 27004
#&gt;  2     2 24951
#&gt;  3     3 28834
#&gt;  4     4 28330
#&gt;  5     5 28796
#&gt;  6     6 28243
#&gt;  7     7 29425
#&gt;  8     8 29327
#&gt;  9     9 27574
#&gt; 10    10 28889
#&gt; 11    11 27268
#&gt; 12    12 28135</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp31_1b167db8607c6d002ac627e534e60ec2">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Triez la table résultat selon le nombre de vols croissant.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-119_f0088cefea2eb413e1bad534def962da">
<pre><code>#&gt; # A tibble: 12 × 2
#&gt;    month     n
#&gt;    &lt;int&gt; &lt;int&gt;
#&gt;  1     2 24951
#&gt;  2     1 27004
#&gt;  3    11 27268
#&gt;  4     9 27574
#&gt;  5    12 28135
#&gt;  6     6 28243
#&gt;  7     4 28330
#&gt;  8     5 28796
#&gt;  9     3 28834
#&gt; 10    10 28889
#&gt; 11     8 29327
#&gt; 12     7 29425</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp31b_9a2491be3c9770f304f4f88d93cf5611">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 3.2</strong></p>
<p>Calculer la distance moyenne des vols selon l’aéroport de départ (variable <code>origin</code>).</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-120_7e85c4fb5426881ba63d2d9b81218dcb">
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   origin distance_moyenne
#&gt;   &lt;chr&gt;             &lt;dbl&gt;
#&gt; 1 EWR               1057.
#&gt; 2 JFK               1266.
#&gt; 3 LGA                780.</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp32_bc97d8858b726d8c25113576664794ae">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">distance_moyenne =</span> <span class="fu">mean</span>(distance))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 3.3</strong></p>
<p>Calculer le nombre de vols à destination de Los Angeles (code <code>LAX</code>) pour chaque mois de l’année.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-121_bffc4996b391ee9c578640772cad3606">
<pre><code>#&gt; # A tibble: 12 × 2
#&gt;    month     n
#&gt;    &lt;int&gt; &lt;int&gt;
#&gt;  1     1  1159
#&gt;  2     2  1030
#&gt;  3     3  1178
#&gt;  4     4  1382
#&gt;  5     5  1453
#&gt;  6     6  1430
#&gt;  7     7  1500
#&gt;  8     8  1505
#&gt;  9     9  1384
#&gt; 10    10  1409
#&gt; 11    11  1336
#&gt; 12    12  1408</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp33_630b63af6f9bb804289ca153b6df062b">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"LAX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 3.4</strong></p>
<p>Calculer le nombre de vols selon le mois et la destination.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-122_48e3c5a411995a96c67d31d08c7fb0e7">
<pre><code>#&gt; # A tibble: 1,113 × 3
#&gt;    month dest      n
#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt;
#&gt;  1     1 ALB      64
#&gt;  2     1 ATL    1396
#&gt;  3     1 AUS     169
#&gt;  4     1 AVL       2
#&gt;  5     1 BDL      37
#&gt;  6     1 BHM      25
#&gt;  7     1 BNA     399
#&gt;  8     1 BOS    1245
#&gt;  9     1 BQN      93
#&gt; 10     1 BTV     223
#&gt; # … with 1,103 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp34_24471864b440ab689248f3d18181b8b4">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, dest)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Ne conserver, pour chaque mois, que la destination avec le nombre maximal de vols.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-123_5b62dbbdee3d5efc4da90e56b9fa1bd6">
<pre><code>#&gt; # A tibble: 12 × 3
#&gt; # Groups:   month [12]
#&gt;    month dest      n
#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt;
#&gt;  1     1 ATL    1396
#&gt;  2     2 ATL    1267
#&gt;  3     3 ATL    1448
#&gt;  4     4 ATL    1490
#&gt;  5     5 ORD    1582
#&gt;  6     6 ORD    1547
#&gt;  7     7 ORD    1573
#&gt;  8     8 ORD    1604
#&gt;  9     9 ORD    1582
#&gt; 10    10 ORD    1604
#&gt; 11    11 ATL    1384
#&gt; 12    12 ATL    1463</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp34b_aa3e3eb922101b70cd8a109495d6d26b">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, dest) <span class="sc">%&gt;%</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 3.5</strong></p>
<p>Calculer le nombre de vols selon le mois. Ajouter une colonne comportant le pourcentage de vols annuels réalisés par mois.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-124_838facc8273da65b16362a8f20e62a29">
<pre><code>#&gt; # A tibble: 12 × 3
#&gt;    month     n pourcentage
#&gt;    &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
#&gt;  1     1 27004        8.02
#&gt;  2     2 24951        7.41
#&gt;  3     3 28834        8.56
#&gt;  4     4 28330        8.41
#&gt;  5     5 28796        8.55
#&gt;  6     6 28243        8.39
#&gt;  7     7 29425        8.74
#&gt;  8     8 29327        8.71
#&gt;  9     9 27574        8.19
#&gt; 10    10 28889        8.58
#&gt; 11    11 27268        8.10
#&gt; 12    12 28135        8.35</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp35_3e1929c85bb275145b0275c44502ca58">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pourcentage =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 3.6</strong></p>
<p>Calculer, pour chaque aéroport de départ et de destination, la durée moyenne des vols (variable air_time). Pour chaque aéroport de départ, ne conserver que la destination avec la durée moyenne la plus longue.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-125_524b1e14af010012480d213d9236dc76">
<pre><code>#&gt; `summarise()` has grouped output by 'origin'. You can override using the
#&gt; `.groups` argument.
#&gt; # A tibble: 3 × 3
#&gt; # Groups:   origin [3]
#&gt;   origin dest  duree_moyenne
#&gt;   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
#&gt; 1 EWR    HNL            612.
#&gt; 2 JFK    HNL            623.
#&gt; 3 LGA    DEN            228.</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp36_73c933c480934c61f2de4fc2da27d85c">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin, dest) <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">duree_moyenne =</span> <span class="fu">mean</span>(air_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Le group_by suivant n'est pas obligatoire</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(duree_moyenne)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="jointures-1" class="level3" data-number="10.8.4">
<h3 data-number="10.8.4" class="anchored" data-anchor-id="jointures-1"><span class="header-section-number">10.8.4</span> Jointures</h3>
<p><strong>Exercice 4.1</strong></p>
<p>Faire la jointure de la table <code>airlines</code> sur la table <code>flights</code> à l’aide de <code>left_join</code>.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-126_c001c22e96fd20c58392fa1b74b15e09">
<pre><code>#&gt; # A tibble: 336,776 × 20
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     
#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     
#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     
#&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     
#&gt;  5  2013     1     1      554        600      -6     812     837     -25 DL     
#&gt;  6  2013     1     1      554        558      -4     740     728      12 UA     
#&gt;  7  2013     1     1      555        600      -5     913     854      19 B6     
#&gt;  8  2013     1     1      557        600      -3     709     723     -14 EV     
#&gt;  9  2013     1     1      557        600      -3     838     846      -8 B6     
#&gt; 10  2013     1     1      558        600      -2     753     745       8 AA     
#&gt; # … with 336,766 more rows, 10 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp41_98b10056fdac1173533d33aae2bf3be6">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airlines)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 4.2</strong></p>
<p>À partir de la table résultat de l’exercice précédent, calculer le retard moyen au départ pour chaque compagnie, et trier selon ce retard décroissant.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-127_d4c1aa410e5b0b50714838bcebc95a3f">
<pre><code>#&gt; # A tibble: 16 × 2
#&gt;    name                        retard_moyen
#&gt;    &lt;chr&gt;                              &lt;dbl&gt;
#&gt;  1 Frontier Airlines Inc.             20.2 
#&gt;  2 ExpressJet Airlines Inc.           20.0 
#&gt;  3 Mesa Airlines Inc.                 19.0 
#&gt;  4 AirTran Airways Corporation        18.7 
#&gt;  5 Southwest Airlines Co.             17.7 
#&gt;  6 Endeavor Air Inc.                  16.7 
#&gt;  7 JetBlue Airways                    13.0 
#&gt;  8 Virgin America                     12.9 
#&gt;  9 SkyWest Airlines Inc.              12.6 
#&gt; 10 United Air Lines Inc.              12.1 
#&gt; 11 Envoy Air                          10.6 
#&gt; 12 Delta Air Lines Inc.                9.26
#&gt; 13 American Airlines Inc.              8.59
#&gt; 14 Alaska Airlines Inc.                5.80
#&gt; 15 Hawaiian Airlines Inc.              4.90
#&gt; 16 US Airways Inc.                     3.78</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp42_69f50f53fa20a14f69b1d7c71b66ed05">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airlines) <span class="sc">%&gt;%</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">retard_moyen =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(retard_moyen))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 4.3</strong></p>
<p>Faire la jointure de la table <code>airports</code> sur la table <code>flights</code> en utilisant comme clé le code de l’aéroport de destination.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-128_a4e3e7228f95c6bdf256e11499680e87">
<pre><code>#&gt; # A tibble: 336,776 × 26
#&gt;     year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt;  1  2013     1     1      517        515       2     830     819      11 UA     
#&gt;  2  2013     1     1      533        529       4     850     830      20 UA     
#&gt;  3  2013     1     1      542        540       2     923     850      33 AA     
#&gt;  4  2013     1     1      544        545      -1    1004    1022     -18 B6     
#&gt;  5  2013     1     1      554        600      -6     812     837     -25 DL     
#&gt;  6  2013     1     1      554        558      -4     740     728      12 UA     
#&gt;  7  2013     1     1      555        600      -5     913     854      19 B6     
#&gt;  8  2013     1     1      557        600      -3     709     723     -14 EV     
#&gt;  9  2013     1     1      557        600      -3     838     846      -8 B6     
#&gt; 10  2013     1     1      558        600      -2     753     745       8 AA     
#&gt; # … with 336,766 more rows, 16 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;,
#&gt; #   alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;, and abbreviated variable names
#&gt; #   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp43_d77c521f7ca2600fbdd7b5cd3bf41ecb">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>À partir de cette table, afficher pour chaque mois le nom de l’aéroport de destination ayant eu le plus petit nombre de vol.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-129_fe71f8a30e4c5c0593d91b08063fa549">
<pre><code>#&gt; # A tibble: 14 × 3
#&gt; # Groups:   month [12]
#&gt;    month name                      n
#&gt;    &lt;int&gt; &lt;chr&gt;                 &lt;int&gt;
#&gt;  1     1 Key West Intl             1
#&gt;  2     2 Jackson Hole Airport      3
#&gt;  3     3 Bangor Intl               2
#&gt;  4     4 Key West Intl             1
#&gt;  5     4 Myrtle Beach Intl         1
#&gt;  6     5 Columbia Metropolitan     9
#&gt;  7     6 Myrtle Beach Intl         1
#&gt;  8     7 La Guardia                1
#&gt;  9     8 South Bend Rgnl           1
#&gt; 10     9 South Bend Rgnl           5
#&gt; 11    10 Albany Intl               1
#&gt; 12    10 South Bend Rgnl           1
#&gt; 13    11 Blue Grass                1
#&gt; 14    12 South Bend Rgnl           1</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp43b_d3cea865c62062259fbd35c548a39390">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, name) <span class="sc">%&gt;%</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(n)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><strong>Exercice 4.4</strong></p>
<p>Créer une table indiquant, pour chaque vol, uniquement le nom de l’aéroport de départ et celui de l’aéroport d’arrivée.</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-130_946389cf3c2b692f10f13401b8556786">
<pre><code>#&gt; # A tibble: 336,776 × 2
#&gt;    orig_name           dest_name                      
#&gt;    &lt;chr&gt;               &lt;chr&gt;                          
#&gt;  1 Newark Liberty Intl George Bush Intercontinental   
#&gt;  2 La Guardia          George Bush Intercontinental   
#&gt;  3 John F Kennedy Intl Miami Intl                     
#&gt;  4 John F Kennedy Intl &lt;NA&gt;                           
#&gt;  5 La Guardia          Hartsfield Jackson Atlanta Intl
#&gt;  6 Newark Liberty Intl Chicago Ohare Intl             
#&gt;  7 Newark Liberty Intl Fort Lauderdale Hollywood Intl 
#&gt;  8 La Guardia          Washington Dulles Intl         
#&gt;  9 John F Kennedy Intl Orlando Intl                   
#&gt; 10 La Guardia          Chicago Ohare Intl             
#&gt; # … with 336,766 more rows</code></pre>
</div>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp44_e8651ed62da7df2b1e220affb8f85c71">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span> <span class="ot">=</span> <span class="st">"faa"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dest_name =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"origin"</span> <span class="ot">=</span> <span class="st">"faa"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">orig_name =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(orig_name, dest_name)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="bonus" class="level3" data-number="10.8.5">
<h3 data-number="10.8.5" class="anchored" data-anchor-id="bonus"><span class="header-section-number">10.8.5</span> Bonus</h3>
<p><strong>Exercice 5.1</strong></p>
<p>Calculer le nombre de vols selon l’aéroport de destination, et fusionnez la table <code>airports</code> sur le résultat avec <code>left_join</code>. Stocker le résultat final dans un objet nommé <code>flights_dest</code>.</p>
<div class="solution-exo">
<div class="cell" data-hash="10-dplyr_cache/html/dp51_4d5e6c3a37c13592e5b04846dba10330">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>flights_dest <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"dest"</span><span class="ot">=</span><span class="st">"faa"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Créez une carte interactive des résultats avec le package <code>leaflet</code> et le code suivant&nbsp;:</p>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-132_b89d2b34c9a79211496f8f129ed43ea0">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(<span class="at">data =</span> flights_dest) <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  addTiles <span class="sc">%&gt;%</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircles</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, <span class="at">radius =</span> <span class="sc">~</span>n <span class="sc">*</span> <span class="dv">10</span>, <span class="at">popup =</span> <span class="sc">~</span>name)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="10-dplyr_cache/html/unnamed-chunk-133_70d3117a32a7e7e892640627be51efe2">
<pre><code>#&gt; Warning in validateCoords(lng, lat, funcName): Data contains 4 rows with either
#&gt; missing or invalid lat/lon values and will be ignored</code></pre>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9d4eecc38ee389a3b9d3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9d4eecc38ee389a3b9d3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircles","args":[[35.0402222,41.253053,42.748267,61.174361,33.636719,30.194528,35.436194,41.938889,44.807444,33.562942,36.124472,42.364347,null,44.471861,42.940525,34.200667,39.175361,45.777643,33.938833,40.9160833,38.138639,32.898647,41.411689,35.214,39.997972,38.373147,39.048836,39.902375,38.852083,39.861656,32.896828,41.533972,42.212444,39.642556,24.556111,26.072583,42.880833,36.09775,34.895556,40.481181,21.318681,29.645419,38.944533,29.984433,34.270615,39.717331,43.607333333,30.494056,36.080056,33.942536,38.0365,40.777245,33.817722,39.297606,28.429394,41.785972,35.042417,42.932556,25.79325,42.947222,43.139858,44.881956,29.993389,38.509794,41.391667,33.67975,37.721278,35.393089,41.303167,41.978603,36.894611,26.683161,45.588722,39.871944,33.434278,40.491467,null,33.829667,41.732581,43.646161,35.877639,37.505167,43.118866,26.536167,32.733556,29.533694,32.127583,41.708661,38.1740858,47.449,37.618972,37.3626,null,40.788389,38.695417,33.675667,27.395444,38.748697,null,43.111187,27.975472,36.198389,44.741445,35.810972,36.2818694],[-106.6091944,-70.060181,-73.801692,-149.996361,-84.428067,-97.669889,-82.541806,-72.683222,-68.828139,-86.75355,-86.678194,-71.005181,null,-73.153278,-78.732167,-118.358667,-76.668333,-111.160151,-81.119528,-81.4421944,-78.452861,-80.040528,-81.849794,-80.943139,-82.891889,-81.593189,-84.667822,-84.219375,-77.037722,-104.673178,-97.037997,-93.663083,-83.353389,-106.917694,-81.759556,-80.15275,-85.522806,-79.937306,-82.218889,-107.21766,-157.922428,-95.278889,-77.455811,-95.341442,-77.902569,-86.294383,-110.73775,-81.687861,-115.15225,-118.408075,-84.605889,-73.872608,-118.151611,-94.713905,-81.308994,-87.752417,-89.976667,-71.435667,-80.290556,-87.896583,-89.337514,-93.221767,-90.258028,-107.894242,-70.615278,-78.928333,-122.220722,-97.600733,-95.894069,-87.904842,-76.201222,-80.095589,-122.5975,-75.241139,-112.011583,-80.232872,null,-116.506694,-71.420383,-70.309281,-78.787472,-77.319667,-77.672389,-81.755167,-117.189667,-98.469778,-81.202139,-86.31725,-85.7364989,-122.309306,-122.374889,-121.929022,null,-111.977772,-121.590778,-117.868222,-82.554389,-90.370028,null,-76.106311,-82.53325,-95.888111,-85.582235,-83.994028,-94.3068111],[2540,2650,4390,80,172150,24390,2750,4430,3750,2970,63330,155080,8960,25890,46810,3710,17810,360,1160,8640,520,28840,45730,140640,35240,1380,39410,15250,97050,72660,87380,5690,93840,2130,170,120550,7650,16060,8490,150,7070,21150,57000,71980,1100,20770,250,27200,59970,161740,10,10,6680,20080,140820,41130,17890,10090,117280,28020,5720,71850,37990,150,2210,590,3120,3460,8490,172830,15360,65540,13540,16320,46560,28750,3650,190,3760,23520,81630,24540,24160,35370,27370,6860,8040,100,11570,39230,133310,3290,58190,24670,2840,8250,12110,43390,5220,17610,74660,3150,1010,6310,10360],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},["Albuquerque International Sunport","Nantucket Mem","Albany Intl","Ted Stevens Anchorage Intl","Hartsfield Jackson Atlanta Intl","Austin Bergstrom Intl","Asheville Regional Airport","Bradley Intl","Bangor Intl","Birmingham Intl","Nashville Intl","General Edward Lawrence Logan Intl",null,"Burlington Intl","Buffalo Niagara Intl","Bob Hope","Baltimore Washington Intl","Gallatin Field","Columbia Metropolitan","Akron Canton Regional Airport","Charlottesville-Albemarle","Charleston Afb Intl","Cleveland Hopkins Intl","Charlotte Douglas Intl","Port Columbus Intl","Yeager","Cincinnati Northern Kentucky Intl","James M Cox Dayton Intl","Ronald Reagan Washington Natl","Denver Intl","Dallas Fort Worth Intl","Des Moines Intl","Detroit Metro Wayne Co","Eagle Co Rgnl","Key West Intl","Fort Lauderdale Hollywood Intl","Gerald R Ford Intl","Piedmont Triad","Greenville-Spartanburg International","Yampa Valley","Honolulu Intl","William P Hobby","Washington Dulles Intl","George Bush Intercontinental","Wilmington Intl","Indianapolis Intl","Jackson Hole Airport","Jacksonville Intl","Mc Carran Intl","Los Angeles Intl","Blue Grass","La Guardia","Long Beach","Kansas City Intl","Orlando Intl","Chicago Midway Intl","Memphis Intl","Manchester Regional Airport","Miami Intl","General Mitchell Intl","Dane Co Rgnl Truax Fld","Minneapolis St Paul Intl","Louis Armstrong New Orleans Intl","Montrose Regional Airport","Martha\\\\'s Vineyard","Myrtle Beach Intl","Metropolitan Oakland Intl","Will Rogers World","Eppley Afld","Chicago Ohare Intl","Norfolk Intl","Palm Beach Intl","Portland Intl","Philadelphia Intl","Phoenix Sky Harbor Intl","Pittsburgh Intl",null,"Palm Springs Intl","Theodore Francis Green State","Portland Intl Jetport","Raleigh Durham Intl","Richmond Intl","Greater Rochester Intl","Southwest Florida Intl","San Diego Intl","San Antonio Intl","Savannah Hilton Head Intl","South Bend Rgnl","Louisville International Airport","Seattle Tacoma Intl","San Francisco Intl","Norman Y Mineta San Jose Intl",null,"Salt Lake City Intl","Sacramento Intl","John Wayne Arpt Orange Co","Sarasota Bradenton Intl","Lambert St Louis Intl",null,"Syracuse Hancock Intl","Tampa Intl","Tulsa Intl","Cherry Capital Airport","Mc Ghee Tyson","NW Arkansas Regional"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[21.318681,61.174361],"lng":[-157.922428,-68.828139]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>À noter que cette opération est un peu plus “fragile” que les autres, car si l’ordre des colonnes change elle peut renvoyer un résultat différent.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Il est également possible de renommer des colonnes directement avec <code>select</code>, avec la même syntaxe que pour <code>rename</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Le <em>pipe</em> a été introduit à l’origine par l’extension <code>magrittr</code>, et repris par <code>dplyr</code><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09-recodages.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Recoder des variables</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-stringr.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Manipuler du texte avec <code>stringr</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script src="js/tidyverse.js"></script>



</body></html>