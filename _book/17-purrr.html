<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Partie 17 Itérer avec purrr | Introduction à R et au tidyverse</title>
  <meta name="description" content="Une introduction à R et aux extensions du tidyverse" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Partie 17 Itérer avec purrr | Introduction à R et au tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Une introduction à R et aux extensions du tidyverse" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Partie 17 Itérer avec purrr | Introduction à R et au tidyverse" />
  
  <meta name="twitter:description" content="Une introduction à R et aux extensions du tidyverse" />
  

<meta name="author" content="Julien Barnier" />


<meta name="date" content="2021-09-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="16-dplyr-avance.html"/>
<link rel="next" href="18-programmer-tidyverse.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Introduction à R et au <em>tidyverse</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>À propos de ce document</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01-presentation.html"><a href="01-presentation.html"><i class="fa fa-check"></i><b>1</b> Présentation</a><ul>
<li class="chapter" data-level="1.1" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-de-r"><i class="fa fa-check"></i><b>1.1</b> À propos de R</a></li>
<li class="chapter" data-level="1.2" data-path="01-presentation.html"><a href="01-presentation.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> À propos de RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="01-presentation.html"><a href="01-presentation.html#à-propos-du-tidyverse"><i class="fa fa-check"></i><b>1.3</b> À propos du <em>tidyverse</em></a></li>
<li class="chapter" data-level="1.4" data-path="01-presentation.html"><a href="01-presentation.html#structure-du-document"><i class="fa fa-check"></i><b>1.4</b> Structure du document</a></li>
<li class="chapter" data-level="1.5" data-path="01-presentation.html"><a href="01-presentation.html#prérequis"><i class="fa fa-check"></i><b>1.5</b> Prérequis</a></li>
</ul></li>
<li class="part"><span><b>I Introduction à R</b></span></li>
<li class="chapter" data-level="2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html"><i class="fa fa-check"></i><b>2</b> Prise en main</a><ul>
<li class="chapter" data-level="2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#la-console"><i class="fa fa-check"></i><b>2.1</b> La console</a><ul>
<li class="chapter" data-level="2.1.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#linvite-de-commandes"><i class="fa fa-check"></i><b>2.1.1</b> L’invite de commandes</a></li>
<li class="chapter" data-level="2.1.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#précisions-concernant-la-saisie-des-commandes"><i class="fa fa-check"></i><b>2.1.2</b> Précisions concernant la saisie des commandes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets"><i class="fa fa-check"></i><b>2.2</b> Objets</a><ul>
<li class="chapter" data-level="2.2.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#objets-simples"><i class="fa fa-check"></i><b>2.2.1</b> Objets simples</a></li>
<li class="chapter" data-level="2.2.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#introvecteurs"><i class="fa fa-check"></i><b>2.2.2</b> Vecteurs</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#fonctions"><i class="fa fa-check"></i><b>2.3</b> Fonctions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#principe"><i class="fa fa-check"></i><b>2.3.1</b> Principe</a></li>
<li class="chapter" data-level="2.3.2" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#arguments"><i class="fa fa-check"></i><b>2.3.2</b> Arguments</a></li>
<li class="chapter" data-level="2.3.3" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#aide-sur-une-fonction"><i class="fa fa-check"></i><b>2.3.3</b> Aide sur une fonction</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#regrouper-ses-commandes-dans-des-scripts"><i class="fa fa-check"></i><b>2.4</b> Regrouper ses commandes dans des scripts</a><ul>
<li class="chapter" data-level="2.4.1" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#commentaires"><i class="fa fa-check"></i><b>2.4.1</b> Commentaires</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#packages"><i class="fa fa-check"></i><b>2.5</b> Installer et charger des extensions (<em>packages</em>)</a></li>
<li class="chapter" data-level="2.6" data-path="02-prise_en_main.html"><a href="02-prise_en_main.html#exercices"><i class="fa fa-check"></i><b>2.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-premier_travail.html"><a href="03-premier_travail.html"><i class="fa fa-check"></i><b>3</b> Premier travail avec des données</a><ul>
<li class="chapter" data-level="3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#jeu-de-données-dexemple"><i class="fa fa-check"></i><b>3.1</b> Jeu de données d’exemple</a></li>
<li class="chapter" data-level="3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#tableau-de-données-data-frame"><i class="fa fa-check"></i><b>3.2</b> Tableau de données (<em>data frame</em>)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#structure-du-tableau"><i class="fa fa-check"></i><b>3.2.1</b> Structure du tableau</a></li>
<li class="chapter" data-level="3.2.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#accéder-aux-variables-dun-tableau"><i class="fa fa-check"></i><b>3.2.2</b> Accéder aux variables d’un tableau</a></li>
<li class="chapter" data-level="3.2.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#créer-une-nouvelle-variable"><i class="fa fa-check"></i><b>3.2.3</b> Créer une nouvelle variable</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyse-univariée"><i class="fa fa-check"></i><b>3.3</b> Analyse univariée</a><ul>
<li class="chapter" data-level="3.3.1" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-quantitative"><i class="fa fa-check"></i><b>3.3.1</b> Analyser une variable quantitative</a></li>
<li class="chapter" data-level="3.3.2" data-path="03-premier_travail.html"><a href="03-premier_travail.html#analyser-une-variable-qualitative"><i class="fa fa-check"></i><b>3.3.2</b> Analyser une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="03-premier_travail.html"><a href="03-premier_travail.html#exercices-1"><i class="fa fa-check"></i><b>3.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-bivarie.html"><a href="04-bivarie.html"><i class="fa fa-check"></i><b>4</b> Analyse bivariée</a><ul>
<li class="chapter" data-level="4.1" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-qualitatives"><i class="fa fa-check"></i><b>4.1</b> Croisement de deux variables qualitatives</a><ul>
<li class="chapter" data-level="4.1.1" data-path="04-bivarie.html"><a href="04-bivarie.html#tableaux-croisés"><i class="fa fa-check"></i><b>4.1.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="4.1.2" data-path="04-bivarie.html"><a href="04-bivarie.html#test-du-χ²"><i class="fa fa-check"></i><b>4.1.2</b> Test du χ²</a></li>
<li class="chapter" data-level="4.1.3" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-1"><i class="fa fa-check"></i><b>4.1.3</b> Représentation graphique</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-dune-variable-quantitative-et-dune-variable-qualitative"><i class="fa fa-check"></i><b>4.2</b> Croisement d’une variable quantitative et d’une variable qualitative</a><ul>
<li class="chapter" data-level="4.2.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-2"><i class="fa fa-check"></i><b>4.2.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.2.2" data-path="04-bivarie.html"><a href="04-bivarie.html#tapply"><i class="fa fa-check"></i><b>4.2.2</b> Calculs d’indicateurs</a></li>
<li class="chapter" data-level="4.2.3" data-path="04-bivarie.html"><a href="04-bivarie.html#tests-statistiques"><i class="fa fa-check"></i><b>4.2.3</b> Tests statistiques</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="04-bivarie.html"><a href="04-bivarie.html#croisement-de-deux-variables-quantitatives"><i class="fa fa-check"></i><b>4.3</b> Croisement de deux variables quantitatives</a><ul>
<li class="chapter" data-level="4.3.1" data-path="04-bivarie.html"><a href="04-bivarie.html#représentation-graphique-3"><i class="fa fa-check"></i><b>4.3.1</b> Représentation graphique</a></li>
<li class="chapter" data-level="4.3.2" data-path="04-bivarie.html"><a href="04-bivarie.html#calcul-dindicateurs"><i class="fa fa-check"></i><b>4.3.2</b> Calcul d’indicateurs</a></li>
<li class="chapter" data-level="4.3.3" data-path="04-bivarie.html"><a href="04-bivarie.html#régression-linéaire"><i class="fa fa-check"></i><b>4.3.3</b> Régression linéaire</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="04-bivarie.html"><a href="04-bivarie.html#exercices-2"><i class="fa fa-check"></i><b>4.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-organiser.html"><a href="05-organiser.html"><i class="fa fa-check"></i><b>5</b> Organiser ses scripts</a><ul>
<li class="chapter" data-level="5.1" data-path="05-organiser.html"><a href="05-organiser.html#projets"><i class="fa fa-check"></i><b>5.1</b> Les projets dans RStudio</a></li>
<li class="chapter" data-level="5.2" data-path="05-organiser.html"><a href="05-organiser.html#créer-des-sections-dans-un-script"><i class="fa fa-check"></i><b>5.2</b> Créer des sections dans un script</a></li>
<li class="chapter" data-level="5.3" data-path="05-organiser.html"><a href="05-organiser.html#répartir-son-travail-entre-plusieurs-scripts"><i class="fa fa-check"></i><b>5.3</b> Répartir son travail entre plusieurs scripts</a></li>
<li class="chapter" data-level="5.4" data-path="05-organiser.html"><a href="05-organiser.html#désactiver-la-sauvegarde-de-lespace-de-travail"><i class="fa fa-check"></i><b>5.4</b> Désactiver la sauvegarde de l’espace de travail</a></li>
</ul></li>
<li class="part"><span><b>II Introduction au tidyverse</b></span></li>
<li class="chapter" data-level="6" data-path="06-tidyverse.html"><a href="06-tidyverse.html"><i class="fa fa-check"></i><b>6</b> Le tidyverse</a><ul>
<li class="chapter" data-level="6.1" data-path="06-tidyverse.html"><a href="06-tidyverse.html#extensions"><i class="fa fa-check"></i><b>6.1</b> Extensions</a></li>
<li class="chapter" data-level="6.2" data-path="06-tidyverse.html"><a href="06-tidyverse.html#installation"><i class="fa fa-check"></i><b>6.2</b> Installation</a></li>
<li class="chapter" data-level="6.3" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tidydata"><i class="fa fa-check"></i><b>6.3</b> tidy data</a></li>
<li class="chapter" data-level="6.4" data-path="06-tidyverse.html"><a href="06-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>6.4</b> tibbles</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-import.html"><a href="07-import.html"><i class="fa fa-check"></i><b>7</b> Importer et exporter des données</a><ul>
<li class="chapter" data-level="7.1" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-textes"><i class="fa fa-check"></i><b>7.1</b> Import de fichiers textes</a><ul>
<li class="chapter" data-level="7.1.1" data-path="07-import.html"><a href="07-import.html#interface-interactive-dimport-de-fichiers"><i class="fa fa-check"></i><b>7.1.1</b> Interface interactive d’import de fichiers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="07-import.html"><a href="07-import.html#import-depuis-un-fichier-excel"><i class="fa fa-check"></i><b>7.2</b> Import depuis un fichier Excel</a></li>
<li class="chapter" data-level="7.3" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-sas-spss-et-stata"><i class="fa fa-check"></i><b>7.3</b> Import de fichiers SAS, SPSS et Stata</a></li>
<li class="chapter" data-level="7.4" data-path="07-import.html"><a href="07-import.html#import-de-fichiers-dbase"><i class="fa fa-check"></i><b>7.4</b> Import de fichiers dBase</a></li>
<li class="chapter" data-level="7.5" data-path="07-import.html"><a href="07-import.html#connexion-à-des-bases-de-données"><i class="fa fa-check"></i><b>7.5</b> Connexion à des bases de données</a><ul>
<li class="chapter" data-level="7.5.1" data-path="07-import.html"><a href="07-import.html#interfaçage-via-lextension-dbi"><i class="fa fa-check"></i><b>7.5.1</b> Interfaçage via l’extension <code>DBI</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="07-import.html"><a href="07-import.html#utilisation-de-dplyr-et-dbplyr"><i class="fa fa-check"></i><b>7.5.2</b> Utilisation de <code>dplyr</code> et <code>dbplyr</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="07-import.html"><a href="07-import.html#ressources"><i class="fa fa-check"></i><b>7.5.3</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="07-import.html"><a href="07-import.html#export-de-données"><i class="fa fa-check"></i><b>7.6</b> Export de données</a><ul>
<li class="chapter" data-level="7.6.1" data-path="07-import.html"><a href="07-import.html#export-de-tableaux-de-données"><i class="fa fa-check"></i><b>7.6.1</b> Export de tableaux de données</a></li>
<li class="chapter" data-level="7.6.2" data-path="07-import.html"><a href="07-import.html#sauvegarder-des-objets"><i class="fa fa-check"></i><b>7.6.2</b> Sauvegarder des objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-ggplot2.html"><a href="08-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Visualiser avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="8.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#préparation"><i class="fa fa-check"></i><b>8.1</b> Préparation</a></li>
<li class="chapter" data-level="8.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#initialisation"><i class="fa fa-check"></i><b>8.2</b> Initialisation</a></li>
<li class="chapter" data-level="8.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-geom"><i class="fa fa-check"></i><b>8.3</b> Exemples de <code>geom</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_boxplot"><i class="fa fa-check"></i><b>8.3.1</b> <code>geom_boxplot</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_violin"><i class="fa fa-check"></i><b>8.3.2</b> <code>geom_violin</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar"><i class="fa fa-check"></i><b>8.3.3</b> <code>geom_bar</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_text"><i class="fa fa-check"></i><b>8.3.4</b> <code>geom_text</code></a></li>
<li class="chapter" data-level="8.3.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_label"><i class="fa fa-check"></i><b>8.3.5</b> <code>geom_label</code></a></li>
<li class="chapter" data-level="8.3.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_density"><i class="fa fa-check"></i><b>8.3.6</b> <code>geom_density</code></a></li>
<li class="chapter" data-level="8.3.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_line"><i class="fa fa-check"></i><b>8.3.7</b> <code>geom_line</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-ggplot2.html"><a href="08-ggplot2.html#mappages"><i class="fa fa-check"></i><b>8.4</b> Mappages</a><ul>
<li class="chapter" data-level="8.4.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exemples-de-mappages"><i class="fa fa-check"></i><b>8.4.1</b> Exemples de mappages</a></li>
<li class="chapter" data-level="8.4.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#aes-or-not-aes"><i class="fa fa-check"></i><b>8.4.2</b> <code>aes()</code> or not <code>aes()</code> ?</a></li>
<li class="chapter" data-level="8.4.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#geom_bar-et-position"><i class="fa fa-check"></i><b>8.4.3</b> <code>geom_bar</code> et <code>position</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08-ggplot2.html"><a href="08-ggplot2.html#représentation-de-plusieurs-geom"><i class="fa fa-check"></i><b>8.5</b> Représentation de plusieurs <code>geom</code></a><ul>
<li class="chapter" data-level="8.5.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#plusieurs-sources-de-données"><i class="fa fa-check"></i><b>8.5.1</b> Plusieurs sources de données</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="08-ggplot2.html"><a href="08-ggplot2.html#faceting"><i class="fa fa-check"></i><b>8.6</b> Faceting</a></li>
<li class="chapter" data-level="8.7" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scales"><i class="fa fa-check"></i><b>8.7</b> Scales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_size"><i class="fa fa-check"></i><b>8.7.1</b> <code>scale_size</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scale_x-scale_y"><i class="fa fa-check"></i><b>8.7.2</b> <code>scale_x</code>, <code>scale_y</code></a></li>
<li class="chapter" data-level="8.7.3" data-path="08-ggplot2.html"><a href="08-ggplot2.html#scalecolor"><i class="fa fa-check"></i><b>8.7.3</b> <code>scale_color</code>, <code>scale_fill</code></a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="08-ggplot2.html"><a href="08-ggplot2.html#thèmes"><i class="fa fa-check"></i><b>8.8</b> Thèmes</a></li>
<li class="chapter" data-level="8.9" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ladd-in-esquisse"><i class="fa fa-check"></i><b>8.9</b> L’add-in <code>esquisse</code></a></li>
<li class="chapter" data-level="8.10" data-path="08-ggplot2.html"><a href="08-ggplot2.html#ressources-1"><i class="fa fa-check"></i><b>8.10</b> Ressources</a></li>
<li class="chapter" data-level="8.11" data-path="08-ggplot2.html"><a href="08-ggplot2.html#exercices-3"><i class="fa fa-check"></i><b>8.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-recodages.html"><a href="09-recodages.html"><i class="fa fa-check"></i><b>9</b> Recoder des variables</a><ul>
<li class="chapter" data-level="9.1" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs"><i class="fa fa-check"></i><b>9.1</b> Rappel sur les variables et les vecteurs</a></li>
<li class="chapter" data-level="9.2" data-path="09-recodages.html"><a href="09-recodages.html#tests"><i class="fa fa-check"></i><b>9.2</b> Tests et comparaison</a></li>
<li class="chapter" data-level="9.3" data-path="09-recodages.html"><a href="09-recodages.html#recoder-une-variable-qualitative"><i class="fa fa-check"></i><b>9.3</b> Recoder une variable qualitative</a><ul>
<li class="chapter" data-level="9.3.1" data-path="09-recodages.html"><a href="09-recodages.html#facteurs"><i class="fa fa-check"></i><b>9.3.1</b> Facteurs et <code>forcats</code></a></li>
<li class="chapter" data-level="9.3.2" data-path="09-recodages.html"><a href="09-recodages.html#recode"><i class="fa fa-check"></i><b>9.3.2</b> Modifier les modalités d’une variable qualitative</a></li>
<li class="chapter" data-level="9.3.3" data-path="09-recodages.html"><a href="09-recodages.html#ordonner-les-modalités-dune-variable-qualitative"><i class="fa fa-check"></i><b>9.3.3</b> Ordonner les modalités d’une variable qualitative</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables"><i class="fa fa-check"></i><b>9.4</b> Combiner plusieurs variables</a><ul>
<li class="chapter" data-level="9.4.1" data-path="09-recodages.html"><a href="09-recodages.html#if-else"><i class="fa fa-check"></i><b>9.4.1</b> <code>if_else</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="09-recodages.html"><a href="09-recodages.html#case_when"><i class="fa fa-check"></i><b>9.4.2</b> <code>case_when</code></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique-en-classes"><i class="fa fa-check"></i><b>9.5</b> Découper une variable numérique en classes</a><ul>
<li class="chapter" data-level="9.5.1" data-path="09-recodages.html"><a href="09-recodages.html#interface-graphique"><i class="fa fa-check"></i><b>9.5.1</b> Interface graphique</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="09-recodages.html"><a href="09-recodages.html#exercices-4"><i class="fa fa-check"></i><b>9.6</b> Exercices</a><ul>
<li class="chapter" data-level="9.6.1" data-path="09-recodages.html"><a href="09-recodages.html#préparation-1"><i class="fa fa-check"></i><b>9.6.1</b> Préparation</a></li>
<li class="chapter" data-level="9.6.2" data-path="09-recodages.html"><a href="09-recodages.html#vecteurs-et-tests"><i class="fa fa-check"></i><b>9.6.2</b> Vecteurs et tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="09-recodages.html"><a href="09-recodages.html#recodages-de-variable-qualitative"><i class="fa fa-check"></i><b>9.6.3</b> Recodages de variable qualitative</a></li>
<li class="chapter" data-level="9.6.4" data-path="09-recodages.html"><a href="09-recodages.html#combiner-plusieurs-variables-1"><i class="fa fa-check"></i><b>9.6.4</b> Combiner plusieurs variables</a></li>
<li class="chapter" data-level="9.6.5" data-path="09-recodages.html"><a href="09-recodages.html#découper-une-variable-numérique"><i class="fa fa-check"></i><b>9.6.5</b> Découper une variable numérique</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-dplyr.html"><a href="10-dplyr.html"><i class="fa fa-check"></i><b>10</b> Manipuler les données avec <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.1" data-path="10-dplyr.html"><a href="10-dplyr.html#préparation-2"><i class="fa fa-check"></i><b>10.1</b> Préparation</a></li>
<li class="chapter" data-level="10.2" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-dplyr"><i class="fa fa-check"></i><b>10.2</b> Les verbes de <code>dplyr</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice"><i class="fa fa-check"></i><b>10.2.1</b> <code>slice</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="10-dplyr.html"><a href="10-dplyr.html#filter"><i class="fa fa-check"></i><b>10.2.2</b> <code>filter</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="10-dplyr.html"><a href="10-dplyr.html#select-rename"><i class="fa fa-check"></i><b>10.2.3</b> <code>select</code> et <code>rename</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="10-dplyr.html"><a href="10-dplyr.html#arrange"><i class="fa fa-check"></i><b>10.2.4</b> <code>arrange</code></a></li>
<li class="chapter" data-level="10.2.5" data-path="10-dplyr.html"><a href="10-dplyr.html#mutate"><i class="fa fa-check"></i><b>10.2.5</b> <code>mutate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="10-dplyr.html"><a href="10-dplyr.html#pipe"><i class="fa fa-check"></i><b>10.3</b> Enchaîner les opérations avec le <em>pipe</em></a></li>
<li class="chapter" data-level="10.4" data-path="10-dplyr.html"><a href="10-dplyr.html#opérations-groupées"><i class="fa fa-check"></i><b>10.4</b> Opérations groupées</a><ul>
<li class="chapter" data-level="10.4.1" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by"><i class="fa fa-check"></i><b>10.4.1</b> <code>group_by</code></a></li>
<li class="chapter" data-level="10.4.2" data-path="10-dplyr.html"><a href="10-dplyr.html#summarise-et-count"><i class="fa fa-check"></i><b>10.4.2</b> <code>summarise</code> et <code>count</code></a></li>
<li class="chapter" data-level="10.4.3" data-path="10-dplyr.html"><a href="10-dplyr.html#grouper-selon-plusieurs-variables"><i class="fa fa-check"></i><b>10.4.3</b> Grouper selon plusieurs variables</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="10-dplyr.html"><a href="10-dplyr.html#autres-fonctions-utiles"><i class="fa fa-check"></i><b>10.5</b> Autres fonctions utiles</a><ul>
<li class="chapter" data-level="10.5.1" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_sample"><i class="fa fa-check"></i><b>10.5.1</b> <code>slice_sample</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="10-dplyr.html"><a href="10-dplyr.html#slice_head-slice_tail-slice_min-slice_max"><i class="fa fa-check"></i><b>10.5.2</b> <code>slice_head</code>, <code>slice_tail</code>, <code>slice_min</code>, <code>slice_max</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="10-dplyr.html"><a href="10-dplyr.html#lead-et-lag"><i class="fa fa-check"></i><b>10.5.3</b> <code>lead</code> et <code>lag</code></a></li>
<li class="chapter" data-level="10.5.4" data-path="10-dplyr.html"><a href="10-dplyr.html#distinct-et-n_distinct"><i class="fa fa-check"></i><b>10.5.4</b> <code>distinct</code> et <code>n_distinct</code></a></li>
<li class="chapter" data-level="10.5.5" data-path="10-dplyr.html"><a href="10-dplyr.html#relocate"><i class="fa fa-check"></i><b>10.5.5</b> <code>relocate</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="10-dplyr.html"><a href="10-dplyr.html#tables-multiples"><i class="fa fa-check"></i><b>10.6</b> Tables multiples</a><ul>
<li class="chapter" data-level="10.6.1" data-path="10-dplyr.html"><a href="10-dplyr.html#concaténation-bind_rows-et-bind_cols"><i class="fa fa-check"></i><b>10.6.1</b> Concaténation : <code>bind_rows</code> et <code>bind_cols</code></a></li>
<li class="chapter" data-level="10.6.2" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures"><i class="fa fa-check"></i><b>10.6.2</b> Jointures</a></li>
<li class="chapter" data-level="10.6.3" data-path="10-dplyr.html"><a href="10-dplyr.html#types-de-jointures"><i class="fa fa-check"></i><b>10.6.3</b> Types de jointures</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="10-dplyr.html"><a href="10-dplyr.html#ressources-2"><i class="fa fa-check"></i><b>10.7</b> Ressources</a></li>
<li class="chapter" data-level="10.8" data-path="10-dplyr.html"><a href="10-dplyr.html#exercices-5"><i class="fa fa-check"></i><b>10.8</b> Exercices</a><ul>
<li class="chapter" data-level="10.8.1" data-path="10-dplyr.html"><a href="10-dplyr.html#les-verbes-de-base-de-dplyr"><i class="fa fa-check"></i><b>10.8.1</b> Les verbes de base de <code>dplyr</code></a></li>
<li class="chapter" data-level="10.8.2" data-path="10-dplyr.html"><a href="10-dplyr.html#enchaîner-des-opérations"><i class="fa fa-check"></i><b>10.8.2</b> Enchaîner des opérations</a></li>
<li class="chapter" data-level="10.8.3" data-path="10-dplyr.html"><a href="10-dplyr.html#group_by-et-summarise"><i class="fa fa-check"></i><b>10.8.3</b> <code>group_by</code> et <code>summarise</code></a></li>
<li class="chapter" data-level="10.8.4" data-path="10-dplyr.html"><a href="10-dplyr.html#jointures-1"><i class="fa fa-check"></i><b>10.8.4</b> Jointures</a></li>
<li class="chapter" data-level="10.8.5" data-path="10-dplyr.html"><a href="10-dplyr.html#bonus"><i class="fa fa-check"></i><b>10.8.5</b> Bonus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-stringr.html"><a href="11-stringr.html"><i class="fa fa-check"></i><b>11</b> Manipuler du texte avec <code>stringr</code></a><ul>
<li class="chapter" data-level="11.1" data-path="11-stringr.html"><a href="11-stringr.html#expressions-régulières"><i class="fa fa-check"></i><b>11.1</b> Expressions régulières</a></li>
<li class="chapter" data-level="11.2" data-path="11-stringr.html"><a href="11-stringr.html#concat"><i class="fa fa-check"></i><b>11.2</b> Concaténer des chaînes</a></li>
<li class="chapter" data-level="11.3" data-path="11-stringr.html"><a href="11-stringr.html#convertir-en-majuscules-minuscules"><i class="fa fa-check"></i><b>11.3</b> Convertir en majuscules / minuscules</a></li>
<li class="chapter" data-level="11.4" data-path="11-stringr.html"><a href="11-stringr.html#découper-des-chaînes"><i class="fa fa-check"></i><b>11.4</b> Découper des chaînes</a></li>
<li class="chapter" data-level="11.5" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-sous-chaînes-par-position"><i class="fa fa-check"></i><b>11.5</b> Extraire des sous-chaînes par position</a></li>
<li class="chapter" data-level="11.6" data-path="11-stringr.html"><a href="11-stringr.html#str-detect"><i class="fa fa-check"></i><b>11.6</b> Détecter des motifs</a></li>
<li class="chapter" data-level="11.7" data-path="11-stringr.html"><a href="11-stringr.html#extraire-des-motifs"><i class="fa fa-check"></i><b>11.7</b> Extraire des motifs</a></li>
<li class="chapter" data-level="11.8" data-path="11-stringr.html"><a href="11-stringr.html#remplacer-des-motifs"><i class="fa fa-check"></i><b>11.8</b> Remplacer des motifs</a></li>
<li class="chapter" data-level="11.9" data-path="11-stringr.html"><a href="11-stringr.html#modificateurs"><i class="fa fa-check"></i><b>11.9</b> Modificateurs de motifs</a></li>
<li class="chapter" data-level="11.10" data-path="11-stringr.html"><a href="11-stringr.html#ressources-3"><i class="fa fa-check"></i><b>11.10</b> Ressources</a></li>
<li class="chapter" data-level="11.11" data-path="11-stringr.html"><a href="11-stringr.html#exercices-6"><i class="fa fa-check"></i><b>11.11</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-tidyr.html"><a href="12-tidyr.html"><i class="fa fa-check"></i><b>12</b> Mettre en ordre avec <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.1" data-path="12-tidyr.html"><a href="12-tidyr.html#tidy-data"><i class="fa fa-check"></i><b>12.1</b> Tidy data</a></li>
<li class="chapter" data-level="12.2" data-path="12-tidyr.html"><a href="12-tidyr.html#trois-règles-pour-des-données-bien-rangées"><i class="fa fa-check"></i><b>12.2</b> Trois règles pour des données bien rangées</a></li>
<li class="chapter" data-level="12.3" data-path="12-tidyr.html"><a href="12-tidyr.html#les-verbes-de-tidyr"><i class="fa fa-check"></i><b>12.3</b> Les verbes de <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.3.1" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_longer-transformer-des-colonnes-en-lignes"><i class="fa fa-check"></i><b>12.3.1</b> <code>pivot_longer</code> : transformer des colonnes en lignes</a></li>
<li class="chapter" data-level="12.3.2" data-path="12-tidyr.html"><a href="12-tidyr.html#pivot_wider-transformer-des-lignes-en-colonnes"><i class="fa fa-check"></i><b>12.3.2</b> <code>pivot_wider</code> : transformer des lignes en colonnes</a></li>
<li class="chapter" data-level="12.3.3" data-path="12-tidyr.html"><a href="12-tidyr.html#separate"><i class="fa fa-check"></i><b>12.3.3</b> <code>separate</code> : séparer une colonne en plusieurs colonnes</a></li>
<li class="chapter" data-level="12.3.4" data-path="12-tidyr.html"><a href="12-tidyr.html#separate-rows"><i class="fa fa-check"></i><b>12.3.4</b> <code>separate_rows</code> : séparer une colonne en plusieurs lignes</a></li>
<li class="chapter" data-level="12.3.5" data-path="12-tidyr.html"><a href="12-tidyr.html#unite-regrouper-plusieurs-colonnes-en-une-seule"><i class="fa fa-check"></i><b>12.3.5</b> <code>unite</code> : regrouper plusieurs colonnes en une seule</a></li>
<li class="chapter" data-level="12.3.6" data-path="12-tidyr.html"><a href="12-tidyr.html#extract"><i class="fa fa-check"></i><b>12.3.6</b> <code>extract</code> : créer de nouvelles colonnes à partir d’une colonne de texte</a></li>
<li class="chapter" data-level="12.3.7" data-path="12-tidyr.html"><a href="12-tidyr.html#complete-compléter-des-combinaisons-de-variables-manquantes"><i class="fa fa-check"></i><b>12.3.7</b> <code>complete</code> : compléter des combinaisons de variables manquantes</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="12-tidyr.html"><a href="12-tidyr.html#ressources-4"><i class="fa fa-check"></i><b>12.4</b> Ressources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html"><i class="fa fa-check"></i><b>13</b> Diffuser et publier avec <code>rmarkdown</code></a><ul>
<li class="chapter" data-level="13.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#créer-un-nouveau-document"><i class="fa fa-check"></i><b>13.1</b> Créer un nouveau document</a></li>
<li class="chapter" data-level="13.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#éléments-dun-document-r-markdown"><i class="fa fa-check"></i><b>13.2</b> Éléments d’un document R Markdown</a><ul>
<li class="chapter" data-level="13.2.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#en-tête-préambule"><i class="fa fa-check"></i><b>13.2.1</b> En-tête (préambule)</a></li>
<li class="chapter" data-level="13.2.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#texte-du-document"><i class="fa fa-check"></i><b>13.2.2</b> Texte du document</a></li>
<li class="chapter" data-level="13.2.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#blocs-de-code-r"><i class="fa fa-check"></i><b>13.2.3</b> Blocs de code R</a></li>
<li class="chapter" data-level="13.2.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#compiler-un-document-knit"><i class="fa fa-check"></i><b>13.2.4</b> Compiler un document (<em>Knit</em>)</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#personnaliser-le-document-généré"><i class="fa fa-check"></i><b>13.3</b> Personnaliser le document généré</a></li>
<li class="chapter" data-level="13.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-des-blocs-de-code-r"><i class="fa fa-check"></i><b>13.4</b> Options des blocs de code R</a><ul>
<li class="chapter" data-level="13.4.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#nom-du-bloc"><i class="fa fa-check"></i><b>13.4.1</b> Nom du bloc</a></li>
<li class="chapter" data-level="13.4.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options"><i class="fa fa-check"></i><b>13.4.2</b> Options</a></li>
<li class="chapter" data-level="13.4.3" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#modifier-les-options"><i class="fa fa-check"></i><b>13.4.3</b> Modifier les options</a></li>
<li class="chapter" data-level="13.4.4" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#options-globales"><i class="fa fa-check"></i><b>13.4.4</b> Options globales</a></li>
<li class="chapter" data-level="13.4.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#mise-en-cache-des-résultats"><i class="fa fa-check"></i><b>13.4.5</b> Mise en cache des résultats</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#rendu-des-tableaux"><i class="fa fa-check"></i><b>13.5</b> Rendu des tableaux</a><ul>
<li class="chapter" data-level="13.5.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-croisés-1"><i class="fa fa-check"></i><b>13.5.1</b> Tableaux croisés</a></li>
<li class="chapter" data-level="13.5.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#tableaux-de-données-et-tris-à-plat"><i class="fa fa-check"></i><b>13.5.2</b> Tableaux de données et tris à plat</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates"><i class="fa fa-check"></i><b>13.6</b> Modèles de documents</a><ul>
<li class="chapter" data-level="13.6.1" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#slides"><i class="fa fa-check"></i><b>13.6.1</b> Slides</a></li>
<li class="chapter" data-level="13.6.2" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#templates-1"><i class="fa fa-check"></i><b>13.6.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="13-rmarkdown.html"><a href="13-rmarkdown.html#ressources-5"><i class="fa fa-check"></i><b>13.7</b> Ressources</a></li>
</ul></li>
<li class="part"><span><b>III Aller plus loin</b></span></li>
<li class="chapter" data-level="14" data-path="14-fonctions.html"><a href="14-fonctions.html"><i class="fa fa-check"></i><b>14</b> Écrire ses propres fonctions</a><ul>
<li class="chapter" data-level="14.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples"><i class="fa fa-check"></i><b>14.1</b> Introduction et exemples</a><ul>
<li class="chapter" data-level="14.1.1" data-path="14-fonctions.html"><a href="14-fonctions.html#structure-dune-fonction"><i class="fa fa-check"></i><b>14.1.1</b> Structure d’une fonction</a></li>
<li class="chapter" data-level="14.1.2" data-path="14-fonctions.html"><a href="14-fonctions.html#exemples-de-fonctions"><i class="fa fa-check"></i><b>14.1.2</b> Exemples de fonctions</a></li>
<li class="chapter" data-level="14.1.3" data-path="14-fonctions.html"><a href="14-fonctions.html#effets-de-bord"><i class="fa fa-check"></i><b>14.1.3</b> Effets de bord</a></li>
<li class="chapter" data-level="14.1.4" data-path="14-fonctions.html"><a href="14-fonctions.html#utilité-des-fonctions"><i class="fa fa-check"></i><b>14.1.4</b> Utilité des fonctions</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultat-dune-fonction"><i class="fa fa-check"></i><b>14.2</b> Arguments et résultat d’une fonction</a><ul>
<li class="chapter" data-level="14.2.1" data-path="14-fonctions.html"><a href="14-fonctions.html#définition-des-arguments"><i class="fa fa-check"></i><b>14.2.1</b> Définition des arguments</a></li>
<li class="chapter" data-level="14.2.2" data-path="14-fonctions.html"><a href="14-fonctions.html#valeurs-par-défaut"><i class="fa fa-check"></i><b>14.2.2</b> Valeurs par défaut</a></li>
<li class="chapter" data-level="14.2.3" data-path="14-fonctions.html"><a href="14-fonctions.html#largument-..."><i class="fa fa-check"></i><b>14.2.3</b> L’argument <code>...</code></a></li>
<li class="chapter" data-level="14.2.4" data-path="14-fonctions.html"><a href="14-fonctions.html#resfunc"><i class="fa fa-check"></i><b>14.2.4</b> Résultat d’une fonction</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables"><i class="fa fa-check"></i><b>14.3</b> Portée des variables</a><ul>
<li class="chapter" data-level="14.3.1" data-path="14-fonctions.html"><a href="14-fonctions.html#une-fonction-peut-accéder-à-un-objet-extérieur"><i class="fa fa-check"></i><b>14.3.1</b> Une fonction peut accéder à un objet extérieur</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets"><i class="fa fa-check"></i><b>14.4</b> Les fonctions comme objets</a><ul>
<li class="chapter" data-level="14.4.1" data-path="14-fonctions.html"><a href="14-fonctions.html#passer-des-fonctions-comme-argument"><i class="fa fa-check"></i><b>14.4.1</b> Passer des fonctions comme argument</a></li>
<li class="chapter" data-level="14.4.2" data-path="14-fonctions.html"><a href="14-fonctions.html#fonctions-anonymes"><i class="fa fa-check"></i><b>14.4.2</b> Fonctions anonymes</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="14-fonctions.html"><a href="14-fonctions.html#ressources-6"><i class="fa fa-check"></i><b>14.5</b> Ressources</a></li>
<li class="chapter" data-level="14.6" data-path="14-fonctions.html"><a href="14-fonctions.html#exercices-7"><i class="fa fa-check"></i><b>14.6</b> Exercices</a><ul>
<li class="chapter" data-level="14.6.1" data-path="14-fonctions.html"><a href="14-fonctions.html#introduction-et-exemples-1"><i class="fa fa-check"></i><b>14.6.1</b> Introduction et exemples</a></li>
<li class="chapter" data-level="14.6.2" data-path="14-fonctions.html"><a href="14-fonctions.html#arguments-et-résultats"><i class="fa fa-check"></i><b>14.6.2</b> Arguments et résultats</a></li>
<li class="chapter" data-level="14.6.3" data-path="14-fonctions.html"><a href="14-fonctions.html#portée-des-variables-1"><i class="fa fa-check"></i><b>14.6.3</b> Portée des variables</a></li>
<li class="chapter" data-level="14.6.4" data-path="14-fonctions.html"><a href="14-fonctions.html#les-fonctions-comme-objets-1"><i class="fa fa-check"></i><b>14.6.4</b> Les fonctions comme objets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="15-programmer.html"><a href="15-programmer.html"><i class="fa fa-check"></i><b>15</b> Programmer avec R</a><ul>
<li class="chapter" data-level="15.1" data-path="15-programmer.html"><a href="15-programmer.html#structures-de-données"><i class="fa fa-check"></i><b>15.1</b> Structures de données</a><ul>
<li class="chapter" data-level="15.1.1" data-path="15-programmer.html"><a href="15-programmer.html#vecteurs-atomiques"><i class="fa fa-check"></i><b>15.1.1</b> Vecteurs atomiques</a></li>
<li class="chapter" data-level="15.1.2" data-path="15-programmer.html"><a href="15-programmer.html#listes"><i class="fa fa-check"></i><b>15.1.2</b> Listes</a></li>
<li class="chapter" data-level="15.1.3" data-path="15-programmer.html"><a href="15-programmer.html#data-frame-tibbles"><i class="fa fa-check"></i><b>15.1.3</b> Tableaux de données (<em>data frame</em> et <em>tibble</em>)</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="15-programmer.html"><a href="15-programmer.html#if-else-exécuter-du-code-sous-certaines-conditions"><i class="fa fa-check"></i><b>15.2</b> <code>if</code>, <code>else</code> : exécuter du code sous certaines conditions</a><ul>
<li class="chapter" data-level="15.2.1" data-path="15-programmer.html"><a href="15-programmer.html#if"><i class="fa fa-check"></i><b>15.2.1</b> <code>if</code></a></li>
<li class="chapter" data-level="15.2.2" data-path="15-programmer.html"><a href="15-programmer.html#if-else-1"><i class="fa fa-check"></i><b>15.2.2</b> <code>if</code> / <code>else</code></a></li>
<li class="chapter" data-level="15.2.3" data-path="15-programmer.html"><a href="15-programmer.html#if-else-if-else"><i class="fa fa-check"></i><b>15.2.3</b> “<code>if</code>” / “<code>else if</code>” / “<code>else</code>”</a></li>
<li class="chapter" data-level="15.2.4" data-path="15-programmer.html"><a href="15-programmer.html#construction-de-conditions-complexes"><i class="fa fa-check"></i><b>15.2.4</b> Construction de conditions complexes</a></li>
<li class="chapter" data-level="15.2.5" data-path="15-programmer.html"><a href="15-programmer.html#différence-entre-if-else-et-ifelse"><i class="fa fa-check"></i><b>15.2.5</b> Différence entre <code>if</code> / <code>else</code> et <code>ifelse</code></a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="15-programmer.html"><a href="15-programmer.html#contrôle-de-lexécution-et-gestion-des-erreurs"><i class="fa fa-check"></i><b>15.3</b> Contrôle de l’exécution et gestion des erreurs</a><ul>
<li class="chapter" data-level="15.3.1" data-path="15-programmer.html"><a href="15-programmer.html#utilisation-de-return-pour-sortir-de-la-fonction"><i class="fa fa-check"></i><b>15.3.1</b> Utilisation de <code>return</code> pour sortir de la fonction</a></li>
<li class="chapter" data-level="15.3.2" data-path="15-programmer.html"><a href="15-programmer.html#warning"><i class="fa fa-check"></i><b>15.3.2</b> <code>warning</code></a></li>
<li class="chapter" data-level="15.3.3" data-path="15-programmer.html"><a href="15-programmer.html#stop-et-stopifnot"><i class="fa fa-check"></i><b>15.3.3</b> <code>stop</code> et <code>stopifnot</code></a></li>
<li class="chapter" data-level="15.3.4" data-path="15-programmer.html"><a href="15-programmer.html#tester-la-présence-dun-argument"><i class="fa fa-check"></i><b>15.3.4</b> Tester la présence d’un argument</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="15-programmer.html"><a href="15-programmer.html#for-et-while-répéter-des-instructions-dans-une-boucle"><i class="fa fa-check"></i><b>15.4</b> <code>for</code> et <code>while</code> : répéter des instructions dans une boucle</a><ul>
<li class="chapter" data-level="15.4.1" data-path="15-programmer.html"><a href="15-programmer.html#for"><i class="fa fa-check"></i><b>15.4.1</b> <code>for</code></a></li>
<li class="chapter" data-level="15.4.2" data-path="15-programmer.html"><a href="15-programmer.html#while"><i class="fa fa-check"></i><b>15.4.2</b> <code>while</code></a></li>
<li class="chapter" data-level="15.4.3" data-path="15-programmer.html"><a href="15-programmer.html#break-et-next"><i class="fa fa-check"></i><b>15.4.3</b> <code>break</code> et <code>next</code></a></li>
<li class="chapter" data-level="15.4.4" data-path="15-programmer.html"><a href="15-programmer.html#no-boucles"><i class="fa fa-check"></i><b>15.4.4</b> Quand (ne pas) utiliser des boucles</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="15-programmer.html"><a href="15-programmer.html#ressources-7"><i class="fa fa-check"></i><b>15.5</b> Ressources</a></li>
<li class="chapter" data-level="15.6" data-path="15-programmer.html"><a href="15-programmer.html#exercices-8"><i class="fa fa-check"></i><b>15.6</b> Exercices</a><ul>
<li class="chapter" data-level="15.6.1" data-path="15-programmer.html"><a href="15-programmer.html#vecteurs-atomiques-1"><i class="fa fa-check"></i><b>15.6.1</b> Vecteurs atomiques</a></li>
<li class="chapter" data-level="15.6.2" data-path="15-programmer.html"><a href="15-programmer.html#listes-1"><i class="fa fa-check"></i><b>15.6.2</b> Listes</a></li>
<li class="chapter" data-level="15.6.3" data-path="15-programmer.html"><a href="15-programmer.html#data-frame-et-tibble"><i class="fa fa-check"></i><b>15.6.3</b> <em>data frame</em> et <em>tibble</em></a></li>
<li class="chapter" data-level="15.6.4" data-path="15-programmer.html"><a href="15-programmer.html#if-et-else"><i class="fa fa-check"></i><b>15.6.4</b> <code>if</code> et <code>else</code></a></li>
<li class="chapter" data-level="15.6.5" data-path="15-programmer.html"><a href="15-programmer.html#contrôle-de-lexécution"><i class="fa fa-check"></i><b>15.6.5</b> Contrôle de l’exécution</a></li>
<li class="chapter" data-level="15.6.6" data-path="15-programmer.html"><a href="15-programmer.html#boucles"><i class="fa fa-check"></i><b>15.6.6</b> Boucles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html"><i class="fa fa-check"></i><b>16</b> <code>dplyr</code> avancé</a><ul>
<li class="chapter" data-level="16.1" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#appliquer-ses-propres-fonctions"><i class="fa fa-check"></i><b>16.1</b> Appliquer ses propres fonctions</a><ul>
<li class="chapter" data-level="16.1.1" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#exemple-avec-un-mutate"><i class="fa fa-check"></i><b>16.1.1</b> Exemple avec un <code>mutate</code></a></li>
<li class="chapter" data-level="16.1.2" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#exemple-avec-un-summarise"><i class="fa fa-check"></i><b>16.1.2</b> Exemple avec un <code>summarise</code></a></li>
<li class="chapter" data-level="16.1.3" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#exemple-avec-un-rename_with"><i class="fa fa-check"></i><b>16.1.3</b> Exemple avec un <code>rename_with</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#across"><i class="fa fa-check"></i><b>16.2</b> <code>across()</code> : appliquer des fonctions à plusieurs colonnes</a><ul>
<li class="chapter" data-level="16.2.1" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#appliquer-une-fonction-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>16.2.1</b> Appliquer une fonction à plusieurs colonnes</a></li>
<li class="chapter" data-level="16.2.2" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#appliquer-plusieurs-fonctions-à-plusieurs-colonnes"><i class="fa fa-check"></i><b>16.2.2</b> Appliquer plusieurs fonctions à plusieurs colonnes</a></li>
<li class="chapter" data-level="16.2.3" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#renommer-plusieurs-colonnes-avec-une-fonctions"><i class="fa fa-check"></i><b>16.2.3</b> Renommer plusieurs colonnes avec une fonctions</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#rowwise-et-c_across-appliquer-une-transformation-ligne-par-ligne"><i class="fa fa-check"></i><b>16.3</b> <code>rowwise()</code> et <code>c_across()</code> : appliquer une transformation ligne par ligne</a></li>
<li class="chapter" data-level="16.4" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#syntaxes-abregees"><i class="fa fa-check"></i><b>16.4</b> Fonctions anonymes et syntaxes abrégées</a></li>
<li class="chapter" data-level="16.5" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#ressources-8"><i class="fa fa-check"></i><b>16.5</b> Ressources</a></li>
<li class="chapter" data-level="16.6" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#exercices-9"><i class="fa fa-check"></i><b>16.6</b> Exercices</a><ul>
<li class="chapter" data-level="16.6.1" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#appliquer-ses-propres-fonctions-1"><i class="fa fa-check"></i><b>16.6.1</b> Appliquer ses propres fonctions</a></li>
<li class="chapter" data-level="16.6.2" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#across-1"><i class="fa fa-check"></i><b>16.6.2</b> <code>across()</code></a></li>
<li class="chapter" data-level="16.6.3" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#rowwise-et-c_across"><i class="fa fa-check"></i><b>16.6.3</b> <code>rowwise()</code> et <code>c_across()</code></a></li>
<li class="chapter" data-level="16.6.4" data-path="16-dplyr-avance.html"><a href="16-dplyr-avance.html#fonctions-anonymes-et-notations-abrégées"><i class="fa fa-check"></i><b>16.6.4</b> Fonctions anonymes et notations abrégées</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="17-purrr.html"><a href="17-purrr.html"><i class="fa fa-check"></i><b>17</b> Itérer avec <code>purrr</code></a><ul>
<li class="chapter" data-level="17.1" data-path="17-purrr.html"><a href="17-purrr.html#exemple-dapplication"><i class="fa fa-check"></i><b>17.1</b> Exemple d’application</a></li>
<li class="chapter" data-level="17.2" data-path="17-purrr.html"><a href="17-purrr.html#map-et-ses-variantes"><i class="fa fa-check"></i><b>17.2</b> <code>map</code> et ses variantes</a><ul>
<li class="chapter" data-level="17.2.1" data-path="17-purrr.html"><a href="17-purrr.html#modes-dappel-de-map"><i class="fa fa-check"></i><b>17.2.1</b> Modes d’appel de <code>map</code></a></li>
<li class="chapter" data-level="17.2.2" data-path="17-purrr.html"><a href="17-purrr.html#variantes-de-map"><i class="fa fa-check"></i><b>17.2.2</b> Variantes de <code>map</code></a></li>
<li class="chapter" data-level="17.2.3" data-path="17-purrr.html"><a href="17-purrr.html#map_dfr-et-map_dfc"><i class="fa fa-check"></i><b>17.2.3</b> <code>map_dfr()</code> et <code>map_dfc()</code></a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="17-purrr.html"><a href="17-purrr.html#itérer-sur-les-colonnes-dun-tableau-de-données"><i class="fa fa-check"></i><b>17.3</b> Itérer sur les colonnes d’un tableau de données</a></li>
<li class="chapter" data-level="17.4" data-path="17-purrr.html"><a href="17-purrr.html#modify"><i class="fa fa-check"></i><b>17.4</b> <code>modify</code></a></li>
<li class="chapter" data-level="17.5" data-path="17-purrr.html"><a href="17-purrr.html#imap"><i class="fa fa-check"></i><b>17.5</b> <code>imap</code></a></li>
<li class="chapter" data-level="17.6" data-path="17-purrr.html"><a href="17-purrr.html#walk"><i class="fa fa-check"></i><b>17.6</b> <code>walk</code></a></li>
<li class="chapter" data-level="17.7" data-path="17-purrr.html"><a href="17-purrr.html#map2-et-pmap-itérer-sur-plusieurs-vecteurs-en-parallèle"><i class="fa fa-check"></i><b>17.7</b> <code>map2</code> et <code>pmap</code> : itérer sur plusieurs vecteurs en parallèle</a></li>
<li class="chapter" data-level="17.8" data-path="17-purrr.html"><a href="17-purrr.html#répéter-une-opération"><i class="fa fa-check"></i><b>17.8</b> Répéter une opération</a></li>
<li class="chapter" data-level="17.9" data-path="17-purrr.html"><a href="17-purrr.html#quand-ne-pas-utiliser-map"><i class="fa fa-check"></i><b>17.9</b> Quand ne pas utiliser <code>map</code></a></li>
<li class="chapter" data-level="17.10" data-path="17-purrr.html"><a href="17-purrr.html#purrr-vs-apply"><i class="fa fa-check"></i><b>17.10</b> <code>purrr</code> vs *apply</a></li>
<li class="chapter" data-level="17.11" data-path="17-purrr.html"><a href="17-purrr.html#ressources-9"><i class="fa fa-check"></i><b>17.11</b> Ressources</a></li>
<li class="chapter" data-level="17.12" data-path="17-purrr.html"><a href="17-purrr.html#exercices-10"><i class="fa fa-check"></i><b>17.12</b> Exercices</a><ul>
<li class="chapter" data-level="17.12.1" data-path="17-purrr.html"><a href="17-purrr.html#map-et-ses-variantes-1"><i class="fa fa-check"></i><b>17.12.1</b> <code>map</code> et ses variantes</a></li>
<li class="chapter" data-level="17.12.2" data-path="17-purrr.html"><a href="17-purrr.html#modify-et-itération-sur-les-colonnes-dun-tableau"><i class="fa fa-check"></i><b>17.12.2</b> <code>modify</code> et itération sur les colonnes d’un tableau</a></li>
<li class="chapter" data-level="17.12.3" data-path="17-purrr.html"><a href="17-purrr.html#imap-et-walk"><i class="fa fa-check"></i><b>17.12.3</b> <code>imap</code> et <code>walk</code></a></li>
<li class="chapter" data-level="17.12.4" data-path="17-purrr.html"><a href="17-purrr.html#map2-et-pmap"><i class="fa fa-check"></i><b>17.12.4</b> <code>map2</code> et <code>pmap</code></a></li>
<li class="chapter" data-level="17.12.5" data-path="17-purrr.html"><a href="17-purrr.html#répéter-une-opération-1"><i class="fa fa-check"></i><b>17.12.5</b> Répéter une opération</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="18-programmer-tidyverse.html"><a href="18-programmer-tidyverse.html"><i class="fa fa-check"></i><b>18</b> Programmer avec le <em>tidyverse</em></a></li>
<li class="chapter" data-level="19" data-path="19-targets.html"><a href="19-targets.html"><i class="fa fa-check"></i><b>19</b> Organiser ses traitements avec <code>targets</code></a><ul>
<li class="chapter" data-level="19.1" data-path="19-targets.html"><a href="19-targets.html#ressources-10"><i class="fa fa-check"></i><b>19.1</b> Ressources</a></li>
</ul></li>
<li class="appendix"><span><b>Annexes</b></span></li>
<li class="chapter" data-level="A" data-path="20-ressources.html"><a href="20-ressources.html"><i class="fa fa-check"></i><b>A</b> Ressources</a><ul>
<li class="chapter" data-level="A.1" data-path="20-ressources.html"><a href="20-ressources.html#aide"><i class="fa fa-check"></i><b>A.1</b> Aide</a><ul>
<li class="chapter" data-level="A.1.1" data-path="20-ressources.html"><a href="20-ressources.html#aide-de-r-et-rstudio"><i class="fa fa-check"></i><b>A.1.1</b> Aide de R et RStudio</a></li>
<li class="chapter" data-level="A.1.2" data-path="20-ressources.html"><a href="20-ressources.html#aide-en-ligne"><i class="fa fa-check"></i><b>A.1.2</b> Aide en ligne</a></li>
<li class="chapter" data-level="A.1.3" data-path="20-ressources.html"><a href="20-ressources.html#antisèches"><i class="fa fa-check"></i><b>A.1.3</b> Antisèches</a></li>
<li class="chapter" data-level="A.1.4" data-path="20-ressources.html"><a href="20-ressources.html#où-poser-des-questions"><i class="fa fa-check"></i><b>A.1.4</b> Où poser des questions</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="20-ressources.html"><a href="20-ressources.html#ouvrages-blogs-moocs"><i class="fa fa-check"></i><b>A.2</b> Ouvrages, blogs, MOOCs…</a><ul>
<li class="chapter" data-level="A.2.1" data-path="20-ressources.html"><a href="20-ressources.html#francophones"><i class="fa fa-check"></i><b>A.2.1</b> Francophones</a></li>
<li class="chapter" data-level="A.2.2" data-path="20-ressources.html"><a href="20-ressources.html#anglophones"><i class="fa fa-check"></i><b>A.2.2</b> Anglophones</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="20-ressources.html"><a href="20-ressources.html#extensions-1"><i class="fa fa-check"></i><b>A.3</b> Extensions</a><ul>
<li class="chapter" data-level="A.3.1" data-path="20-ressources.html"><a href="20-ressources.html#où-trouver-des-extensions-intéressantes"><i class="fa fa-check"></i><b>A.3.1</b> Où trouver des extensions intéressantes ?</a></li>
<li class="chapter" data-level="A.3.2" data-path="20-ressources.html"><a href="20-ressources.html#lextension-questionr"><i class="fa fa-check"></i><b>A.3.2</b> L’extension <code>questionr</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction à R et au tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="purrr" class="section level1">
<h1><span class="header-section-number">Partie 17</span> Itérer avec <code>purrr</code></h1>
<p><code>purrr</code> est une extension du <em>tidyverse</em> qui fournit des outils pour travailler avec les vecteurs et les fonctions, et notamment pour appliquer des fonctions à l’ensemble des éléments de vecteurs ou de listes.</p>
<p>Dans cette section on aura besoin des extensions du <em>tidyverse</em> (dont <code>purrr</code> fait partie), que nous chargeons donc immédiatement, de même que les jeux de données <code>rp2012</code> et <code>hdv2003</code> de <code>questionr</code>.</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb946-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb946-2" title="2"><span class="kw">library</span>(questionr)</a>
<a class="sourceLine" id="cb946-3" title="3"><span class="kw">data</span>(hdv2003)</a>
<a class="sourceLine" id="cb946-4" title="4"><span class="kw">data</span>(rp2012)</a></code></pre></div>
<div id="exemple-dapplication" class="section level2">
<h2><span class="header-section-number">17.1</span> Exemple d’application</h2>
<p>Pour mieux appréhender de quoi il s’agit, supposons que nous avons le vecteur suivant, qui contient des extraits de discours politiques.</p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb947-1" title="1">discours &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb947-2" title="2">    <span class="st">&quot;nous privilégierons une intergouvernementalisation sans agir anticonstitutionnellement&quot;</span>,</a>
<a class="sourceLine" id="cb947-3" title="3">    <span class="st">&quot;le souffle de la nation est le vent qui agite les drapeaux de nos libertés&quot;</span>,</a>
<a class="sourceLine" id="cb947-4" title="4">    <span class="st">&quot;nous devons faire preuve de plus de pédagogie pour cette réforme&quot;</span>,</a>
<a class="sourceLine" id="cb947-5" title="5">    <span class="st">&quot;mon compte twitter a été piraté&quot;</span></a>
<a class="sourceLine" id="cb947-6" title="6">)</a></code></pre></div>
<p>On souhaite calculer la longueur de chaque extrait, en nombre de mots.</p>
<p>On commence par découper chaque extrait en mots en utilisant la fonction <code>str_split()</code> de <code>stringr</code>.</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb948-1" title="1">mots &lt;-<span class="st"> </span><span class="kw">str_split</span>(discours, <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb948-2" title="2"><span class="kw">str</span>(mots)</a>
<a class="sourceLine" id="cb948-3" title="3"><span class="co">#&gt; List of 4</span></a>
<a class="sourceLine" id="cb948-4" title="4"><span class="co">#&gt;  $ : chr [1:7] &quot;nous&quot; &quot;privilégierons&quot; &quot;une&quot; &quot;intergouvernementalisation&quot; ...</span></a>
<a class="sourceLine" id="cb948-5" title="5"><span class="co">#&gt;  $ : chr [1:15] &quot;le&quot; &quot;souffle&quot; &quot;de&quot; &quot;la&quot; ...</span></a>
<a class="sourceLine" id="cb948-6" title="6"><span class="co">#&gt;  $ : chr [1:11] &quot;nous&quot; &quot;devons&quot; &quot;faire&quot; &quot;preuve&quot; ...</span></a>
<a class="sourceLine" id="cb948-7" title="7"><span class="co">#&gt;  $ : chr [1:6] &quot;mon&quot; &quot;compte&quot; &quot;twitter&quot; &quot;a&quot; ...</span></a></code></pre></div>
<p>L’objet <code>mots</code> qui contient le résultat du découpage est une liste constituée de vecteurs de chaînes de caractères qui contiennent les mots des différents discours.</p>
<p>Calculer le nombre de mots de chaque discours, revient à calculer la longueur de chaque élément de <code>mots</code>. Pour cela on pourrait vouloir utiliser la fonction <code>length()</code> directement :</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" title="1"><span class="kw">length</span>(mots)</a>
<a class="sourceLine" id="cb949-2" title="2"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>Ceci ne fonctionne pas, car <code>length()</code> nous retourne le nombre d’éléments de <code>mots</code>, pas celui de chacun de ses éléments. On a en fait besoin d’appliquer <code>length()</code> tour à tour à chacun des éléments de <code>mots</code>.</p>
<p>On a vu section <a href="15-programmer.html#no-boucles">15.4.4</a> qu’on peut pour cela utiliser une boucle <code>for</code>, par exemple de la manière suivante.</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb950-1" title="1">resultat &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb950-2" title="2"><span class="cf">for</span> (item <span class="cf">in</span> mots) {</a>
<a class="sourceLine" id="cb950-3" title="3">    resultat &lt;-<span class="st"> </span><span class="kw">append</span>(resultat, <span class="kw">length</span>(item))</a>
<a class="sourceLine" id="cb950-4" title="4">}</a>
<a class="sourceLine" id="cb950-5" title="5">resultat</a>
<a class="sourceLine" id="cb950-6" title="6"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb950-7" title="7"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb950-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb950-9" title="9"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb950-10" title="10"><span class="co">#&gt; [1] 15</span></a>
<a class="sourceLine" id="cb950-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb950-12" title="12"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb950-13" title="13"><span class="co">#&gt; [1] 11</span></a>
<a class="sourceLine" id="cb950-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb950-15" title="15"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb950-16" title="16"><span class="co">#&gt; [1] 6</span></a></code></pre></div>
<p>Cela fonctionne, mais la syntaxe est un peu “lourde”.</p>
<p>La fonction <code>map()</code> de <code>purrr</code> propose exactement cette fonctionnalité. Elle prend deux arguments principaux :</p>
<ol style="list-style-type: decimal">
<li>un vecteur ou une liste</li>
<li>une fonction</li>
</ol>
<p>et elle retourne une liste contenant le résultat de la fonction appliquée à chaque élément du vecteur ou de la liste.</p>
<p>En utilisant <code>map()</code> on peut du coup remplacer notre boucle <code>for</code> par un simple :</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb951-1" title="1"><span class="kw">map</span>(mots, length)</a>
<a class="sourceLine" id="cb951-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb951-3" title="3"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb951-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb951-5" title="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb951-6" title="6"><span class="co">#&gt; [1] 15</span></a>
<a class="sourceLine" id="cb951-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb951-8" title="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb951-9" title="9"><span class="co">#&gt; [1] 11</span></a>
<a class="sourceLine" id="cb951-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb951-11" title="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb951-12" title="12"><span class="co">#&gt; [1] 6</span></a></code></pre></div>
<p>À noter qu’on peut évidemment utiliser le <em>pipe</em>.</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb952-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(length)</a>
<a class="sourceLine" id="cb952-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb952-3" title="3"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb952-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb952-5" title="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb952-6" title="6"><span class="co">#&gt; [1] 15</span></a>
<a class="sourceLine" id="cb952-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb952-8" title="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb952-9" title="9"><span class="co">#&gt; [1] 11</span></a>
<a class="sourceLine" id="cb952-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb952-11" title="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb952-12" title="12"><span class="co">#&gt; [1] 6</span></a></code></pre></div>
<p>Ici notre résultat est donné sous forme de liste. Or il pourrait être simplifié sous forme de vecteur atomique, puisque tous ses éléments sont des nombres. Si on souhaitait faire ceci avec une boucle <code>for</code>, il faudrait soit convertir le résultat de la boucle précédente en vecteur atomique (avec <code>unlist()</code> ou <code>purrr::flatten_int()</code>), soit modifier cette boucle pour qu’elle génère plutôt un vecteur numérique. C’est ce que fait le code suivant, en n’oubliant pas de “pré-allouer” le nombre d’éléments nécessaires au vecteur résultat pour éviter des problèmes de performance.</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb953-1" title="1">resultat &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(discours))</a>
<a class="sourceLine" id="cb953-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(mots)) {</a>
<a class="sourceLine" id="cb953-3" title="3">    resultat[i] &lt;-<span class="st"> </span><span class="kw">length</span>(mots[[i]])</a>
<a class="sourceLine" id="cb953-4" title="4">}</a>
<a class="sourceLine" id="cb953-5" title="5">resultat</a>
<a class="sourceLine" id="cb953-6" title="6"><span class="co">#&gt; [1]  7 15 11  6</span></a></code></pre></div>
<p><code>purrr</code> propose des variantes de la fonction <code>map</code> qui permettent justement de s’assurer du type de résultat obtenu. Ainsi, <code>map_dbl()</code> renverra toujours un vecteur de nombres flottants, et <code>map_int()</code> un vecteur de nombres entiers. Plutôt que la boucle <code>for</code> ci-dessus, on peut plutôt utiliser :</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb954-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</a>
<a class="sourceLine" id="cb954-2" title="2"><span class="co">#&gt; [1]  7 15 11  6</span></a></code></pre></div>
</div>
<div id="map-et-ses-variantes" class="section level2">
<h2><span class="header-section-number">17.2</span> <code>map</code> et ses variantes</h2>
<div id="modes-dappel-de-map" class="section level3">
<h3><span class="header-section-number">17.2.1</span> Modes d’appel de <code>map</code></h3>
<p>L’objectif de <code>map</code> est donc d’appliquer une fonction à l’ensemble des éléments d’un vecteur ou d’une liste.</p>
<p>On a vu qu’on pouvait l’utiliser pour appliquer la fonction <code>length</code> à chacun des vecteurs contenus par la liste <code>mots</code>. En utilisant <code>map_int</code> on s’assure de récupérer un simple vecteur numérique, plus facile à utiliser par la suite si on souhaite par exemple calculer une moyenne.</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb955-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</a>
<a class="sourceLine" id="cb955-2" title="2"><span class="co">#&gt; [1]  7 15 11  6</span></a></code></pre></div>
<p>Si on souhaitait plutôt extraire le dernier mot de chaque vecteur, on pourrait créer une fonction spécifique et l’appliquer avec <code>map()</code>.</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb956-1" title="1">dernier_mot &lt;-<span class="st"> </span><span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb956-2" title="2">    <span class="kw">tail</span>(v, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb956-3" title="3">}</a>
<a class="sourceLine" id="cb956-4" title="4"></a>
<a class="sourceLine" id="cb956-5" title="5">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(dernier_mot)</a>
<a class="sourceLine" id="cb956-6" title="6"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb956-7" title="7"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot;</span></a>
<a class="sourceLine" id="cb956-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb956-9" title="9"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb956-10" title="10"><span class="co">#&gt; [1] &quot;libertés&quot;</span></a>
<a class="sourceLine" id="cb956-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb956-12" title="12"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb956-13" title="13"><span class="co">#&gt; [1] &quot;réforme&quot;</span></a>
<a class="sourceLine" id="cb956-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb956-15" title="15"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb956-16" title="16"><span class="co">#&gt; [1] &quot;piraté&quot;</span></a></code></pre></div>
<p>Comme notre résultat est une liste de chaînes de caractères simples, on peut forcer le résultat à être plutôt un vecteur de type <em>character</em> en utilisant <code>map_chr()</code> :</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(dernier_mot)</a>
<a class="sourceLine" id="cb957-2" title="2"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></a>
<a class="sourceLine" id="cb957-3" title="3"><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></a></code></pre></div>
<p>Comme notre fonction est très courte, on peut aussi préférer utiliser une <em>fonction anonyme</em>, introduites section <a href="14-fonctions.html#fonctions-anonymes">14.4.2</a>.</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb958-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="cf">function</span>(v) { <span class="kw">tail</span>(v, <span class="dv">1</span>) })</a>
<a class="sourceLine" id="cb958-2" title="2"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></a>
<a class="sourceLine" id="cb958-3" title="3"><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></a></code></pre></div>
<p>On peut aussi utiliser la notation abrégée sous forme de formule, présentée section <a href="16-dplyr-avance.html#syntaxes-abregees">16.4</a> propre aux fonctions du <em>tidyverse</em>.</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">tail</span>(.x, <span class="dv">1</span>) )</a>
<a class="sourceLine" id="cb959-2" title="2"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></a>
<a class="sourceLine" id="cb959-3" title="3"><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></a></code></pre></div>
<p>On peut également utiliser la notation compacte pour les fonctions anonymes propre aux versions de R à partir de la 4.1.</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb960-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(\(v) <span class="kw">tail</span>(v, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb960-2" title="2"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></a>
<a class="sourceLine" id="cb960-3" title="3"><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></a></code></pre></div>
<p>Enfin, si on fournit des arguments supplémentaires à <code>map</code>, ils sont passés comme argument à la fonction qu’il applique, on peut donc également utiliser la notation suivante :</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb961-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(tail, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb961-2" title="2"><span class="co">#&gt; [1] &quot;anticonstitutionnellement&quot; &quot;libertés&quot;                 </span></a>
<a class="sourceLine" id="cb961-3" title="3"><span class="co">#&gt; [3] &quot;réforme&quot;                   &quot;piraté&quot;</span></a></code></pre></div>
<p>Dans ce qui suit on utilisera de préférence la notation “formule”, mais toutes les versions ci-dessus sont équivalentes et donnent le même résultat.</p>
<div class="rmdnote">
<p>
Petite astuce à noter, si on transmet à <code>map()</code> autre chose qu’une fonction, elle utilisera cette information pour extraire des éléments. Ainsi, <code>map(v, 1)</code> extraiera le premier élément de chaque élément du vecteur <code>v</code>, <code>map(v, “foo”)</code> extraiera les éléments nommés “foo”, etc.
</p>
</div>
</div>
<div id="variantes-de-map" class="section level3">
<h3><span class="header-section-number">17.2.2</span> Variantes de <code>map</code></h3>
<p>On a vu que <code>map</code> propose plusieurs variantes qui permettent de contrôler le type de résultat qu’elle retourne :</p>
<ul>
<li><code>map()</code> retourne une liste</li>
<li><code>map_int()</code> retourne un vecteur atomique d’entiers</li>
<li><code>map_dbl()</code> retourne un vecteur atomique de nombres flottants</li>
<li><code>map_chr()</code> retourne un vecteur atomique de chaînes de caractères</li>
<li><code>map_lgl()</code> retourne un vecteur atomique de <code>TRUE</code> / <code>FALSE</code></li>
</ul>
<p>Attention, ces variantes sont très strictes dans le sens où si la fonction appelée retourne un résultat qui n’est pas compatible avec le résultat attendu, elle génère une erreur. Ainsi, si dans le code précédent on souhaitait récupérer chaque dernier mot sous forme d’un vecteur de nombres :</p>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb962-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(tail, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb962-2" title="2"><span class="co">#&gt; Error: Can&#39;t coerce element 1 from a character to a double</span></a></code></pre></div>
<p>Pour pouvoir utiliser ces variantes, chaque résultat retourné par la fonction appliquée doit être de longueur 1. Par exemple, si on souhaitait extraire plutôt la liste des mots contenant un “f” :</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb963-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) )</a>
<a class="sourceLine" id="cb963-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb963-3" title="3"><span class="co">#&gt; character(0)</span></a>
<a class="sourceLine" id="cb963-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb963-5" title="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb963-6" title="6"><span class="co">#&gt; [1] &quot;souffle&quot;</span></a>
<a class="sourceLine" id="cb963-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb963-8" title="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb963-9" title="9"><span class="co">#&gt; [1] &quot;faire&quot;   &quot;réforme&quot;</span></a>
<a class="sourceLine" id="cb963-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb963-11" title="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb963-12" title="12"><span class="co">#&gt; character(0)</span></a></code></pre></div>
<p>Dans ce cas on ne peut utiliser <code>map_chr()</code> puisque certains vecteurs contiennent plusieurs mots avec un “f”, et donc le résultat de <code>str_subset()</code> est lui-même un vecteur.</p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb964-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) )</a>
<a class="sourceLine" id="cb964-2" title="2"><span class="co">#&gt; Error: Result 1 must be a single string, not a character vector of length 0</span></a></code></pre></div>
<p>Dans ce cas, on doit utiliser <code>map()</code> et conserver le résultat sous forme de liste. Et, pourquoi pas, enchaîner les <code>map()</code> si on veut effectuer des opérations supplémentaires.</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb965-1" title="1">mots <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb965-2" title="2"><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_subset</span>(.x, <span class="st">&quot;f&quot;</span>) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb965-3" title="3"><span class="st">    </span><span class="kw">map_int</span>(length)</a>
<a class="sourceLine" id="cb965-4" title="4"><span class="co">#&gt; [1] 0 1 2 0</span></a></code></pre></div>
</div>
<div id="map_dfr-et-map_dfc" class="section level3">
<h3><span class="header-section-number">17.2.3</span> <code>map_dfr()</code> et <code>map_dfc()</code></h3>
<p>La page suivante contient les données du jeu de données <code>rp2012</code> sous la forme de fichiers CSV, avec un fichier par département :</p>
<p>TODO: Mettre à jour avec la branche master
<a href="https://github.com/juba/tidyverse/tree/aller-plus-loin/data/rp2012" class="uri">https://github.com/juba/tidyverse/tree/aller-plus-loin/data/rp2012</a></p>
<p>À partir de cette page, on peut télécharger les fichiers CSV en utilisant des adresses de la forme :</p>
<p><a href="https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_01.csv" class="uri">https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_01.csv</a></p>
<p>En remplaçant “01” par le code du département souhaité.</p>
<p>On peut facilement créer une fonction <code>genere_url()</code> qui, à partir d’une liste de codes de départements, retourne les adresses des fichiers correspondant.</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb966-1" title="1">genere_url &lt;-<span class="st"> </span><span class="cf">function</span>(codes) {</a>
<a class="sourceLine" id="cb966-2" title="2">    <span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb966-3" title="3">        <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_&quot;</span>,</a>
<a class="sourceLine" id="cb966-4" title="4">        codes,</a>
<a class="sourceLine" id="cb966-5" title="5">        <span class="st">&quot;.csv&quot;</span></a>
<a class="sourceLine" id="cb966-6" title="6">    )</a>
<a class="sourceLine" id="cb966-7" title="7">}</a>
<a class="sourceLine" id="cb966-8" title="8"></a>
<a class="sourceLine" id="cb966-9" title="9"><span class="kw">genere_url</span>(<span class="kw">c</span>(<span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>))</a>
<a class="sourceLine" id="cb966-10" title="10"><span class="co">#&gt; [1] &quot;https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_42.csv&quot;</span></a>
<a class="sourceLine" id="cb966-11" title="11"><span class="co">#&gt; [2] &quot;https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_69.csv&quot;</span></a></code></pre></div>
<p>Grâce à la fonction <code>read_csv()</code>, on peut charger directement dans notre session R un fichier en indiquant son URL.</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb967-1" title="1">data69 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">genere_url</span>(<span class="st">&quot;69&quot;</span>))</a></code></pre></div>
<p>Comment faire si l’on souhaite charger les fichiers de plusieurs départements ? La fonction <code>read_csv()</code> n’accepte qu’une seule URL à la fois, mais on peut très bien utiliser <code>map()</code> pour l’appliquer tour à tour à plusieurs URL.</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb968-1" title="1">departements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;38&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>)</a>
<a class="sourceLine" id="cb968-2" title="2"></a>
<a class="sourceLine" id="cb968-3" title="3">l &lt;-<span class="st"> </span><span class="kw">genere_url</span>(departements) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-4" title="4"><span class="st">    </span><span class="kw">map</span>(read_csv)</a></code></pre></div>
<p><code>l</code> ici est donc une liste de tableaux de données, chacun de ces éléments étant un <em>tibble</em> : d’abord celui du fichier CSV correspondant aux données de l’Ain, puis celui de la Loire, etc.</p>
<p>Si on souhaite réunir ces trois <em>tibbles</em> en un seul, on peut utiliser la fonction <code>bind_rows()</code> de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" title="1">departements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;38&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;69&quot;</span>)</a>
<a class="sourceLine" id="cb969-2" title="2"></a>
<a class="sourceLine" id="cb969-3" title="3">df &lt;-<span class="st"> </span><span class="kw">genere_url</span>(departements) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-4" title="4"><span class="st">    </span><span class="kw">map</span>(read_csv) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-5" title="5"><span class="st">    </span><span class="kw">bind_rows</span>()</a>
<a class="sourceLine" id="cb969-6" title="6"><span class="co">#&gt; Rows: 129 Columns: 36</span></a>
<a class="sourceLine" id="cb969-7" title="7"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb969-8" title="8"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb969-9" title="9"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb969-10" title="10"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb969-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb969-12" title="12"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb969-13" title="13"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb969-14" title="14"><span class="co">#&gt; Rows: 56 Columns: 36</span></a>
<a class="sourceLine" id="cb969-15" title="15"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb969-16" title="16"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb969-17" title="17"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb969-18" title="18"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb969-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb969-20" title="20"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb969-21" title="21"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb969-22" title="22"><span class="co">#&gt; Rows: 119 Columns: 36</span></a>
<a class="sourceLine" id="cb969-23" title="23"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb969-24" title="24"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb969-25" title="25"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb969-26" title="26"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb969-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb969-28" title="28"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb969-29" title="29"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a></code></pre></div>
<p>Mais on peut aussi utiliser la variante <code>map_dfr()</code> de <code>map()</code>, qui considère les résultats obtenus par l’application de la fonction comme les lignes d’un tableau de données qu’elle va automatiquement rassembler en un seul tableau, de la même manière qu’avec un <code>bind_rows()</code>.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb970-1" title="1">df &lt;-<span class="st"> </span><span class="kw">genere_url</span>(departements) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb970-2" title="2"><span class="st">    </span><span class="kw">map_dfr</span>(read_csv)</a>
<a class="sourceLine" id="cb970-3" title="3"><span class="co">#&gt; Rows: 129 Columns: 36</span></a>
<a class="sourceLine" id="cb970-4" title="4"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb970-5" title="5"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb970-6" title="6"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb970-7" title="7"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb970-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb970-9" title="9"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb970-10" title="10"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb970-11" title="11"><span class="co">#&gt; Rows: 56 Columns: 36</span></a>
<a class="sourceLine" id="cb970-12" title="12"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb970-13" title="13"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb970-14" title="14"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb970-15" title="15"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb970-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb970-17" title="17"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb970-18" title="18"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb970-19" title="19"><span class="co">#&gt; Rows: 119 Columns: 36</span></a>
<a class="sourceLine" id="cb970-20" title="20"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb970-21" title="21"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb970-22" title="22"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb970-23" title="23"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb970-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb970-25" title="25"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb970-26" title="26"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb970-27" title="27">df</a>
<a class="sourceLine" id="cb970-28" title="28"><span class="co">#&gt; # A tibble: 304 × 36</span></a>
<a class="sourceLine" id="cb970-29" title="29"><span class="co">#&gt;    code_insee commune  code_region region departement log_rp log_proprio log_loc</span></a>
<a class="sourceLine" id="cb970-30" title="30"><span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb970-31" title="31"><span class="co">#&gt;  1      38001 Les Abr…          82 Rhône… Isère         1432         814     588</span></a>
<a class="sourceLine" id="cb970-32" title="32"><span class="co">#&gt;  2      38006 Allevard          82 Rhône… Isère         1684        1033     610</span></a>
<a class="sourceLine" id="cb970-33" title="33"><span class="co">#&gt;  3      38012 Aoste             82 Rhône… Isère         1083         733     331</span></a>
<a class="sourceLine" id="cb970-34" title="34"><span class="co">#&gt;  4      38013 Apprieu           82 Rhône… Isère         1197        1007     172</span></a>
<a class="sourceLine" id="cb970-35" title="35"><span class="co">#&gt;  5      38022 Les Ave…          82 Rhône… Isère         2320        1596     679</span></a>
<a class="sourceLine" id="cb970-36" title="36"><span class="co">#&gt;  6      38034 Beaurep…          82 Rhône… Isère         1985        1080     861</span></a>
<a class="sourceLine" id="cb970-37" title="37"><span class="co">#&gt;  7      38039 Bernin            82 Rhône… Isère         1117         922     172</span></a>
<a class="sourceLine" id="cb970-38" title="38"><span class="co">#&gt;  8      38045 Biviers           82 Rhône… Isère          942         801     131</span></a>
<a class="sourceLine" id="cb970-39" title="39"><span class="co">#&gt;  9      38052 Le Bour…          82 Rhône… Isère         1363         843     476</span></a>
<a class="sourceLine" id="cb970-40" title="40"><span class="co">#&gt; 10      38053 Bourgoi…          82 Rhône… Isère        12129        4924    6913</span></a>
<a class="sourceLine" id="cb970-41" title="41"><span class="co">#&gt; # … with 294 more rows, and 28 more variables: log_hlm &lt;dbl&gt;, log_sec &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-42" title="42"><span class="co">#&gt; #   log_maison &lt;dbl&gt;, log_appart &lt;dbl&gt;, age_0_14 &lt;dbl&gt;, age_15_29 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-43" title="43"><span class="co">#&gt; #   age_75p &lt;dbl&gt;, femmes &lt;dbl&gt;, chom &lt;dbl&gt;, agric &lt;dbl&gt;, indep &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-44" title="44"><span class="co">#&gt; #   cadres &lt;dbl&gt;, interm &lt;dbl&gt;, empl &lt;dbl&gt;, ouvr &lt;dbl&gt;, etud &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-45" title="45"><span class="co">#&gt; #   dipl_aucun &lt;dbl&gt;, dipl_bepc &lt;dbl&gt;, dipl_capbep &lt;dbl&gt;, dipl_bac &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-46" title="46"><span class="co">#&gt; #   dipl_bac2 &lt;dbl&gt;, dipl_sup &lt;dbl&gt;, resid_sec &lt;dbl&gt;, proprio &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb970-47" title="47"><span class="co">#&gt; #   locataire &lt;dbl&gt;, hlm &lt;dbl&gt;, maison &lt;dbl&gt;, appart &lt;dbl&gt;</span></a></code></pre></div>
<p>Les deux lignes de code ci-dessus partent d’une liste d’identifiants de départements, génèrent les URL des fichiers CSV correspondant, les importent dans R et assemblent le résultat en un seul tableau. Plutôt efficace !</p>
<div class="rmdnote">
<p>
Il existe également une variante <code>map_dfc()</code>, un peu moins fréquemment utilisée, qui considère les résultats comme des colonnes d’un tableau de données et les rassemble en un seul tableau comme le ferait la fonction <code>bind_cols()</code> de <code>dplyr</code>.
</p>
</div>
</div>
</div>
<div id="itérer-sur-les-colonnes-dun-tableau-de-données" class="section level2">
<h2><span class="header-section-number">17.3</span> Itérer sur les colonnes d’un tableau de données</h2>
<p>On a vu section <a href="15-programmer.html#data-frame-tibbles">15.1.3</a> que les tableaux de données (<em>data frame</em> ou <em>tibble</em>) sont en fait des listes dont les éléments sont les colonnes du tableau. On peut donc tout à fait appliquer <code>map()</code> et ses variantes à un tableau, et celle-ci itèrera sur ses colonnes.</p>
<p>Par exemple, on peut appliquer <code>n_distinct</code> au jeu de données <code>starwars</code> et obtenir le nombre de valeurs distinctes de chacune de ses colonnes.</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(n_distinct)</a>
<a class="sourceLine" id="cb971-2" title="2"><span class="co">#&gt;       name     height       mass hair_color skin_color  eye_color birth_year </span></a>
<a class="sourceLine" id="cb971-3" title="3"><span class="co">#&gt;         87         46         39         13         31         15         37 </span></a>
<a class="sourceLine" id="cb971-4" title="4"><span class="co">#&gt;        sex     gender  homeworld    species      films   vehicles  starships </span></a>
<a class="sourceLine" id="cb971-5" title="5"><span class="co">#&gt;          5          3         49         38         24         11         17</span></a></code></pre></div>
<p>Le résultat est équivalent à celui qu’on obtient en faisant un <code>summarise()</code> sur l’ensemble des colonnes, comme vu section <a href="16-dplyr-avance.html#across">16.2</a>, sauf que <code>map_int()</code> retourne un vecteur numérique tandis que <code>summarise()</code> renvoie un <em>tibble</em> à une ligne.</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb972-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb972-2" title="2"><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">everything</span>(), n_distinct))</a>
<a class="sourceLine" id="cb972-3" title="3"><span class="co">#&gt; # A tibble: 1 × 14</span></a>
<a class="sourceLine" id="cb972-4" title="4"><span class="co">#&gt;    name height  mass hair_color skin_color eye_color birth_year   sex gender</span></a>
<a class="sourceLine" id="cb972-5" title="5"><span class="co">#&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;int&gt;     &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb972-6" title="6"><span class="co">#&gt; 1    87     46    39         13         31        15         37     5      3</span></a>
<a class="sourceLine" id="cb972-7" title="7"><span class="co">#&gt; # … with 5 more variables: homeworld &lt;int&gt;, species &lt;int&gt;, films &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb972-8" title="8"><span class="co">#&gt; #   vehicles &lt;int&gt;, starships &lt;int&gt;</span></a></code></pre></div>
<p>De la même manière, si on veut connaître le nombre de valeurs manquantes pour chaquae variables :</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb973-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) )</a>
<a class="sourceLine" id="cb973-2" title="2"><span class="co">#&gt;       name     height       mass hair_color skin_color  eye_color birth_year </span></a>
<a class="sourceLine" id="cb973-3" title="3"><span class="co">#&gt;          0          6         28          5          0          0         44 </span></a>
<a class="sourceLine" id="cb973-4" title="4"><span class="co">#&gt;        sex     gender  homeworld    species      films   vehicles  starships </span></a>
<a class="sourceLine" id="cb973-5" title="5"><span class="co">#&gt;          4          4         10          4          0          0          0</span></a></code></pre></div>
<p>Contrairement à <code>across()</code>, on ne peut pas spécifier directement une sélection de colonnes à <code>map()</code>. On peut par contre utiliser des fonctions comme <code>keep()</code> ou <code>discard()</code> qui “filtrent” les éléments d’une liste via une fonction qui renvoie <code>TRUE</code> ou <code>FALSE</code>.</p>
<p>Dans l’exemple suivant, on utilise <code>keep()</code> pour n’appliquer <code>mean</code> que sur les variables numériques.</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb974-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb974-2" title="2"><span class="st">    </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb974-3" title="3"><span class="st">    </span><span class="kw">map</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb974-4" title="4"><span class="co">#&gt; $height</span></a>
<a class="sourceLine" id="cb974-5" title="5"><span class="co">#&gt; [1] 174.358</span></a>
<a class="sourceLine" id="cb974-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb974-7" title="7"><span class="co">#&gt; $mass</span></a>
<a class="sourceLine" id="cb974-8" title="8"><span class="co">#&gt; [1] 97.31186</span></a>
<a class="sourceLine" id="cb974-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb974-10" title="10"><span class="co">#&gt; $birth_year</span></a>
<a class="sourceLine" id="cb974-11" title="11"><span class="co">#&gt; [1] 87.56512</span></a></code></pre></div>
<p>Ici, on applique <code>discard()</code> après le <code>map()</code> pour ne conserver que les colonnes ayant au moins une valeur <code>NA</code>.</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb975-2" title="2"><span class="st">    </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb975-3" title="3"><span class="st">    </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span>.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span> )</a>
<a class="sourceLine" id="cb975-4" title="4"><span class="co">#&gt;     height       mass hair_color birth_year        sex     gender  homeworld </span></a>
<a class="sourceLine" id="cb975-5" title="5"><span class="co">#&gt;          6         28          5         44          4          4         10 </span></a>
<a class="sourceLine" id="cb975-6" title="6"><span class="co">#&gt;    species </span></a>
<a class="sourceLine" id="cb975-7" title="7"><span class="co">#&gt;          4</span></a></code></pre></div>
</div>
<div id="modify" class="section level2">
<h2><span class="header-section-number">17.4</span> <code>modify</code></h2>
<p><code>modify()</code> est une variante de <code>map()</code> qui a pour particularité de renvoyer un résultat du même type que la liste ou le vecteur donné en entrée.</p>
<p>Ainsi, si on l’applique à un vecteur de chaînes de caractères, le résultat sera aussi un vecteur de chaînes de caractères même si la fonction appliquée retourne un résultat numérique.</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb976-1" title="1">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</a>
<a class="sourceLine" id="cb976-2" title="2">v <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify</span>(length)</a>
<a class="sourceLine" id="cb976-3" title="3"><span class="co">#&gt; [1] &quot;1&quot; &quot;1&quot; &quot;1&quot;</span></a></code></pre></div>
<p>Si on l’applique à une liste, le résultat sera aussi une liste.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" title="1">v &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</a>
<a class="sourceLine" id="cb977-2" title="2">v <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify</span>(length)</a>
<a class="sourceLine" id="cb977-3" title="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb977-4" title="4"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb977-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb977-6" title="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb977-7" title="7"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb977-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb977-9" title="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb977-10" title="10"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>L’objectif de <code>modify()</code> est de permettre de “modifier” une liste ou un vecteur en lui appliquant une fonction tout en étant sûr qu’on ne va pas modifier son type.</p>
<p>L’intérêt est que <code>modify</code> propose deux variantes, <code>modify_if</code> et <code>modify_at</code>, qui permettent de sélectionner les éléments soit via une fonction soit par leur nom ou leur position, et n’appliquent la fonction de transformation qu’aux éléments sélectionnés.</p>
<p>Cela peut être particulièrement utile quand on l’applique à un tableau de données. Par exemple le code suivant transforme uniquement les colonnes de type <code>factor</code> de <code>hdv2003</code> en <code>character</code>, et laisse les autres inchangées.</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb978-1" title="1">hdv2003 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify_if</span>(is.factor, as.character)</a>
<a class="sourceLine" id="cb978-2" title="2"><span class="co">#&gt; # A tibble: 2,000 × 20</span></a>
<a class="sourceLine" id="cb978-3" title="3"><span class="co">#&gt;       id   age sexe  nivetud     poids occup   qualif freres.soeurs clso  relig </span></a>
<a class="sourceLine" id="cb978-4" title="4"><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt; &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb978-5" title="5"><span class="co">#&gt;  1     1    28 Femme Enseignem…  2634. Exerce… Emplo…             8 Oui   Ni cr…</span></a>
<a class="sourceLine" id="cb978-6" title="6"><span class="co">#&gt;  2     2    23 Femme &lt;NA&gt;        9738. Etudia… &lt;NA&gt;               2 Oui   Ni cr…</span></a>
<a class="sourceLine" id="cb978-7" title="7"><span class="co">#&gt;  3     3    59 Homme Derniere …  3994. Exerce… Techn…             2 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb978-8" title="8"><span class="co">#&gt;  4     4    34 Homme Enseignem…  5732. Exerce… Techn…             1 Non   Appar…</span></a>
<a class="sourceLine" id="cb978-9" title="9"><span class="co">#&gt;  5     5    71 Femme Derniere …  4329. Retrai… Emplo…             0 Oui   Prati…</span></a>
<a class="sourceLine" id="cb978-10" title="10"><span class="co">#&gt;  6     6    35 Femme Enseignem…  8675. Exerce… Emplo…             5 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb978-11" title="11"><span class="co">#&gt;  7     7    60 Femme Derniere …  6166. Au foy… Ouvri…             1 Oui   Appar…</span></a>
<a class="sourceLine" id="cb978-12" title="12"><span class="co">#&gt;  8     8    47 Homme Enseignem… 12892. Exerce… Ouvri…             5 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb978-13" title="13"><span class="co">#&gt;  9     9    20 Femme &lt;NA&gt;        7809. Etudia… &lt;NA&gt;               4 Oui   Appar…</span></a>
<a class="sourceLine" id="cb978-14" title="14"><span class="co">#&gt; 10    10    28 Homme Enseignem…  2277. Exerce… Autre              2 Non   Prati…</span></a>
<a class="sourceLine" id="cb978-15" title="15"><span class="co">#&gt; # … with 1,990 more rows, and 10 more variables: trav.imp &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb978-16" title="16"><span class="co">#&gt; #   trav.satisf &lt;chr&gt;, hard.rock &lt;chr&gt;, lecture.bd &lt;chr&gt;, peche.chasse &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb978-17" title="17"><span class="co">#&gt; #   cuisine &lt;chr&gt;, bricol &lt;chr&gt;, cinema &lt;chr&gt;, sport &lt;chr&gt;, heures.tv &lt;dbl&gt;</span></a></code></pre></div>
<p>On notera qu’on obtient le même résultat avec le code suivant qui utilise <code>across()</code> de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb979-1" title="1">hdv2003 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb979-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb979-3" title="3">        <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb979-4" title="4">            <span class="kw">where</span>(is.factor),</a>
<a class="sourceLine" id="cb979-5" title="5">            as.character</a>
<a class="sourceLine" id="cb979-6" title="6">        )</a>
<a class="sourceLine" id="cb979-7" title="7">    )</a>
<a class="sourceLine" id="cb979-8" title="8"><span class="co">#&gt; # A tibble: 2,000 × 20</span></a>
<a class="sourceLine" id="cb979-9" title="9"><span class="co">#&gt;       id   age sexe  nivetud     poids occup   qualif freres.soeurs clso  relig </span></a>
<a class="sourceLine" id="cb979-10" title="10"><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt; &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb979-11" title="11"><span class="co">#&gt;  1     1    28 Femme Enseignem…  2634. Exerce… Emplo…             8 Oui   Ni cr…</span></a>
<a class="sourceLine" id="cb979-12" title="12"><span class="co">#&gt;  2     2    23 Femme &lt;NA&gt;        9738. Etudia… &lt;NA&gt;               2 Oui   Ni cr…</span></a>
<a class="sourceLine" id="cb979-13" title="13"><span class="co">#&gt;  3     3    59 Homme Derniere …  3994. Exerce… Techn…             2 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb979-14" title="14"><span class="co">#&gt;  4     4    34 Homme Enseignem…  5732. Exerce… Techn…             1 Non   Appar…</span></a>
<a class="sourceLine" id="cb979-15" title="15"><span class="co">#&gt;  5     5    71 Femme Derniere …  4329. Retrai… Emplo…             0 Oui   Prati…</span></a>
<a class="sourceLine" id="cb979-16" title="16"><span class="co">#&gt;  6     6    35 Femme Enseignem…  8675. Exerce… Emplo…             5 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb979-17" title="17"><span class="co">#&gt;  7     7    60 Femme Derniere …  6166. Au foy… Ouvri…             1 Oui   Appar…</span></a>
<a class="sourceLine" id="cb979-18" title="18"><span class="co">#&gt;  8     8    47 Homme Enseignem… 12892. Exerce… Ouvri…             5 Non   Ni cr…</span></a>
<a class="sourceLine" id="cb979-19" title="19"><span class="co">#&gt;  9     9    20 Femme &lt;NA&gt;        7809. Etudia… &lt;NA&gt;               4 Oui   Appar…</span></a>
<a class="sourceLine" id="cb979-20" title="20"><span class="co">#&gt; 10    10    28 Homme Enseignem…  2277. Exerce… Autre              2 Non   Prati…</span></a>
<a class="sourceLine" id="cb979-21" title="21"><span class="co">#&gt; # … with 1,990 more rows, and 10 more variables: trav.imp &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb979-22" title="22"><span class="co">#&gt; #   trav.satisf &lt;chr&gt;, hard.rock &lt;chr&gt;, lecture.bd &lt;chr&gt;, peche.chasse &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb979-23" title="23"><span class="co">#&gt; #   cuisine &lt;chr&gt;, bricol &lt;chr&gt;, cinema &lt;chr&gt;, sport &lt;chr&gt;, heures.tv &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="imap" class="section level2">
<h2><span class="header-section-number">17.5</span> <code>imap</code></h2>
<p>Imaginons que nous avons récupéré les données suivantes, qui représentent les notes obtenues par quatre restaurants sur quatre critères différents, sous la forme d’une liste.</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb980-1" title="1">restos &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb980-2" title="2">    <span class="st">&quot;La bonne fourchette&quot;</span>     =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb980-3" title="3">    <span class="st">&quot;La choucroute de l&#39;amer&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb980-4" title="4">    <span class="st">&quot;L&#39;Hair de rien&quot;</span>          =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb980-5" title="5">    <span class="st">&quot;La blanquette de Vaulx&quot;</span>  =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb980-6" title="6">)</a></code></pre></div>
<p>À partir de cette liste, on souhaite créer un tableau de données comportant la moyenne et l’écart-type de chaque restaurant. Comme on l’a vu précédemment, cela peut se faire avec l’aide de <code>map_dfr()</code>.</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb981-1" title="1">restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">tibble</span>(<span class="dt">moyenne =</span> <span class="kw">mean</span>(.x), <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x)) )</a>
<a class="sourceLine" id="cb981-2" title="2"><span class="co">#&gt; # A tibble: 4 × 2</span></a>
<a class="sourceLine" id="cb981-3" title="3"><span class="co">#&gt;   moyenne ecart_type</span></a>
<a class="sourceLine" id="cb981-4" title="4"><span class="co">#&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb981-5" title="5"><span class="co">#&gt; 1     2.8       1.14</span></a>
<a class="sourceLine" id="cb981-6" title="6"><span class="co">#&gt; 2     3.1       1.29</span></a>
<a class="sourceLine" id="cb981-7" title="7"><span class="co">#&gt; 3     3.2       1.81</span></a>
<a class="sourceLine" id="cb981-8" title="8"><span class="co">#&gt; 4     2.7       1.42</span></a></code></pre></div>
<p>On obtient le tableau souhaité, mais il manque une information : le nom du restaurant correspondant à chaque ligne. Or, cette information est incluse dans les noms des éléments de la liste <code>restos</code>, or la fonction passée à <code>map_dfr</code> n’y a pas accès, elle n’a accès qu’à leurs valeurs.</p>
<p>C’est pour ce type de cas de figure que <code>purrr</code> propose la famille de fonctions <code>imap()</code>. Celle-ci fonctionne de la même manière que <code>map()</code>, sauf que la fonction appliquée prend deux arguments : d’abord la valeur de l’élément courant, puis son nom.</p>
<p>Dans l’exemple suivant, on applique <code>imap()</code> à une liste simple et on affiche un message avec le nom et la valeur de chaque élément.</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb982-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nom1 =</span> <span class="dv">1</span>, <span class="dt">nom2 =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb982-2" title="2"></a>
<a class="sourceLine" id="cb982-3" title="3">l2 &lt;-<span class="st"> </span>l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap</span>(<span class="cf">function</span>(valeur, nom) {</a>
<a class="sourceLine" id="cb982-4" title="4">   <span class="kw">message</span>(<span class="st">&quot;La valeur de &quot;</span>, nom, <span class="st">&quot; est &quot;</span>, valeur)</a>
<a class="sourceLine" id="cb982-5" title="5">})</a>
<a class="sourceLine" id="cb982-6" title="6"><span class="co">#&gt; La valeur de nom1 est 1</span></a>
<a class="sourceLine" id="cb982-7" title="7"><span class="co">#&gt; La valeur de nom2 est 3</span></a></code></pre></div>
<p>On peut évidemment utiliser la notation “formule” de <code>purrr</code>, il faut juste se souvenir que dans ce cas <code>.x</code> correspond à la valeur, et <code>.y</code> au nom.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb983-1" title="1">l2 &lt;-<span class="st"> </span>l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap</span>(<span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb983-2" title="2">   <span class="kw">message</span>(<span class="st">&quot;La valeur de &quot;</span>, .y, <span class="st">&quot; est &quot;</span>, .x)</a>
<a class="sourceLine" id="cb983-3" title="3">})</a>
<a class="sourceLine" id="cb983-4" title="4"><span class="co">#&gt; La valeur de nom1 est 1</span></a>
<a class="sourceLine" id="cb983-5" title="5"><span class="co">#&gt; La valeur de nom2 est 3</span></a></code></pre></div>
<p>Tout comme <code>map()</code> proposait les variantes <code>map_int()</code>, <code>map_chr()</code> ou <code>map_dfr()</code>, on peut également utiliser <code>imap_dbl()</code>, <code>imap_chr()</code> et autres <code>imap_dfc()</code> pour forcer le type de résultat retourné.</p>
<p>Pour reprendre notre exemple de départ, on peut donc, en utilisant <code>imap</code> récupérer le nom de l’élément de la liste courant et l’utiliser pour rajouter le nom du restaurant dans notre <em>tibble</em> de résultats.</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb984-1" title="1">restos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap_dfr</span>(<span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb984-2" title="2">    <span class="kw">tibble</span>(<span class="dt">nom =</span> .y, <span class="dt">moyenne =</span> <span class="kw">mean</span>(.x), <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x))</a>
<a class="sourceLine" id="cb984-3" title="3">})</a>
<a class="sourceLine" id="cb984-4" title="4"><span class="co">#&gt; # A tibble: 4 × 3</span></a>
<a class="sourceLine" id="cb984-5" title="5"><span class="co">#&gt;   nom                     moyenne ecart_type</span></a>
<a class="sourceLine" id="cb984-6" title="6"><span class="co">#&gt;   &lt;chr&gt;                     &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb984-7" title="7"><span class="co">#&gt; 1 La bonne fourchette         2.8       1.14</span></a>
<a class="sourceLine" id="cb984-8" title="8"><span class="co">#&gt; 2 La choucroute de l&#39;amer     3.1       1.29</span></a>
<a class="sourceLine" id="cb984-9" title="9"><span class="co">#&gt; 3 L&#39;Hair de rien              3.2       1.81</span></a>
<a class="sourceLine" id="cb984-10" title="10"><span class="co">#&gt; 4 La blanquette de Vaulx      2.7       1.42</span></a></code></pre></div>
<div class="rmdnote">
<p>
Si on utilise <code>imap()</code> sur une liste ou un vecteur qui n’a pas de nom, le deuxième argument passé à la fonction appliquée sera l’indice de l’élément courant : 1 pour le premier, 2 pour le deuxième, etc.
</p>
</div>
</div>
<div id="walk" class="section level2">
<h2><span class="header-section-number">17.6</span> <code>walk</code></h2>
<p><code>walk()</code> est une variante de <code>map()</code> qui a pour particularité de ne pas retourner de résultat. On l’utilise lorsqu’on souhaite parcourir un vecteur ou une liste et appliquer à ses éléments une fonction dont on ne souhaite conserver que les “effets de bord” : afficher un message, générer un graphique, enregistrer un fichier…</p>
<p>Par exemple, le code suivant génère quatre diagrammes en barre indiquant la répartition des notes des différents restaurants vus dans la section précédente.</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb985-1" title="1"><span class="kw">walk</span>(restos, <span class="op">~</span>{</a>
<a class="sourceLine" id="cb985-2" title="2">    <span class="kw">barplot</span>(<span class="kw">table</span>(.x))</a>
<a class="sourceLine" id="cb985-3" title="3">})</a></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1086-1.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1086-2.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1086-3.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1086-4.svg" width="672" /></p>
<p>Comme pour <code>map()</code>, la variante <code>iwalk()</code> permet d’itérer à la fois sur les valeurs et sur les noms des éléments du vecteur ou de la liste. Ceci permet par exemple d’afficher le nom du restaurant comme titre de chaque graphique.</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb986-1" title="1"><span class="kw">iwalk</span>(restos, <span class="op">~</span>{</a>
<a class="sourceLine" id="cb986-2" title="2">    <span class="kw">barplot</span>(<span class="kw">table</span>(.x), <span class="dt">main =</span> .y)</a>
<a class="sourceLine" id="cb986-3" title="3">})</a></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1087-1.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1087-2.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1087-3.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1087-4.svg" width="672" /></p>
<p>Au final, on notera que l’utilisation de <code>walk()</code>, comme elle ne retourne pas de résultats, est très proche de celle d’une boucle <code>for</code>.</p>
<div class="rmdnote">
<p>
Comme <code>walk()</code> ne retourne pas de résultats, il n’existe pas de variantes du type <code>map_chr()</code> ou <code>imap_int()</code>.
</p>
</div>
</div>
<div id="map2-et-pmap-itérer-sur-plusieurs-vecteurs-en-parallèle" class="section level2">
<h2><span class="header-section-number">17.7</span> <code>map2</code> et <code>pmap</code> : itérer sur plusieurs vecteurs en parallèle</h2>
<p>Supposons qu’un.e collègue, qui travaille avec nous sur le jeu de données <code>rp2012</code>, nous a envoyé une liste de variables dont elle souhaite qu’on calcule la corrélation. Cette liste a été saisie dans un tableur sur deux colonnes, chaque ligne indiquant les deux variables dont on souhaite la corrélation.</p>
<p>Au final après importation dans R on obtient le tableau de données suivant.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb987-1" title="1">correlations &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb987-2" title="2">    <span class="dt">var1 =</span> <span class="kw">c</span>(<span class="st">&quot;dipl_sup&quot;</span>,   <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;hlm&quot;</span>,    <span class="st">&quot;hlm&quot;</span>,  <span class="st">&quot;proprio&quot;</span>),</a>
<a class="sourceLine" id="cb987-3" title="3">    <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="st">&quot;dipl_aucun&quot;</span>, <span class="st">&quot;cadres&quot;</span>,   <span class="st">&quot;cadres&quot;</span>, <span class="st">&quot;ouvr&quot;</span>, <span class="st">&quot;hlm&quot;</span>),</a>
<a class="sourceLine" id="cb987-4" title="4">)</a></code></pre></div>
<p>Pour pouvoir calculer les corrélations souhaitées, on doit itérer sur les deux vecteurs <code>var1</code> et <code>var2</code> <em>en parallèle</em>, et calculer la corrélation entre le vecteur correspondant à la valeur courante de <code>var1</code> et celui correspondant à la valeur courante de <code>var2</code>.</p>
<p>C’est précisément ce que fait la fonction <code>map2()</code>. Celle-ci prend trois arguments en entrée : deux listes ou vecteurs qui seront itérées en parallèle, et une fonction qui accepte elle-même deux arguments, qui seront remplacés par les valeurs courantes.</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb988-1" title="1"><span class="kw">map2_dbl</span>(correlations<span class="op">$</span>var1, correlations<span class="op">$</span>var2, <span class="op">~</span><span class="st"> </span><span class="kw">cor</span>(rp2012[[.x]], rp2012[[.y]]))</a>
<a class="sourceLine" id="cb988-2" title="2"><span class="co">#&gt; [1] -0.5337366  0.9371629 -0.1452185  0.2526703 -0.7878005</span></a></code></pre></div>
<p><code>map2()</code> propose les mêmes variantes <code>map2_int()</code>, <code>mapr2_chr()</code>, etc. que <code>map()</code>. Ici on a utilisé <code>map2_dbl()</code> pour récupérer un vecteur numérique plutôt qu’une liste. Si on souhaite uniquement capturer les effets de bord sans récupérer les résultats de la fonctions appliquée, on peut aussi utiliser la variante <code>walk2()</code>.</p>
<p>Supposons maintenant que notre collègue nous a envoyé, toujours sous la même forme, une liste de variables dont elle souhaite obtenir un nuage de points, mais aussi un titre à ajouter au graphique. On obtient le tableau suivant.</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb989-1" title="1">nuages &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb989-2" title="2">    <span class="dt">var1 =</span> <span class="kw">c</span>(<span class="st">&quot;dipl_sup&quot;</span>,   <span class="st">&quot;dipl_sup&quot;</span>, <span class="st">&quot;hlm&quot;</span>),</a>
<a class="sourceLine" id="cb989-3" title="3">    <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="st">&quot;dipl_aucun&quot;</span>, <span class="st">&quot;cadres&quot;</span>,   <span class="st">&quot;cadres&quot;</span>),</a>
<a class="sourceLine" id="cb989-4" title="4">    <span class="dt">titre =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb989-5" title="5">        <span class="st">&quot;Relation entre la proportion de diplômés du supérieur et celle de sans diplôme&quot;</span>,</a>
<a class="sourceLine" id="cb989-6" title="6">        <span class="st">&quot;Y&#39;a-t-il un lien entre le pourcentage de cadres et celui de diplômés du supérieur&quot;</span>,</a>
<a class="sourceLine" id="cb989-7" title="7">        <span class="st">&quot;C&#39;est pas toujours facile de trouver des titres pas trop rébarbatifs&quot;</span></a>
<a class="sourceLine" id="cb989-8" title="8">    )</a>
<a class="sourceLine" id="cb989-9" title="9">)</a></code></pre></div>
<p>On est dans une situation similaire à la précédente, sauf que cette fois on doit itérer sur trois listes en parallèle. On va donc utiliser la fonction <code>pmap()</code> qui permet d’itérer sur autant de listes ou vecteurs que l’on souhaite. Plus précisément, comme on souhaite générer des graphiques on va utiliser la variante <code>pwalk()</code> qui ne retourne pas de résultat.</p>
<p><code>pmap()</code> et <code>pwalk()</code> prennent deux principaux arguments :</p>
<ul>
<li>les vecteurs et listes sur lesquels itérer, eux-mêmes regroupés dans une liste</li>
<li>une fonction acceptant autant d’arguments que de vecteur ou listes sur lesquels on itère</li>
</ul>
<p>Dans notre exemple on aurait donc un appel de la forme suivante.</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb990-1" title="1"><span class="kw">pwalk</span>(</a>
<a class="sourceLine" id="cb990-2" title="2">    <span class="kw">list</span>(nuages<span class="op">$</span>var1, nuages<span class="op">$</span>var2, nuages<span class="op">$</span>titre),</a>
<a class="sourceLine" id="cb990-3" title="3">    <span class="cf">function</span>(var1, var2, titre) {</a>
<a class="sourceLine" id="cb990-4" title="4">        <span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb990-5" title="5">            rp2012[[var1]], rp2012[[var2]],</a>
<a class="sourceLine" id="cb990-6" title="6">            <span class="dt">xlab =</span> var1, <span class="dt">ylab =</span> var2, <span class="dt">main =</span> titre</a>
<a class="sourceLine" id="cb990-7" title="7">        )</a>
<a class="sourceLine" id="cb990-8" title="8">    }</a>
<a class="sourceLine" id="cb990-9" title="9">)</a></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1093-1.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1093-2.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1093-3.svg" width="672" /></p>
<p>Petite précision, si la liste est nommée, il faut que les noms des arguments de la fonction correspondent aux noms.</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb991-1" title="1"><span class="kw">pwalk</span>(</a>
<a class="sourceLine" id="cb991-2" title="2">    <span class="kw">list</span>(<span class="dt">v1 =</span> nuages<span class="op">$</span>var1, <span class="dt">v2 =</span> nuages<span class="op">$</span>var2, <span class="dt">titre =</span> nuages<span class="op">$</span>titre),</a>
<a class="sourceLine" id="cb991-3" title="3">    <span class="cf">function</span>(v1, v2, titre) {</a>
<a class="sourceLine" id="cb991-4" title="4">        <span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb991-5" title="5">            rp2012[[v1]], rp2012[[v2]],</a>
<a class="sourceLine" id="cb991-6" title="6">            <span class="dt">xlab =</span> v1, <span class="dt">ylab =</span> v2, <span class="dt">main =</span> titre</a>
<a class="sourceLine" id="cb991-7" title="7">        )</a>
<a class="sourceLine" id="cb991-8" title="8">    }</a>
<a class="sourceLine" id="cb991-9" title="9">)</a></code></pre></div>
<p><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1094-1.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1094-2.svg" width="672" /><img src="introduction_au_tidyverse_files/figure-html/unnamed-chunk-1094-3.svg" width="672" /></p>
<p>À noter que comme <code>nuages</code> est un tableau de données, donc une liste dont les éléments sont ses colonnes, on aurait obtenu le même résultat avec :</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb992-1" title="1"><span class="kw">pwalk</span>(</a>
<a class="sourceLine" id="cb992-2" title="2">    nuages,</a>
<a class="sourceLine" id="cb992-3" title="3">    <span class="cf">function</span>(var1, var2, titre) {</a>
<a class="sourceLine" id="cb992-4" title="4">        <span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb992-5" title="5">            rp2012[[var1]], rp2012[[var2]],</a>
<a class="sourceLine" id="cb992-6" title="6">            <span class="dt">xlab =</span> var1, <span class="dt">ylab =</span> var2, <span class="dt">main =</span> titre</a>
<a class="sourceLine" id="cb992-7" title="7">        )</a>
<a class="sourceLine" id="cb992-8" title="8">    }</a>
<a class="sourceLine" id="cb992-9" title="9">)</a></code></pre></div>
<p>Enfin, on peut utiliser la syntaxe “formule” pour la fonction anonyme, dans ce cas les arguments sont accessibles avec la notation <code>..1</code>, <code>..2</code>, etc.</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb993-1" title="1"><span class="kw">pwalk</span>(</a>
<a class="sourceLine" id="cb993-2" title="2">    nuages,</a>
<a class="sourceLine" id="cb993-3" title="3">    <span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb993-4" title="4">        <span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb993-5" title="5">            rp2012[[..<span class="dv">1</span>]], rp2012[[..<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb993-6" title="6">            <span class="dt">xlab =</span> ..<span class="dv">1</span>, <span class="dt">ylab =</span> ..<span class="dv">2</span>, <span class="dt">main =</span> ..<span class="dv">3</span></a>
<a class="sourceLine" id="cb993-7" title="7">        )</a>
<a class="sourceLine" id="cb993-8" title="8">    }</a>
<a class="sourceLine" id="cb993-9" title="9">)</a></code></pre></div>
<p>On notera que dans ce cas la syntaxe “formule” est sans doute moins lisible que la syntaxe classique avec <code>function()</code> qui permet de nommer les paramètres.</p>
<p>Comme pour <code>map()</code> et <code>map2()</code>, <code>pmap()</code> propose aussi les variantes <code>pmap_int()</code>, <code>pmap_chr()</code>, etc.</p>
</div>
<div id="répéter-une-opération" class="section level2">
<h2><span class="header-section-number">17.8</span> Répéter une opération</h2>
<p>Les fonctions de <code>purrr</code> peuvent être utilisées quand on souhaite juste répéter une opération un certain nombre de fois, à la place d’une boucle <code>for</code>.</p>
<p>Par exemple si on souhaite générer 10 vecteurs de 100 nombre aléatoires, on pourra remplacer :</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb994-1" title="1">res &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb994-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb994-3" title="3">    res[[i]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb994-4" title="4">}</a></code></pre></div>
<p>Par :</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb995-1" title="1">res &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>))</a></code></pre></div>
<p>Ce qui donne un code un peu plus compact et plus lisible.</p>
<div class="rmdnote">
<p>
De la même manière, si on s’intéresse juste aux effets de bord, on pourra remplacer une boucle <code>for</code> par un appel à <code>walk()</code>, mais dans ce cas de figure le code résultant n’est pas forcément plus lisible.
</p>
</div>
</div>
<div id="quand-ne-pas-utiliser-map" class="section level2">
<h2><span class="header-section-number">17.9</span> Quand ne pas utiliser <code>map</code></h2>
<p>Une fois qu’on a compris la logique de <code>map()</code> et de ses variantes, on peut être tenté.es de l’appliquer un peu systématiquement. Il faut cependant garder en tête que son usage n’est pas conseillé notamment dans les cas où il existe déjà une fonction vectorisée qui permet d’obtenir le même résultat.</p>
<p>Ainsi ça n’aurait pas de sens de faire <code>map(v, length)</code> quand on peut simplement faire <code>length(v)</code>.</p>
<p>Pour prendre un exemple un peu moins caricatural, de nombreuses fonctions de <code>stringr</code> par exemple s’appliquent à des vecteurs, il n’est donc pas utile de faire <code>map(txt, str_count("f"))</code> quand on peut faire simplement <code>str_count(txt, "f")</code>.</p>
<p>Par contre <code>map()</code> est utile quand on souhaite appliquer une fonction qui n’est pas vectorisée, comme c’est le cas par exemple avec <code>read_csv()</code> :</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb996-1" title="1">fichiers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fichier1.csv&quot;</span>, <span class="st">&quot;fichier2.csv&quot;</span>)</a>
<a class="sourceLine" id="cb996-2" title="2">l &lt;-<span class="st"> </span>fichiers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(read_csv)</a></code></pre></div>
<p>Ou quand on veut itérer sur un argument, par exemple ici sur l’argument <code>pattern</code> de <code>str_count()</code> :</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb997-1" title="1">voyelle &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">e =</span> <span class="st">&quot;e&quot;</span>, <span class="dt">i =</span> <span class="st">&quot;i&quot;</span>)</a>
<a class="sourceLine" id="cb997-2" title="2">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brouette&quot;</span>, <span class="st">&quot;moto&quot;</span>, <span class="st">&quot;igloo&quot;</span>)</a>
<a class="sourceLine" id="cb997-3" title="3">voyelle <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_count</span>(v, <span class="dt">pattern =</span> .x) )</a>
<a class="sourceLine" id="cb997-4" title="4"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb997-5" title="5"><span class="co">#&gt; [1] 0 0 0</span></a>
<a class="sourceLine" id="cb997-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb997-7" title="7"><span class="co">#&gt; $e</span></a>
<a class="sourceLine" id="cb997-8" title="8"><span class="co">#&gt; [1] 2 0 0</span></a>
<a class="sourceLine" id="cb997-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb997-10" title="10"><span class="co">#&gt; $i</span></a>
<a class="sourceLine" id="cb997-11" title="11"><span class="co">#&gt; [1] 0 0 1</span></a></code></pre></div>
<p>On l’utilise également quand on veut appliquer une fonction non pas à une liste, mais aux éléments qu’elle contient :</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb998-1" title="1">l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb998-2" title="2">l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</a>
<a class="sourceLine" id="cb998-3" title="3"><span class="co">#&gt; [1] 3 2</span></a></code></pre></div>
<p>En termes de performance, <code>map()</code> n’est pas forcément plus rapide qu’une boucle <code>for</code>, puisque dans les deux cas on itère sur un ensemble de valeurs. Par contre une fonction vectorisée existante sera toujours (beaucoup) plus rapide.</p>
</div>
<div id="purrr-vs-apply" class="section level2">
<h2><span class="header-section-number">17.10</span> <code>purrr</code> vs *apply</h2>
<p>Les fonctions de <code>purrr</code> ont des équivalents dans R “de base”, ce sont notamment les fonctions de la famille <code>apply</code> : <code>lapply,</code>sapply<code>,</code>mapply`…</p>
<p>L’avantage de <code>map()</code> et des autres fonctions fournies par <code>purrr</code> et qu’elles sont plus explicites, on a des fonctions bien précises selon qu’on veut seulement appliquer une fonction (<code>map()</code>), générer des effets de bord (<code>walk</code>), modifier une liste sans changer son type (<code>modify()</code>), etc. <code>purrr</code> propose également de nombreuses fonctions utiles qui facilite le travail avec les vecteurs et listes.</p>
<p>Mais un des avantages principaux des fonctions de la famille <code>map()</code> est qu’elles sont consistantes et cohérentes dans le type de résultat qu’elles retournent : on est certain que <code>map()</code> ou <code>imap()</code> retourneront une liste, que <code>map_chr()</code> ou <code>map2_chr()</code> retourneront un vecteur de chaînes de caractères, etc.</p>
<p>Là encore, il n’est pas question de dire qu’il ne faut pas utiliser les fonctions <code>*apply</code>. Si vous en avez l’habitude et qu’elles fonctionnent pour vous, il n’y a pas forcément de raison de changer. Mais si vous n’avez pas l’habitude de ce type d’opérations ou si vous préférez une syntaxe plus cohérente et plus facile à retenir, les fonctions de <code>purrr</code> peuvent être intéressantes.</p>
<p>Si vous souhaitez en savoir plus, l’ouvrage en ligne <em>R for data science</em> contient <a href="https://r4ds.had.co.nz/iteration.html#base-r">une comparaison plus détaillée</a> des deux familles de fonction.</p>
</div>
<div id="ressources-9" class="section level2">
<h2><span class="header-section-number">17.11</span> Ressources</h2>
<p>Au-delà de celles présentées ici, <code>purrr</code> propose de nombreuses autres fonctions facilitant la manipulation et les itérations sur les listes et les vecteurs. On peut en trouver la <a href="https://purrr.tidyverse.org/reference/index.html">liste complète</a> et la documentation associée (en anglais) sur <a href="https://purrr.tidyverse.org">le site de l’extension</a>.</p>
<p>La section <em>Iteration</em> de l’ouvrage en ligne <em>R for data science</em> (en anglais) propose <a href="https://r4ds.had.co.nz/iteration.html#the-map-functions">une présentation de plusieurs fonctions de <code>purrr</code></a>.</p>
<p>RStudio propose une <a href="antisèche">https://github.com/rstudio/cheatsheets/blob/master/purrr.pdf</a> (en anglais, format PDF) qui résume les différentes fonctions de l’extension.</p>
<p>Sur le blog en français de Lise Vaudor, on trouvera un billet <a href="https://perso.ens-lyon.fr/lise.vaudor/iterer-des-fonctions-avec-purrr/">Itérer des fonctions avec purrr</a> et une suite <a href="https://perso.ens-lyon.fr/lise.vaudor/practice-makes-purrr-fect/">Practice makes purrr-fect</a>.</p>
</div>
<div id="exercices-10" class="section level2">
<h2><span class="header-section-number">17.12</span> Exercices</h2>
<div id="map-et-ses-variantes-1" class="section level3">
<h3><span class="header-section-number">17.12.1</span> <code>map</code> et ses variantes</h3>
<p><strong>Exercice 1.1</strong></p>
<p>La liste suivante rassemble les notes obtenues par un ou une élève dans différentes matières.</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb999-1" title="1">notes &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb999-2" title="2">    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb999-3" title="3">    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb999-4" title="4">    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</a>
<a class="sourceLine" id="cb999-5" title="5">    <span class="dt">musique =</span> <span class="dv">14</span></a>
<a class="sourceLine" id="cb999-6" title="6">)</a></code></pre></div>
<p>En utilisant <code>map()</code>, calculer une liste indiquant la moyenne dans chaque matière.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1000-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(mean)</a></code></pre></div>
</div>

<p>En utilisant une variante de <code>map()</code>, simplifier le résultat pour obtenir un vecteur numérique.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1001-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean)</a></code></pre></div>
</div>

<p>On a rajouté à la liste les notes obtenues en technologie, parmi lesquelles une note est manquante.</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1002-1" title="1">notes &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1002-2" title="2">    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1002-3" title="3">    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb1002-4" title="4">    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</a>
<a class="sourceLine" id="cb1002-5" title="5">    <span class="dt">musique =</span> <span class="dv">14</span>,</a>
<a class="sourceLine" id="cb1002-6" title="6">    <span class="dt">techno =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1002-7" title="7">)</a></code></pre></div>
<p>Calculer à nouveau un vecteur numérique des moyennes par matière, mais sans tenir compte de la valeur manquante.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1003-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) )</a>
<a class="sourceLine" id="cb1003-2" title="2"><span class="co"># Ou bien</span></a>
<a class="sourceLine" id="cb1003-3" title="3">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>

<p>Calculer une liste qui contient pour chaque matière le nombre de notes, leur moyenne et leur écart-type.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1004-1" title="1"><span class="co"># On peut aussi utiliser list() plutôt que c()</span></a>
<a class="sourceLine" id="cb1004-2" title="2">notes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1004-3" title="3"><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1004-4" title="4">            <span class="dt">nb_notes =</span> <span class="kw">length</span>(.x),</a>
<a class="sourceLine" id="cb1004-5" title="5">            <span class="dt">moyenne =</span> <span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1004-6" title="6">            <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1004-7" title="7">        )</a>
<a class="sourceLine" id="cb1004-8" title="8">    )</a>
<a class="sourceLine" id="cb1004-9" title="9"><span class="co">#&gt; $maths</span></a>
<a class="sourceLine" id="cb1004-10" title="10"><span class="co">#&gt;   nb_notes    moyenne ecart_type </span></a>
<a class="sourceLine" id="cb1004-11" title="11"><span class="co">#&gt;   4.000000  11.250000   2.986079 </span></a>
<a class="sourceLine" id="cb1004-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1004-13" title="13"><span class="co">#&gt; $anglais</span></a>
<a class="sourceLine" id="cb1004-14" title="14"><span class="co">#&gt;   nb_notes    moyenne ecart_type </span></a>
<a class="sourceLine" id="cb1004-15" title="15"><span class="co">#&gt;   3.000000  12.666667   4.725816 </span></a>
<a class="sourceLine" id="cb1004-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1004-17" title="17"><span class="co">#&gt; $sport</span></a>
<a class="sourceLine" id="cb1004-18" title="18"><span class="co">#&gt;   nb_notes    moyenne ecart_type </span></a>
<a class="sourceLine" id="cb1004-19" title="19"><span class="co">#&gt;   2.000000   9.000000   5.656854 </span></a>
<a class="sourceLine" id="cb1004-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1004-21" title="21"><span class="co">#&gt; $musique</span></a>
<a class="sourceLine" id="cb1004-22" title="22"><span class="co">#&gt;   nb_notes    moyenne ecart_type </span></a>
<a class="sourceLine" id="cb1004-23" title="23"><span class="co">#&gt;          1         14         NA </span></a>
<a class="sourceLine" id="cb1004-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1004-25" title="25"><span class="co">#&gt; $techno</span></a>
<a class="sourceLine" id="cb1004-26" title="26"><span class="co">#&gt;   nb_notes    moyenne ecart_type </span></a>
<a class="sourceLine" id="cb1004-27" title="27"><span class="co">#&gt;          2         12         NA</span></a></code></pre></div>
</div>

<p>Calculer et retourner les mêmes résultats, mais cette fois sous la forme d’un tableau de données.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" title="1">notes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1005-2" title="2"><span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1005-3" title="3">            <span class="dt">nb_notes =</span> <span class="kw">length</span>(.x),</a>
<a class="sourceLine" id="cb1005-4" title="4">            <span class="dt">moyenne =</span> <span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1005-5" title="5">            <span class="dt">ecart_type =</span> <span class="kw">sd</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1005-6" title="6">        )</a>
<a class="sourceLine" id="cb1005-7" title="7">    )</a></code></pre></div>
</div>

<p><strong>Exercice 1.2</strong></p>
<p>La liste suivante comporte les parcours biographiques de 5 personnes sous la forme de vecteurs indiquant leurs communes de résidence successive.</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1006-1" title="1">parcours &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1006-2" title="2">    <span class="kw">c</span>(<span class="st">&quot;Lyon&quot;</span>, <span class="st">&quot;Flixevile&quot;</span>, <span class="st">&quot;Saint-Dié-en-Pouilly&quot;</span>),</a>
<a class="sourceLine" id="cb1006-3" title="3">    <span class="kw">c</span>(<span class="st">&quot;Sainte-Gabelle-sur-Sarthe&quot;</span>),</a>
<a class="sourceLine" id="cb1006-4" title="4">    <span class="kw">c</span>(<span class="st">&quot;Décines&quot;</span>, <span class="st">&quot;Meyzieu&quot;</span>, <span class="st">&quot;Demptezieu&quot;</span>),</a>
<a class="sourceLine" id="cb1006-5" title="5">    <span class="kw">c</span>(<span class="st">&quot;Meyzieu&quot;</span>, <span class="st">&quot;Lyon&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Flixevile&quot;</span>, <span class="st">&quot;Lyon&quot;</span>),</a>
<a class="sourceLine" id="cb1006-6" title="6">    <span class="kw">c</span>(<span class="st">&quot;La Bâtie-Divisin&quot;</span>, <span class="st">&quot;Versailles&quot;</span>)</a>
<a class="sourceLine" id="cb1006-7" title="7">)</a></code></pre></div>
<p>À l’aide de <code>map()</code>, calculer une nouvelle liste comportant le nombre de villes de résidence pour chaque parcours.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" title="1">parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(length)</a></code></pre></div>
</div>

<p>Utiliser une variante de <code>map()</code> pour simplifier le résultat et obtenir un vecteur numérique plutôt qu’une liste.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1008-1" title="1">parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(length)</a></code></pre></div>
</div>

<p>Déterminer pour chaque parcours le nombre de fois où la personne a résidé à Lyon.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" title="1">parcours <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x <span class="op">==</span><span class="st"> &quot;Lyon&quot;</span>))</a></code></pre></div>
</div>

<p>L’équipe chargée de l’enquête vient de repérer une erreur de saisie : “Flixevile” s’écrit en réalité “Flixeville”. Utiliser <code>map()</code> pour corriger la liste <code>parcours</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1010-1" title="1">parcours &lt;-<span class="st"> </span>parcours <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1010-2" title="2"><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> &quot;Flixevile&quot;</span>, <span class="st">&quot;Flixeville&quot;</span>, .x))</a></code></pre></div>
</div>

<p><strong>Exercice 1.3</strong></p>
<p>Le vecteur suivant contient les adresses de deux fichiers CSV contenant les données de <code>rp2012</code> pour les départements de l’Ain et du Rhône :</p>
<p>TODO: aller-plus-loin -&gt; master</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" title="1">urls &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1011-2" title="2">    <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_01.csv&quot;</span>,</a>
<a class="sourceLine" id="cb1011-3" title="3">    <span class="st">&quot;https://raw.githubusercontent.com/juba/tidyverse/aller-plus-loin/data/rp2012/rp2012_69.csv&quot;</span></a>
<a class="sourceLine" id="cb1011-4" title="4">)</a></code></pre></div>
<p>Utiliser <code>map()</code> pour charger ces deux tableaux de données dans une liste <code>l</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1012-1" title="1">l &lt;-<span class="st"> </span><span class="kw">map</span>(urls, read_csv)</a>
<a class="sourceLine" id="cb1012-2" title="2"><span class="co">#&gt; Rows: 72 Columns: 36</span></a>
<a class="sourceLine" id="cb1012-3" title="3"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb1012-4" title="4"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb1012-5" title="5"><span class="co">#&gt; chr  (4): code_insee, commune, region, departement</span></a>
<a class="sourceLine" id="cb1012-6" title="6"><span class="co">#&gt; dbl (32): code_region, log_rp, log_proprio, log_loc, log_hlm, log_sec, log_m...</span></a>
<a class="sourceLine" id="cb1012-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1012-8" title="8"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb1012-9" title="9"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a>
<a class="sourceLine" id="cb1012-10" title="10"><span class="co">#&gt; Rows: 119 Columns: 36</span></a>
<a class="sourceLine" id="cb1012-11" title="11"><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb1012-12" title="12"><span class="co">#&gt; Delimiter: &quot;,&quot;</span></a>
<a class="sourceLine" id="cb1012-13" title="13"><span class="co">#&gt; chr  (3): commune, region, departement</span></a>
<a class="sourceLine" id="cb1012-14" title="14"><span class="co">#&gt; dbl (33): code_insee, code_region, log_rp, log_proprio, log_loc, log_hlm, lo...</span></a>
<a class="sourceLine" id="cb1012-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1012-16" title="16"><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></a>
<a class="sourceLine" id="cb1012-17" title="17"><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></a></code></pre></div>
</div>

<p>Utiliser <code>map_dfr()</code> pour charger ces deux tableaux de données et les regrouper en une seule table <code>d</code>. Que constatez-vous ?</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" title="1">d &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(urls, read_csv)</a></code></pre></div>
</div>

<p>Comparer la variable <code>code_insee</code> contenue dans les deux tableaux de <code>l</code>. D’où vient le problème ?</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1014-1" title="1"><span class="co"># Une variable a été importée en character, l&#39;autre en numérique</span></a>
<a class="sourceLine" id="cb1014-2" title="2">l <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>( <span class="op">~</span>.x<span class="op">$</span>code_insee)</a></code></pre></div>
</div>

<p>Trouver une solution pour corriger le problème.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1015-1" title="1"><span class="co"># En convertissant manuellement code_insee en character</span></a>
<a class="sourceLine" id="cb1015-2" title="2">d &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(urls, <span class="op">~</span>{</a>
<a class="sourceLine" id="cb1015-3" title="3">    tab &lt;-<span class="st"> </span><span class="kw">read_csv</span>(.x)</a>
<a class="sourceLine" id="cb1015-4" title="4">    tab<span class="op">$</span>code_insee &lt;-<span class="st"> </span><span class="kw">as.character</span>(tab<span class="op">$</span>code_insee)</a>
<a class="sourceLine" id="cb1015-5" title="5">    tab</a>
<a class="sourceLine" id="cb1015-6" title="6">})</a>
<a class="sourceLine" id="cb1015-7" title="7"><span class="co"># Ou bien en utilisant l&#39;option col_types de read_csv</span></a>
<a class="sourceLine" id="cb1015-8" title="8">d &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(urls, read_csv, <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">&quot;code_insee&quot;</span> =<span class="st"> &quot;c&quot;</span>))</a></code></pre></div>
</div>

</div>
<div id="modify-et-itération-sur-les-colonnes-dun-tableau" class="section level3">
<h3><span class="header-section-number">17.12.2</span> <code>modify</code> et itération sur les colonnes d’un tableau</h3>
<p><strong>Exercice 2.1</strong></p>
<p>Soit le tableau de données <code>d</code> suivant :</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1016-1" title="1">d &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1016-2" title="2">    <span class="dt">prenom =</span> <span class="kw">c</span>(<span class="st">&quot;pierre-edmond&quot;</span>, <span class="st">&quot;YVONNE&quot;</span>, <span class="st">&quot;charlotte-adélaïde&quot;</span>),</a>
<a class="sourceLine" id="cb1016-3" title="3">    <span class="dt">nom =</span> <span class="kw">c</span>(<span class="st">&quot;rateau&quot;</span>, <span class="st">&quot;de la grappinière&quot;</span>, <span class="st">&quot;QUIGNON&quot;</span>),</a>
<a class="sourceLine" id="cb1016-4" title="4">    <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">73</span>, <span class="dv">27</span>),</a>
<a class="sourceLine" id="cb1016-5" title="5">    <span class="dt">taille =</span> <span class="kw">c</span>(<span class="dv">151</span>, <span class="dv">182</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1016-6" title="6">)</a></code></pre></div>
<p>Utliser la fonction <code>typeof()</code> pour afficher le type de toutes les colonnes de <code>d</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1017-1" title="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(typeof)</a></code></pre></div>
</div>

<p>En utilisant <code>keep()</code> et <code>map()</code>, calculer la moyenne de toutes les variables numériques de <code>d</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1018-1" title="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1018-2" title="2"><span class="st">    </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1018-3" title="3"><span class="st">    </span><span class="kw">map</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>

<p>En utilisant <code>modify_if()</code>, appliquer <code>str_to_title()</code> à toutes les colonnes de type <code>character</code> pour corriger la capitalisation des noms et prénoms.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1019-1" title="1">d &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify_if</span>(is.character, str_to_title)</a></code></pre></div>
</div>

<p>À l’aide de la fonction <code>discard()</code>, supprimer de <code>d</code> les colonnes qui comportent des <code>NA</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1020-1" title="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.x)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1020-2" title="2"><span class="co"># Autre possibilité</span></a>
<a class="sourceLine" id="cb1020-3" title="3">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(.x)))</a></code></pre></div>
</div>

</div>
<div id="imap-et-walk" class="section level3">
<h3><span class="header-section-number">17.12.3</span> <code>imap</code> et <code>walk</code></h3>
<p><strong>Exercice 3.1</strong></p>
<p>On reprend la liste de notes vue dans un exercice précédent.</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1021-1" title="1">notes &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1021-2" title="2">    <span class="dt">maths =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1021-3" title="3">    <span class="dt">anglais =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">11</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb1021-4" title="4">    <span class="dt">sport =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">13</span>),</a>
<a class="sourceLine" id="cb1021-5" title="5">    <span class="dt">musique =</span> <span class="dv">14</span>,</a>
<a class="sourceLine" id="cb1021-6" title="6">    <span class="dt">techno =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1021-7" title="7">)</a></code></pre></div>
<p>Sans utiliser de boucle <code>for</code>, afficher avec la fonction <code>message()</code> les valeurs de chaque moyenne tour à tour de manière à obtenir le résultat suivant :</p>
<pre><code>#&gt; 11.25
#&gt; 12.6666666666667
#&gt; 9
#&gt; 14
#&gt; 12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1023-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(<span class="op">~</span><span class="st"> </span><span class="kw">message</span>(<span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a></code></pre></div>
</div>

<p>De la même manière afficher pour chaque matière les messages suivants :</p>
<pre><code>#&gt; Votre moyenne en maths est 11.25
#&gt; Votre moyenne en anglais est 12.6666666666667
#&gt; Votre moyenne en sport est 9
#&gt; Votre moyenne en musique est 14
#&gt; Votre moyenne en techno est 12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1025-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">iwalk</span>(<span class="cf">function</span>(notes, matiere) {</a>
<a class="sourceLine" id="cb1025-2" title="2">    <span class="kw">message</span>(<span class="st">&quot;Votre moyenne en &quot;</span>, matiere, <span class="st">&quot; est &quot;</span>, <span class="kw">mean</span>(notes, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1025-3" title="3">})</a></code></pre></div>
</div>

<p>Construire un tableau de données avec une matière par ligne et deux colonnes contenant le nom de la matière et la valeur de la moyenne.</p>
<pre><code>#&gt; # A tibble: 5 × 2
#&gt;   matiere moyenne
#&gt;   &lt;chr&gt;     &lt;dbl&gt;
#&gt; 1 maths      11.2
#&gt; 2 anglais    12.7
#&gt; 3 sport       9  
#&gt; 4 musique    14  
#&gt; 5 techno     12</code></pre>

<div class="solution-exo">
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1027-1" title="1">notes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">imap_dfr</span>(<span class="cf">function</span>(notes, matiere) {</a>
<a class="sourceLine" id="cb1027-2" title="2">    <span class="kw">tibble</span>(<span class="dt">matiere =</span> matiere, <span class="dt">moyenne =</span> <span class="kw">mean</span>(notes, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1027-3" title="3">})</a></code></pre></div>
</div>

</div>
<div id="map2-et-pmap" class="section level3">
<h3><span class="header-section-number">17.12.4</span> <code>map2</code> et <code>pmap</code></h3>
<p><strong>Exercice 4.1</strong></p>
<p>Soit le tableau de données suivant, qui indique des couples de variables du jeu de données <code>hdv2003</code>.</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1028-1" title="1">croisements &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1028-2" title="2">    <span class="dt">v1 =</span> <span class="kw">c</span>(<span class="st">&quot;qualif&quot;</span>, <span class="st">&quot;qualif&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;sexe&quot;</span>),</a>
<a class="sourceLine" id="cb1028-3" title="3">    <span class="dt">v2 =</span> <span class="kw">c</span>(<span class="st">&quot;clso&quot;</span>,   <span class="st">&quot;cinema&quot;</span>, <span class="st">&quot;clso&quot;</span>, <span class="st">&quot;cinema&quot;</span>)</a>
<a class="sourceLine" id="cb1028-4" title="4">)</a></code></pre></div>
<p>Calculer une liste qui contient tous les tableaux croisés entre les quatre couples de variables de <code>croisements</code>.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1029-1" title="1"><span class="kw">map2</span>(croisements<span class="op">$</span>v1, croisements<span class="op">$</span>v2,</a>
<a class="sourceLine" id="cb1029-2" title="2">    <span class="op">~</span><span class="kw">table</span>(hdv2003[[.x]], hdv2003[[.y]]) </a>
<a class="sourceLine" id="cb1029-3" title="3">)</a></code></pre></div>
</div>

<p>Modifier le code précédent pour obtenir, pour chaque croisement, une liste avec les noms des deux variables et le résultat du test du Khi2 sur le tableau croisé.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1030-1" title="1">khi2 &lt;-<span class="st"> </span><span class="kw">map2</span>(croisements<span class="op">$</span>v1, croisements<span class="op">$</span>v2,</a>
<a class="sourceLine" id="cb1030-2" title="2">    <span class="op">~</span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1030-3" title="3">        <span class="dt">variables =</span> <span class="kw">paste</span>(.x, .y),</a>
<a class="sourceLine" id="cb1030-4" title="4">        <span class="dt">chisq =</span> <span class="kw">chisq.test</span>(hdv2003[[.x]], hdv2003[[.y]])</a>
<a class="sourceLine" id="cb1030-5" title="5">    )</a>
<a class="sourceLine" id="cb1030-6" title="6">)</a></code></pre></div>
</div>

<p>Filtrer la liste obtenue à l’étape précédente pour ne conserver que les éléments dont la p-value du test du Khi2 est inférieure à 0.001.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1031-1" title="1">khi2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span>.x<span class="op">$</span>chisq<span class="op">$</span>p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.001</span>)</a></code></pre></div>
</div>

<p><strong>Exercice 4.2</strong></p>
<p>Pour rappel, on peut simuler un tirage au sort de type “pile ou face” avec la fonction <code>sample()</code> de la manière suivante :</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1032-1" title="1"><span class="kw">sample</span>(</a>
<a class="sourceLine" id="cb1032-2" title="2">    <span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>),</a>
<a class="sourceLine" id="cb1032-3" title="3">    <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1032-4" title="4">    <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1032-5" title="5">    <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1032-6" title="6">)</a>
<a class="sourceLine" id="cb1032-7" title="7"><span class="co">#&gt;  [1] &quot;face&quot; &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot; &quot;face&quot; &quot;pile&quot;</span></a></code></pre></div>
<p>Le tableau de données suivant définit trois types de tirages aléatoires différents. <code>elements</code> contient les éléments parmi lesquels on tire, <code>probas</code> les probabilités de chaque élément d’être tiré, et <code>n</code> le nombre de tirages.</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1033-1" title="1">tirages &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1033-2" title="2">    <span class="dt">elements =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1033-3" title="3">        <span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>),</a>
<a class="sourceLine" id="cb1033-4" title="4">        <span class="kw">c</span>(<span class="st">&quot;boule rouge&quot;</span>, <span class="st">&quot;boule noire&quot;</span>),</a>
<a class="sourceLine" id="cb1033-5" title="5">        <span class="dv">1</span><span class="op">:</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb1033-6" title="6">    ),</a>
<a class="sourceLine" id="cb1033-7" title="7">    <span class="dt">probas =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1033-8" title="8">        <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb1033-9" title="9">        <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>),</a>
<a class="sourceLine" id="cb1033-10" title="10">        <span class="kw">rep</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">6</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb1033-11" title="11">    ),</a>
<a class="sourceLine" id="cb1033-12" title="12">    <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">500</span>, <span class="dv">800</span>)</a>
<a class="sourceLine" id="cb1033-13" title="13">)</a></code></pre></div>
<p>Créer une liste contenant les résultats de ces trois séries de tirages.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1034-1" title="1">resultats &lt;-<span class="st"> </span>tirages <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1034-2" title="2"><span class="st">    </span><span class="kw">pmap</span>(</a>
<a class="sourceLine" id="cb1034-3" title="3">        <span class="cf">function</span>(elements, probas, n) {</a>
<a class="sourceLine" id="cb1034-4" title="4">            <span class="kw">sample</span>(elements, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> probas)</a>
<a class="sourceLine" id="cb1034-5" title="5">        }</a>
<a class="sourceLine" id="cb1034-6" title="6">    )</a></code></pre></div>
</div>

<p>Représenter avec <code>barplot()</code> les résultats obtenus.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1035-1" title="1">resultats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(<span class="op">~</span><span class="kw">barplot</span>(<span class="kw">table</span>(.x)))</a></code></pre></div>
</div>

</div>
<div id="répéter-une-opération-1" class="section level3">
<h3><span class="header-section-number">17.12.5</span> Répéter une opération</h3>
<p><strong>Exercice 5.1</strong></p>
<p>Comme vu précédemment, la fonction suivante permet de simuler 20 lancers de pièces et de stocker le résultat dans un vecteur de chaînes de caractères.</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1036-1" title="1"><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>), <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1036-2" title="2"><span class="co">#&gt;  [1] &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;pile&quot;</span></a>
<a class="sourceLine" id="cb1036-3" title="3"><span class="co">#&gt; [11] &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;pile&quot; &quot;face&quot; &quot;pile&quot; &quot;face&quot; &quot;pile&quot; &quot;pile&quot; &quot;face&quot;</span></a></code></pre></div>
<p>À l’aide de <code>map</code> et de cette fonction, créer une liste contenant le résultat de 100 simulations de 20 lancers.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1037-1" title="1">sims &lt;-<span class="st"> </span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb1037-2" title="2">    <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb1037-3" title="3">    <span class="op">~</span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>), <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1037-4" title="4">)</a></code></pre></div>
</div>

<p>Toujours à l’aide de <code>map</code>, calculer le nombre de “pile” obtenus pour chaque simulation.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1038-1" title="1">piles &lt;-<span class="st"> </span>sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x <span class="op">==</span><span class="st"> &quot;pile&quot;</span>))</a></code></pre></div>
</div>

<p>Déterminer le nombre minimal et le nombre maximal de “pile” obtenus parmi toutes les simulations.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1039-1" title="1"><span class="kw">range</span>(piles)</a></code></pre></div>
</div>

<p>À l’aide de la fonction <a href="https://purrr.tidyverse.org/reference/head_while.html">head_while()</a>, déterminer pour chaque simulation le nombre de “pile” consécutifs obtenus avant le premier “face”.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1040-1" title="1">egal_pile &lt;-<span class="st"> </span><span class="cf">function</span>(v) { v <span class="op">==</span><span class="st"> &quot;pile&quot;</span>}</a>
<a class="sourceLine" id="cb1040-2" title="2">sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(</a>
<a class="sourceLine" id="cb1040-3" title="3">    <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">head_while</span>(.x, egal_pile))</a>
<a class="sourceLine" id="cb1040-4" title="4">)</a>
<a class="sourceLine" id="cb1040-5" title="5"><span class="co"># En abrégé, moins lisible</span></a>
<a class="sourceLine" id="cb1040-6" title="6">sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_int</span>(</a>
<a class="sourceLine" id="cb1040-7" title="7">    <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">head_while</span>(.x, <span class="op">~</span><span class="st"> </span>.x <span class="op">==</span><span class="st"> &quot;pile&quot;</span>))</a>
<a class="sourceLine" id="cb1040-8" title="8">)</a></code></pre></div>
</div>

<p><em>Facultatif :</em> la fonction <code>rle()</code> permet de calculer les *run length encoding d’un vecteur.</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1041-1" title="1"><span class="kw">rle</span>(<span class="kw">c</span>(<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;face&quot;</span>, <span class="st">&quot;face&quot;</span>, <span class="st">&quot;face&quot;</span>,<span class="st">&quot;pile&quot;</span>, <span class="st">&quot;pile&quot;</span>))</a>
<a class="sourceLine" id="cb1041-2" title="2"><span class="co">#&gt; Run Length Encoding</span></a>
<a class="sourceLine" id="cb1041-3" title="3"><span class="co">#&gt;   lengths: int [1:3] 1 3 2</span></a>
<a class="sourceLine" id="cb1041-4" title="4"><span class="co">#&gt;   values : chr [1:3] &quot;pile&quot; &quot;face&quot; &quot;pile&quot;</span></a></code></pre></div>
<p>À l’aide de cette fonction, calculer pour chaque simulation la longueur de la plus grande série consécutive de “pile”.</p>

<div class="solution-exo">
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1042-1" title="1">sims <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="op">~</span>{</a>
<a class="sourceLine" id="cb1042-2" title="2">    r &lt;-<span class="st"> </span><span class="kw">rle</span>(.x)</a>
<a class="sourceLine" id="cb1042-3" title="3">    longueurs_pile &lt;-<span class="st"> </span>r<span class="op">$</span>lengths[r<span class="op">$</span>values <span class="op">==</span><span class="st"> &quot;pile&quot;</span>]</a>
<a class="sourceLine" id="cb1042-4" title="4">    <span class="kw">max</span>(longueurs_pile)</a>
<a class="sourceLine" id="cb1042-5" title="5">})</a></code></pre></div>
</div>


</div>
</div>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="16-dplyr-avance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="18-programmer-tidyverse.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/juba/tidyverse/blob/master/17-purrr.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["introduction_au_tidyverse.epub", "introduction_au_tidyverse.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
